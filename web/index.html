<!DOCTYPE html>
<html lang="en" data-theme="midnight" data-font="cabinet">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>StudyBot | AI-Powered Study Manager</title>
<meta name="description" content="StudyBot â€” Your AI-powered personal study assistant. Manage tasks, track performance, and get smart study insights.">
<meta name="theme-color" content="#09090f">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“š</text></svg>">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cabinet+Grotesk:wght@400;500;700;800;900&family=Instrument+Serif:ital@0;1&family=DM+Sans:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,700;0,900;1,400&family=Unbounded:wght@400;700;900&family=Epilogue:wght@400;500;700;800&family=Architects+Daughter&family=Crimson+Pro:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js" defer></script>
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THEME SYSTEM â€” 6 themes Ã— font system
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --transition: all 0.22s cubic-bezier(0.4,0,0.2,1);
  --r:8px; --r-lg:14px; --r-xl:22px; --r-2xl:32px;
  --shadow-sm: 0 2px 12px rgba(0,0,0,0.15);
  --shadow: 0 8px 32px rgba(0,0,0,0.25);
  --shadow-lg: 0 20px 60px rgba(0,0,0,0.4);
}

/* MIDNIGHT (default dark) */
[data-theme="midnight"] {
  --bg: #09090f;
  --bg2: #0f0f1a;
  --surface: #111120;
  --surface2: #191930;
  --surface3: #1e2040;
  --border: #1e2040;
  --border2: #2a2e5a;
  --accent: #7c6fef;
  --accent-hov: #9b90f5;
  --accent2: #2dc7b0;
  --accent3: #f4698c;
  --accent4: #ffb86c;
  --accent5: #69f0ae;
  --text: #e8eaf6;
  --text2: #8890b5;
  --text3: #454d70;
  --glow: 0 0 28px rgba(124,111,239,0.22);
  --glow2: 0 0 28px rgba(45,199,176,0.18);
  --grad-hero: linear-gradient(135deg, #7c6fef22, #2dc7b011);
}

/* AURORA (green/teal dark) */
[data-theme="aurora"] {
  --bg: #050c0a;
  --bg2: #071410;
  --surface: #0a1c16;
  --surface2: #0f2a20;
  --surface3: #163828;
  --border: #1a3828;
  --border2: #245040;
  --accent: #39d98a;
  --accent-hov: #5ee8a2;
  --accent2: #38bdf8;
  --accent3: #fb7185;
  --accent4: #fbbf24;
  --accent5: #a78bfa;
  --text: #d4f5e5;
  --text2: #6ba888;
  --text3: #2d5040;
  --glow: 0 0 28px rgba(57,217,138,0.22);
  --glow2: 0 0 28px rgba(56,189,248,0.18);
  --grad-hero: linear-gradient(135deg, #39d98a22, #38bdf811);
}

/* SOLAR (warm amber dark) */
[data-theme="solar"] {
  --bg: #0d0a04;
  --bg2: #150e06;
  --surface: #1c1208;
  --surface2: #251808;
  --surface3: #30200c;
  --border: #302010;
  --border2: #4a3018;
  --accent: #f59e0b;
  --accent-hov: #fbbf24;
  --accent2: #ef4444;
  --accent3: #ec4899;
  --accent4: #84cc16;
  --accent5: #06b6d4;
  --text: #fef3c7;
  --text2: #a87c40;
  --text3: #5c3a18;
  --glow: 0 0 28px rgba(245,158,11,0.25);
  --glow2: 0 0 28px rgba(239,68,68,0.18);
  --grad-hero: linear-gradient(135deg, #f59e0b22, #ef444411);
}

/* PAPER (clean light) */
[data-theme="paper"] {
  --bg: #f7f5f0;
  --bg2: #eeeae0;
  --surface: #ffffff;
  --surface2: #f5f2eb;
  --surface3: #ece8de;
  --border: #ddd8cc;
  --border2: #c8c2b4;
  --accent: #1a1a2e;
  --accent-hov: #2d2d4e;
  --accent2: #0f6eb4;
  --accent3: #c0392b;
  --accent4: #d4830a;
  --accent5: #16a085;
  --text: #1a1a1a;
  --text2: #6b6050;
  --text3: #a09880;
  --glow: 0 4px 20px rgba(26,26,46,0.12);
  --glow2: 0 4px 20px rgba(15,110,180,0.1);
  --grad-hero: linear-gradient(135deg, #1a1a2e08, #0f6eb408);
  --shadow: 0 2px 16px rgba(0,0,0,0.08);
  --shadow-lg: 0 8px 40px rgba(0,0,0,0.12);
}

/* ROSE (pink pastel light) */
[data-theme="rose"] {
  --bg: #fff5f7;
  --bg2: #ffe8ec;
  --surface: #ffffff;
  --surface2: #fff0f3;
  --surface3: #ffe4e9;
  --border: #f8d0d8;
  --border2: #f0b8c4;
  --accent: #e11d6a;
  --accent-hov: #f43f8a;
  --accent2: #7c3aed;
  --accent3: #0891b2;
  --accent4: #d97706;
  --accent5: #059669;
  --text: #1a0a10;
  --text2: #8a4060;
  --text3: #c090a8;
  --glow: 0 4px 20px rgba(225,29,106,0.18);
  --glow2: 0 4px 20px rgba(124,58,237,0.12);
  --grad-hero: linear-gradient(135deg, #e11d6a15, #7c3aed0a);
  --shadow: 0 2px 16px rgba(0,0,0,0.06);
  --shadow-lg: 0 8px 40px rgba(0,0,0,0.1);
}

/* SLATE (neutral pro) */
[data-theme="slate"] {
  --bg: #0c0e12;
  --bg2: #111318;
  --surface: #161820;
  --surface2: #1e2130;
  --surface3: #262b3e;
  --border: #242838;
  --border2: #30364e;
  --accent: #60a5fa;
  --accent-hov: #93c5fd;
  --accent2: #34d399;
  --accent3: #f87171;
  --accent4: #fcd34d;
  --accent5: #c084fc;
  --text: #e2e8f5;
  --text2: #7080a8;
  --text3: #3a4260;
  --glow: 0 0 28px rgba(96,165,250,0.2);
  --glow2: 0 0 28px rgba(52,211,153,0.16);
  --grad-hero: linear-gradient(135deg, #60a5fa18, #34d39910);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FONT SYSTEM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
[data-font="cabinet"] {
  --font: 'Cabinet Grotesk', sans-serif;
  --font-display: 'Cabinet Grotesk', sans-serif;
  --font-serif: 'Instrument Serif', serif;
  --font-mono: 'DM Sans', sans-serif;
}
[data-font="playfair"] {
  --font: 'DM Sans', sans-serif;
  --font-display: 'Playfair Display', serif;
  --font-serif: 'Playfair Display', serif;
  --font-mono: 'DM Sans', sans-serif;
}
[data-font="unbounded"] {
  --font: 'Unbounded', sans-serif;
  --font-display: 'Unbounded', sans-serif;
  --font-serif: 'Unbounded', sans-serif;
  --font-mono: 'Unbounded', sans-serif;
}
[data-font="epilogue"] {
  --font: 'Epilogue', sans-serif;
  --font-display: 'Epilogue', sans-serif;
  --font-serif: 'Crimson Pro', serif;
  --font-mono: 'Epilogue', sans-serif;
}
[data-font="handwritten"] {
  --font: 'DM Sans', sans-serif;
  --font-display: 'Architects Daughter', cursive;
  --font-serif: 'Architects Daughter', cursive;
  --font-mono: 'Architects Daughter', cursive;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;font-size:15px;}
body{background:var(--bg);color:var(--text);font-family:var(--font);line-height:1.6;min-height:100vh;overflow-x:hidden;transition:background 0.3s,color 0.3s;}

/* Ambient background glow */
body::after{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background:radial-gradient(ellipse 80% 50% at 80% 0%, color-mix(in srgb, var(--accent) 7%, transparent) 0%, transparent 55%),
    radial-gradient(ellipse 60% 50% at 10% 100%, color-mix(in srgb, var(--accent2) 5%, transparent) 0%, transparent 55%);}
[data-theme="paper"] body::after,[data-theme="rose"] body::after{display:none;}

::-webkit-scrollbar{width:4px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}
:focus-visible{outline:2px solid var(--accent);outline-offset:2px;border-radius:4px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LANDING PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#landingPage{position:relative;z-index:1;}

.lp-nav{position:fixed;top:0;left:0;right:0;z-index:90;padding:0 48px;height:66px;display:flex;align-items:center;justify-content:space-between;backdrop-filter:blur(20px);background:color-mix(in srgb, var(--bg) 85%, transparent);border-bottom:1px solid var(--border);transition:var(--transition);}
.lp-logo{font-family:var(--font-display);font-size:1.4rem;font-weight:900;letter-spacing:-0.5px;display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--text);}
.logo-pulse{width:9px;height:9px;border-radius:50%;background:var(--accent);box-shadow:0 0 12px var(--accent);animation:pulse 2.2s ease-in-out infinite;}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1);}50%{opacity:0.45;transform:scale(0.65);}}
.lp-logo span{color:var(--accent);}
.nav-right{display:flex;align-items:center;gap:8px;}
.nav-link{padding:8px 14px;border-radius:var(--r);color:var(--text2);font-size:0.875rem;font-weight:600;cursor:pointer;border:none;background:none;font-family:var(--font);transition:var(--transition);text-decoration:none;}
.nav-link:hover{color:var(--text);background:var(--surface2);}
.nav-cta{padding:9px 22px;border-radius:var(--r);background:var(--accent);color:#fff;font-weight:800;font-size:0.875rem;cursor:pointer;border:none;font-family:var(--font);transition:var(--transition);}
[data-theme="paper"] .nav-cta,[data-theme="rose"] .nav-cta{color:var(--bg);}
.nav-cta:hover{transform:translateY(-1px);box-shadow:var(--glow);}
.theme-btn{width:34px;height:34px;border-radius:var(--r);background:var(--surface2);border:1px solid var(--border2);color:var(--text2);font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--transition);}
.theme-btn:hover{border-color:var(--accent);color:var(--accent);}

/* HERO */
.hero{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:110px 24px 80px;position:relative;text-align:center;}
.hero-inner{max-width:860px;}
.hero-pill{display:inline-flex;align-items:center;gap:8px;padding:6px 18px;border-radius:100px;border:1px solid color-mix(in srgb, var(--accent) 30%, transparent);background:color-mix(in srgb, var(--accent) 8%, transparent);color:var(--accent);font-size:0.78rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:28px;animation:fadeUp 0.7s ease both;}
@keyframes fadeUp{from{opacity:0;transform:translateY(18px);}to{opacity:1;transform:translateY(0);}}
.hero-h1{font-family:var(--font-display);font-size:clamp(2.8rem,7vw,5.8rem);font-weight:900;line-height:1.05;letter-spacing:-2px;margin-bottom:22px;animation:fadeUp 0.7s 0.1s ease both;}
.hero-h1 em{color:var(--accent);font-style:italic;font-family:var(--font-serif);}
.hero-sub{font-size:1.1rem;color:var(--text2);max-width:540px;margin:0 auto 44px;line-height:1.8;animation:fadeUp 0.7s 0.2s ease both;}
.hero-actions{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;animation:fadeUp 0.7s 0.3s ease both;}
.btn-cta{padding:14px 34px;border-radius:var(--r-lg);background:var(--accent);color:#fff;font-family:var(--font-display);font-weight:800;font-size:1rem;cursor:pointer;border:none;transition:var(--transition);letter-spacing:-0.3px;}
[data-theme="paper"] .btn-cta,[data-theme="rose"] .btn-cta{color:var(--bg);}
.btn-cta:hover{transform:translateY(-2px);box-shadow:0 14px 44px color-mix(in srgb, var(--accent) 35%, transparent);}
.btn-ghost{padding:14px 34px;border-radius:var(--r-lg);background:transparent;color:var(--text);font-family:var(--font);font-weight:600;font-size:1rem;cursor:pointer;border:1.5px solid var(--border2);transition:var(--transition);}
.btn-ghost:hover{border-color:var(--accent2);color:var(--accent2);}

/* DASHBOARD PREVIEW */
.dash-preview{margin-top:72px;animation:fadeUp 0.9s 0.5s ease both;position:relative;}
.dash-preview::before{content:'';position:absolute;inset:-1px;border-radius:calc(var(--r-2xl) + 1px);background:linear-gradient(135deg, var(--accent), var(--accent2), var(--accent3));opacity:0.3;filter:blur(8px);z-index:-1;}
.preview-shell{background:var(--surface);border:1px solid var(--border2);border-radius:var(--r-2xl);overflow:hidden;box-shadow:var(--shadow-lg);max-width:900px;margin:0 auto;}
.preview-bar{background:var(--surface2);padding:13px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px;}
.pdots{display:flex;gap:6px;}
.pdot{width:11px;height:11px;border-radius:50%;}
.pdot:nth-child(1){background:#f87171;}
.pdot:nth-child(2){background:#fbbf24;}
.pdot:nth-child(3){background:#34d399;}
.purl{flex:1;background:var(--surface3);border-radius:6px;padding:5px 14px;font-size:0.75rem;color:var(--text3);max-width:260px;margin:0 auto;text-align:center;font-family:monospace;}
.preview-body{display:grid;grid-template-columns:190px 1fr;min-height:360px;}
.psidebar{background:var(--surface2);border-right:1px solid var(--border);padding:16px 12px;display:flex;flex-direction:column;gap:4px;}
.pnav{height:34px;border-radius:var(--r);display:flex;align-items:center;gap:8px;padding:0 10px;font-size:0.78rem;font-weight:600;color:var(--text3);font-family:var(--font);}
.pnav.active{background:color-mix(in srgb, var(--accent) 12%, transparent);color:var(--accent);border:1px solid color-mix(in srgb, var(--accent) 20%, transparent);}
.pnav-dot{width:6px;height:6px;border-radius:50%;background:currentColor;flex-shrink:0;}
.pmain{padding:22px;display:flex;flex-direction:column;gap:14px;}
.pgreeting{font-family:var(--font-display);font-size:1.05rem;font-weight:800;}
.pgreeting span{color:var(--accent);}
.pkpi-row{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;}
.pkpi{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:13px;display:flex;flex-direction:column;gap:5px;}
.pkpi-n{font-family:var(--font-display);font-size:1.5rem;font-weight:900;line-height:1;}
.pkpi-l{font-size:0.65rem;color:var(--text3);font-weight:700;letter-spacing:0.5px;text-transform:uppercase;}
.ptasks{display:flex;flex-direction:column;gap:7px;}
.ptask{background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:10px 12px;display:flex;align-items:center;gap:10px;font-size:0.8rem;font-weight:600;}
.ptask-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
.ptag{padding:2px 8px;border-radius:100px;font-size:0.6rem;font-weight:800;letter-spacing:0.5px;}

/* STATS BAR */
.stats-bar{background:var(--surface);border-top:1px solid var(--border);border-bottom:1px solid var(--border);padding:0;}
.stats-inner{max-width:1000px;margin:0 auto;display:grid;grid-template-columns:repeat(4,1fr);}
.sstat{padding:44px 28px;text-align:center;border-right:1px solid var(--border);}
.sstat:last-child{border-right:none;}
.sstat-n{font-family:var(--font-display);font-size:2.6rem;font-weight:900;letter-spacing:-2px;color:var(--accent);}
.sstat-l{font-size:0.82rem;color:var(--text2);margin-top:3px;}

/* FEATURES */
.section{padding:90px 28px;position:relative;z-index:1;}
.section-center{max-width:1100px;margin:0 auto;}
.sec-badge{display:inline-flex;align-items:center;gap:6px;padding:5px 15px;border-radius:100px;border:1px solid var(--border2);color:var(--text2);font-size:0.72rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;margin-bottom:18px;}
.sec-h{font-family:var(--font-display);font-size:clamp(1.8rem,4vw,3rem);font-weight:900;letter-spacing:-1px;margin-bottom:13px;line-height:1.12;}
.sec-h em{color:var(--accent);font-style:italic;font-family:var(--font-serif);}
.sec-sub{color:var(--text2);font-size:0.975rem;max-width:500px;line-height:1.75;margin-bottom:52px;}
.feat-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(290px,1fr));gap:16px;}
.feat{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-xl);padding:28px;transition:var(--transition);position:relative;overflow:hidden;}
.feat::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--accent),var(--accent2));opacity:0;transition:var(--transition);}
.feat:hover{transform:translateY(-4px);border-color:var(--border2);box-shadow:var(--shadow);}
.feat:hover::before{opacity:1;}
.feat-icon{font-size:2rem;margin-bottom:14px;display:block;}
.feat-t{font-family:var(--font-display);font-size:1.05rem;font-weight:800;margin-bottom:8px;}
.feat-d{font-size:0.875rem;color:var(--text2);line-height:1.65;}

/* HOW IT WORKS */
.steps{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:18px;}
.step{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-xl);padding:28px 24px;text-align:center;transition:var(--transition);}
.step:hover{border-color:var(--border2);transform:translateY(-3px);}
.step-n{width:46px;height:46px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-weight:900;font-size:1.1rem;color:#fff;margin:0 auto 15px;}
[data-theme="paper"] .step-n,[data-theme="rose"] .step-n{color:var(--bg);}
.step-t{font-family:var(--font-display);font-size:0.975rem;font-weight:800;margin-bottom:7px;}
.step-d{font-size:0.845rem;color:var(--text2);line-height:1.6;}

/* TESTIMONIALS */
.testi-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(290px,1fr));gap:16px;}
.testi{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-xl);padding:26px;}
.testi-stars{color:var(--accent4);font-size:0.85rem;margin-bottom:12px;letter-spacing:2px;}
.testi-q{font-family:var(--font-serif);font-style:italic;font-size:0.975rem;color:var(--text);line-height:1.7;margin-bottom:18px;}
.testi-author{display:flex;align-items:center;gap:11px;}
.testi-av{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-size:0.85rem;font-weight:900;color:#fff;flex-shrink:0;}
[data-theme="paper"] .testi-av,[data-theme="rose"] .testi-av{color:var(--bg);}
.testi-name{font-family:var(--font-display);font-weight:800;font-size:0.9rem;}
.testi-role{font-size:0.78rem;color:var(--text3);}

/* CTA */
.cta-section{padding:90px 28px;text-align:center;position:relative;z-index:1;}
.cta-box{max-width:620px;margin:0 auto;background:var(--surface);border:1px solid var(--border2);border-radius:var(--r-2xl);padding:64px 48px;position:relative;overflow:hidden;}
.cta-box::before{content:'';position:absolute;inset:0;background:var(--grad-hero);pointer-events:none;}
.cta-h{font-family:var(--font-display);font-size:2.2rem;font-weight:900;letter-spacing:-1px;margin-bottom:11px;}
.cta-h em{color:var(--accent);font-style:italic;font-family:var(--font-serif);}
.cta-sub{color:var(--text2);font-size:0.975rem;margin-bottom:32px;}

/* FOOTER */
footer{background:var(--surface);border-top:1px solid var(--border);padding:52px 48px 30px;}
.footer-grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:2fr 1fr 1fr;gap:48px;margin-bottom:40px;}
.footer-brand p{font-size:0.875rem;color:var(--text2);line-height:1.7;max-width:280px;margin-top:12px;}
.footer-head{font-size:0.7rem;font-weight:800;letter-spacing:2.5px;text-transform:uppercase;color:var(--text3);margin-bottom:16px;}
.footer-links{display:flex;flex-direction:column;gap:10px;}
.footer-links a{font-size:0.875rem;color:var(--text2);text-decoration:none;transition:color 0.15s;cursor:pointer;font-family:var(--font);}
.footer-links a:hover{color:var(--accent);}
.footer-bottom{max-width:1100px;margin:0 auto;padding-top:22px;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;font-size:0.8rem;color:var(--text3);flex-wrap:wrap;gap:8px;}

/* THEME PICKER PANEL */
.theme-picker{position:fixed;top:72px;right:16px;width:300px;background:var(--surface);border:1px solid var(--border2);border-radius:var(--r-xl);box-shadow:var(--shadow-lg);z-index:200;display:none;flex-direction:column;overflow:hidden;}
.theme-picker.open{display:flex;}
.tp-head{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;}
.tp-title{font-family:var(--font-display);font-weight:800;font-size:0.95rem;}
.tp-close{background:none;border:none;color:var(--text3);cursor:pointer;font-size:1.1rem;padding:2px;transition:color 0.15s;}
.tp-close:hover{color:var(--accent3);}
.tp-body{padding:16px;display:flex;flex-direction:column;gap:16px;}
.tp-section{font-size:0.68rem;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--text3);margin-bottom:8px;}
.theme-swatches{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.swatch{border:2px solid var(--border);border-radius:var(--r);overflow:hidden;cursor:pointer;transition:var(--transition);aspect-ratio:auto;}
.swatch.active{border-color:var(--accent);box-shadow:0 0 0 2px var(--accent);}
.swatch:hover{transform:scale(1.04);}
.sw-preview{height:40px;display:grid;grid-template-columns:1fr 2fr;}
.sw-sidebar{height:100%;}
.sw-main{height:100%;display:flex;flex-direction:column;gap:4px;padding:5px 6px;}
.sw-bar{height:5px;border-radius:2px;opacity:0.7;}
.sw-label{font-size:0.7rem;font-weight:700;padding:5px 6px;color:var(--text2);font-family:var(--font);}
.font-options{display:flex;flex-direction:column;gap:6px;}
.font-opt{padding:9px 13px;border-radius:var(--r);border:1.5px solid var(--border);background:transparent;color:var(--text2);cursor:pointer;transition:var(--transition);text-align:left;display:flex;flex-direction:column;gap:2px;}
.font-opt.active{border-color:var(--accent);color:var(--accent);background:color-mix(in srgb, var(--accent) 8%, transparent);}
.font-opt:hover:not(.active){border-color:var(--border2);color:var(--text);}
.font-opt-name{font-size:0.8rem;font-weight:700;}
.font-opt-preview{font-size:0.75rem;color:var(--text3);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#authScreen{position:fixed;inset:0;z-index:300;display:none;align-items:center;justify-content:center;background:var(--bg);padding:16px;}
.auth-card{width:100%;max-width:430px;}
.auth-logo{font-family:var(--font-display);font-size:1.8rem;font-weight:900;text-align:center;margin-bottom:4px;}
.auth-logo span{color:var(--accent);}
.auth-tag{text-align:center;color:var(--text2);font-size:0.875rem;margin-bottom:26px;}
.auth-box{background:var(--surface);border:1px solid var(--border2);border-radius:var(--r-xl);padding:32px;box-shadow:var(--shadow-lg);}
.auth-tabs{display:flex;background:var(--surface2);border-radius:var(--r);padding:4px;margin-bottom:22px;gap:4px;}
.auth-tab{flex:1;padding:9px;background:transparent;border:none;color:var(--text2);font-family:var(--font);font-size:0.875rem;font-weight:700;cursor:pointer;border-radius:6px;transition:var(--transition);}
.auth-tab.active{background:var(--accent);color:#fff;}
[data-theme="paper"] .auth-tab.active,[data-theme="rose"] .auth-tab.active{color:var(--bg);}
.auth-field{margin-bottom:14px;}
.auth-field label{display:block;font-size:0.68rem;font-weight:800;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);margin-bottom:5px;}
.auth-field input{width:100%;background:var(--surface2);border:1.5px solid var(--border2);border-radius:var(--r);padding:11px 13px;color:var(--text);font-family:var(--font);font-size:0.875rem;outline:none;transition:var(--transition);}
.auth-field input:focus{border-color:var(--accent);box-shadow:0 0 0 3px color-mix(in srgb, var(--accent) 15%, transparent);}
.auth-field input::placeholder{color:var(--text3);}
.auth-submit{width:100%;padding:13px;border-radius:var(--r);border:none;background:var(--accent);color:#fff;font-family:var(--font-display);font-size:0.925rem;font-weight:900;cursor:pointer;transition:var(--transition);margin-top:4px;letter-spacing:-0.2px;}
[data-theme="paper"] .auth-submit,[data-theme="rose"] .auth-submit{color:var(--bg);}
.auth-submit:hover{transform:translateY(-1px);box-shadow:var(--glow);}
.auth-err{color:var(--accent3);font-size:0.8rem;text-align:center;margin-top:9px;min-height:16px;font-weight:700;}
.auth-back{display:flex;align-items:center;justify-content:center;gap:5px;width:100%;padding:9px;border-radius:var(--r);border:1px solid var(--border2);background:none;color:var(--text2);font-family:var(--font);font-size:0.845rem;cursor:pointer;margin-top:14px;transition:var(--transition);}
.auth-back:hover{border-color:var(--accent2);color:var(--accent2);}
.auth-divider{text-align:center;color:var(--text3);font-size:0.75rem;margin:14px 0 10px;position:relative;}
.auth-divider::before{content:'';position:absolute;left:0;top:50%;width:100%;height:1px;background:var(--border);}
.auth-divider span{position:relative;background:var(--surface);padding:0 10px;}
.quick-users{display:flex;flex-wrap:wrap;gap:7px;justify-content:center;}
.quick-chip{display:flex;align-items:center;gap:6px;padding:6px 13px;border-radius:100px;background:var(--surface2);border:1px solid var(--border2);font-size:0.8rem;cursor:pointer;color:var(--text2);transition:var(--transition);font-family:var(--font);}
.quick-chip:hover{border-color:var(--accent);color:var(--accent);}
.q-av{width:19px;height:19px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:0.65rem;font-weight:800;color:#fff;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APP SHELL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#mainApp{display:none;position:relative;z-index:1;grid-template-columns:248px 1fr 306px;grid-template-rows:60px 1fr;height:100vh;}
#mainApp.visible{display:grid;}

header{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;padding:0 20px;border-bottom:1px solid var(--border);background:color-mix(in srgb, var(--bg) 95%, transparent);backdrop-filter:blur(16px);position:sticky;top:0;z-index:50;}
.app-logo{font-family:var(--font-display);font-size:1.2rem;font-weight:900;letter-spacing:-0.5px;display:flex;align-items:center;gap:8px;color:var(--text);}
.app-logo em{color:var(--accent);font-style:normal;}
.hdr-center{display:flex;align-items:center;gap:8px;font-size:0.78rem;color:var(--text3);font-family:monospace;}
.hdr-center strong{color:var(--accent);}
.hdr-right{display:flex;align-items:center;gap:7px;}
.hbtn{width:34px;height:34px;border-radius:var(--r);background:var(--surface2);border:1px solid var(--border2);color:var(--text2);font-size:0.95rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--transition);}
.hbtn:hover{border-color:var(--accent);color:var(--accent);}
.notif-wrap{position:relative;}
.notif-dot{position:absolute;top:-3px;right:-3px;width:15px;height:15px;border-radius:50%;background:var(--accent3);font-size:0.58rem;font-weight:800;color:#fff;display:flex;align-items:center;justify-content:center;border:2px solid var(--bg);}
.notif-dot.hidden{display:none;}
.user-chip{display:flex;align-items:center;gap:7px;padding:4px 12px 4px 4px;background:var(--surface2);border:1px solid var(--border2);border-radius:100px;cursor:pointer;transition:var(--transition);font-size:0.845rem;font-weight:700;font-family:var(--font);}
.user-chip:hover{border-color:var(--accent3);}
.u-av{width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:0.75rem;font-weight:900;color:#fff;}
.hamburger{display:none;flex-direction:column;gap:5px;background:none;border:none;cursor:pointer;padding:5px;border-radius:var(--r);}
.hamburger span{display:block;width:19px;height:2px;background:var(--text);border-radius:2px;}
.ai-pill-btn{display:none;align-items:center;gap:6px;padding:7px 13px;background:color-mix(in srgb, var(--accent) 12%, transparent);border:1px solid color-mix(in srgb, var(--accent) 28%, transparent);color:var(--accent);border-radius:var(--r);font-size:0.8rem;font-weight:800;cursor:pointer;font-family:var(--font);}

/* SIDEBAR */
.sidebar{background:var(--surface);border-right:1px solid var(--border);padding:18px 12px;overflow-y:auto;display:flex;flex-direction:column;gap:5px;}
.sb-label{font-size:0.63rem;font-weight:800;letter-spacing:2.5px;text-transform:uppercase;color:var(--text3);padding:0 10px;margin:12px 0 5px;}
.sb-label:first-child{margin-top:0;}
.sb-btn{display:flex;align-items:center;gap:10px;width:100%;padding:10px 12px;border-radius:var(--r);border:none;background:transparent;color:var(--text2);font-family:var(--font);font-size:0.875rem;font-weight:600;cursor:pointer;transition:var(--transition);text-align:left;}
.sb-btn:hover{background:var(--surface2);color:var(--text);}
.sb-btn.active{background:color-mix(in srgb, var(--accent) 12%, transparent);color:var(--accent);border:1px solid color-mix(in srgb, var(--accent) 22%, transparent);}
.sb-btn .icon{font-size:1rem;width:20px;text-align:center;}
.sb-stat{display:flex;justify-content:space-between;align-items:center;padding:6px 12px;font-size:0.8rem;color:var(--text3);}
.sb-val{font-family:var(--font-display);font-size:1.15rem;font-weight:900;color:var(--text);}
.sb-val.g{color:var(--accent);}
.sb-val.b{color:var(--accent2);}
.sb-val.r{color:var(--accent3);}
.sb-div{height:1px;background:var(--border);margin:5px 8px;}

/* MAIN */
.main{overflow-y:auto;padding:26px 28px;background:transparent;}
.page{display:none;flex-direction:column;gap:22px;animation:pageIn 0.2s ease both;}
.page.active{display:flex;}
@keyframes pageIn{from{opacity:0;transform:translateY(6px);}to{opacity:1;transform:translateY(0);}}
.pg-head{display:flex;flex-direction:column;gap:3px;}
.pg-title{font-family:var(--font-display);font-size:1.75rem;font-weight:900;letter-spacing:-0.5px;line-height:1.1;}
.pg-title em{color:var(--accent);font-style:italic;font-family:var(--font-serif);}
.pg-sub{font-size:0.845rem;color:var(--text3);}

/* â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.dash-welcome{display:flex;align-items:flex-start;justify-content:space-between;gap:16px;padding:22px 24px;background:var(--surface);border:1px solid var(--border);border-radius:var(--r-xl);position:relative;overflow:hidden;}
.dash-welcome::before{content:'';position:absolute;top:-60%;right:-20%;width:50%;height:200%;background:var(--grad-hero);pointer-events:none;border-radius:50%;}
.dw-left{position:relative;}
.dw-greeting{font-family:var(--font-display);font-size:1.5rem;font-weight:900;line-height:1.2;margin-bottom:5px;}
.dw-greeting span{color:var(--accent);}
.dw-sub{font-size:0.875rem;color:var(--text2);max-width:340px;}
.dw-badges{display:flex;gap:8px;margin-top:14px;flex-wrap:wrap;}
.dw-badge{display:flex;align-items:center;gap:5px;padding:5px 11px;border-radius:100px;background:var(--surface2);border:1px solid var(--border2);font-size:0.78rem;font-weight:700;color:var(--text2);}
.dw-badge span{color:var(--text);}
.dw-right{display:flex;flex-direction:column;align-items:center;gap:4px;flex-shrink:0;position:relative;}
.dw-ring{position:relative;width:90px;height:90px;}
.dw-ring-svg{transform:rotate(-90deg);}
.dw-ring-track{fill:none;stroke:var(--surface3);stroke-width:7;}
.dw-ring-fill{fill:none;stroke:var(--accent);stroke-width:7;stroke-linecap:round;stroke-dasharray:226;transition:stroke-dashoffset 1.2s cubic-bezier(.4,0,.2,1);}
.dw-ring-text{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;}
.dw-ring-pct{font-family:var(--font-display);font-size:1.35rem;font-weight:900;line-height:1;color:var(--accent);}
.dw-ring-label{font-size:0.6rem;color:var(--text3);font-weight:700;letter-spacing:0.5px;text-transform:uppercase;}

.kpi-row{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:11px;}
.kpi{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-lg);padding:17px 15px;display:flex;flex-direction:column;gap:7px;transition:var(--transition);cursor:default;}
.kpi:hover{transform:translateY(-2px);border-color:var(--border2);box-shadow:var(--shadow);}
.kpi-ico{font-size:1.2rem;}
.kpi-v{font-family:var(--font-display);font-size:1.9rem;font-weight:900;line-height:1;}
.kpi-v.g{color:var(--accent);}
.kpi-v.b{color:var(--accent2);}
.kpi-v.p{color:var(--accent3);}
.kpi-v.o{color:var(--accent4);}
.kpi-l{font-size:0.68rem;color:var(--text3);font-weight:700;letter-spacing:0.5px;text-transform:uppercase;}

.dash-grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.panel{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-lg);padding:20px;}
.panel-title{font-size:0.68rem;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--text3);margin-bottom:16px;display:flex;align-items:center;gap:6px;}
.panel-title span{font-size:0.9rem;}
.chart-wrap{position:relative;height:170px;}

.streak-days{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;margin-bottom:12px;}
.s-day{aspect-ratio:1;border-radius:6px;background:var(--surface2);border:1px solid var(--border);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;}
.s-day .s-lbl{font-size:0.52rem;color:var(--text3);font-weight:800;letter-spacing:0.5px;}
.s-day .s-dot{width:6px;height:6px;border-radius:50%;background:var(--border);}
.s-day.active .s-dot{background:var(--accent);box-shadow:0 0 6px var(--accent);}
.s-day.active .s-lbl{color:var(--accent);}
.s-day.today{border-color:var(--accent2);}
.streak-score{display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--surface2);border-radius:var(--r);}
.streak-fire{font-size:1.5rem;}
.streak-num{font-family:var(--font-display);font-size:1.5rem;font-weight:900;color:var(--accent4);}
.streak-txt{font-size:0.75rem;color:var(--text3);}

.recent-list{display:flex;flex-direction:column;gap:6px;}
.recent-item{display:flex;align-items:center;gap:9px;padding:9px 11px;background:var(--surface2);border-radius:var(--r);border:1px solid transparent;transition:var(--transition);}
.recent-item:hover{border-color:var(--border2);}
.recent-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
.recent-title{flex:1;font-size:0.875rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}

/* TASKS */
.toolbar{display:flex;align-items:center;gap:7px;flex-wrap:wrap;}
.fchip{padding:6px 13px;border-radius:100px;border:1px solid var(--border2);background:transparent;color:var(--text3);font-family:var(--font);font-size:0.8rem;font-weight:700;cursor:pointer;transition:var(--transition);}
.fchip:hover{border-color:var(--accent);color:var(--accent);}
.fchip.active{background:var(--accent);color:#fff;border-color:var(--accent);}
[data-theme="paper"] .fchip.active,[data-theme="rose"] .fchip.active{color:var(--bg);}
.search-inp{flex:1;min-width:140px;max-width:270px;padding:8px 14px;border-radius:100px;border:1.5px solid var(--border2);background:var(--surface2);color:var(--text);font-family:var(--font);font-size:0.875rem;outline:none;transition:var(--transition);}
.search-inp:focus{border-color:var(--accent);box-shadow:0 0 0 3px color-mix(in srgb, var(--accent) 12%, transparent);}
.search-inp::placeholder{color:var(--text3);}

.task-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(265px,1fr));gap:12px;}
.task-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-lg);padding:16px 17px;transition:var(--transition);position:relative;overflow:hidden;}
.task-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;}
.task-card.priority-high::before{background:var(--accent3);}
.task-card.priority-medium::before{background:var(--accent4);}
.task-card.priority-low::before{background:var(--accent2);opacity:0.5;}
.task-card:hover{border-color:var(--border2);transform:translateY(-2px);box-shadow:var(--shadow);}
.tc-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px;gap:7px;}
.tc-title{font-family:var(--font-display);font-size:0.975rem;font-weight:800;line-height:1.3;flex:1;}
.task-card.completed .tc-title{text-decoration:line-through;color:var(--text3);}
.tc-actions{display:flex;gap:3px;flex-shrink:0;opacity:0;transition:opacity 0.15s;}
.task-card:hover .tc-actions,.task-card:focus-within .tc-actions{opacity:1;}
@media(hover:none){.tc-actions{opacity:1!important;}}
.icobtn{width:27px;height:27px;border-radius:7px;border:none;background:var(--surface2);color:var(--text3);font-size:0.78rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--transition);}
.icobtn:hover{background:var(--surface3);color:var(--text);}
.icobtn.del:hover{background:color-mix(in srgb, var(--accent3) 15%, transparent);color:var(--accent3);}
.icobtn.ai-b:hover{background:color-mix(in srgb, var(--accent) 12%, transparent);color:var(--accent);}
.tc-desc{font-size:0.8rem;color:var(--text3);margin-top:4px;line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;}
.tc-meta{display:flex;gap:5px;flex-wrap:wrap;margin-top:8px;}
.badge{padding:2px 7px;border-radius:100px;font-size:0.67rem;font-weight:800;border:1px solid;letter-spacing:0.2px;}
.badge-subject{background:color-mix(in srgb, var(--accent2) 10%, transparent);color:var(--accent2);border-color:color-mix(in srgb, var(--accent2) 22%, transparent);}
.badge-high{background:color-mix(in srgb, var(--accent3) 10%, transparent);color:var(--accent3);border-color:color-mix(in srgb, var(--accent3) 22%, transparent);}
.badge-medium{background:color-mix(in srgb, var(--accent4) 10%, transparent);color:var(--accent4);border-color:color-mix(in srgb, var(--accent4) 22%, transparent);}
.badge-low{background:var(--surface2);color:var(--text3);border-color:var(--border2);}
.badge-pending{background:color-mix(in srgb, var(--accent4) 10%, transparent);color:var(--accent4);border-color:color-mix(in srgb, var(--accent4) 22%, transparent);}
.badge-in-progress{background:color-mix(in srgb, var(--accent2) 10%, transparent);color:var(--accent2);border-color:color-mix(in srgb, var(--accent2) 22%, transparent);}
.badge-completed{background:color-mix(in srgb, var(--accent) 10%, transparent);color:var(--accent);border-color:color-mix(in srgb, var(--accent) 22%, transparent);}
.tc-due{font-size:0.78rem;color:var(--text3);margin-top:6px;display:flex;align-items:center;gap:4px;}
.tc-due.overdue{color:var(--accent3);font-weight:700;}
.subtasks-list{margin-top:10px;padding-top:10px;border-top:1px solid var(--border);display:flex;flex-direction:column;gap:4px;}
.sub-item{display:flex;align-items:center;gap:7px;font-size:0.78rem;color:var(--text3);cursor:pointer;padding:2px 0;transition:color 0.15s;}
.sub-item:hover{color:var(--text);}
.sub-chk{width:13px;height:13px;border-radius:3px;border:1.5px solid var(--border2);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:0.58rem;transition:all 0.15s;}
.sub-item.done .sub-chk{background:var(--accent);border-color:var(--accent);color:#fff;}
.sub-item.done span{text-decoration:line-through;}
.empty-state{grid-column:1/-1;text-align:center;padding:56px 20px;color:var(--text3);}
.empty-state .big{font-size:2.8rem;margin-bottom:11px;}
.empty-state p{font-family:var(--font-serif);font-style:italic;font-size:1.05rem;color:var(--text2);}

/* ADD FORM */
.add-form{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-lg);padding:26px;display:flex;flex-direction:column;gap:15px;}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:13px;}
.form-group{display:flex;flex-direction:column;gap:5px;}
.form-group.full{grid-column:1/-1;}
label{font-size:0.67rem;font-weight:800;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);}
input[type="text"],input[type="date"],input[type="email"],input[type="password"],textarea,select{background:var(--surface2);border:1.5px solid var(--border2);border-radius:var(--r);padding:10px 13px;color:var(--text);font-family:var(--font);font-size:0.875rem;outline:none;transition:var(--transition);width:100%;}
input:focus,textarea:focus,select:focus{border-color:var(--accent);box-shadow:0 0 0 3px color-mix(in srgb, var(--accent) 12%, transparent);}
input::placeholder,textarea::placeholder{color:var(--text3);}
textarea{resize:vertical;min-height:80px;}
select option{background:var(--surface2);}
.btn{padding:10px 18px;border-radius:var(--r);border:none;font-family:var(--font);font-size:0.875rem;font-weight:800;cursor:pointer;transition:var(--transition);display:inline-flex;align-items:center;gap:5px;}
.btn-primary{background:var(--accent);color:#fff;}
[data-theme="paper"] .btn-primary,[data-theme="rose"] .btn-primary{color:var(--bg);}
.btn-primary:hover{transform:translateY(-1px);box-shadow:var(--glow);}
.btn-secondary{background:var(--surface2);color:var(--text);border:1.5px solid var(--border2);}
.btn-secondary:hover{border-color:var(--accent2);color:var(--accent2);}
.btn-ai{background:color-mix(in srgb, var(--accent) 10%, transparent);color:var(--accent);border:1.5px solid color-mix(in srgb, var(--accent) 25%, transparent);}
.btn-ai:hover{background:color-mix(in srgb, var(--accent) 18%, transparent);}
.form-actions{display:flex;gap:7px;justify-content:flex-end;flex-wrap:wrap;}

/* PERFORMANCE */
.perf-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(185px,1fr));gap:12px;}
.perf-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-lg);padding:18px;display:flex;flex-direction:column;gap:5px;}
.pc-title{font-size:0.67rem;font-weight:800;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);}
.pc-val{font-family:var(--font-display);font-size:2rem;font-weight:900;}
.pc-desc{font-size:0.8rem;color:var(--text3);}
.perf-item{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.perf-label{font-size:0.78rem;color:var(--text2);width:78px;flex-shrink:0;}
.perf-bar-wrap{flex:1;height:6px;background:var(--surface2);border-radius:3px;overflow:hidden;}
.perf-bar{height:100%;border-radius:3px;transition:width 1.1s cubic-bezier(.4,0,.2,1);}
.perf-pct{font-size:0.78rem;color:var(--text2);width:28px;text-align:right;font-weight:700;}
.heatmap{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;}
.heat-cell{aspect-ratio:1;border-radius:3px;background:var(--surface2);}
.heat-cell.l1{background:color-mix(in srgb, var(--accent) 25%, transparent);}
.heat-cell.l2{background:color-mix(in srgb, var(--accent) 50%, transparent);}
.heat-cell.l3{background:color-mix(in srgb, var(--accent) 75%, transparent);}
.heat-cell.l4{background:var(--accent);}

/* TIMELINE */
.timeline{display:flex;flex-direction:column;gap:10px;}
.tl-item{display:flex;gap:14px;align-items:flex-start;padding:14px 17px;background:var(--surface);border:1px solid var(--border);border-radius:var(--r-lg);transition:var(--transition);}
.tl-item:hover{border-color:var(--border2);transform:translateX(3px);}
.tl-date{text-align:center;min-width:40px;flex-shrink:0;}
.tl-day{font-family:var(--font-display);font-size:1.45rem;font-weight:900;line-height:1;color:var(--accent2);}
.tl-month{font-size:0.62rem;color:var(--text3);letter-spacing:1px;text-transform:uppercase;margin-top:1px;}
.tl-content{flex:1;}
.tl-title{font-family:var(--font-display);font-size:0.975rem;font-weight:800;margin-bottom:5px;}

/* AI PANEL */
.ai-panel{background:var(--surface);border-left:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;}
.ai-head{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px;}
.ai-av{width:32px;height:32px;border-radius:9px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0;box-shadow:var(--glow);}
.ai-name{font-family:var(--font-display);font-weight:900;font-size:0.9rem;}
.ai-status{font-size:0.68rem;color:var(--accent);display:flex;align-items:center;gap:4px;}
.ai-status::before{content:'';width:5px;height:5px;border-radius:50%;background:var(--accent);display:inline-block;animation:pulse 2s infinite;}
.ai-close{display:none;background:none;border:none;color:var(--text3);font-size:1.1rem;cursor:pointer;padding:4px;border-radius:5px;transition:var(--transition);margin-left:auto;}
.ai-close:hover{color:var(--accent3);}
.ai-msgs{flex:1;overflow-y:auto;padding:14px;display:flex;flex-direction:column;gap:10px;}
.msg{display:flex;gap:7px;animation:msgIn 0.22s ease both;}
@keyframes msgIn{from{opacity:0;transform:translateY(5px);}to{opacity:1;transform:translateY(0);}}
.msg.user{flex-direction:row-reverse;}
.msg-bub{max-width:88%;padding:9px 13px;border-radius:12px;font-size:0.875rem;line-height:1.55;}
.msg.ai .msg-bub{background:var(--surface2);border:1px solid var(--border2);border-bottom-left-radius:3px;}
.msg.user .msg-bub{background:color-mix(in srgb, var(--accent) 12%, transparent);border:1px solid color-mix(in srgb, var(--accent) 22%, transparent);border-bottom-right-radius:3px;}
.msg-mav{width:24px;height:24px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:0.8rem;flex-shrink:0;align-self:flex-end;}
.msg.ai .msg-mav{background:linear-gradient(135deg,var(--accent),var(--accent2));}
.msg.user .msg-mav{background:var(--surface2);border:1px solid var(--border2);}
.q-chips{padding:8px 14px;display:flex;gap:5px;flex-wrap:wrap;border-top:1px solid var(--border);}
.q-chip{padding:5px 10px;border-radius:100px;border:1px solid var(--border2);background:transparent;color:var(--text3);font-family:var(--font);font-size:0.7rem;font-weight:700;cursor:pointer;transition:var(--transition);}
.q-chip:hover{border-color:var(--accent);color:var(--accent);}
.ai-input-row{padding:10px 13px;display:flex;gap:6px;border-top:1px solid var(--border);}
.ai-inp{flex:1;background:var(--surface2);border:1.5px solid var(--border2);border-radius:var(--r);padding:9px 13px;color:var(--text);font-family:var(--font);font-size:0.875rem;outline:none;transition:var(--transition);}
.ai-inp:focus{border-color:var(--accent);box-shadow:0 0 0 3px color-mix(in srgb, var(--accent) 12%, transparent);}
.send-btn{width:36px;height:36px;border-radius:8px;border:none;background:var(--accent);color:#fff;font-size:0.9rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--transition);flex-shrink:0;}
[data-theme="paper"] .send-btn,[data-theme="rose"] .send-btn{color:var(--bg);}
.send-btn:hover{transform:scale(1.06);}
.send-btn:disabled{background:var(--surface2);color:var(--text3);cursor:default;transform:none;}
.typing-row{display:flex;gap:4px;padding:8px 12px;}
.t-dot{width:6px;height:6px;border-radius:50%;background:var(--text3);animation:tdot 1.2s ease-in-out infinite;}
.t-dot:nth-child(2){animation-delay:.15s;}.t-dot:nth-child(3){animation-delay:.3s;}
@keyframes tdot{0%,80%,100%{opacity:0.3;transform:scale(0.8);}40%{opacity:1;transform:scale(1.2);}}

/* NOTIF PANEL */
.notif-panel{position:fixed;top:66px;right:14px;width:325px;background:var(--surface);border:1px solid var(--border2);border-radius:var(--r-xl);box-shadow:var(--shadow-lg);z-index:100;display:none;flex-direction:column;overflow:hidden;max-height:460px;}
.notif-panel.open{display:flex;}
.notif-head{padding:12px 15px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;}
.notif-head-title{font-family:var(--font-display);font-weight:900;font-size:0.9rem;}
.notif-clear{background:none;border:none;color:var(--text3);font-size:0.8rem;cursor:pointer;padding:3px 7px;border-radius:5px;transition:var(--transition);font-family:var(--font);}
.notif-clear:hover{color:var(--accent3);}
.notif-list{overflow-y:auto;flex:1;}
.notif-item{padding:11px 15px;border-bottom:1px solid var(--border);display:flex;gap:9px;align-items:flex-start;transition:background 0.15s;cursor:pointer;}
.notif-item:hover{background:var(--surface2);}
.notif-item.unread{border-left:3px solid var(--accent4);}
.notif-ico{font-size:1.05rem;flex-shrink:0;margin-top:1px;}
.notif-txt{font-size:0.845rem;font-weight:600;line-height:1.4;}
.notif-time{font-size:0.68rem;color:var(--text3);margin-top:2px;}
.notif-empty{padding:26px;text-align:center;color:var(--text3);font-size:0.875rem;}

/* MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.78);backdrop-filter:blur(6px);z-index:200;display:none;align-items:center;justify-content:center;padding:16px;}
.modal-overlay.open{display:flex;}
.modal{background:var(--surface);border:1px solid var(--border2);border-radius:var(--r-xl);padding:26px;width:100%;max-width:500px;box-shadow:var(--shadow-lg);max-height:90vh;overflow-y:auto;}
.modal-title{font-family:var(--font-display);font-size:1.2rem;font-weight:900;margin-bottom:17px;display:flex;align-items:center;gap:7px;}

/* TOAST */
.toast-container{position:fixed;bottom:16px;right:16px;z-index:500;display:flex;flex-direction:column;gap:6px;}
.toast{padding:10px 15px;border-radius:var(--r);border:1px solid var(--border2);background:var(--surface2);font-size:0.875rem;font-weight:700;animation:toastIn .22s ease both;max-width:265px;box-shadow:var(--shadow);font-family:var(--font);}
@keyframes toastIn{from{opacity:0;transform:translateX(14px);}to{opacity:1;transform:translateX(0);}}
.toast.success{border-color:color-mix(in srgb, var(--accent) 40%, transparent);color:var(--accent);}
.toast.error{border-color:color-mix(in srgb, var(--accent3) 40%, transparent);color:var(--accent3);}
.toast.info{border-color:color-mix(in srgb, var(--accent2) 35%, transparent);color:var(--accent2);}
.toast.warn{border-color:color-mix(in srgb, var(--accent4) 40%, transparent);color:var(--accent4);}

/* BOTTOM NAV */
.bottom-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:color-mix(in srgb, var(--bg) 96%, transparent);backdrop-filter:blur(16px);border-top:1px solid var(--border);z-index:40;padding:8px 4px calc(8px + env(safe-area-inset-bottom));justify-content:space-around;align-items:center;}
.bn-btn{display:flex;flex-direction:column;align-items:center;gap:3px;background:none;border:none;color:var(--text3);font-family:var(--font);font-size:0.62rem;font-weight:700;cursor:pointer;padding:5px 8px;border-radius:var(--r);transition:var(--transition);min-width:48px;}
.bn-btn .bni{font-size:1.15rem;}
.bn-btn.active{color:var(--accent);}
.drawer-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:55;backdrop-filter:blur(2px);}
.drawer-overlay.open{display:block;}

/* RESPONSIVE */
@media(max-width:1199px){
  #mainApp{grid-template-columns:228px 1fr;}
  .ai-panel{position:fixed;top:0;right:-100%;width:min(330px,88vw);height:100%;z-index:60;transition:right 0.3s ease;box-shadow:-12px 0 40px rgba(0,0,0,0.6);}
  .ai-panel.open{right:0;}
  .ai-close{display:block;}
  .ai-pill-btn{display:flex;}
  .hdr-center{display:none;}
  .dash-grid2{grid-template-columns:1fr;}
}
@media(max-width:767px){
  #mainApp{grid-template-columns:1fr;grid-template-rows:60px 1fr;}
  .sidebar{position:fixed;top:0;left:-100%;width:255px;height:100%;z-index:60;transition:left 0.3s ease;padding-top:70px;box-shadow:12px 0 40px rgba(0,0,0,0.6);}
  .sidebar.open{left:0;}
  .hamburger{display:flex;}
  header{padding:0 13px;}
  .main{padding:15px 13px 80px;}
  .bottom-nav{display:flex;}
  .task-grid{grid-template-columns:1fr;}
  .form-row{grid-template-columns:1fr;}
  .kpi-row{grid-template-columns:1fr 1fr;}
  .modal{padding:18px;}
  .form-actions{justify-content:stretch;}
  .form-actions .btn{flex:1;justify-content:center;}
  .toast-container{bottom:70px;right:10px;left:10px;}
  .toast{max-width:100%;}
  .notif-panel{right:10px;left:10px;width:auto;}
  .dash-grid2{grid-template-columns:1fr;}
  .dash-welcome{flex-direction:column;}
  .dw-right{flex-direction:row;align-items:center;}
  .lp-nav{padding:0 18px;}
  .lp-nav .nav-link{display:none;}
  .footer-grid{grid-template-columns:1fr;}
  .stats-inner{grid-template-columns:1fr 1fr;}
  .sstat{border-right:none;border-bottom:1px solid var(--border);}
  .cta-box{padding:38px 22px;}
  .pkpi-row{grid-template-columns:1fr 1fr;}
  .preview-body{grid-template-columns:1fr;}
  .psidebar{display:none;}
  .theme-picker{right:10px;left:10px;width:auto;}
}
@media(min-width:1400px){
  #mainApp{grid-template-columns:262px 1fr 326px;}
  .main{padding:28px 34px;}
  .kpi-row{grid-template-columns:repeat(6,1fr);}
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  THEME PICKER PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="theme-picker" id="themePicker">
  <div class="tp-head">
    <div class="tp-title">ğŸ¨ Appearance</div>
    <button class="tp-close" onclick="closeThemePicker()">âœ•</button>
  </div>
  <div class="tp-body">
    <div>
      <div class="tp-section">Themes</div>
      <div class="theme-swatches" id="themeSwatches">
        <!-- filled by JS -->
      </div>
    </div>
    <div>
      <div class="tp-section">Fonts</div>
      <div class="font-options" id="fontOptions">
        <!-- filled by JS -->
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  LANDING PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="landingPage">
  <nav class="lp-nav">
    <a class="lp-logo" href="#"><div class="logo-pulse"></div>Study<span>Bot</span></a>
    <div class="nav-right">
      <a class="nav-link" href="#features">Features</a>
      <a class="nav-link" href="#how-it-works">How It Works</a>
      <a class="nav-link" href="#testimonials">Reviews</a>
      <button class="theme-btn" onclick="toggleThemePicker()" title="Change theme">ğŸ¨</button>
      <button class="nav-cta" onclick="showAuth('login')">Login â†’</button>
      <button class="btn-ghost" style="padding:8px 18px;font-size:0.875rem;" onclick="showAuth('register')">Sign Up</button>
    </div>
  </nav>

  <!-- HERO -->
  <section class="hero">
    <div class="hero-inner">
      <div class="hero-pill">âœ¨ AI-Powered Study Assistant</div>
      <h1 class="hero-h1">Study <em>smarter,</em><br>not harder</h1>
      <p class="hero-sub">StudyBot combines intelligent task management with real AI insights to help you ace every deadline, track performance, and stay ahead â€” effortlessly.</p>
      <div class="hero-actions">
        <button class="btn-cta" onclick="showAuth('register')">ğŸš€ Get Started Free</button>
        <button class="btn-ghost" onclick="showAuth('login')">Login â†’</button>
      </div>
      <!-- PREVIEW -->
      <div class="dash-preview">
        <div class="preview-shell">
          <div class="preview-bar">
            <div class="pdots"><div class="pdot"></div><div class="pdot"></div><div class="pdot"></div></div>
            <div class="purl">studybot.app/dashboard</div>
          </div>
          <div class="preview-body">
            <div class="psidebar">
              <div class="pnav active"><div class="pnav-dot"></div>Dashboard</div>
              <div class="pnav"><div class="pnav-dot"></div>Tasks</div>
              <div class="pnav"><div class="pnav-dot"></div>Upcoming</div>
              <div class="pnav"><div class="pnav-dot"></div>Performance</div>
              <div class="pnav"><div class="pnav-dot"></div>Add Task</div>
            </div>
            <div class="pmain">
              <div class="pgreeting">Good morning, <span>Student!</span> ğŸ‘‹</div>
              <div class="pkpi-row">
                <div class="pkpi"><div class="pkpi-n" style="color:var(--accent2)">12</div><div class="pkpi-l">Total</div></div>
                <div class="pkpi"><div class="pkpi-n" style="color:var(--accent)">7</div><div class="pkpi-l">Done</div></div>
                <div class="pkpi"><div class="pkpi-n" style="color:var(--accent3)">3</div><div class="pkpi-l">Urgent</div></div>
                <div class="pkpi"><div class="pkpi-n" style="color:var(--accent)">58%</div><div class="pkpi-l">Progress</div></div>
              </div>
              <div class="ptasks">
                <div class="ptask"><div class="ptask-dot" style="background:var(--accent3)"></div><span style="flex:1">Chemistry Lab Report</span><div class="ptag" style="background:color-mix(in srgb,var(--accent3) 12%,transparent);color:var(--accent3)">HIGH</div></div>
                <div class="ptask"><div class="ptask-dot" style="background:var(--accent)"></div><span style="flex:1;opacity:0.5;text-decoration:line-through">Math Assignment</span><div class="ptag" style="background:color-mix(in srgb,var(--accent) 12%,transparent);color:var(--accent)">DONE</div></div>
                <div class="ptask"><div class="ptask-dot" style="background:var(--accent2)"></div><span style="flex:1">English Essay Draft</span><div class="ptag" style="background:color-mix(in srgb,var(--accent2) 12%,transparent);color:var(--accent2)">IN PROG</div></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- STATS -->
  <div class="stats-bar">
    <div class="stats-inner">
      <div class="sstat"><div class="sstat-n">50K+</div><div class="sstat-l">Students Helped</div></div>
      <div class="sstat"><div class="sstat-n">2.4M</div><div class="sstat-l">Tasks Managed</div></div>
      <div class="sstat"><div class="sstat-n">94%</div><div class="sstat-l">On-Time Rate</div></div>
      <div class="sstat"><div class="sstat-n">4.9â˜…</div><div class="sstat-l">Average Rating</div></div>
    </div>
  </div>

  <!-- FEATURES -->
  <section class="section" id="features">
    <div class="section-center">
      <div class="sec-badge">âš¡ Features</div>
      <h2 class="sec-h">Everything to <em>ace</em> your studies</h2>
      <p class="sec-sub">Built for students â€” from managing deadlines to generating AI study plans and tracking your performance over time.</p>
      <div class="feat-grid">
        <div class="feat"><span class="feat-icon">ğŸ¤–</span><div class="feat-t">AI Study Assistant</div><div class="feat-d">Chat with StudyBot AI to get personalized study plans, priority suggestions, and smart task breakdowns instantly.</div></div>
        <div class="feat"><span class="feat-icon">ğŸ“Š</span><div class="feat-t">Performance Analytics</div><div class="feat-d">Track completion rates, subject progress, on-time delivery, and weekly trends with beautiful interactive charts.</div></div>
        <div class="feat"><span class="feat-icon">â°</span><div class="feat-t">Smart Deadline Alerts</div><div class="feat-d">Never miss a deadline again. Get automatic alerts for overdue, due-today, and approaching tasks.</div></div>
        <div class="feat"><span class="feat-icon">âœ¨</span><div class="feat-t">AI Subtask Generator</div><div class="feat-d">Turn any big task into manageable steps instantly â€” just click AI and let StudyBot do the heavy thinking.</div></div>
        <div class="feat"><span class="feat-icon">ğŸ”¥</span><div class="feat-t">Study Streak Tracking</div><div class="feat-d">Stay motivated with daily streak tracking. See your study consistency across the week at a glance.</div></div>
        <div class="feat"><span class="feat-icon">ğŸ¨</span><div class="feat-t">6 Beautiful Themes</div><div class="feat-d">Midnight, Aurora, Solar, Paper, Rose, Slate â€” plus 5 font styles. Make StudyBot truly yours.</div></div>
      </div>
    </div>
  </section>

  <!-- HOW IT WORKS -->
  <section class="section" id="how-it-works" style="background:var(--surface);border-top:1px solid var(--border);border-bottom:1px solid var(--border);">
    <div class="section-center" style="text-align:center;">
      <div class="sec-badge">ğŸ—º Process</div>
      <h2 class="sec-h">Up and running in <em>60 seconds</em></h2>
      <p class="sec-sub" style="margin:0 auto 48px;">No complicated setup. Just sign up and start managing your studies smarter right away.</p>
      <div class="steps">
        <div class="step"><div class="step-n">1</div><div class="step-t">Create Account</div><div class="step-d">Sign up with your name, email, and password. Free forever, no credit card needed.</div></div>
        <div class="step"><div class="step-n">2</div><div class="step-t">Add Your Tasks</div><div class="step-d">Add assignments, exams, and projects. Set priorities, deadlines, and subjects.</div></div>
        <div class="step"><div class="step-n">3</div><div class="step-t">Let AI Help</div><div class="step-d">Chat with StudyBot AI to get study schedules, suggestions, and auto subtasks.</div></div>
        <div class="step"><div class="step-n">4</div><div class="step-t">Track Progress</div><div class="step-d">Watch your completion rate climb. Celebrate streaks and dominate every deadline.</div></div>
      </div>
    </div>
  </section>

  <!-- TESTIMONIALS -->
  <section class="section" id="testimonials">
    <div class="section-center" style="text-align:center;">
      <div class="sec-badge">ğŸ’¬ Reviews</div>
      <h2 class="sec-h">Students <em>love</em> StudyBot</h2>
      <p class="sec-sub" style="margin:0 auto 48px;">From stressed freshmen to high-achieving seniors â€” StudyBot works for everyone.</p>
      <div class="testi-grid">
        <div class="testi"><div class="testi-stars">â˜…â˜…â˜…â˜…â˜…</div><div class="testi-q">Since using StudyBot, I've never missed a single deadline. The AI suggestions are genuinely impressive.</div><div class="testi-author"><div class="testi-av" style="background:linear-gradient(135deg,var(--accent),var(--accent2))">P</div><div><div class="testi-name">Priya S.</div><div class="testi-role">Engineering Student</div></div></div></div>
        <div class="testi"><div class="testi-stars">â˜…â˜…â˜…â˜…â˜…</div><div class="testi-q">The performance dashboard helped me realise I was spending too much time on low-priority tasks. Game changer!</div><div class="testi-author"><div class="testi-av" style="background:linear-gradient(135deg,var(--accent3),var(--accent4))">R</div><div><div class="testi-name">Rahul K.</div><div class="testi-role">Pre-Med Student</div></div></div></div>
        <div class="testi"><div class="testi-stars">â˜…â˜…â˜…â˜…â˜…</div><div class="testi-q">The AI subtask generator breaks down huge assignments into bite-sized chunks. My productivity literally tripled.</div><div class="testi-author"><div class="testi-av" style="background:linear-gradient(135deg,var(--accent4),var(--accent5))">A</div><div><div class="testi-name">Ananya M.</div><div class="testi-role">MBA Candidate</div></div></div></div>
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="cta-section">
    <div class="cta-box">
      <div class="cta-h">Ready to study <em>smarter?</em></div>
      <div class="cta-sub">Join 50,000+ students who are already ahead of their deadlines.</div>
      <button class="btn-cta" onclick="showAuth('register')">ğŸš€ Start Free â€” No Credit Card</button>
    </div>
  </section>

  <!-- FOOTER -->
  <footer>
    <div class="footer-grid">
      <div class="footer-brand">
        <div class="lp-logo"><div class="logo-pulse"></div>Study<span>Bot</span></div>
        <p>Your AI-powered personal study assistant. Built for students who want to stay ahead without burning out.</p>
      </div>
      <div>
        <div class="footer-head">Product</div>
        <div class="footer-links">
          <a href="#features">Features</a>
          <a href="#how-it-works">How It Works</a>
          <a onclick="showAuth('register')">Get Started</a>
          <a onclick="showAuth('login')">Login</a>
        </div>
      </div>
      <div>
        <div class="footer-head">Support</div>
        <div class="footer-links">
          <a href="#">Help Center</a>
          <a href="#">Privacy Policy</a>
          <a href="#">Terms of Service</a>
          <a href="#">Contact</a>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <span>Â© 2026 StudyBot. All rights reserved.</span>
      <span>Made with â¤ï¸ for students everywhere</span>
    </div>
  </footer>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  AUTH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="authScreen">
  <div class="auth-card">
    <div class="auth-logo">Study<span>Bot</span> ğŸ“š</div>
    <div class="auth-tag">Your AI-powered personal study assistant</div>
    <div class="auth-box">
      <div class="auth-tabs">
        <button class="auth-tab active" id="tabLogin" onclick="switchTab('login')">Login</button>
        <button class="auth-tab" id="tabReg" onclick="switchTab('register')">Register</button>
      </div>
      <div id="loginForm">
        <div class="auth-field"><label for="l-email">Email</label><input type="email" id="l-email" placeholder="you@email.com" autocomplete="email"></div>
        <div class="auth-field"><label for="l-pass">Password</label><input type="password" id="l-pass" placeholder="Your password" autocomplete="current-password" onkeydown="if(event.key==='Enter')doLogin()"></div>
        <button class="auth-submit" onclick="doLogin()">Login â†’</button>
        <div class="auth-err" id="l-err"></div>
        <div id="savedUsersWrap"></div>
      </div>
      <div id="regForm" style="display:none">
        <div class="auth-field"><label for="r-name">Name</label><input type="text" id="r-name" placeholder="Your full name" autocomplete="name"></div>
        <div class="auth-field"><label for="r-email">Email</label><input type="email" id="r-email" placeholder="you@email.com" autocomplete="email"></div>
        <div class="auth-field"><label for="r-pass">Password</label><input type="password" id="r-pass" placeholder="Min. 4 characters" autocomplete="new-password"></div>
        <div class="auth-field"><label for="r-pass2">Confirm</label><input type="password" id="r-pass2" placeholder="Repeat password" onkeydown="if(event.key==='Enter')doRegister()"></div>
        <button class="auth-submit" onclick="doRegister()">Create Account â†’</button>
        <div class="auth-err" id="r-err"></div>
      </div>
      <button class="auth-back" onclick="showLanding()">â† Back to home</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  MAIN APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="mainApp">
  <header>
    <div style="display:flex;align-items:center;gap:9px;">
      <button class="hamburger" onclick="toggleSidebar()" aria-label="Menu"><span></span><span></span><span></span></button>
      <div class="app-logo"><div class="logo-pulse"></div>Study<em>Bot</em></div>
    </div>
    <div class="hdr-center" id="headerStats">Loading...</div>
    <div class="hdr-right">
      <button class="ai-pill-btn" onclick="toggleAI()">ğŸ¤– StudyBot AI</button>
      <button class="hbtn" onclick="toggleThemePicker()" title="Change theme">ğŸ¨</button>
      <div class="notif-wrap">
        <button class="hbtn" id="notifBtn" onclick="toggleNotifPanel()" title="Notifications">ğŸ””</button>
        <div class="notif-dot hidden" id="notifBadge">0</div>
      </div>
      <div class="user-chip" onclick="doLogout()" title="Logout">
        <div class="u-av" id="uAvatar">?</div>
        <span id="uName">User</span>
        <span style="color:var(--text3);font-size:0.72rem;">âœ•</span>
      </div>
    </div>
  </header>

  <aside class="sidebar" id="sidebar">
    <div class="sb-label">Main</div>
    <button class="sb-btn active" data-page="dashboard" onclick="showPage('dashboard',this)"><span class="icon">ğŸ“Š</span>Dashboard</button>
    <button class="sb-btn" data-page="tasks" onclick="showPage('tasks',this)"><span class="icon">ğŸ“‹</span>All Tasks</button>
    <button class="sb-btn" data-page="upcoming" onclick="showPage('upcoming',this)"><span class="icon">ğŸ“…</span>Upcoming</button>
    <button class="sb-btn" data-page="performance" onclick="showPage('performance',this)"><span class="icon">ğŸ“ˆ</span>Performance</button>
    <button class="sb-btn" data-page="add" onclick="showPage('add',this)"><span class="icon">â•</span>Add Task</button>
    <div class="sb-div"></div>
    <div class="sb-label">Overview</div>
    <div class="sb-stat"><span>Pending</span><span class="sb-val" id="sPending">â€”</span></div>
    <div class="sb-stat"><span>In Progress</span><span class="sb-val b" id="sProgress">â€”</span></div>
    <div class="sb-stat"><span>Done</span><span class="sb-val g" id="sDone">â€”</span></div>
    <div class="sb-stat"><span>High Priority</span><span class="sb-val r" id="sHigh">â€”</span></div>
    <div class="sb-div"></div>
    <div class="sb-label">Quick Filter</div>
    <button class="sb-btn" onclick="quickFilter('pending')"><span class="icon">ğŸŸ¡</span>Pending</button>
    <button class="sb-btn" onclick="quickFilter('in-progress')"><span class="icon">ğŸ”µ</span>In Progress</button>
    <button class="sb-btn" onclick="quickFilter('completed')"><span class="icon">âœ…</span>Completed</button>
    <button class="sb-btn" onclick="quickFilter(null)"><span class="icon">ğŸ”„</span>Clear Filter</button>
  </aside>

  <main class="main" id="mainContent">

    <!-- DASHBOARD PAGE -->
    <div class="page active" id="page-dashboard">
      <!-- Welcome Hero Card -->
      <div class="dash-welcome">
        <div class="dw-left">
          <div class="dw-greeting" id="dashGreeting">Loading...</div>
          <div class="dw-sub" id="dashSub">Your study overview for today</div>
          <div class="dw-badges" id="dashBadges"></div>
        </div>
        <div class="dw-right">
          <div class="dw-ring">
            <svg class="dw-ring-svg" width="90" height="90" viewBox="0 0 90 90">
              <circle class="dw-ring-track" cx="45" cy="45" r="36"/>
              <circle class="dw-ring-fill" id="ringFill" cx="45" cy="45" r="36" stroke-dashoffset="226"/>
            </svg>
            <div class="dw-ring-text">
              <div class="dw-ring-pct" id="ringPct">0%</div>
              <div class="dw-ring-label">done</div>
            </div>
          </div>
        </div>
      </div>

      <!-- KPIs -->
      <div class="kpi-row" id="kpiGrid"></div>

      <!-- Charts + Streak -->
      <div class="dash-grid2">
        <div class="panel">
          <div class="panel-title"><span>ğŸ“Š</span>Task Breakdown</div>
          <div class="chart-wrap"><canvas id="taskChart"></canvas></div>
        </div>
        <div class="panel">
          <div class="panel-title"><span>ğŸ”¥</span>Study Streak</div>
          <div class="streak-days" id="streakDays"></div>
          <div class="streak-score">
            <div class="streak-fire">ğŸ”¥</div>
            <div>
              <div class="streak-num" id="streakCount">0</div>
              <div class="streak-txt">day streak</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="panel">
        <div class="panel-title"><span>ğŸ“‹</span>Recent Activity</div>
        <div class="recent-list" id="recentList"></div>
      </div>
    </div>

    <!-- TASKS -->
    <div class="page" id="page-tasks">
      <div class="pg-head">
        <div class="pg-title">Your <em>Tasks</em></div>
        <div class="pg-sub" id="taskCount">Loading...</div>
      </div>
      <div class="toolbar">
        <input class="search-inp" type="search" placeholder="ğŸ” Search tasks..." id="searchBox" oninput="renderTasks()">
        <button class="fchip active" onclick="setPriFilter('all',this)">All</button>
        <button class="fchip" onclick="setPriFilter('high',this)">ğŸ”´ High</button>
        <button class="fchip" onclick="setPriFilter('medium',this)">ğŸŸ¡ Medium</button>
        <button class="fchip" onclick="setPriFilter('low',this)">ğŸŸ¢ Low</button>
      </div>
      <div class="task-grid" id="taskGrid"></div>
    </div>

    <!-- UPCOMING -->
    <div class="page" id="page-upcoming">
      <div class="pg-head">
        <div class="pg-title"><em>Upcoming</em> Deadlines</div>
        <div class="pg-sub">Next 14 days</div>
      </div>
      <div class="timeline" id="upcomingList"></div>
    </div>

    <!-- PERFORMANCE -->
    <div class="page" id="page-performance">
      <div class="pg-head">
        <div class="pg-title">Your <em>Performance</em></div>
        <div class="pg-sub">Track your progress and study habits</div>
      </div>
      <div class="perf-grid" id="perfGrid"></div>
      <div class="dash-grid2">
        <div class="panel">
          <div class="panel-title"><span>ğŸ“Š</span>Subject Progress</div>
          <div id="subjectProgress"></div>
        </div>
        <div class="panel">
          <div class="panel-title"><span>ğŸ—“</span>28-Day Activity</div>
          <div class="heatmap" id="heatmap"></div>
          <div style="margin-top:10px;font-size:0.72rem;color:var(--text3);">Each cell = 1 day Â· Darker = more completed</div>
        </div>
      </div>
      <div class="panel">
        <div class="panel-title"><span>ğŸ“ˆ</span>Weekly Completion</div>
        <div class="chart-wrap"><canvas id="perfChart"></canvas></div>
      </div>
    </div>

    <!-- ADD TASK -->
    <div class="page" id="page-add">
      <div class="pg-head">
        <div class="pg-title">Add <em>New</em> Task</div>
        <div class="pg-sub">Fill in the details below</div>
      </div>
      <form class="add-form" onsubmit="submitTask(event)" novalidate>
        <div class="form-group full"><label for="f-title">Task Title *</label><input type="text" id="f-title" placeholder="e.g. Write Chemistry Lab Report" required></div>
        <div class="form-row">
          <div class="form-group"><label for="f-subject">Subject</label><input type="text" id="f-subject" placeholder="e.g. Chemistry"></div>
          <div class="form-group"><label for="f-due">Due Date</label><input type="date" id="f-due"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label for="f-priority">Priority</label><select id="f-priority"><option value="medium">ğŸŸ¡ Medium</option><option value="high">ğŸ”´ High</option><option value="low">ğŸŸ¢ Low</option></select></div>
          <div class="form-group"><label for="f-status">Status</label><select id="f-status"><option value="pending">Pending</option><option value="in-progress">In Progress</option><option value="completed">Completed</option></select></div>
        </div>
        <div class="form-group full"><label for="f-desc">Notes</label><textarea id="f-desc" placeholder="Any extra details..."></textarea></div>
        <div class="form-actions">
          <button type="button" class="btn btn-ai" onclick="aiSuggestPriority()">âœ¨ AI Priority</button>
          <button type="button" class="btn btn-secondary" onclick="resetForm()">Clear</button>
          <button type="submit" class="btn btn-primary">â• Add Task</button>
        </div>
      </form>
    </div>

  </main>

  <!-- AI PANEL -->
  <aside class="ai-panel" id="aiPanel">
    <div class="ai-head">
      <div class="ai-av">ğŸ¤–</div>
      <div class="ai-info">
        <div class="ai-name">StudyBot AI</div>
        <div class="ai-status">Online Â· Powered by AI</div>
      </div>
      <button class="ai-close" onclick="toggleAI()">âœ•</button>
    </div>
    <div class="ai-msgs" id="aiMessages"></div>
    <div class="q-chips">
      <button class="q-chip" onclick="qp('What should I focus on today?')">Focus today</button>
      <button class="q-chip" onclick="qp('Am I overloaded this week?')">Overloaded?</button>
      <button class="q-chip" onclick="qp('What are my high priority tasks?')">High priority</button>
      <button class="q-chip" onclick="qp('Give me a study schedule')">Study plan</button>
    </div>
    <div class="ai-input-row">
      <input class="ai-inp" id="aiInput" type="text" placeholder="Ask StudyBot..." onkeydown="if(event.key==='Enter')sendMsg()">
      <button class="send-btn" id="sendBtn" onclick="sendMsg()">â¤</button>
    </div>
  </aside>
</div>

<!-- BOTTOM NAV -->
<nav class="bottom-nav">
  <button class="bn-btn active" id="bn-dashboard" onclick="showPage('dashboard',null);setBN('bn-dashboard')"><span class="bni">ğŸ“Š</span>Dash</button>
  <button class="bn-btn" id="bn-tasks" onclick="showPage('tasks',null);setBN('bn-tasks')"><span class="bni">ğŸ“‹</span>Tasks</button>
  <button class="bn-btn" id="bn-upcoming" onclick="showPage('upcoming',null);setBN('bn-upcoming')"><span class="bni">ğŸ“…</span>Soon</button>
  <button class="bn-btn" id="bn-performance" onclick="showPage('performance',null);setBN('bn-performance')"><span class="bni">ğŸ“ˆ</span>Stats</button>
  <button class="bn-btn" id="bn-add" onclick="showPage('add',null);setBN('bn-add')"><span class="bni">â•</span>Add</button>
  <button class="bn-btn" id="bn-ai" onclick="toggleAI()"><span class="bni">ğŸ¤–</span>AI</button>
</nav>

<div class="drawer-overlay" id="drawerOverlay" onclick="closeAll()"></div>

<!-- NOTIF PANEL -->
<div class="notif-panel" id="notifPanel">
  <div class="notif-head">
    <div class="notif-head-title">ğŸ”” Notifications</div>
    <button class="notif-clear" onclick="clearNotifs()">Clear all</button>
  </div>
  <div class="notif-list" id="notifList"></div>
</div>

<!-- EDIT MODAL -->
<div class="modal-overlay" id="editModal">
  <div class="modal">
    <div class="modal-title">âœï¸ Edit Task</div>
    <form onsubmit="submitEdit(event)" style="display:flex;flex-direction:column;gap:13px;">
      <input type="hidden" id="e-id">
      <div class="form-group"><label for="e-title">Title</label><input type="text" id="e-title" required></div>
      <div class="form-row">
        <div class="form-group"><label for="e-subject">Subject</label><input type="text" id="e-subject"></div>
        <div class="form-group"><label for="e-due">Due Date</label><input type="date" id="e-due"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label for="e-priority">Priority</label><select id="e-priority"><option value="medium">ğŸŸ¡ Medium</option><option value="high">ğŸ”´ High</option><option value="low">ğŸŸ¢ Low</option></select></div>
        <div class="form-group"><label for="e-status">Status</label><select id="e-status"><option value="pending">Pending</option><option value="in-progress">In Progress</option><option value="completed">Completed</option></select></div>
      </div>
      <div class="form-group"><label for="e-desc">Notes</label><textarea id="e-desc"></textarea></div>
      <div class="form-actions">
        <button type="button" class="btn btn-ai" onclick="genSubtasks()">âœ¨ AI Subtasks</button>
        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        <button type="submit" class="btn btn-primary">Save Changes</button>
      </div>
    </form>
  </div>
</div>

<div class="toast-container" id="toastContainer"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THEME & FONT SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const THEMES = [
  { id:'midnight', label:'Midnight', bg:'#09090f', sidebar:'#111120', accent:'#7c6fef', accent2:'#2dc7b0' },
  { id:'aurora',   label:'Aurora',   bg:'#050c0a', sidebar:'#0a1c16', accent:'#39d98a', accent2:'#38bdf8' },
  { id:'solar',    label:'Solar',    bg:'#0d0a04', sidebar:'#1c1208', accent:'#f59e0b', accent2:'#ef4444' },
  { id:'paper',    label:'Paper',    bg:'#f7f5f0', sidebar:'#ffffff', accent:'#1a1a2e', accent2:'#0f6eb4' },
  { id:'rose',     label:'Rose',     bg:'#fff5f7', sidebar:'#ffffff', accent:'#e11d6a', accent2:'#7c3aed' },
  { id:'slate',    label:'Slate',    bg:'#0c0e12', sidebar:'#161820', accent:'#60a5fa', accent2:'#34d399' },
];
const FONTS = [
  { id:'cabinet',     name:'Cabinet Grotesk',   preview:'Bold & Modern' },
  { id:'playfair',    name:'Playfair Display',   preview:'Elegant & Editorial' },
  { id:'unbounded',   name:'Unbounded',          preview:'Tech & Futuristic' },
  { id:'epilogue',    name:'Epilogue + Crimson',  preview:'Clean & Literary' },
  { id:'handwritten', name:'Architects Daughter', preview:'Casual & Friendly' },
];

function buildThemePicker(){
  // swatches
  const sw = document.getElementById('themeSwatches');
  const cur = document.documentElement.getAttribute('data-theme') || 'midnight';
  sw.innerHTML = THEMES.map(t=>`
    <div class="swatch ${t.id===cur?'active':''}" onclick="applyTheme('${t.id}')" title="${t.label}">
      <div class="sw-preview">
        <div class="sw-sidebar" style="background:${t.sidebar}"></div>
        <div class="sw-main" style="background:${t.bg}">
          <div class="sw-bar" style="background:${t.accent};width:70%"></div>
          <div class="sw-bar" style="background:${t.accent2};width:50%"></div>
          <div class="sw-bar" style="background:${t.accent};width:60%;opacity:0.4"></div>
        </div>
      </div>
      <div class="sw-label">${t.label}</div>
    </div>`).join('');
  // fonts
  const fo = document.getElementById('fontOptions');
  const curF = document.documentElement.getAttribute('data-font') || 'cabinet';
  fo.innerHTML = FONTS.map(f=>`
    <button class="font-opt ${f.id===curF?'active':''}" onclick="applyFont('${f.id}')" style="font-family:'${f.name}',sans-serif;">
      <div class="font-opt-name">${f.name}</div>
      <div class="font-opt-preview" style="font-family:inherit">${f.preview}</div>
    </button>`).join('');
}

function applyTheme(id){
  document.documentElement.setAttribute('data-theme', id);
  localStorage.setItem('sb_theme', id);
  buildThemePicker();
  // re-render charts if visible
  if(document.getElementById('page-dashboard').classList.contains('active')) renderDashboard();
  if(document.getElementById('page-performance').classList.contains('active')) renderPerformance();
}
function applyFont(id){
  document.documentElement.setAttribute('data-font', id);
  localStorage.setItem('sb_font', id);
  buildThemePicker();
}
function toggleThemePicker(){
  const p=document.getElementById('themePicker');
  p.classList.toggle('open');
  if(p.classList.contains('open')) buildThemePicker();
}
function closeThemePicker(){document.getElementById('themePicker').classList.remove('open');}

// Restore saved theme/font
(function(){
  const t=localStorage.getItem('sb_theme');
  const f=localStorage.getItem('sb_font');
  if(t) document.documentElement.setAttribute('data-theme',t);
  if(f) document.documentElement.setAttribute('data-font',f);
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ROUTING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showLanding(){
  document.getElementById('landingPage').style.display='';
  document.getElementById('authScreen').style.display='none';
  document.getElementById('mainApp').classList.remove('visible');
}
function showAuth(tab){
  document.getElementById('landingPage').style.display='none';
  document.getElementById('authScreen').style.display='flex';
  document.getElementById('mainApp').classList.remove('visible');
  switchTab(tab||'login');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STORAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SK={users:'sb_users',session:'sb_session',chat:u=>`sb_chat_${u}`,notifs:u=>`sb_notifs_${u}`};
const ls={get:k=>{try{return JSON.parse(localStorage.getItem(k));}catch{return null;}},set:(k,v)=>localStorage.setItem(k,JSON.stringify(v)),del:k=>localStorage.removeItem(k)};
function getUsers(){return ls.get(SK.users)||{};}
function saveUsers(u){ls.set(SK.users,u);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentUser=null;

function switchTab(tab){
  document.getElementById('tabLogin').classList.toggle('active',tab==='login');
  document.getElementById('tabReg').classList.toggle('active',tab==='register');
  document.getElementById('loginForm').style.display=tab==='login'?'':'none';
  document.getElementById('regForm').style.display=tab==='register'?'':'none';
}
function renderSavedUsers(){
  const users=getUsers(),keys=Object.keys(users);
  const wrap=document.getElementById('savedUsersWrap');
  if(!keys.length){wrap.innerHTML='';return;}
  wrap.innerHTML=`<div class="auth-divider"><span>Quick login</span></div><div class="quick-users">${keys.map(email=>`
    <button class="quick-chip" onclick="quickFill('${email}')">
      <div class="q-av">${users[email].name[0].toUpperCase()}</div>
      <span>${users[email].name}</span>
    </button>`).join('')}</div>`;
}
function quickFill(email){document.getElementById('l-email').value=email;document.getElementById('l-pass').focus();}
function doLogin(){
  const email=document.getElementById('l-email').value.trim().toLowerCase();
  const pass=document.getElementById('l-pass').value;
  const err=document.getElementById('l-err');
  if(!email||!pass){err.textContent='Please fill in all fields.';return;}
  const users=getUsers();
  if(!users[email]){err.textContent='No account found. Please register.';return;}
  if(users[email].password!==btoa(pass)){err.textContent='Incorrect password.';return;}
  err.textContent='';
  ls.set(SK.session,{email,name:users[email].name,loginTime:Date.now()});
  startApp(email,users[email].name);
}
function doRegister(){
  const name=document.getElementById('r-name').value.trim();
  const email=document.getElementById('r-email').value.trim().toLowerCase();
  const pass=document.getElementById('r-pass').value;
  const pass2=document.getElementById('r-pass2').value;
  const err=document.getElementById('r-err');
  if(!name||!email||!pass){err.textContent='Please fill in all fields.';return;}
  if(!email.includes('@')){err.textContent='Invalid email address.';return;}
  if(pass.length<4){err.textContent='Password must be at least 4 characters.';return;}
  if(pass!==pass2){err.textContent='Passwords do not match.';return;}
  const users=getUsers();
  if(users[email]){err.textContent='Account already exists.';return;}
  users[email]={name,password:btoa(pass),createdAt:Date.now()};
  saveUsers(users);err.textContent='';
  ls.set(SK.session,{email,name,loginTime:Date.now()});
  startApp(email,name);
}
function doLogout(){
  if(!confirm('Log out?'))return;
  saveChatHistory();ls.del(SK.session);
  currentUser=null;chatHistory=[];notifications=[];
  document.getElementById('mainApp').classList.remove('visible');
  showLanding();
  document.getElementById('l-email').value='';
  document.getElementById('l-pass').value='';
  document.getElementById('l-err').textContent='';
  renderSavedUsers();
}
function startApp(email,name){
  currentUser={email,name};
  document.getElementById('landingPage').style.display='none';
  document.getElementById('authScreen').style.display='none';
  document.getElementById('mainApp').classList.add('visible');
  document.getElementById('uName').textContent=name.split(' ')[0];
  document.getElementById('uAvatar').textContent=name[0].toUpperCase();
  const h=new Date().getHours();
  const greet=h<12?'Good morning':h<17?'Good afternoon':'Good evening';
  document.getElementById('dashGreeting').innerHTML=`${greet}, <span>${name.split(' ')[0]}!</span> ğŸ‘‹`;
  chatHistory=ls.get(SK.chat(email))||[];
  notifications=ls.get(SK.notifs(email))||[];
  restoreChatUI();renderNotifBadge();loadTasks();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let tasks=[],filterPriority='all',filterStatus=null,chatHistory=[],notifications=[];
let taskChartInst=null,perfChartInst=null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(msg,type='info'){
  const el=document.createElement('div');
  el.className=`toast ${type}`;el.textContent=msg;
  document.getElementById('toastContainer').appendChild(el);
  setTimeout(()=>el.remove(),3100);
}
function escHtml(s){return(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function fmtDate(s){if(!s)return null;return new Date(s+'T00:00:00').toLocaleDateString('en-GB',{day:'numeric',month:'short',year:'numeric'});}
function isOverdue(s){return s&&new Date(s+'T23:59:59')<new Date();}
async function api(method,path,body){
  const res=await fetch(path,{method,headers:body?{'Content-Type':'application/json'}:{},body:body?JSON.stringify(body):undefined});
  return res.json();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NOTIFICATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addNotif(text,icon='ğŸ“Œ'){
  if(!currentUser)return;
  const n={id:Date.now(),text,icon,time:new Date().toLocaleTimeString(),read:false};
  notifications.unshift(n);notifications=notifications.slice(0,30);
  ls.set(SK.notifs(currentUser.email),notifications);
  renderNotifBadge();renderNotifList();
}
function renderNotifBadge(){
  const unread=notifications.filter(n=>!n.read).length;
  const badge=document.getElementById('notifBadge');
  badge.textContent=unread;badge.classList.toggle('hidden',unread===0);
}
function renderNotifList(){
  const list=document.getElementById('notifList');
  if(!notifications.length){list.innerHTML=`<div class="notif-empty">ğŸ‰ You're all caught up!</div>`;return;}
  list.innerHTML=notifications.map(n=>`
    <div class="notif-item ${n.read?'':'unread'}" onclick="markRead(${n.id})">
      <div class="notif-ico">${n.icon}</div>
      <div><div class="notif-txt">${escHtml(n.text)}</div><div class="notif-time">${n.time}</div></div>
    </div>`).join('');
}
function markRead(id){const n=notifications.find(n=>n.id===id);if(n)n.read=true;ls.set(SK.notifs(currentUser.email),notifications);renderNotifBadge();renderNotifList();}
function clearNotifs(){notifications=[];ls.set(SK.notifs(currentUser.email),notifications);renderNotifBadge();renderNotifList();}
function toggleNotifPanel(){
  const p=document.getElementById('notifPanel');p.classList.toggle('open');
  if(p.classList.contains('open')){notifications.forEach(n=>n.read=true);ls.set(SK.notifs(currentUser.email),notifications);renderNotifBadge();renderNotifList();}
}
function checkDeadlineNotifs(){
  const today=new Date();
  tasks.forEach(t=>{
    if(t.status==='completed'||!t.due_date)return;
    const due=new Date(t.due_date+'T23:59:59');
    const d=Math.ceil((due-today)/(1000*60*60*24));
    if(d<0)addNotif(`"${t.title}" is overdue!`,'âš ï¸');
    else if(d===0)addNotif(`"${t.title}" is due today!`,'ğŸ”¥');
    else if(d===1)addNotif(`"${t.title}" is due tomorrow`,'ğŸ“…');
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TASKS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadTasks(){
  try{tasks=await api('GET','/api/tasks');renderTasks();updateSidebarStats();renderDashboard();checkDeadlineNotifs();}
  catch(e){toast('Cannot connect to server','error');}
}
function updateSidebarStats(){
  document.getElementById('sPending').textContent=tasks.filter(t=>t.status==='pending').length;
  document.getElementById('sProgress').textContent=tasks.filter(t=>t.status==='in-progress').length;
  document.getElementById('sDone').textContent=tasks.filter(t=>t.status==='completed').length;
  document.getElementById('sHigh').textContent=tasks.filter(t=>t.priority==='high'&&t.status!=='completed').length;
  const total=tasks.length,done=tasks.filter(t=>t.status==='completed').length;
  document.getElementById('headerStats').innerHTML=`<strong>${total}</strong> tasks Â· <strong>${done}</strong> done`;
  document.getElementById('taskCount').textContent=`${tasks.length} tasks total`;
}
function renderTasks(){
  const q=document.getElementById('searchBox')?.value.toLowerCase()||'';
  const filtered=tasks.filter(t=>
    (filterPriority==='all'||t.priority===filterPriority)&&
    (!filterStatus||t.status===filterStatus)&&
    (!q||t.title.toLowerCase().includes(q)||(t.subject||'').toLowerCase().includes(q)||(t.description||'').toLowerCase().includes(q))
  );
  const grid=document.getElementById('taskGrid');
  if(!filtered.length){grid.innerHTML=`<div class="empty-state"><div class="big">ğŸ“­</div><p>No tasks found. Add one!</p></div>`;return;}
  grid.innerHTML=filtered.map(taskCardHtml).join('');
}
function taskCardHtml(t){
  const ov=isOverdue(t.due_date)&&t.status!=='completed';
  const subs=(t.subtasks||[]).map((s,i)=>`
    <div class="sub-item ${s.done?'done':''}" onclick="toggleSubtask('${t.id}',${i})">
      <div class="sub-chk">${s.done?'âœ“':''}</div>
      <span>${escHtml(s.text)}</span>
    </div>`).join('');
  return`<div class="task-card priority-${t.priority} ${t.status==='completed'?'completed':''}">
    <div class="tc-top">
      <div class="tc-title">${escHtml(t.title)}</div>
      <div class="tc-actions">
        <button class="icobtn ai-b" onclick="genSubtasksForTask('${t.id}')" title="AI subtasks">âœ¨</button>
        <button class="icobtn" onclick="openEdit('${t.id}')" title="Edit">âœï¸</button>
        <button class="icobtn" onclick="toggleComplete('${t.id}')" title="Done">âœ…</button>
        <button class="icobtn del" onclick="deleteTask('${t.id}')" title="Delete">ğŸ—‘</button>
      </div>
    </div>
    ${t.description?`<div class="tc-desc">${escHtml(t.description)}</div>`:''}
    <div class="tc-meta">
      ${t.subject?`<span class="badge badge-subject">${escHtml(t.subject)}</span>`:''}
      <span class="badge badge-${t.priority}">${t.priority}</span>
      <span class="badge badge-${t.status}">${t.status}</span>
    </div>
    ${t.due_date?`<div class="tc-due ${ov?'overdue':''}">${ov?'âš ï¸':'ğŸ“…'} ${fmtDate(t.due_date)}${ov?' Â· Overdue!':''}</div>`:''}
    ${subs?`<div class="subtasks-list">${subs}</div>`:''}
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD (separated, rich)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDashboard(){
  const total=tasks.length,done=tasks.filter(t=>t.status==='completed').length;
  const pending=tasks.filter(t=>t.status==='pending').length;
  const inprog=tasks.filter(t=>t.status==='in-progress').length;
  const high=tasks.filter(t=>t.priority==='high'&&t.status!=='completed').length;
  const overdue=tasks.filter(t=>isOverdue(t.due_date)&&t.status!=='completed').length;
  const pct=total?Math.round(done/total*100):0;

  // Welcome subtitle
  const msgs=[`${pct}% complete â€” keep the momentum! ğŸš€`,`${pending} task${pending!==1?'s':''} waiting â€” tackle them one by one ğŸ’ª`,high?`${high} high-priority task${high>1?'s':''} need your attention ğŸ”¥`:`No urgent tasks â€” you're ahead! âœ…`,overdue?`âš ï¸ ${overdue} overdue task${overdue>1?'s':''} need immediate action!`:`All deadlines on track! ğŸ‰`];
  document.getElementById('dashSub').textContent=msgs[Math.floor(Date.now()/10000)%msgs.length];

  // Progress ring
  const circumference=226;
  const offset=circumference-(pct/100*circumference);
  document.getElementById('ringFill').style.strokeDashoffset=offset;
  document.getElementById('ringPct').textContent=pct+'%';

  // Badges
  const badgeData=[];
  if(overdue>0) badgeData.push({icon:'âš ï¸',label:`${overdue} Overdue`,color:'var(--accent3)'});
  if(done>0) badgeData.push({icon:'âœ…',label:`${done} Completed`,color:'var(--accent)'});
  if(high>0) badgeData.push({icon:'ğŸ”´',label:`${high} Urgent`,color:'var(--accent3)'});
  badgeData.push({icon:'ğŸ“š',label:`${total} Total`,color:'var(--text2)'});
  document.getElementById('dashBadges').innerHTML=badgeData.map(b=>`<div class="dw-badge">${b.icon} <span style="color:${b.color}">${b.label}</span></div>`).join('');

  // KPIs
  document.getElementById('kpiGrid').innerHTML=`
    <div class="kpi"><div class="kpi-ico">ğŸ“‹</div><div class="kpi-v b">${total}</div><div class="kpi-l">Total Tasks</div></div>
    <div class="kpi"><div class="kpi-ico">âœ…</div><div class="kpi-v g">${done}</div><div class="kpi-l">Completed</div></div>
    <div class="kpi"><div class="kpi-ico">â³</div><div class="kpi-v">${pending}</div><div class="kpi-l">Pending</div></div>
    <div class="kpi"><div class="kpi-ico">âš¡</div><div class="kpi-v b">${inprog}</div><div class="kpi-l">In Progress</div></div>
    <div class="kpi"><div class="kpi-ico">ğŸ”´</div><div class="kpi-v p">${high}</div><div class="kpi-l">High Priority</div></div>
    <div class="kpi"><div class="kpi-ico">âš ï¸</div><div class="kpi-v ${overdue>0?'p':'g'}">${overdue}</div><div class="kpi-l">Overdue</div></div>
  `;

  // Donut chart
  const ctx=document.getElementById('taskChart').getContext('2d');
  if(taskChartInst)taskChartInst.destroy();
  const accent=getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();
  const accent2=getComputedStyle(document.documentElement).getPropertyValue('--accent2').trim();
  const surface3=getComputedStyle(document.documentElement).getPropertyValue('--surface3').trim();
  const surfaceBg=getComputedStyle(document.documentElement).getPropertyValue('--surface').trim();
  taskChartInst=new Chart(ctx,{
    type:'doughnut',
    data:{labels:['Completed','In Progress','Pending'],
      datasets:[{data:[done,inprog,pending],backgroundColor:[accent,accent2,surface3],borderColor:surfaceBg,borderWidth:3,hoverOffset:6}]},
    options:{responsive:true,maintainAspectRatio:false,cutout:'66%',
      plugins:{legend:{position:'bottom',labels:{color:'#94a3b8',font:{size:11},padding:14}}}}
  });

  // Streak
  const days=['Su','Mo','Tu','We','Th','Fr','Sa'];
  const today=new Date();
  let sc=0,check=true,sh='';
  for(let i=6;i>=0;i--){
    const d=new Date(today);d.setDate(d.getDate()-i);
    const ds=d.toISOString().split('T')[0];
    const active=tasks.some(t=>t.status==='completed'&&t.updated_at&&t.updated_at.startsWith(ds));
    const isToday=i===0;
    if(check){if(active||(isToday)){if(active)sc++;}else if(!isToday){check=false;}}
    sh+=`<div class="s-day ${active?'active':''} ${isToday?'today':''}"><div class="s-lbl">${days[d.getDay()]}</div><div class="s-dot"></div></div>`;
  }
  document.getElementById('streakDays').innerHTML=sh;
  document.getElementById('streakCount').textContent=sc;

  // Recent
  const recent=[...tasks].sort((a,b)=>new Date(b.updated_at)-new Date(a.updated_at)).slice(0,7);
  const dc={pending:'var(--accent4)','in-progress':'var(--accent2)',completed:'var(--accent)'};
  document.getElementById('recentList').innerHTML=recent.length?recent.map(t=>`
    <div class="recent-item">
      <div class="recent-dot" style="background:${dc[t.status]||'var(--text3)'}"></div>
      <div class="recent-title">${escHtml(t.title)}</div>
      ${t.subject?`<span class="badge badge-subject" style="font-size:0.62rem;">${escHtml(t.subject)}</span>`:''}
      <span class="badge badge-${t.status}" style="font-size:0.62rem;">${t.status}</span>
    </div>`).join(''):'<div style="color:var(--text3);padding:12px;font-size:0.875rem;">No tasks yet â€” add one to get started!</div>';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PERFORMANCE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPerformance(){
  const total=tasks.length,done=tasks.filter(t=>t.status==='completed').length;
  const high=tasks.filter(t=>t.priority==='high').length,highDone=tasks.filter(t=>t.priority==='high'&&t.status==='completed').length;
  const overdue=tasks.filter(t=>isOverdue(t.due_date)&&t.status!=='completed').length;
  const pct=total?Math.round(done/total*100):0;
  const onTime=Math.max(0,done-overdue);
  const onTimePct=done?Math.round(onTime/done*100):0;
  document.getElementById('perfGrid').innerHTML=`
    <div class="perf-card"><div class="pc-title">Completion Rate</div><div class="pc-val" style="color:var(--accent)">${pct}%</div><div class="pc-desc">${done} of ${total} done</div></div>
    <div class="perf-card"><div class="pc-title">High Priority Done</div><div class="pc-val" style="color:var(--accent3)">${highDone}/${high}</div><div class="pc-desc">Urgent tasks tackled</div></div>
    <div class="perf-card"><div class="pc-title">On-Time Rate</div><div class="pc-val" style="color:var(--accent2)">${onTimePct}%</div><div class="pc-desc">Completed on schedule</div></div>
    <div class="perf-card"><div class="pc-title">Overdue Now</div><div class="pc-val" style="color:${overdue>0?'var(--accent3)':'var(--accent)'}">${overdue}</div><div class="pc-desc">${overdue?'Need attention!':'All clear! âœ…'}</div></div>
  `;
  const subjects={};
  tasks.forEach(t=>{const s=t.subject||'General';if(!subjects[s])subjects[s]={total:0,done:0};subjects[s].total++;if(t.status==='completed')subjects[s].done++;});
  const colors=['var(--accent)','var(--accent2)','var(--accent3)','var(--accent4)','var(--accent5)'];
  document.getElementById('subjectProgress').innerHTML=Object.entries(subjects).map(([subj,data],i)=>{
    const p=data.total?Math.round(data.done/data.total*100):0;
    return`<div class="perf-item"><div class="perf-label">${subj}</div><div class="perf-bar-wrap"><div class="perf-bar" style="width:${p}%;background:${colors[i%colors.length]}"></div></div><div class="perf-pct">${p}%</div></div>`;
  }).join('')||'<div style="color:var(--text3);font-size:0.875rem;padding:10px 0;">Add tasks with subjects to see progress.</div>';
  const today=new Date();let hh='';
  for(let i=27;i>=0;i--){const d=new Date(today);d.setDate(d.getDate()-i);const ds=d.toISOString().split('T')[0];const count=tasks.filter(t=>t.status==='completed'&&t.updated_at&&t.updated_at.startsWith(ds)).length;const lvl=count===0?'':count===1?'l1':count===2?'l2':count<=4?'l3':'l4';hh+=`<div class="heat-cell ${lvl}" title="${ds}: ${count} completed"></div>`;}
  document.getElementById('heatmap').innerHTML=hh;
  const ctx2=document.getElementById('perfChart').getContext('2d');
  if(perfChartInst)perfChartInst.destroy();
  const weeks=['5w ago','4w ago','3w ago','2w ago','Last week','This week'];
  const accent=getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();
  const weekData=weeks.map((_,wi)=>{
    const start=new Date(today);start.setDate(start.getDate()-(5-wi)*7-6);
    const end=new Date(today);end.setDate(end.getDate()-(5-wi)*7);
    return tasks.filter(t=>{if(t.status!=='completed'||!t.updated_at)return false;const d=new Date(t.updated_at);return d>=start&&d<=end;}).length;
  });
  perfChartInst=new Chart(ctx2,{
    type:'bar',
    data:{labels:weeks,datasets:[{label:'Tasks Completed',data:weekData,backgroundColor:`${accent}30`,borderColor:accent,borderWidth:2,borderRadius:7}]},
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{ticks:{color:'var(--text3)'},grid:{color:getComputedStyle(document.documentElement).getPropertyValue('--surface3').trim()}},y:{ticks:{color:'var(--text3)',stepSize:1},grid:{color:getComputedStyle(document.documentElement).getPropertyValue('--surface3').trim()}}}}
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showPage(name,btn){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.sb-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('page-'+name).classList.add('active');
  if(btn)btn.classList.add('active');
  else{const b=document.querySelector(`[data-page="${name}"]`);if(b)b.classList.add('active');}
  if(name==='upcoming')loadUpcoming();
  if(name==='performance')renderPerformance();
  if(name==='dashboard')renderDashboard();
  closeSidebar();closeThemePicker();
}
function setBN(id){document.querySelectorAll('.bn-btn').forEach(b=>b.classList.remove('active'));document.getElementById(id)?.classList.add('active');}
function toggleSidebar(){const s=document.getElementById('sidebar');const o=document.getElementById('drawerOverlay');s.classList.toggle('open');o.classList.toggle('open');}
function closeSidebar(){document.getElementById('sidebar').classList.remove('open');document.getElementById('drawerOverlay').classList.remove('open');}
function toggleAI(){const p=document.getElementById('aiPanel');const o=document.getElementById('drawerOverlay');const open=p.classList.toggle('open');o.classList.toggle('open',open);document.getElementById('notifPanel').classList.remove('open');}
function closeAll(){document.getElementById('sidebar').classList.remove('open');document.getElementById('aiPanel').classList.remove('open');document.getElementById('notifPanel').classList.remove('open');document.getElementById('drawerOverlay').classList.remove('open');}
function setPriFilter(val,btn){filterPriority=val;document.querySelectorAll('.fchip').forEach(c=>c.classList.remove('active'));btn.classList.add('active');renderTasks();}
function quickFilter(val){filterStatus=val;showPage('tasks',null);renderTasks();}

async function loadUpcoming(){
  const items=await api('GET','/api/upcoming?days=14');
  const list=document.getElementById('upcomingList');
  if(!items.length){list.innerHTML=`<div class="empty-state"><div class="big">ğŸ‰</div><p>Nothing due in the next 2 weeks!</p></div>`;return;}
  list.innerHTML=items.map(t=>{
    const d=new Date(t.due_date+'T00:00:00');
    return`<div class="tl-item">
      <div class="tl-date"><div class="tl-day">${d.getDate()}</div><div class="tl-month">${d.toLocaleString('en',{month:'short'})}</div></div>
      <div class="tl-content"><div class="tl-title">${escHtml(t.title)}</div>
      <div class="tc-meta">${t.subject?`<span class="badge badge-subject">${escHtml(t.subject)}</span>`:''}<span class="badge badge-${t.priority}">${t.priority}</span></div></div>
      <div style="display:flex;gap:5px"><button class="icobtn" onclick="openEdit('${t.id}')">âœï¸</button><button class="icobtn" onclick="toggleComplete('${t.id}')">âœ…</button></div>
    </div>`;}).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CRUD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function submitTask(e){
  e.preventDefault();
  const data={title:document.getElementById('f-title').value,subject:document.getElementById('f-subject').value,due_date:document.getElementById('f-due').value||null,priority:document.getElementById('f-priority').value,status:document.getElementById('f-status').value,description:document.getElementById('f-desc').value};
  const res=await api('POST','/api/tasks',data);
  if(res.error){toast(res.error,'error');return;}
  toast('Task added! âœ…','success');addNotif(`New task: "${data.title}"`, 'â•');
  resetForm();await loadTasks();showPage('tasks',null);setBN('bn-tasks');
}
function resetForm(){['f-title','f-subject','f-due','f-desc'].forEach(id=>document.getElementById(id).value='');document.getElementById('f-priority').value='medium';document.getElementById('f-status').value='pending';}
async function deleteTask(id){
  if(!confirm('Delete this task?'))return;
  const t=tasks.find(t=>t.id===id);
  await api('DELETE',`/api/tasks/${id}`);
  toast('Task deleted','info');addNotif(`Deleted: "${t?.title}"`, 'ğŸ—‘');await loadTasks();
}
async function toggleComplete(id){
  const task=tasks.find(t=>t.id===id);if(!task)return;
  const ns=task.status==='completed'?'pending':'completed';
  await api('PUT',`/api/tasks/${id}`,{status:ns});
  toast(ns==='completed'?'âœ… Completed!':'ğŸ”„ Reopened','success');
  if(ns==='completed')addNotif(`Completed: "${task.title}"`, 'âœ…');
  await loadTasks();
}
function toggleSubtask(taskId,idx){const task=tasks.find(t=>t.id===taskId);if(!task||!task.subtasks)return;task.subtasks[idx].done=!task.subtasks[idx].done;renderTasks();}
function openEdit(id){
  const t=tasks.find(t=>t.id===id);if(!t)return;
  ['id','title','subject','due','priority','status','desc'].forEach(f=>{
    const el=document.getElementById('e-'+f);
    if(!el)return;
    el.value=t[f==='due'?'due_date':f==='desc'?'description':f]||'';
  });
  document.getElementById('e-id').value=t.id;
  document.getElementById('editModal').classList.add('open');
}
function closeModal(){document.getElementById('editModal').classList.remove('open');}
async function submitEdit(e){
  e.preventDefault();
  const id=document.getElementById('e-id').value;
  const data={title:document.getElementById('e-title').value,subject:document.getElementById('e-subject').value,due_date:document.getElementById('e-due').value||null,priority:document.getElementById('e-priority').value,status:document.getElementById('e-status').value,description:document.getElementById('e-desc').value};
  const res=await api('PUT',`/api/tasks/${id}`,data);
  if(res.error){toast(res.error,'error');return;}
  toast('Updated! âœ…','success');closeModal();await loadTasks();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function aiSuggestPriority(){
  const title=document.getElementById('f-title').value;if(!title){toast('Enter a title first','info');return;}
  toast('âœ¨ Asking AI...','info');
  try{
    const res=await api('POST','/api/ai/chat',{message:`Suggest priority (ONLY one word: low, medium, or high) for: "${title}"`,history:[]});
    const word=res.reply?.toLowerCase().match(/\b(low|medium|high)\b/);
    if(word){document.getElementById('f-priority').value=word[0];toast(`AI suggests: ${word[0]} priority âœ¨`,'success');}
  }catch{toast('AI unavailable','error');}
}
async function genSubtasks(){await genSubtasksForTask(document.getElementById('e-id').value);}
async function genSubtasksForTask(id){
  toast('âœ¨ Generating subtasks...','info');
  const res=await api('POST',`/api/ai/subtasks/${id}`);
  if(res.error){toast(res.error,'error');return;}
  const task=tasks.find(t=>t.id===id);
  if(task){task.subtasks=res.subtasks.map(s=>({text:s,done:false}));renderTasks();toast(`Generated ${res.subtasks.length} subtasks! âœ¨`,'success');}
}
function saveChatHistory(){if(currentUser)ls.set(SK.chat(currentUser.email),chatHistory.slice(-40));}
async function sendMsg(){
  const input=document.getElementById('aiInput');const msg=input.value.trim();if(!msg)return;
  input.value='';appendBubble('user',msg);chatHistory.push({role:'user',content:msg});saveChatHistory();
  document.getElementById('sendBtn').disabled=true;
  const tid='t-'+Date.now();
  document.getElementById('aiMessages').insertAdjacentHTML('beforeend',`<div class="msg ai" id="${tid}"><div class="msg-mav">ğŸ¤–</div><div class="msg-bub"><div class="typing-row"><div class="t-dot"></div><div class="t-dot"></div><div class="t-dot"></div></div></div></div>`);
  scrollChat();
  try{
    const res=await api('POST','/api/ai/chat',{message:msg,history:chatHistory.slice(-10)});
    document.getElementById(tid)?.remove();
    const reply=res.reply||res.error||'Something went wrong.';
    appendBubble('ai',reply);chatHistory.push({role:'assistant',content:reply});saveChatHistory();
  }catch{document.getElementById(tid)?.remove();appendBubble('ai','âš ï¸ Could not reach the server.');}
  document.getElementById('sendBtn').disabled=false;
}
function appendBubble(role,text){
  document.getElementById('aiMessages').insertAdjacentHTML('beforeend',
    `<div class="msg ${role}">${role==='ai'?`<div class="msg-mav">ğŸ¤–</div>`:''}<div class="msg-bub">${escHtml(text).replace(/\n/g,'<br>')}</div>${role==='user'?`<div class="msg-mav">ğŸ§‘</div>`:''}</div>`);
  scrollChat();
}
function scrollChat(){const el=document.getElementById('aiMessages');el.scrollTop=el.scrollHeight;}
function qp(text){document.getElementById('aiInput').value=text;sendMsg();}
function restoreChatUI(){
  const c=document.getElementById('aiMessages');c.innerHTML='';
  if(!chatHistory.length){c.innerHTML=`<div class="msg ai"><div class="msg-mav">ğŸ¤–</div><div class="msg-bub">Hey ${currentUser.name.split(' ')[0]}! ğŸ‘‹ I'm StudyBot AI â€” I can see all your tasks and remember our chats.<br><br>What can I help you with today?</div></div>`;return;}
  chatHistory.forEach(m=>{if(m.role!=='system')appendBubble(m.role==='user'?'user':'ai',m.content);});
}

// Keyboard shortcuts
document.addEventListener('keydown',e=>{
  if(e.key==='Escape'){closeModal();document.getElementById('notifPanel').classList.remove('open');closeThemePicker();}
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function init(){
  renderSavedUsers();
  const session=ls.get(SK.session);
  if(session?.email){
    const users=getUsers();
    if(users[session.email])startApp(session.email,users[session.email].name);
    else{ls.del(SK.session);showLanding();}
  } else showLanding();
})();
</script>
</body>
</html>