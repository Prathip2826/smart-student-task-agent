<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>StudyBot ‚Äî Smart Task Agent</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,wght@0,300;0,600;0,900;1,300&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root {
    --bg:#0d0d0f; --surface:#141417; --surface2:#1c1c21; --border:#2a2a32;
    --accent:#c8f060; --accent2:#60d4f0; --accent3:#f060a8;
    --text:#e8e8ec; --muted:#6b6b7a;
    --font-head:'Fraunces',Georgia,serif; --font-mono:'DM Mono',monospace;
    --r:12px; --r-lg:20px; --shadow:0 8px 40px rgba(0,0,0,0.5);
  }
  html { scroll-behavior:smooth; }
  body {
    background:var(--bg); color:var(--text);
    font-family:var(--font-mono); font-size:14px;
    line-height:1.6; min-height:100vh; overflow-x:hidden;
  }
  body::before {
    content:''; position:fixed; inset:0;
    background:radial-gradient(ellipse 60% 40% at 80% 10%,rgba(200,240,96,0.06) 0%,transparent 60%),
               radial-gradient(ellipse 50% 50% at 10% 80%,rgba(96,212,240,0.05) 0%,transparent 60%);
    pointer-events:none; z-index:0;
  }

  /* ‚îÄ‚îÄ DESKTOP LAYOUT ‚îÄ‚îÄ */
  .app {
    position:relative; z-index:1;
    display:grid;
    grid-template-columns:240px 1fr 300px;
    grid-template-rows:60px 1fr;
    height:100vh;
  }

  header {
    grid-column:1/-1;
    display:flex; align-items:center; justify-content:space-between;
    padding:0 20px; border-bottom:1px solid var(--border);
    background:rgba(13,13,15,0.95); backdrop-filter:blur(12px);
    position:sticky; top:0; z-index:50;
  }
  .logo { font-family:var(--font-head); font-size:20px; font-weight:900; letter-spacing:-0.5px; display:flex; align-items:center; gap:8px; }
  .logo span { color:var(--accent); }
  .logo-dot { width:8px; height:8px; border-radius:50%; background:var(--accent); animation:pulse 2s ease-in-out infinite; }
  @keyframes pulse { 0%,100%{opacity:1;transform:scale(1);} 50%{opacity:0.5;transform:scale(0.8);} }

  .header-stats { font-size:12px; color:var(--muted); }
  .header-stats strong { color:var(--accent); }
  .hamburger { display:none; flex-direction:column; gap:5px; background:none; border:none; cursor:pointer; padding:6px; }
  .hamburger span { display:block; width:22px; height:2px; background:var(--text); border-radius:2px; transition:all 0.3s; }
  .ai-toggle { display:none; background:rgba(200,240,96,0.12); border:1px solid rgba(200,240,96,0.25); color:var(--accent); font-family:var(--font-mono); font-size:12px; padding:6px 12px; border-radius:var(--r); cursor:pointer; }

  .sidebar { border-right:1px solid var(--border); padding:16px 12px; overflow-y:auto; background:var(--surface); }
  .sidebar-section { margin-bottom:24px; }
  .sidebar-label { font-size:10px; font-weight:500; letter-spacing:2px; text-transform:uppercase; color:var(--muted); margin-bottom:8px; padding:0 8px; }
  .nav-btn { display:flex; align-items:center; gap:10px; width:100%; padding:9px 12px; border-radius:var(--r); border:none; background:transparent; color:var(--muted); font-family:var(--font-mono); font-size:13px; cursor:pointer; transition:all 0.15s; text-align:left; }
  .nav-btn:hover { background:var(--surface2); color:var(--text); }
  .nav-btn.active { background:rgba(200,240,96,0.12); color:var(--accent); }
  .nav-btn .icon { font-size:16px; }
  .mini-stat { display:flex; justify-content:space-between; align-items:center; padding:6px 12px; font-size:12px; color:var(--muted); }
  .mini-stat .val { font-size:18px; font-family:var(--font-head); font-weight:600; color:var(--text); }
  .mini-stat .val.high { color:var(--accent3); }
  .mini-stat .val.done { color:var(--accent); }

  .main { overflow-y:auto; padding:20px 24px; display:flex; flex-direction:column; gap:18px; }
  .page { display:none; flex-direction:column; gap:18px; }
  .page.active { display:flex; }
  .page-title { font-family:var(--font-head); font-size:28px; font-weight:900; letter-spacing:-1px; line-height:1.1; }
  .page-title em { color:var(--accent); font-style:italic; }

  .toolbar { display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
  .filter-chip { padding:6px 14px; border-radius:100px; border:1px solid var(--border); background:transparent; color:var(--muted); font-family:var(--font-mono); font-size:12px; cursor:pointer; transition:all 0.15s; }
  .filter-chip:hover { border-color:var(--accent); color:var(--accent); }
  .filter-chip.active { background:var(--accent); color:var(--bg); border-color:var(--accent); }
  .search-box { flex:1; min-width:140px; max-width:260px; padding:8px 14px; border-radius:100px; border:1px solid var(--border); background:var(--surface2); color:var(--text); font-family:var(--font-mono); font-size:13px; outline:none; transition:border-color 0.2s; }
  .search-box:focus { border-color:var(--accent2); }
  .search-box::placeholder { color:var(--muted); }

  .task-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:12px; }
  .task-card { background:var(--surface); border:1px solid var(--border); border-radius:var(--r-lg); padding:16px 18px; transition:all 0.2s; cursor:pointer; position:relative; overflow:hidden; animation:cardIn 0.3s ease both; }
  @keyframes cardIn { from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);} }
  .task-card:hover { border-color:var(--accent2); transform:translateY(-2px); box-shadow:0 10px 28px rgba(0,0,0,0.4); }
  .task-card::before { content:''; position:absolute; top:0; left:0; right:0; height:3px; border-radius:var(--r-lg) var(--r-lg) 0 0; background:var(--accent2); opacity:0; transition:opacity 0.2s; }
  .task-card:hover::before { opacity:1; }
  .task-card.priority-high::before { background:var(--accent3); opacity:1; }
  .task-card.priority-medium::before { background:var(--accent); opacity:0.6; }
  .task-card-top { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:8px; }
  .task-title { font-family:var(--font-head); font-size:16px; font-weight:600; line-height:1.3; flex:1; }
  .task-card.completed .task-title { text-decoration:line-through; color:var(--muted); }
  .task-card-actions { display:flex; gap:4px; opacity:0; transition:opacity 0.2s; }
  .task-card:hover .task-card-actions { opacity:1; }
  @media (hover:none) { .task-card-actions { opacity:1 !important; } }

  .icon-btn { width:28px; height:28px; border-radius:8px; border:none; background:var(--surface2); color:var(--muted); font-size:13px; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all 0.15s; }
  .icon-btn:hover { background:var(--border); color:var(--text); }
  .icon-btn.danger:hover { background:rgba(240,96,168,0.2); color:var(--accent3); }
  .icon-btn.ai-btn:hover { background:rgba(200,240,96,0.15); color:var(--accent); }

  .task-meta { display:flex; gap:6px; flex-wrap:wrap; margin-top:10px; }
  .badge { padding:3px 8px; border-radius:100px; font-size:11px; font-weight:500; border:1px solid; }
  .badge-subject  { background:rgba(96,212,240,0.1);  color:var(--accent2); border-color:rgba(96,212,240,0.2); }
  .badge-high     { background:rgba(240,96,168,0.1);  color:var(--accent3); border-color:rgba(240,96,168,0.2); }
  .badge-medium   { background:rgba(200,240,96,0.1);  color:var(--accent);  border-color:rgba(200,240,96,0.2); }
  .badge-low      { background:rgba(107,107,122,0.2); color:var(--muted);   border-color:var(--border); }
  .badge-pending      { background:rgba(200,240,96,0.08); color:#a8c84a; border-color:rgba(200,240,96,0.15); }
  .badge-in-progress  { background:rgba(96,212,240,0.1);  color:var(--accent2); border-color:rgba(96,212,240,0.2); }
  .badge-completed    { background:rgba(107,107,122,0.2); color:var(--muted);   border-color:var(--border); }
  .task-due { font-size:12px; color:var(--muted); margin-top:6px; }
  .task-due.overdue { color:var(--accent3); }
  .task-desc { font-size:12px; color:var(--muted); margin-top:5px; line-height:1.5; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
  .subtasks-list { margin-top:10px; padding-top:10px; border-top:1px solid var(--border); display:flex; flex-direction:column; gap:4px; }
  .subtask-item { display:flex; align-items:center; gap:8px; font-size:12px; color:var(--muted); cursor:pointer; padding:2px 0; transition:color 0.15s; }
  .subtask-item:hover { color:var(--text); }
  .subtask-check { width:14px; height:14px; border-radius:3px; border:1px solid var(--border); flex-shrink:0; display:flex; align-items:center; justify-content:center; font-size:9px; transition:all 0.15s; }
  .subtask-item.done .subtask-check { background:var(--accent); border-color:var(--accent); color:var(--bg); }
  .subtask-item.done span { text-decoration:line-through; }
  .empty-state { grid-column:1/-1; text-align:center; padding:50px 20px; color:var(--muted); }
  .empty-state .big { font-size:44px; margin-bottom:10px; }
  .empty-state p { font-family:var(--font-head); font-style:italic; font-size:17px; }

  .add-form { background:var(--surface); border:1px solid var(--border); border-radius:var(--r-lg); padding:20px; display:flex; flex-direction:column; gap:14px; }
  .form-row { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
  .form-group { display:flex; flex-direction:column; gap:5px; }
  .form-group.full { grid-column:1/-1; }
  label { font-size:11px; letter-spacing:1px; text-transform:uppercase; color:var(--muted); }
  input[type="text"],input[type="date"],textarea,select { background:var(--surface2); border:1px solid var(--border); border-radius:var(--r); padding:10px 12px; color:var(--text); font-family:var(--font-mono); font-size:13px; outline:none; transition:border-color 0.2s; width:100%; }
  input:focus,textarea:focus,select:focus { border-color:var(--accent2); }
  input::placeholder,textarea::placeholder { color:var(--muted); }
  textarea { resize:vertical; min-height:70px; }
  select option { background:var(--surface2); }
  .btn { padding:10px 18px; border-radius:var(--r); border:none; font-family:var(--font-mono); font-size:13px; font-weight:500; cursor:pointer; transition:all 0.15s; display:inline-flex; align-items:center; gap:6px; }
  .btn-primary { background:var(--accent); color:var(--bg); }
  .btn-primary:hover { background:#d4f570; transform:translateY(-1px); }
  .btn-secondary { background:var(--surface2); color:var(--text); border:1px solid var(--border); }
  .btn-secondary:hover { border-color:var(--accent2); color:var(--accent2); }
  .btn-ai { background:rgba(200,240,96,0.12); color:var(--accent); border:1px solid rgba(200,240,96,0.25); }
  .btn-ai:hover { background:rgba(200,240,96,0.2); }
  .form-actions { display:flex; gap:8px; justify-content:flex-end; flex-wrap:wrap; }

  .ai-panel { border-left:1px solid var(--border); background:var(--surface); display:flex; flex-direction:column; overflow:hidden; }
  .ai-header { padding:14px 16px; border-bottom:1px solid var(--border); display:flex; align-items:center; gap:10px; }
  .ai-avatar { width:30px; height:30px; border-radius:9px; background:linear-gradient(135deg,var(--accent),var(--accent2)); display:flex; align-items:center; justify-content:center; font-size:15px; flex-shrink:0; }
  .ai-name { font-family:var(--font-head); font-weight:600; font-size:14px; }
  .ai-status { font-size:11px; color:var(--accent); }
  .ai-close { display:none; margin-left:auto; background:none; border:none; color:var(--muted); font-size:18px; cursor:pointer; padding:4px 8px; }
  .ai-messages { flex:1; overflow-y:auto; padding:14px; display:flex; flex-direction:column; gap:10px; scroll-behavior:smooth; }
  .msg { display:flex; gap:8px; animation:msgIn 0.2s ease both; }
  @keyframes msgIn { from{opacity:0;transform:translateY(5px);} to{opacity:1;transform:translateY(0);} }
  .msg.user { flex-direction:row-reverse; }
  .msg-bubble { max-width:85%; padding:9px 13px; border-radius:14px; font-size:13px; line-height:1.5; }
  .msg.ai .msg-bubble { background:var(--surface2); border:1px solid var(--border); border-bottom-left-radius:4px; color:var(--text); }
  .msg.user .msg-bubble { background:rgba(200,240,96,0.15); border:1px solid rgba(200,240,96,0.25); border-bottom-right-radius:4px; color:var(--text); }
  .msg-avatar { width:24px; height:24px; border-radius:7px; display:flex; align-items:center; justify-content:center; font-size:12px; flex-shrink:0; align-self:flex-end; }
  .msg.ai .msg-avatar { background:linear-gradient(135deg,var(--accent),var(--accent2)); }
  .msg.user .msg-avatar { background:var(--surface2); border:1px solid var(--border); }
  .quick-prompts { padding:10px 14px; display:flex; gap:6px; flex-wrap:wrap; border-top:1px solid var(--border); }
  .quick-btn { padding:5px 10px; border-radius:100px; border:1px solid var(--border); background:transparent; color:var(--muted); font-family:var(--font-mono); font-size:11px; cursor:pointer; transition:all 0.15s; white-space:nowrap; }
  .quick-btn:hover { border-color:var(--accent); color:var(--accent); background:rgba(200,240,96,0.08); }
  .ai-input-row { padding:10px 14px; display:flex; gap:8px; border-top:1px solid var(--border); }
  .ai-input { flex:1; background:var(--surface2); border:1px solid var(--border); border-radius:var(--r); padding:9px 12px; color:var(--text); font-family:var(--font-mono); font-size:13px; outline:none; transition:border-color 0.2s; }
  .ai-input:focus { border-color:var(--accent); }
  .send-btn { width:36px; height:36px; border-radius:10px; border:none; background:var(--accent); color:var(--bg); font-size:15px; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all 0.15s; flex-shrink:0; }
  .send-btn:hover { background:#d4f570; }
  .send-btn:disabled { background:var(--surface2); color:var(--muted); cursor:default; }
  .typing { display:flex; gap:4px; padding:9px 13px; }
  .typing-dot { width:6px; height:6px; border-radius:50%; background:var(--muted); animation:typingAnim 1.2s ease-in-out infinite; }
  .typing-dot:nth-child(2){animation-delay:0.15s;} .typing-dot:nth-child(3){animation-delay:0.3s;}
  @keyframes typingAnim { 0%,80%,100%{opacity:0.3;transform:scale(0.8);} 40%{opacity:1;transform:scale(1.1);} }

  .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.7); backdrop-filter:blur(4px); z-index:100; display:none; align-items:center; justify-content:center; padding:16px; }
  .modal-overlay.open { display:flex; }
  .modal { background:var(--surface); border:1px solid var(--border); border-radius:var(--r-lg); padding:24px; width:100%; max-width:500px; box-shadow:var(--shadow); animation:modalIn 0.2s ease; max-height:90vh; overflow-y:auto; }
  @keyframes modalIn { from{opacity:0;transform:scale(0.95);} to{opacity:1;transform:scale(1);} }
  .modal-title { font-family:var(--font-head); font-size:20px; font-weight:900; margin-bottom:18px; display:flex; align-items:center; gap:8px; }

  .toast-container { position:fixed; bottom:16px; right:16px; z-index:200; display:flex; flex-direction:column; gap:8px; }
  .toast { padding:10px 16px; border-radius:var(--r); border:1px solid var(--border); background:var(--surface2); font-size:13px; animation:toastIn 0.25s ease both; max-width:260px; box-shadow:var(--shadow); }
  @keyframes toastIn { from{opacity:0;transform:translateX(20px);} to{opacity:1;transform:translateX(0);} }
  .toast.success{border-color:rgba(200,240,96,0.4);color:var(--accent);}
  .toast.error  {border-color:rgba(240,96,168,0.4);color:var(--accent3);}
  .toast.info   {border-color:rgba(96,212,240,0.3);color:var(--accent2);}

  .timeline { display:flex; flex-direction:column; gap:10px; }
  .timeline-item { display:flex; gap:14px; align-items:flex-start; padding:14px 18px; background:var(--surface); border:1px solid var(--border); border-radius:var(--r-lg); animation:cardIn 0.3s ease both; transition:border-color 0.2s; }
  .timeline-item:hover { border-color:var(--accent2); }
  .timeline-date { text-align:center; min-width:46px; flex-shrink:0; }
  .timeline-day { font-family:var(--font-head); font-size:24px; font-weight:900; line-height:1; color:var(--accent); }
  .timeline-month { font-size:10px; color:var(--muted); letter-spacing:1px; text-transform:uppercase; }
  .timeline-content { flex:1; }
  .timeline-title { font-family:var(--font-head); font-size:15px; font-weight:600; margin-bottom:4px; }

  /* ‚îÄ‚îÄ BOTTOM NAV (mobile only) ‚îÄ‚îÄ */
  .bottom-nav { display:none; position:fixed; bottom:0; left:0; right:0; background:rgba(20,20,23,0.97); backdrop-filter:blur(12px); border-top:1px solid var(--border); z-index:40; padding:8px 0 calc(8px + env(safe-area-inset-bottom)); justify-content:space-around; align-items:center; }
  .bottom-nav-btn { display:flex; flex-direction:column; align-items:center; gap:3px; background:none; border:none; color:var(--muted); font-family:var(--font-mono); font-size:10px; cursor:pointer; padding:6px 12px; border-radius:var(--r); transition:all 0.15s; min-width:56px; }
  .bottom-nav-btn .bn-icon { font-size:20px; }
  .bottom-nav-btn.active { color:var(--accent); }

  .drawer-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:55; }
  .drawer-overlay.open { display:block; }

  ::-webkit-scrollbar { width:4px; }
  ::-webkit-scrollbar-track { background:transparent; }
  ::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }

  /* ‚îÄ‚îÄ TABLET (768‚Äì1023px) ‚îÄ‚îÄ */
  @media (max-width:1023px) {
    .app { grid-template-columns:200px 1fr; }
    .ai-panel { position:fixed; top:0; right:-100%; width:min(340px,90vw); height:100%; z-index:60; border-left:1px solid var(--border); transition:right 0.3s ease; box-shadow:-8px 0 32px rgba(0,0,0,0.5); }
    .ai-panel.open { right:0; }
    .ai-close { display:block; }
    .ai-toggle { display:flex; align-items:center; gap:6px; }
    .header-stats { display:none; }
  }

  /* ‚îÄ‚îÄ MOBILE (<768px) ‚îÄ‚îÄ */
  @media (max-width:767px) {
    .app { grid-template-columns:1fr; grid-template-rows:56px 1fr; height:100vh; }
    .sidebar { position:fixed; top:0; left:-100%; width:260px; height:100%; z-index:60; border-right:1px solid var(--border); transition:left 0.3s ease; box-shadow:8px 0 32px rgba(0,0,0,0.5); padding-top:72px; }
    .sidebar.open { left:0; }
    .hamburger { display:flex; }
    .ai-toggle { display:flex; align-items:center; gap:5px; font-size:11px; }
    .header-stats { display:none; }
    header { padding:0 14px; }
    .logo { font-size:18px; }
    .main { padding:16px 14px 80px; }
    .bottom-nav { display:flex; }
    .task-grid { grid-template-columns:1fr; }
    .form-row { grid-template-columns:1fr; }
    .page-title { font-size:22px; }
    .filter-chip { font-size:11px; padding:5px 10px; }
    .search-box { max-width:100%; }
    .modal { padding:18px; }
    .form-actions { justify-content:stretch; }
    .form-actions .btn { flex:1; justify-content:center; }
    .toast-container { bottom:76px; right:12px; left:12px; }
    .toast { max-width:100%; }
    .ai-panel { position:fixed; top:0; right:-100%; width:100%; height:100%; z-index:60; transition:right 0.3s ease; }
    .ai-panel.open { right:0; }
    .ai-close { display:block; }
  }

  /* ‚îÄ‚îÄ LARGE DESKTOP (>=1400px) ‚îÄ‚îÄ */
  @media (min-width:1400px) {
    .app { grid-template-columns:260px 1fr 320px; }
    .task-grid { grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); }
    .page-title { font-size:32px; }
  }
</style>
</head>
<body>
<div class="app">
  <header>
    <button class="hamburger" onclick="toggleSidebar()" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
    <div class="logo"><div class="logo-dot"></div>Study<span>Bot</span></div>
    <div class="header-stats" id="headerStats">Loading...</div>
    <button class="ai-toggle" onclick="toggleAI()">ü§ñ StudyBot</button>
  </header>

  <aside class="sidebar" id="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-label">Navigate</div>
      <button class="nav-btn active" data-page="tasks" onclick="showPage('tasks',this)"><span class="icon">üìã</span>All Tasks</button>
      <button class="nav-btn" data-page="upcoming" onclick="showPage('upcoming',this)"><span class="icon">üìÖ</span>Upcoming</button>
      <button class="nav-btn" data-page="add" onclick="showPage('add',this)"><span class="icon">‚úèÔ∏è</span>Add Task</button>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-label">Overview</div>
      <div class="mini-stat"><span>Pending</span><span class="val" id="statPending">‚Äî</span></div>
      <div class="mini-stat"><span>In Progress</span><span class="val" id="statInProgress">‚Äî</span></div>
      <div class="mini-stat"><span>Done</span><span class="val done" id="statDone">‚Äî</span></div>
      <div class="mini-stat"><span>High Priority</span><span class="val high" id="statHigh">‚Äî</span></div>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-label">Filter</div>
      <button class="nav-btn" onclick="filterByStatus('pending');closeSidebar()"><span class="icon">üü°</span>Pending</button>
      <button class="nav-btn" onclick="filterByStatus('in-progress');closeSidebar()"><span class="icon">üîµ</span>In Progress</button>
      <button class="nav-btn" onclick="filterByStatus('completed');closeSidebar()"><span class="icon">‚úÖ</span>Completed</button>
      <button class="nav-btn" onclick="filterByStatus(null);closeSidebar()"><span class="icon">üîÑ</span>Clear Filter</button>
    </div>
  </aside>

  <main class="main">
    <div class="page active" id="page-tasks">
      <h1 class="page-title">Your <em>Tasks</em></h1>
      <div class="toolbar">
        <input class="search-box" type="text" placeholder="üîç Search tasks..." id="searchBox" oninput="renderTasks()">
        <button class="filter-chip active" onclick="setFilter('all',this)">All</button>
        <button class="filter-chip" onclick="setFilter('high',this)">üî¥ High</button>
        <button class="filter-chip" onclick="setFilter('medium',this)">üü° Medium</button>
        <button class="filter-chip" onclick="setFilter('low',this)">üü¢ Low</button>
      </div>
      <div class="task-grid" id="taskGrid"></div>
    </div>

    <div class="page" id="page-upcoming">
      <h1 class="page-title"><em>Upcoming</em> Deadlines</h1>
      <div class="timeline" id="upcomingList"></div>
    </div>

    <div class="page" id="page-add">
      <h1 class="page-title">Add <em>New</em> Task</h1>
      <form class="add-form" onsubmit="submitTask(event)">
        <div class="form-group full"><label>Task Title *</label><input type="text" id="f-title" placeholder="e.g. Write Chemistry Lab Report" required></div>
        <div class="form-row">
          <div class="form-group"><label>Subject</label><input type="text" id="f-subject" placeholder="e.g. Chemistry"></div>
          <div class="form-group"><label>Due Date</label><input type="date" id="f-due"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Priority</label><select id="f-priority"><option value="medium">üü° Medium</option><option value="high">üî¥ High</option><option value="low">üü¢ Low</option></select></div>
          <div class="form-group"><label>Status</label><select id="f-status"><option value="pending">Pending</option><option value="in-progress">In Progress</option><option value="completed">Completed</option></select></div>
        </div>
        <div class="form-group full"><label>Notes</label><textarea id="f-desc" placeholder="Any extra details..."></textarea></div>
        <div class="form-actions">
          <button type="button" class="btn btn-ai" onclick="aiSuggestPriorityForNew()">‚ú® AI Priority</button>
          <button type="button" class="btn btn-secondary" onclick="resetForm()">Clear</button>
          <button type="submit" class="btn btn-primary">‚ûï Add Task</button>
        </div>
      </form>
    </div>
  </main>

  <aside class="ai-panel" id="aiPanel">
    <div class="ai-header">
      <div class="ai-avatar">ü§ñ</div>
      <div><div class="ai-name">StudyBot AI</div><div class="ai-status">‚óè Online ‚Äî Claude</div></div>
      <button class="ai-close" onclick="toggleAI()">‚úï</button>
    </div>
    <div class="ai-messages" id="aiMessages">
      <div class="msg ai">
        <div class="msg-avatar">ü§ñ</div>
        <div class="msg-bubble">Hey! üëã I'm StudyBot. I can see all your tasks and help you plan, prioritise, and stay on track.<br><br>Try asking me what to focus on today!</div>
      </div>
    </div>
    <div class="quick-prompts">
      <button class="quick-btn" onclick="quickPrompt('What should I focus on today?')">Focus today</button>
      <button class="quick-btn" onclick="quickPrompt('Am I overloaded this week?')">Overloaded?</button>
      <button class="quick-btn" onclick="quickPrompt('What are my high priority tasks?')">High priority</button>
      <button class="quick-btn" onclick="quickPrompt('Give me a study schedule')">Study plan</button>
    </div>
    <div class="ai-input-row">
      <input class="ai-input" id="aiInput" type="text" placeholder="Ask StudyBot..." onkeydown="if(event.key==='Enter')sendMessage()">
      <button class="send-btn" id="sendBtn" onclick="sendMessage()">‚û§</button>
    </div>
  </aside>
</div>

<!-- Bottom Nav -->
<nav class="bottom-nav">
  <button class="bottom-nav-btn active" id="bn-tasks" onclick="showPage('tasks',null);setBottomNav('bn-tasks')"><span class="bn-icon">üìã</span>Tasks</button>
  <button class="bottom-nav-btn" id="bn-upcoming" onclick="showPage('upcoming',null);setBottomNav('bn-upcoming')"><span class="bn-icon">üìÖ</span>Upcoming</button>
  <button class="bottom-nav-btn" id="bn-add" onclick="showPage('add',null);setBottomNav('bn-add')"><span class="bn-icon">‚ûï</span>Add</button>
  <button class="bottom-nav-btn" id="bn-ai" onclick="toggleAI()"><span class="bn-icon">ü§ñ</span>StudyBot</button>
</nav>

<div class="drawer-overlay" id="drawerOverlay" onclick="closeAll()"></div>

<div class="modal-overlay" id="editModal">
  <div class="modal">
    <div class="modal-title">‚úèÔ∏è Edit Task</div>
    <form onsubmit="submitEdit(event)" style="display:flex;flex-direction:column;gap:12px">
      <input type="hidden" id="e-id">
      <div class="form-group"><label>Title</label><input type="text" id="e-title" required></div>
      <div class="form-row">
        <div class="form-group"><label>Subject</label><input type="text" id="e-subject"></div>
        <div class="form-group"><label>Due Date</label><input type="date" id="e-due"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Priority</label><select id="e-priority"><option value="medium">üü° Medium</option><option value="high">üî¥ High</option><option value="low">üü¢ Low</option></select></div>
        <div class="form-group"><label>Status</label><select id="e-status"><option value="pending">Pending</option><option value="in-progress">In Progress</option><option value="completed">Completed</option></select></div>
      </div>
      <div class="form-group"><label>Notes</label><textarea id="e-desc"></textarea></div>
      <div class="form-actions">
        <button type="button" class="btn btn-ai" onclick="aiSubtasks()">‚ú® Subtasks</button>
        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        <button type="submit" class="btn btn-primary">Save</button>
      </div>
    </form>
  </div>
</div>

<div class="toast-container" id="toastContainer"></div>

<script>
let tasks=[],filterPriority='all',filterStatus=null,chatHistory=[];

function toast(msg,type='info'){const el=document.createElement('div');el.className=`toast ${type}`;el.textContent=msg;document.getElementById('toastContainer').appendChild(el);setTimeout(()=>el.remove(),3000);}
function formatDate(s){if(!s)return null;return new Date(s+'T00:00:00').toLocaleDateString('en-GB',{day:'numeric',month:'short',year:'numeric'});}
function isOverdue(s){return s&&new Date(s+'T23:59:59')<new Date();}
function escHtml(s){return(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

async function api(method,path,body){const res=await fetch(path,{method,headers:body?{'Content-Type':'application/json'}:{},body:body?JSON.stringify(body):undefined});return res.json();}

async function loadTasks(){try{tasks=await api('GET','/api/tasks');renderTasks();updateStats();}catch(e){toast('Cannot connect to server','error');}}
async function updateStats(){try{const s=await api('GET','/api/summary');document.getElementById('statPending').textContent=s.by_status.pending||0;document.getElementById('statInProgress').textContent=s.by_status['in-progress']||0;document.getElementById('statDone').textContent=s.by_status.completed||0;document.getElementById('statHigh').textContent=s.by_priority.high||0;document.getElementById('headerStats').innerHTML=`<strong>${s.total}</strong> tasks ¬∑ <strong>${s.by_status.pending||0}</strong> pending`;}catch(e){}}

function renderTasks(){const q=document.getElementById('searchBox').value.toLowerCase();let filtered=tasks.filter(t=>(filterPriority==='all'||t.priority===filterPriority)&&(!filterStatus||t.status===filterStatus)&&(!q||t.title.toLowerCase().includes(q)||(t.subject||'').toLowerCase().includes(q)||(t.description||'').toLowerCase().includes(q)));const grid=document.getElementById('taskGrid');if(!filtered.length){grid.innerHTML=`<div class="empty-state"><div class="big">üì≠</div><p>No tasks yet.<br>Add one to get started!</p></div>`;return;}grid.innerHTML=filtered.map(taskCard).join('');}

function taskCard(t){const overdue=isOverdue(t.due_date)&&t.status!=='completed';const sub=(t.subtasks||[]).map((s,i)=>`<div class="subtask-item ${s.done?'done':''}" onclick="toggleSubtask('${t.id}',${i})"><div class="subtask-check">${s.done?'‚úì':''}</div><span>${escHtml(s.text)}</span></div>`).join('');return`<div class="task-card priority-${t.priority} ${t.status==='completed'?'completed':''}"><div class="task-card-top"><div class="task-title">${escHtml(t.title)}</div><div class="task-card-actions"><button class="icon-btn ai-btn" onclick="openEditWithSubtasks('${t.id}')" title="AI subtasks">‚ú®</button><button class="icon-btn" onclick="openEdit('${t.id}')" title="Edit">‚úèÔ∏è</button><button class="icon-btn" onclick="quickComplete('${t.id}')" title="Done">‚úÖ</button><button class="icon-btn danger" onclick="deleteTask('${t.id}')" title="Delete">üóë</button></div></div>${t.description?`<div class="task-desc">${escHtml(t.description)}</div>`:''}<div class="task-meta">${t.subject?`<span class="badge badge-subject">${escHtml(t.subject)}</span>`:''}<span class="badge badge-${t.priority}">${t.priority}</span><span class="badge badge-${t.status}">${t.status}</span></div>${t.due_date?`<div class="task-due ${overdue?'overdue':''}">${overdue?'‚ö†Ô∏è':'üìÖ'} ${formatDate(t.due_date)}${overdue?' ‚Äî Overdue!':''}</div>`:''} ${sub?`<div class="subtasks-list">${sub}</div>`:''}</div>`;}

function showPage(name,btn){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));document.getElementById('page-'+name).classList.add('active');if(btn)btn.classList.add('active');if(name==='upcoming')loadUpcoming();closeSidebar();}
function setBottomNav(id){document.querySelectorAll('.bottom-nav-btn').forEach(b=>b.classList.remove('active'));document.getElementById(id)?.classList.add('active');}
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('open');document.getElementById('drawerOverlay').classList.toggle('open');}
function closeSidebar(){document.getElementById('sidebar').classList.remove('open');document.getElementById('drawerOverlay').classList.remove('open');}
function toggleAI(){const p=document.getElementById('aiPanel');const o=document.getElementById('drawerOverlay');const isOpen=p.classList.toggle('open');o.classList.toggle('open',isOpen);}
function closeAll(){document.getElementById('sidebar').classList.remove('open');document.getElementById('aiPanel').classList.remove('open');document.getElementById('drawerOverlay').classList.remove('open');}

async function loadUpcoming(){const items=await api('GET','/api/upcoming?days=14');const list=document.getElementById('upcomingList');if(!items.length){list.innerHTML=`<div class="empty-state"><div class="big">üéâ</div><p>Nothing due in the next 2 weeks!</p></div>`;return;}list.innerHTML=items.map(t=>{const d=new Date(t.due_date+'T00:00:00');return`<div class="timeline-item"><div class="timeline-date"><div class="timeline-day">${d.getDate()}</div><div class="timeline-month">${d.toLocaleString('en',{month:'short'})}</div></div><div class="timeline-content"><div class="timeline-title">${escHtml(t.title)}</div><div class="task-meta">${t.subject?`<span class="badge badge-subject">${escHtml(t.subject)}</span>`:''}<span class="badge badge-${t.priority}">${t.priority}</span></div></div><div style="display:flex;gap:6px;align-items:center"><button class="icon-btn" onclick="openEdit('${t.id}')">‚úèÔ∏è</button><button class="icon-btn" onclick="quickComplete('${t.id}')">‚úÖ</button></div></div>`;}).join('');}

function setFilter(val,btn){filterPriority=val;document.querySelectorAll('.filter-chip').forEach(c=>c.classList.remove('active'));btn.classList.add('active');renderTasks();}
function filterByStatus(val){filterStatus=val;showPage('tasks',document.querySelector('[data-page="tasks"]'));renderTasks();}

async function submitTask(e){e.preventDefault();const data={title:document.getElementById('f-title').value,subject:document.getElementById('f-subject').value,due_date:document.getElementById('f-due').value||null,priority:document.getElementById('f-priority').value,status:document.getElementById('f-status').value,description:document.getElementById('f-desc').value};const result=await api('POST','/api/tasks',data);if(result.error){toast(result.error,'error');return;}toast('Task added! ‚úÖ','success');resetForm();await loadTasks();showPage('tasks',document.querySelector('[data-page="tasks"]'));setBottomNav('bn-tasks');}
function resetForm(){['f-title','f-subject','f-due','f-desc'].forEach(id=>document.getElementById(id).value='');document.getElementById('f-priority').value='medium';document.getElementById('f-status').value='pending';}
async function deleteTask(id){if(!confirm('Delete this task?'))return;await api('DELETE',`/api/tasks/${id}`);toast('Task deleted','info');await loadTasks();}
async function quickComplete(id){const task=tasks.find(t=>t.id===id);if(!task)return;const ns=task.status==='completed'?'pending':'completed';await api('PUT',`/api/tasks/${id}`,{status:ns});toast(ns==='completed'?'‚úÖ Done!':'üîÑ Reopened','success');await loadTasks();}
function toggleSubtask(taskId,idx){const task=tasks.find(t=>t.id===taskId);if(!task||!task.subtasks)return;task.subtasks[idx].done=!task.subtasks[idx].done;renderTasks();}

function openEdit(id){const t=tasks.find(t=>t.id===id);if(!t)return;document.getElementById('e-id').value=t.id;document.getElementById('e-title').value=t.title;document.getElementById('e-subject').value=t.subject||'';document.getElementById('e-due').value=t.due_date||'';document.getElementById('e-priority').value=t.priority;document.getElementById('e-status').value=t.status;document.getElementById('e-desc').value=t.description||'';document.getElementById('editModal').classList.add('open');}
function closeModal(){document.getElementById('editModal').classList.remove('open');}
async function submitEdit(e){e.preventDefault();const id=document.getElementById('e-id').value;const data={title:document.getElementById('e-title').value,subject:document.getElementById('e-subject').value,due_date:document.getElementById('e-due').value||null,priority:document.getElementById('e-priority').value,status:document.getElementById('e-status').value,description:document.getElementById('e-desc').value};const result=await api('PUT',`/api/tasks/${id}`,data);if(result.error){toast(result.error,'error');return;}toast('Task updated! ‚úÖ','success');closeModal();await loadTasks();}

async function aiSuggestPriorityForNew(){const title=document.getElementById('f-title').value;if(!title){toast('Enter a title first','info');return;}toast('‚ú® Asking AI...','info');try{const res=await api('POST','/api/ai/chat',{message:`Suggest priority (reply with ONLY one word: low, medium, or high) for task: "${title}", subject:"${document.getElementById('f-subject').value}"`,history:[]});const word=res.reply?.toLowerCase().match(/\b(low|medium|high)\b/);if(word){document.getElementById('f-priority').value=word[0];toast(`AI suggests: ${word[0]} priority`,'success');}}catch(e){toast('AI unavailable','error');}}
async function openEditWithSubtasks(id){openEdit(id);await aiSubtasksForTask(id);}
async function aiSubtasks(){await aiSubtasksForTask(document.getElementById('e-id').value);}
async function aiSubtasksForTask(id){toast('‚ú® Generating subtasks...','info');const res=await api('POST',`/api/ai/subtasks/${id}`);if(res.error){toast(res.error,'error');return;}const task=tasks.find(t=>t.id===id);if(task){task.subtasks=res.subtasks.map(s=>({text:s,done:false}));renderTasks();toast(`Generated ${res.subtasks.length} subtasks! ‚ú®`,'success');}}

async function sendMessage(){const input=document.getElementById('aiInput');const msg=input.value.trim();if(!msg)return;input.value='';appendMsg('user',msg);chatHistory.push({role:'user',content:msg});document.getElementById('sendBtn').disabled=true;const typingId='typing-'+Date.now();document.getElementById('aiMessages').insertAdjacentHTML('beforeend',`<div class="msg ai" id="${typingId}"><div class="msg-avatar">ü§ñ</div><div class="msg-bubble"><div class="typing"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div></div></div>`);scrollChat();try{const res=await api('POST','/api/ai/chat',{message:msg,history:chatHistory.slice(-10)});document.getElementById(typingId)?.remove();const reply=res.reply||res.error||'Something went wrong.';appendMsg('ai',reply);chatHistory.push({role:'assistant',content:reply});}catch(e){document.getElementById(typingId)?.remove();appendMsg('ai','‚ö†Ô∏è Could not reach the server.');}document.getElementById('sendBtn').disabled=false;}
function appendMsg(role,text){const avatar=role==='ai'?'ü§ñ':'üßë';document.getElementById('aiMessages').insertAdjacentHTML('beforeend',`<div class="msg ${role}">${role==='ai'?`<div class="msg-avatar">${avatar}</div>`:''}<div class="msg-bubble">${escHtml(text).replace(/\n/g,'<br>')}</div>${role==='user'?`<div class="msg-avatar">${avatar}</div>`:''}</div>`);scrollChat();}
function scrollChat(){const el=document.getElementById('aiMessages');el.scrollTop=el.scrollHeight;}
function quickPrompt(text){document.getElementById('aiInput').value=text;sendMessage();}

loadTasks();
setInterval(loadTasks,30000);
</script>
</body>
</html>