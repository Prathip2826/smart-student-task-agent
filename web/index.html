<!DOCTYPE html>
<html lang="en" data-theme="ink">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>StudyBot</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Geist+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê THEMES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
[data-theme="ink"] {
  --bg:#0a0a0e; --surface:#111118; --surface2:#181820; --surface3:#1e1e28;
  --border:rgba(255,255,255,0.06); --border2:rgba(255,255,255,0.11);
  --text:#e8e8f0; --text2:rgba(232,232,240,0.5); --text3:rgba(232,232,240,0.25);
  --accent:#b4f040; --accent2:#40e0f0; --accent3:#f040a0;
  --adim:rgba(180,240,64,0.12); --aborder:rgba(180,240,64,0.22);
  --shadow:0 20px 60px rgba(0,0,0,0.6); --cshadow:0 4px 20px rgba(0,0,0,0.4);
}
[data-theme="paper"] {
  --bg:#f4efe6; --surface:#faf7f0; --surface2:#ece6da; --surface3:#e0d9cc;
  --border:rgba(0,0,0,0.07); --border2:rgba(0,0,0,0.13);
  --text:#1a1710; --text2:rgba(26,23,16,0.5); --text3:rgba(26,23,16,0.28);
  --accent:#c4401c; --accent2:#1c6ec4; --accent3:#8b1cc4;
  --adim:rgba(196,64,28,0.1); --aborder:rgba(196,64,28,0.22);
  --shadow:0 20px 60px rgba(0,0,0,0.12); --cshadow:0 2px 12px rgba(0,0,0,0.08);
}
[data-theme="slate"] {
  --bg:#0d1117; --surface:#161b22; --surface2:#1c2230; --surface3:#21293a;
  --border:rgba(255,255,255,0.07); --border2:rgba(255,255,255,0.12);
  --text:#d0d8e8; --text2:rgba(208,216,232,0.5); --text3:rgba(208,216,232,0.25);
  --accent:#58a6ff; --accent2:#56d364; --accent3:#f78166;
  --adim:rgba(88,166,255,0.12); --aborder:rgba(88,166,255,0.22);
  --shadow:0 20px 60px rgba(0,0,0,0.5); --cshadow:0 4px 16px rgba(0,0,0,0.3);
}
[data-theme="rose"] {
  --bg:#0f0a0a; --surface:#180e0e; --surface2:#201414; --surface3:#2a1a1a;
  --border:rgba(255,200,200,0.07); --border2:rgba(255,200,200,0.12);
  --text:#f0e8e8; --text2:rgba(240,232,232,0.5); --text3:rgba(240,232,232,0.25);
  --accent:#ff6b8a; --accent2:#ffaa6b; --accent3:#c86bff;
  --adim:rgba(255,107,138,0.12); --aborder:rgba(255,107,138,0.22);
  --shadow:0 20px 60px rgba(0,0,0,0.6); --cshadow:0 4px 20px rgba(0,0,0,0.4);
}
[data-theme="mint"] {
  --bg:#eef5f1; --surface:#ffffff; --surface2:#e4f0eb; --surface3:#d6e8e0;
  --border:rgba(0,0,0,0.07); --border2:rgba(0,0,0,0.12);
  --text:#0c1e16; --text2:rgba(12,30,22,0.5); --text3:rgba(12,30,22,0.28);
  --accent:#0a7c55; --accent2:#0a5a7c; --accent3:#7c0a5a;
  --adim:rgba(10,124,85,0.1); --aborder:rgba(10,124,85,0.2);
  --shadow:0 20px 60px rgba(0,0,0,0.1); --cshadow:0 2px 12px rgba(0,0,0,0.07);
}
[data-theme="dusk"] {
  --bg:#08060f; --surface:#100d1a; --surface2:#171222; --surface3:#1e162a;
  --border:rgba(200,180,255,0.07); --border2:rgba(200,180,255,0.12);
  --text:#ece8f8; --text2:rgba(236,232,248,0.5); --text3:rgba(236,232,248,0.25);
  --accent:#c084fc; --accent2:#67e8f9; --accent3:#fb7185;
  --adim:rgba(192,132,252,0.12); --aborder:rgba(192,132,252,0.22);
  --shadow:0 20px 60px rgba(0,0,0,0.65); --cshadow:0 4px 20px rgba(0,0,0,0.45);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BASE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
html { scroll-behavior: smooth; }

body {
  background: var(--bg); color: var(--text);
  font-family: 'Geist Mono', monospace;
  font-size: 13px; line-height: 1.65;
  min-height: 100vh; overflow-x: hidden;
  transition: background .3s, color .3s;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#authScreen {
  position: fixed; inset: 0; z-index: 300;
  display: flex; align-items: center; justify-content: center;
  background: var(--bg); padding: 20px;
}

.auth-wrap { width: 100%; max-width: 372px; animation: riseIn .4s cubic-bezier(.22,1,.36,1) both; }

.auth-logo { text-align: center; margin-bottom: 28px; }
.auth-wordmark { font-family:'Instrument Serif',Georgia,serif; font-size:34px; font-style:italic; letter-spacing:-1px; color:var(--text); line-height:1; }
.auth-wordmark span { color:var(--accent); }
.auth-tagline { font-size:10px; letter-spacing:2.5px; text-transform:uppercase; color:var(--text3); margin-top:6px; }

.auth-card { background:var(--surface); border:1px solid var(--border2); border-radius:18px; padding:28px; }

.auth-tabs { display:flex; background:var(--surface2); border-radius:9px; padding:3px; margin-bottom:22px; }
.auth-tab { flex:1; padding:8px; border:none; background:transparent; color:var(--text3); font-family:'Geist Mono',monospace; font-size:12px; font-weight:500; cursor:pointer; border-radius:6px; transition:all .18s; letter-spacing:.3px; }
.auth-tab.active { background:var(--accent); color:var(--bg); font-weight:600; }

.afield { margin-bottom:14px; }
.afield label { display:block; font-size:10px; font-weight:600; letter-spacing:1.5px; text-transform:uppercase; color:var(--text3); margin-bottom:6px; }
.afield input { width:100%; background:var(--surface2); border:1px solid var(--border2); border-radius:9px; padding:10px 13px; color:var(--text); font-family:'Geist Mono',monospace; font-size:12px; outline:none; transition:border-color .18s,box-shadow .18s; }
.afield input:focus { border-color:var(--accent); box-shadow:0 0 0 3px var(--adim); }
.afield input::placeholder { color:var(--text3); }

.auth-submit { width:100%; padding:11px; background:var(--accent); color:var(--bg); border:none; border-radius:9px; font-family:'Geist Mono',monospace; font-size:13px; font-weight:600; cursor:pointer; transition:opacity .15s,transform .15s; margin-top:4px; }
.auth-submit:hover { opacity:.85; transform:translateY(-1px); }

.auth-err { font-size:11px; color:var(--accent3); text-align:center; margin-top:10px; min-height:16px; }

.saved-users { margin-top:18px; padding-top:16px; border-top:1px solid var(--border); }
.saved-lbl { font-size:9px; font-weight:600; letter-spacing:2px; text-transform:uppercase; color:var(--text3); margin-bottom:9px; }
.uchip { display:inline-flex; align-items:center; gap:5px; padding:5px 11px; background:var(--surface2); border:1px solid var(--border); border-radius:100px; font-size:11px; cursor:pointer; margin:2px; color:var(--text2); transition:all .15s; }
.uchip:hover { border-color:var(--accent); color:var(--accent); background:var(--adim); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê APP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.app { position:relative; z-index:1; display:grid; grid-template-columns:224px 1fr 296px; grid-template-rows:52px 1fr; height:100vh; }

/* Header */
header { grid-column:1/-1; display:flex; align-items:center; justify-content:space-between; padding:0 16px; border-bottom:1px solid var(--border); background:var(--bg); position:sticky; top:0; z-index:50; transition:background .3s; }

.h-left { display:flex; align-items:center; gap:10px; }

.logo { font-family:'Instrument Serif',Georgia,serif; font-size:18px; font-style:italic; letter-spacing:-.5px; color:var(--text); display:flex; align-items:center; gap:7px; }
.logo span { color:var(--accent); }
.logo-dot { width:6px; height:6px; border-radius:50%; background:var(--accent); animation:pulse 2.2s ease-in-out infinite; }
@keyframes pulse { 0%,100%{opacity:1;transform:scale(1);} 50%{opacity:.3;transform:scale(.7);} }

.hnav { display:flex; gap:2px; background:var(--surface2); border:1px solid var(--border); border-radius:100px; padding:3px; }
.hnav-btn { padding:5px 13px; border:none; border-radius:100px; background:transparent; color:var(--text3); font-family:'Geist Mono',monospace; font-size:11px; font-weight:500; cursor:pointer; transition:all .15s; letter-spacing:.3px; }
.hnav-btn.active,.hnav-btn:hover { background:var(--surface3); color:var(--text); }
.hnav-btn.active { color:var(--accent); }

.h-right { display:flex; align-items:center; gap:7px; }

.hstat { font-size:11px; color:var(--text3); padding:5px 11px; background:var(--surface2); border:1px solid var(--border); border-radius:100px; }
.hstat strong { color:var(--accent); font-weight:600; }

/* Theme switcher */
.theme-wrap { position:relative; }

.theme-trigger { display:flex; align-items:center; gap:6px; padding:5px 11px; background:var(--surface2); border:1px solid var(--border); border-radius:100px; color:var(--text2); font-family:'Geist Mono',monospace; font-size:11px; cursor:pointer; transition:all .15s; }
.theme-trigger:hover { border-color:var(--border2); color:var(--text); }

.theme-popup { position:absolute; top:calc(100% + 7px); right:0; background:var(--surface); border:1px solid var(--border2); border-radius:14px; padding:12px; width:210px; box-shadow:var(--shadow); z-index:200; display:none; animation:dropIn .2s cubic-bezier(.22,1,.36,1); }
.theme-popup.open { display:block; }
@keyframes dropIn { from{opacity:0;transform:translateY(-7px) scale(.96);} to{opacity:1;transform:translateY(0) scale(1);} }

.tp-label { font-size:9px; font-weight:600; letter-spacing:2px; text-transform:uppercase; color:var(--text3); margin-bottom:9px; padding:0 2px; }
.tp-grid { display:grid; grid-template-columns:1fr 1fr; gap:5px; }

.tp-opt { display:flex; flex-direction:column; align-items:center; gap:6px; padding:9px 5px; border-radius:9px; border:1px solid var(--border); background:var(--surface2); cursor:pointer; transition:all .15s; font-size:10px; color:var(--text2); letter-spacing:.3px; }
.tp-opt:hover { border-color:var(--border2); color:var(--text); }
.tp-opt.active { border-color:var(--accent); color:var(--accent); background:var(--adim); }

.tp-swatch { width:30px; height:18px; border-radius:5px; flex-shrink:0; }

/* AI toggle */
.ai-toggle { display:flex; align-items:center; gap:6px; padding:5px 11px; background:var(--adim); border:1px solid var(--aborder); border-radius:100px; color:var(--accent); font-family:'Geist Mono',monospace; font-size:11px; font-weight:600; cursor:pointer; transition:all .18s; letter-spacing:.3px; }
.ai-toggle:hover { background:var(--accent); color:var(--bg); }

.user-pill { display:flex; align-items:center; gap:7px; padding:4px 11px 4px 4px; background:var(--surface2); border:1px solid var(--border); border-radius:100px; color:var(--text2); font-size:11px; cursor:pointer; transition:all .18s; }
.user-pill:hover { border-color:var(--accent3); color:var(--accent3); }
.user-ava { width:24px; height:24px; border-radius:50%; background:linear-gradient(135deg,var(--accent),var(--accent2)); display:flex; align-items:center; justify-content:center; font-size:11px; font-weight:700; color:var(--bg); }

.hamburger { display:none; flex-direction:column; gap:5px; background:none; border:none; cursor:pointer; padding:5px; }
.hamburger span { display:block; width:18px; height:1.5px; background:var(--text2); border-radius:2px; }

/* Sidebar */
.sidebar { border-right:1px solid var(--border); padding:14px 8px; overflow-y:auto; background:var(--surface); transition:background .3s; }
.sb-section { margin-bottom:22px; }
.sb-lbl { font-size:9px; font-weight:600; letter-spacing:2.5px; text-transform:uppercase; color:var(--text3); margin-bottom:4px; padding:0 10px; }
.nav-btn { display:flex; align-items:center; gap:9px; width:100%; padding:8px 11px; border-radius:8px; border:none; background:transparent; color:var(--text2); font-family:'Geist Mono',monospace; font-size:12px; cursor:pointer; transition:all .15s; text-align:left; }
.nav-btn:hover { background:var(--surface2); color:var(--text); }
.nav-btn.active { background:var(--adim); color:var(--accent); border:1px solid var(--aborder); }
.nav-btn .icon { font-size:13px; }
.stat-pill { display:flex; justify-content:space-between; align-items:center; padding:5px 11px; font-size:11px; color:var(--text3); }
.stat-pill .v { font-family:'Instrument Serif',Georgia,serif; font-size:21px; color:var(--text2); }
.stat-pill .v.g { color:var(--accent); }
.stat-pill .v.r { color:var(--accent3); }

/* Main */
.main { overflow-y:auto; padding:22px 24px; display:flex; flex-direction:column; gap:18px; }
.page { display:none; flex-direction:column; gap:18px; }
.page.active { display:flex; animation:fadeUp .2s ease; }
@keyframes fadeUp { from{opacity:0;transform:translateY(6px);} to{opacity:1;transform:translateY(0);} }
@keyframes riseIn { from{opacity:0;transform:translateY(22px);} to{opacity:1;transform:translateY(0);} }

.page-title { font-family:'Instrument Serif',Georgia,serif; font-size:30px; font-style:italic; letter-spacing:-1px; line-height:1.1; color:var(--text); display:flex; align-items:baseline; gap:12px; }
.page-title em { color:var(--accent); }
.title-count { font-family:'Geist Mono',monospace; font-size:11px; font-weight:500; color:var(--text3); font-style:normal; }

/* Dashboard hero */
.dash-hero { background:var(--surface); border:1px solid var(--border); border-radius:15px; padding:22px 26px; position:relative; overflow:hidden; }
.dash-hero::after { content:''; position:absolute; top:0; right:0; width:280px; height:100%; background:radial-gradient(ellipse at 80% 50%,var(--adim),transparent 70%); pointer-events:none; }
.dash-tag { font-size:10px; font-weight:600; letter-spacing:2px; text-transform:uppercase; color:var(--accent); margin-bottom:8px; display:flex; align-items:center; gap:7px; }
.dash-tag::before { content:''; display:block; width:14px; height:1px; background:var(--accent); }
.dash-greet { font-family:'Instrument Serif',Georgia,serif; font-size:26px; font-style:italic; letter-spacing:-.5px; line-height:1.15; color:var(--text); margin-bottom:6px; }
.dash-greet span { color:var(--accent); }
.dash-sub { font-size:12px; color:var(--text2); line-height:1.6; max-width:380px; margin-bottom:16px; }

.progress-row { display:flex; align-items:center; gap:11px; margin-bottom:16px; }
.progress-track { flex:1; max-width:190px; height:3px; background:var(--surface3); border-radius:2px; overflow:hidden; }
.progress-fill { height:100%; background:var(--accent); border-radius:2px; transition:width 1s cubic-bezier(.22,1,.36,1); }
.progress-lbl { font-size:11px; color:var(--text3); }
.progress-pct { font-size:11px; color:var(--accent); font-weight:600; }

.dash-ctas { display:flex; gap:8px; flex-wrap:wrap; }
.dcta { display:inline-flex; align-items:center; gap:6px; padding:8px 15px; border-radius:8px; border:none; font-family:'Geist Mono',monospace; font-size:12px; font-weight:500; cursor:pointer; transition:all .18s; letter-spacing:.2px; }
.dcta.p { background:var(--accent); color:var(--bg); }
.dcta.p:hover { opacity:.85; transform:translateY(-1px); }
.dcta.s { background:var(--surface2); color:var(--text2); border:1px solid var(--border2); }
.dcta.s:hover { color:var(--text); border-color:var(--accent); }

/* Stats grid */
.stats-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(135px,1fr)); gap:9px; }
.scard { background:var(--surface); border:1px solid var(--border); border-radius:13px; padding:15px 17px; display:flex; flex-direction:column; gap:4px; transition:border-color .18s,transform .18s; animation:fadeUp .3s ease both; }
.scard:hover { border-color:var(--border2); transform:translateY(-2px); }
.scard:nth-child(1){animation-delay:.04s;} .scard:nth-child(2){animation-delay:.08s;} .scard:nth-child(3){animation-delay:.12s;} .scard:nth-child(4){animation-delay:.16s;} .scard:nth-child(5){animation-delay:.20s;} .scard:nth-child(6){animation-delay:.24s;}
.scard-lbl { font-size:9px; font-weight:600; letter-spacing:1.5px; text-transform:uppercase; color:var(--text3); }
.scard-val { font-family:'Instrument Serif',Georgia,serif; font-size:36px; line-height:1; letter-spacing:-2px; color:var(--text); }
.scard-val.a{color:var(--accent);} .scard-val.b{color:var(--accent2);} .scard-val.c{color:var(--accent3);}
.scard-sub { font-size:11px; color:var(--text3); }

/* Panels */
.panels-row { display:grid; grid-template-columns:1.1fr .9fr; gap:11px; }
.panel { background:var(--surface); border:1px solid var(--border); border-radius:13px; padding:18px 19px; transition:background .3s; animation:fadeUp .3s ease .1s both; }
.panel-title { font-size:9px; font-weight:600; letter-spacing:2px; text-transform:uppercase; color:var(--text3); margin-bottom:13px; display:flex; align-items:center; gap:8px; }
.panel-title::after { content:''; flex:1; height:1px; background:var(--border); }
.chart-wrap { position:relative; height:155px; }

.streak-row { display:flex; gap:5px; flex-wrap:wrap; }
.sday { width:28px; height:28px; border-radius:6px; background:var(--surface2); border:1px solid var(--border); display:flex; align-items:center; justify-content:center; font-size:9px; font-weight:600; color:var(--text3); transition:all .18s; }
.sday.on { background:var(--adim); border-color:var(--aborder); color:var(--accent); }
.sday.today { background:var(--accent); border-color:var(--accent); color:var(--bg); }
.streak-note { font-size:11px; color:var(--text3); margin-top:11px; }

.recent-row { display:flex; justify-content:space-between; align-items:center; padding:8px 0; border-bottom:1px solid var(--border); font-size:12px; gap:10px; }
.recent-row:last-child { border-bottom:none; }
.recent-name { flex:1; color:var(--text2); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

/* Toolbar */
.toolbar { display:flex; align-items:center; gap:7px; flex-wrap:wrap; background:var(--surface); border:1px solid var(--border); border-radius:11px; padding:9px 12px; }
.tdiv { width:1px; height:18px; background:var(--border); flex-shrink:0; }
.chip { padding:5px 13px; border-radius:100px; border:1px solid var(--border); background:transparent; color:var(--text3); font-family:'Geist Mono',monospace; font-size:11px; font-weight:500; cursor:pointer; transition:all .15s; letter-spacing:.2px; }
.chip:hover { border-color:var(--border2); color:var(--text2); }
.chip.on { background:var(--accent); color:var(--bg); border-color:var(--accent); font-weight:600; }
.searchbox { flex:1; min-width:130px; max-width:250px; padding:6px 12px; border-radius:100px; border:1px solid var(--border); background:var(--surface2); color:var(--text); font-family:'Geist Mono',monospace; font-size:12px; outline:none; transition:all .18s; }
.searchbox:focus { border-color:var(--accent); box-shadow:0 0 0 3px var(--adim); }
.searchbox::placeholder { color:var(--text3); }

/* Task cards */
.task-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(262px,1fr)); gap:9px; }
.tcard { background:var(--surface); border:1px solid var(--border); border-radius:13px; padding:15px 17px; transition:border-color .18s,transform .18s,box-shadow .18s; position:relative; overflow:hidden; animation:fadeUp .24s ease both; }
.tcard::before { content:''; position:absolute; top:0; left:0; right:0; height:2px; background:var(--border); transition:background .2s; }
.tcard:hover { border-color:var(--border2); transform:translateY(-2px); box-shadow:var(--cshadow); }
.tcard.p-high::before { background:var(--accent3); }
.tcard.p-medium::before { background:var(--accent2); opacity:.7; }
.tcard.completed { opacity:.58; }

.tc-top { display:flex; justify-content:space-between; align-items:flex-start; gap:8px; margin-bottom:5px; }
.tc-title { font-family:'Instrument Serif',Georgia,serif; font-size:15px; font-style:italic; line-height:1.35; flex:1; color:var(--text); }
.tcard.completed .tc-title { text-decoration:line-through; color:var(--text3); font-style:normal; }

.tc-acts { display:flex; gap:3px; opacity:0; transition:opacity .18s; flex-shrink:0; }
.tcard:hover .tc-acts { opacity:1; }
@media(hover:none){.tc-acts{opacity:1!important;}}

.ibt { width:25px; height:25px; border-radius:6px; border:1px solid var(--border); background:var(--surface2); color:var(--text3); font-size:11px; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all .15s; }
.ibt:hover { background:var(--surface3); color:var(--text); border-color:var(--border2); }
.ibt.del:hover { background:var(--adim); color:var(--accent3); border-color:var(--accent3); }
.ibt.ai:hover { background:var(--adim); color:var(--accent); border-color:var(--aborder); }

.tc-desc { font-size:11px; color:var(--text3); margin-top:5px; line-height:1.6; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
.tc-meta { display:flex; gap:5px; flex-wrap:wrap; margin-top:9px; }

.badge { padding:2px 8px; border-radius:100px; font-size:10px; font-weight:600; border:1px solid; letter-spacing:.3px; }
.b-subj { background:var(--adim); color:var(--accent); border-color:var(--aborder); }
.b-high { color:var(--accent3); border-color:var(--accent3); background:transparent; }
.b-medium { color:var(--accent2); border-color:var(--accent2); background:transparent; }
.b-low,.b-pending { color:var(--text3); border-color:var(--border2); background:transparent; }
.b-in-progress { color:var(--accent2); border-color:var(--accent2); background:transparent; }
.b-completed { color:var(--text3); border-color:var(--border); background:transparent; }

.tc-due { font-size:11px; color:var(--text3); margin-top:6px; }
.tc-due.od { color:var(--accent3); }

.sub-list { margin-top:9px; padding-top:9px; border-top:1px solid var(--border); display:flex; flex-direction:column; gap:4px; }
.sub-item { display:flex; align-items:center; gap:8px; font-size:11px; color:var(--text3); cursor:pointer; padding:2px 0; transition:color .15s; }
.sub-item:hover { color:var(--text2); }
.sub-chk { width:13px; height:13px; border-radius:3px; border:1px solid var(--border2); flex-shrink:0; display:flex; align-items:center; justify-content:center; font-size:8px; transition:all .15s; }
.sub-item.done .sub-chk { background:var(--accent); border-color:var(--accent); color:var(--bg); }
.sub-item.done span { text-decoration:line-through; opacity:.4; }

.empty { grid-column:1/-1; text-align:center; padding:52px 20px; color:var(--text3); }
.empty-ico { font-size:38px; display:block; margin-bottom:12px; opacity:.35; }
.empty-txt { font-family:'Instrument Serif',Georgia,serif; font-size:17px; font-style:italic; }

/* Forms */
.form-card { background:var(--surface); border:1px solid var(--border); border-radius:14px; padding:22px; display:flex; flex-direction:column; gap:13px; }
.form-row { display:grid; grid-template-columns:1fr 1fr; gap:11px; }
.fg { display:flex; flex-direction:column; gap:6px; }
.fg.full { grid-column:1/-1; }
.fg label { font-size:10px; font-weight:600; letter-spacing:1.5px; text-transform:uppercase; color:var(--text3); }
.fg input,.fg textarea,.fg select { background:var(--surface2); border:1px solid var(--border2); border-radius:9px; padding:10px 13px; color:var(--text); font-family:'Geist Mono',monospace; font-size:12px; outline:none; transition:all .18s; width:100%; }
.fg input:focus,.fg textarea:focus,.fg select:focus { border-color:var(--accent); box-shadow:0 0 0 3px var(--adim); background:var(--surface3); }
.fg input::placeholder,.fg textarea::placeholder { color:var(--text3); }
.fg textarea { resize:vertical; min-height:76px; }
.fg select option { background:var(--surface2); }
.form-acts { display:flex; gap:7px; justify-content:flex-end; flex-wrap:wrap; padding-top:3px; }

.btn { padding:9px 17px; border-radius:8px; border:none; font-family:'Geist Mono',monospace; font-size:12px; font-weight:600; cursor:pointer; transition:all .18s; display:inline-flex; align-items:center; gap:6px; letter-spacing:.2px; }
.btn-p { background:var(--accent); color:var(--bg); }
.btn-p:hover { opacity:.85; transform:translateY(-1px); }
.btn-s { background:var(--surface2); color:var(--text2); border:1px solid var(--border2); }
.btn-s:hover { border-color:var(--accent); color:var(--accent); }
.btn-ai { background:var(--adim); color:var(--accent); border:1px solid var(--aborder); }
.btn-ai:hover { background:var(--accent); color:var(--bg); }

/* Timeline */
.timeline { display:flex; flex-direction:column; gap:8px; }
.tl-item { display:flex; gap:13px; align-items:flex-start; padding:13px 17px; background:var(--surface); border:1px solid var(--border); border-radius:13px; animation:fadeUp .24s ease both; transition:border-color .18s,transform .18s; }
.tl-item:hover { border-color:var(--border2); transform:translateX(3px); }
.tl-date { text-align:center; min-width:38px; flex-shrink:0; padding:6px 7px; background:var(--adim); border:1px solid var(--aborder); border-radius:8px; }
.tl-day { font-family:'Instrument Serif',Georgia,serif; font-size:23px; line-height:1; color:var(--accent); }
.tl-mon { font-size:9px; font-weight:600; color:var(--accent); letter-spacing:1.5px; text-transform:uppercase; }
.tl-body { flex:1; min-width:0; }
.tl-title { font-family:'Instrument Serif',Georgia,serif; font-size:15px; font-style:italic; color:var(--text); margin-bottom:6px; }
.tl-acts { display:flex; gap:5px; align-items:center; flex-shrink:0; }

/* AI Panel */
.ai-panel { border-left:1px solid var(--border); background:var(--surface); display:flex; flex-direction:column; overflow:hidden; transition:background .3s; }
.ai-header { padding:13px 15px; border-bottom:1px solid var(--border); display:flex; align-items:center; gap:10px; }
.ai-ava { width:30px; height:30px; border-radius:8px; background:var(--adim); border:1px solid var(--aborder); display:flex; align-items:center; justify-content:center; font-size:15px; flex-shrink:0; }
.ai-name { font-family:'Instrument Serif',Georgia,serif; font-size:14px; font-style:italic; color:var(--text); }
.ai-stat { font-size:10px; color:var(--accent); display:flex; align-items:center; gap:4px; margin-top:1px; }
.ai-close { display:none; margin-left:auto; background:none; border:none; color:var(--text3); font-size:15px; cursor:pointer; padding:4px 8px; }
.ai-close:hover { color:var(--accent3); }

.ai-msgs { flex:1; overflow-y:auto; padding:13px; display:flex; flex-direction:column; gap:10px; scroll-behavior:smooth; }
.msg { display:flex; gap:7px; animation:fadeUp .18s ease both; }
.msg.user { flex-direction:row-reverse; }
.msg-bub { max-width:88%; padding:9px 12px; border-radius:12px; font-size:12px; line-height:1.6; }
.msg.ai .msg-bub { background:var(--surface2); border:1px solid var(--border); border-bottom-left-radius:3px; color:var(--text2); }
.msg.user .msg-bub { background:var(--adim); border:1px solid var(--aborder); border-bottom-right-radius:3px; color:var(--text); }
.msg-ava { width:23px; height:23px; border-radius:6px; display:flex; align-items:center; justify-content:center; font-size:11px; flex-shrink:0; align-self:flex-end; }
.msg.ai .msg-ava { background:var(--adim); border:1px solid var(--aborder); }
.msg.user .msg-ava { background:var(--surface2); border:1px solid var(--border); }

.quick-p { padding:9px 13px; display:flex; gap:5px; flex-wrap:wrap; border-top:1px solid var(--border); }
.qbtn { padding:4px 10px; border-radius:100px; border:1px solid var(--border); background:transparent; color:var(--text3); font-family:'Geist Mono',monospace; font-size:10px; font-weight:500; cursor:pointer; transition:all .15s; white-space:nowrap; }
.qbtn:hover { border-color:var(--aborder); color:var(--accent); background:var(--adim); }

.ai-inp-row { padding:10px 13px; display:flex; gap:7px; border-top:1px solid var(--border); }
.ai-inp { flex:1; background:var(--surface2); border:1px solid var(--border); border-radius:100px; padding:8px 14px; color:var(--text); font-family:'Geist Mono',monospace; font-size:12px; outline:none; transition:all .18s; }
.ai-inp:focus { border-color:var(--accent); box-shadow:0 0 0 3px var(--adim); }
.send-btn { width:33px; height:33px; border-radius:100%; border:none; background:var(--accent); color:var(--bg); font-size:12px; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all .18s; flex-shrink:0; }
.send-btn:hover { opacity:.82; transform:scale(1.07); }
.send-btn:disabled { background:var(--surface2); color:var(--text3); cursor:default; transform:none; opacity:1; }

.typing { display:flex; gap:4px; padding:7px 12px; align-items:center; }
.tdot { width:5px; height:5px; border-radius:50%; background:var(--text3); animation:tdota 1.2s ease-in-out infinite; }
.tdot:nth-child(2){animation-delay:.15s;} .tdot:nth-child(3){animation-delay:.3s;}
@keyframes tdota{0%,80%,100%{opacity:.3;transform:scale(.7);}40%{opacity:1;transform:scale(1.1);}}

/* Modal */
.modal-ov { position:fixed; inset:0; background:rgba(0,0,0,.6); backdrop-filter:blur(5px); z-index:100; display:none; align-items:center; justify-content:center; padding:16px; }
.modal-ov.open { display:flex; }
.modal { background:var(--surface); border:1px solid var(--border2); border-radius:17px; padding:24px; width:100%; max-width:496px; box-shadow:var(--shadow); animation:riseIn .22s cubic-bezier(.22,1,.36,1); max-height:90vh; overflow-y:auto; }
.modal-title { font-family:'Instrument Serif',Georgia,serif; font-size:21px; font-style:italic; margin-bottom:18px; color:var(--text); }

/* Toasts */
.toast-wrap { position:fixed; bottom:17px; right:17px; z-index:400; display:flex; flex-direction:column; gap:6px; }
.toast { padding:9px 15px; border-radius:9px; border:1px solid var(--border2); background:var(--surface2); font-size:12px; font-weight:500; display:flex; align-items:center; gap:8px; animation:toastIn .25s cubic-bezier(.22,1,.36,1) both; max-width:252px; box-shadow:var(--shadow); }
@keyframes toastIn{from{opacity:0;transform:translateX(14px) scale(.94);}to{opacity:1;transform:translateX(0) scale(1);}}
.toast.ok{border-color:var(--aborder);color:var(--accent);} .toast.err{border-color:var(--accent3);color:var(--accent3);} .toast.inf{border-color:var(--accent2);color:var(--accent2);}

/* Bottom nav */
.bottom-nav { display:none; position:fixed; bottom:0; left:0; right:0; background:var(--surface); border-top:1px solid var(--border); z-index:40; padding:8px 0 calc(8px + env(safe-area-inset-bottom)); justify-content:space-around; align-items:center; }
.bnbtn { display:flex; flex-direction:column; align-items:center; gap:3px; background:none; border:none; color:var(--text3); font-family:'Geist Mono',monospace; font-size:9px; font-weight:500; cursor:pointer; padding:6px 10px; border-radius:8px; transition:all .15s; min-width:50px; text-transform:uppercase; letter-spacing:.5px; }
.bnbtn .bni { font-size:17px; }
.bnbtn.active { color:var(--accent); }
.drawer-ov { display:none; position:fixed; inset:0; background:rgba(0,0,0,.5); backdrop-filter:blur(3px); z-index:55; }
.drawer-ov.open { display:block; }

::-webkit-scrollbar{width:3px;} ::-webkit-scrollbar-track{background:transparent;} ::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}

/* Responsive */
@media(max-width:1100px){
  .app{grid-template-columns:215px 1fr;}
  .ai-panel{position:fixed;top:0;right:-100%;width:min(315px,90vw);height:100%;z-index:60;border-left:1px solid var(--border2);transition:right .3s cubic-bezier(.22,1,.36,1);box-shadow:-10px 0 40px rgba(0,0,0,.5);}
  .ai-panel.open{right:0;} .ai-close{display:block;} .hnav{display:none;} .hstat{display:none;} .panels-row{grid-template-columns:1fr;}
}
@media(max-width:767px){
  .app{grid-template-columns:1fr;grid-template-rows:52px 1fr;}
  .sidebar{position:fixed;top:0;left:-100%;width:246px;height:100%;z-index:60;transition:left .3s cubic-bezier(.22,1,.36,1);padding-top:68px;box-shadow:8px 0 28px rgba(0,0,0,.5);}
  .sidebar.open{left:0;} .hamburger{display:flex;} .hnav{display:none;} .hstat{display:none;}
  header{padding:0 12px;} .main{padding:15px 13px 78px;} .bottom-nav{display:flex;}
  .task-grid{grid-template-columns:1fr;} .form-row{grid-template-columns:1fr;} .page-title{font-size:25px;}
  .modal{padding:18px;} .form-acts{flex-direction:column;} .form-acts .btn{justify-content:center;}
  .toast-wrap{bottom:70px;right:9px;left:9px;} .toast{max-width:100%;}
  .ai-panel{position:fixed;top:0;right:-100%;width:100%;height:100%;z-index:60;} .ai-panel.open{right:0;}
  .stats-grid{grid-template-columns:1fr 1fr;}
  .theme-trigger span:last-child{display:none;}
  .ai-toggle span:not(.logo-dot){display:none;}
}
@media(min-width:1440px){
  .app{grid-template-columns:240px 1fr 315px;}
  .task-grid{grid-template-columns:repeat(auto-fill,minmax(275px,1fr));}
}
</style>
</head>
<body>

<!-- AUTH -->
<div id="authScreen">
  <div class="auth-wrap">
    <div class="auth-logo">
      <div class="auth-wordmark">Study<span>Bot</span></div>
      <div class="auth-tagline">AI-Powered Study Assistant</div>
    </div>
    <div class="auth-card">
      <div class="auth-tabs">
        <button class="auth-tab active" id="loginTab" onclick="switchTab('login')">Login</button>
        <button class="auth-tab" id="registerTab" onclick="switchTab('register')">Register</button>
      </div>
      <div id="loginForm">
        <div class="afield"><label>Username</label><input type="text" id="loginUser" placeholder="Enter username" autocomplete="username"></div>
        <div class="afield"><label>Password</label><input type="password" id="loginPass" placeholder="Enter password" autocomplete="current-password" onkeydown="if(event.key==='Enter')doLogin()"></div>
        <button class="auth-submit" onclick="doLogin()">Sign In ‚Üí</button>
        <div class="auth-err" id="loginErr"></div>
        <div class="saved-users" id="savedUsers"></div>
      </div>
      <div id="registerForm" style="display:none">
        <div class="afield"><label>Username</label><input type="text" id="regUser" placeholder="Choose a username" autocomplete="username"></div>
        <div class="afield"><label>Password</label><input type="password" id="regPass" placeholder="Min. 4 characters" autocomplete="new-password"></div>
        <div class="afield"><label>Confirm</label><input type="password" id="regPass2" placeholder="Repeat password" autocomplete="new-password" onkeydown="if(event.key==='Enter')doRegister()"></div>
        <button class="auth-submit" onclick="doRegister()">Create Account ‚Üí</button>
        <div class="auth-err" id="regErr"></div>
      </div>
    </div>
  </div>
</div>

<!-- APP -->
<div class="app" id="mainApp" style="display:none">

  <header>
    <div class="h-left">
      <button class="hamburger" onclick="toggleSidebar()" aria-label="Menu"><span></span><span></span><span></span></button>
      <div class="logo"><div class="logo-dot"></div>Study<span>Bot</span></div>
    </div>

    <div class="hnav">
      <button class="hnav-btn active" id="hn-dashboard" onclick="goPage('dashboard');setHNav('hn-dashboard')">Dashboard</button>
      <button class="hnav-btn" id="hn-tasks"    onclick="goPage('tasks');setHNav('hn-tasks')">Tasks</button>
      <button class="hnav-btn" id="hn-upcoming" onclick="goPage('upcoming');setHNav('hn-upcoming')">Upcoming</button>
      <button class="hnav-btn" id="hn-add"      onclick="goPage('add');setHNav('hn-add')">+ Add</button>
    </div>

    <div class="h-right">
      <div class="hstat" id="hstat">‚Äî</div>

      <div class="theme-wrap">
        <button class="theme-trigger" onclick="toggleThemeMenu()">üé® <span>Theme</span></button>
        <div class="theme-popup" id="themePopup">
          <div class="tp-label">Choose Theme</div>
          <div class="tp-grid">
            <div class="tp-opt active" id="to-ink"   onclick="setTheme('ink')">  <div class="tp-swatch" style="background:linear-gradient(135deg,#0a0a0e 50%,#b4f040)"></div>Ink</div>
            <div class="tp-opt" id="to-paper"  onclick="setTheme('paper')"> <div class="tp-swatch" style="background:linear-gradient(135deg,#f4efe6 50%,#c4401c)"></div>Paper</div>
            <div class="tp-opt" id="to-slate"  onclick="setTheme('slate')"> <div class="tp-swatch" style="background:linear-gradient(135deg,#0d1117 50%,#58a6ff)"></div>Slate</div>
            <div class="tp-opt" id="to-rose"   onclick="setTheme('rose')">  <div class="tp-swatch" style="background:linear-gradient(135deg,#0f0a0a 50%,#ff6b8a)"></div>Rose</div>
            <div class="tp-opt" id="to-mint"   onclick="setTheme('mint')">  <div class="tp-swatch" style="background:linear-gradient(135deg,#eef5f1 50%,#0a7c55)"></div>Mint</div>
            <div class="tp-opt" id="to-dusk"   onclick="setTheme('dusk')">  <div class="tp-swatch" style="background:linear-gradient(135deg,#08060f 50%,#c084fc)"></div>Dusk</div>
          </div>
        </div>
      </div>

      <button class="ai-toggle" onclick="toggleAI()"><span class="logo-dot"></span><span>AI Chat</span></button>

      <div class="user-pill" onclick="doLogout()" id="userPill" title="Sign out">
        <div class="user-ava" id="userAva">?</div>
        <span id="userName">‚Äî</span>
      </div>
    </div>
  </header>

  <aside class="sidebar" id="sidebar">
    <div class="sb-section">
      <div class="sb-lbl">Pages</div>
      <button class="nav-btn active" data-page="dashboard" onclick="goPage('dashboard',this)"><span class="icon">üìä</span>Dashboard</button>
      <button class="nav-btn" data-page="tasks"     onclick="goPage('tasks',this)"><span class="icon">üìã</span>All Tasks</button>
      <button class="nav-btn" data-page="upcoming"  onclick="goPage('upcoming',this)"><span class="icon">üìÖ</span>Upcoming</button>
      <button class="nav-btn" data-page="add"       onclick="goPage('add',this)"><span class="icon">‚úèÔ∏è</span>Add Task</button>
    </div>
    <div class="sb-section">
      <div class="sb-lbl">Overview</div>
      <div class="stat-pill"><span>Pending</span>  <span class="v" id="sPending">‚Äî</span></div>
      <div class="stat-pill"><span>In Progress</span><span class="v" id="sInProg">‚Äî</span></div>
      <div class="stat-pill"><span>Done</span>     <span class="v g" id="sDone">‚Äî</span></div>
      <div class="stat-pill"><span>Overdue</span>  <span class="v r" id="sOverdue">‚Äî</span></div>
    </div>
    <div class="sb-section">
      <div class="sb-lbl">Filter</div>
      <button class="nav-btn" onclick="filterSt('pending');closeSidebar()"><span class="icon">üü°</span>Pending</button>
      <button class="nav-btn" onclick="filterSt('in-progress');closeSidebar()"><span class="icon">üîµ</span>In Progress</button>
      <button class="nav-btn" onclick="filterSt('completed');closeSidebar()"><span class="icon">‚úÖ</span>Completed</button>
      <button class="nav-btn" onclick="filterSt(null);closeSidebar()"><span class="icon">‚úï</span>Clear Filter</button>
    </div>
  </aside>

  <main class="main">

    <!-- DASHBOARD -->
    <div class="page active" id="page-dashboard">
      <div class="dash-hero">
        <div class="dash-tag" id="todayTag">TODAY</div>
        <div class="dash-greet">Good <span id="timeGreet">day</span>, <span id="greetName">Student</span>.</div>
        <div class="dash-sub" id="dashMotivation">Loading overview‚Ä¶</div>
        <div class="progress-row" id="progressRow" style="display:none">
          <div class="progress-track"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
          <span class="progress-lbl">Completion</span>
          <span class="progress-pct" id="progressPct">0%</span>
        </div>
        <div class="dash-ctas">
          <button class="dcta p" onclick="goPage('add');setHNav('hn-add')">+ Add Task</button>
          <button class="dcta s" onclick="quickPrompt('What should I focus on today?');if(!document.getElementById('aiPanel').classList.contains('open'))toggleAI()">‚ú® Ask AI</button>
        </div>
      </div>
      <div class="stats-grid" id="dashStats"></div>
      <div class="panels-row">
        <div class="panel"><div class="panel-title">Task Breakdown</div><div class="chart-wrap"><canvas id="taskChart"></canvas></div></div>
        <div class="panel"><div class="panel-title">7-Day Streak</div><div class="streak-row" id="streakRow"></div><div class="streak-note">Complete tasks daily to build momentum üî•</div></div>
      </div>
      <div class="panel"><div class="panel-title">Recent Activity</div><div id="recentTasks"></div></div>
    </div>

    <!-- TASKS -->
    <div class="page" id="page-tasks">
      <h1 class="page-title"><em>Tasks</em> <span class="title-count" id="taskCount">‚Äî</span></h1>
      <div class="toolbar">
        <input class="searchbox" type="text" id="searchBox" placeholder="Search tasks‚Ä¶" oninput="renderTasks()">
        <div class="tdiv"></div>
        <button class="chip on" onclick="setPri('all',this)">All</button>
        <button class="chip" onclick="setPri('high',this)">High</button>
        <button class="chip" onclick="setPri('medium',this)">Medium</button>
        <button class="chip" onclick="setPri('low',this)">Low</button>
        <div class="tdiv"></div>
        <button class="chip" onclick="toggleSort('due')">üìÖ Date</button>
        <button class="chip" onclick="toggleSort('priority')">üéØ Priority</button>
      </div>
      <div class="task-grid" id="taskGrid"></div>
    </div>

    <!-- UPCOMING -->
    <div class="page" id="page-upcoming">
      <h1 class="page-title"><em>Upcoming</em> Deadlines</h1>
      <div class="timeline" id="upcomingList"></div>
    </div>

    <!-- ADD -->
    <div class="page" id="page-add">
      <h1 class="page-title">Add <em>Task</em></h1>
      <form class="form-card" onsubmit="submitTask(event)">
        <div class="fg full"><label>Task Title *</label><input type="text" id="f-title" placeholder="e.g. Write chemistry lab report" required></div>
        <div class="form-row">
          <div class="fg"><label>Subject</label><input type="text" id="f-subject" placeholder="e.g. Chemistry"></div>
          <div class="fg"><label>Due Date</label><input type="date" id="f-due"></div>
        </div>
        <div class="form-row">
          <div class="fg"><label>Priority</label><select id="f-priority"><option value="medium">Medium</option><option value="high">High</option><option value="low">Low</option></select></div>
          <div class="fg"><label>Status</label><select id="f-status"><option value="pending">Pending</option><option value="in-progress">In Progress</option><option value="completed">Completed</option></select></div>
        </div>
        <div class="fg full"><label>Notes</label><textarea id="f-desc" placeholder="Any extra details or resources‚Ä¶"></textarea></div>
        <div class="form-acts">
          <button type="button" class="btn btn-ai" onclick="aiPriority()">‚ú® AI Priority</button>
          <button type="button" class="btn btn-s" onclick="resetForm()">Clear</button>
          <button type="submit" class="btn btn-p">Add Task ‚Üí</button>
        </div>
      </form>
    </div>

  </main>

  <!-- AI PANEL -->
  <aside class="ai-panel" id="aiPanel">
    <div class="ai-header">
      <div class="ai-ava">ü§ñ</div>
      <div>
        <div class="ai-name">StudyBot AI</div>
        <div class="ai-stat"><span class="logo-dot" style="width:5px;height:5px"></span>Online ¬∑ Claude</div>
      </div>
      <button class="ai-close" onclick="toggleAI()">‚úï</button>
    </div>
    <div class="ai-msgs" id="aiMsgs"></div>
    <div class="quick-p">
      <button class="qbtn" onclick="quickPrompt('What should I focus on today?')">Focus today</button>
      <button class="qbtn" onclick="quickPrompt('Am I overloaded this week?')">Overloaded?</button>
      <button class="qbtn" onclick="quickPrompt('List my high priority tasks')">High priority</button>
      <button class="qbtn" onclick="quickPrompt('Build me a study schedule')">Study plan</button>
      <button class="qbtn" onclick="quickPrompt('Which tasks are overdue?')">Overdue</button>
    </div>
    <div class="ai-inp-row">
      <input class="ai-inp" id="aiInput" type="text" placeholder="Ask anything‚Ä¶" onkeydown="if(event.key==='Enter')sendMsg()">
      <button class="send-btn" id="sendBtn" onclick="sendMsg()">‚û§</button>
    </div>
  </aside>
</div>

<nav class="bottom-nav">
  <button class="bnbtn active" id="bn-dashboard" onclick="goPage('dashboard');setBNav('bn-dashboard')"><span class="bni">üìä</span>Dash</button>
  <button class="bnbtn" id="bn-tasks"    onclick="goPage('tasks');setBNav('bn-tasks')"><span class="bni">üìã</span>Tasks</button>
  <button class="bnbtn" id="bn-upcoming" onclick="goPage('upcoming');setBNav('bn-upcoming')"><span class="bni">üìÖ</span>Soon</button>
  <button class="bnbtn" id="bn-add"      onclick="goPage('add');setBNav('bn-add')"><span class="bni">‚ûï</span>Add</button>
  <button class="bnbtn" id="bn-ai"       onclick="toggleAI()"><span class="bni">ü§ñ</span>AI</button>
</nav>

<div class="drawer-ov" id="drawerOv" onclick="closeAll()"></div>

<!-- Edit Modal -->
<div class="modal-ov" id="editModal">
  <div class="modal">
    <div class="modal-title">Edit Task</div>
    <form onsubmit="submitEdit(event)" style="display:flex;flex-direction:column;gap:12px">
      <input type="hidden" id="e-id">
      <div class="fg"><label>Title</label><input type="text" id="e-title" required></div>
      <div class="form-row">
        <div class="fg"><label>Subject</label><input type="text" id="e-subject"></div>
        <div class="fg"><label>Due Date</label><input type="date" id="e-due"></div>
      </div>
      <div class="form-row">
        <div class="fg"><label>Priority</label><select id="e-priority"><option value="medium">Medium</option><option value="high">High</option><option value="low">Low</option></select></div>
        <div class="fg"><label>Status</label><select id="e-status"><option value="pending">Pending</option><option value="in-progress">In Progress</option><option value="completed">Completed</option></select></div>
      </div>
      <div class="fg"><label>Notes</label><textarea id="e-desc"></textarea></div>
      <div class="form-acts">
        <button type="button" class="btn btn-ai" onclick="aiSubtasks()">‚ú® Subtasks</button>
        <button type="button" class="btn btn-s" onclick="closeModal()">Cancel</button>
        <button type="submit" class="btn btn-p">Save Changes</button>
      </div>
    </form>
  </div>
</div>

<div class="toast-wrap" id="toastWrap"></div>

<script>
/* ‚îÄ‚îÄ STORAGE ‚îÄ‚îÄ */
const R=(k,fb)=>{try{const v=JSON.parse(localStorage.getItem(k));return v===null?fb:v;}catch{return fb;}};
const W=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
const UK='sb_users',SK='sb_sess',CK='sb_chat_',THK='sb_theme';
const getUsers=()=>R(UK,{});const saveUsers=u=>W(UK,u);
const getSess=()=>R(SK,null);const saveSess=s=>W(SK,s);const clrSess=()=>localStorage.removeItem(SK);
const getChat=u=>R(CK+u,[]);const saveChat=(u,h)=>W(CK+u,h.slice(-50));

/* ‚îÄ‚îÄ THEMES ‚îÄ‚îÄ */
const THEMES=['ink','paper','slate','rose','mint','dusk'];
let chartInst=null;

function setTheme(t){
  if(!THEMES.includes(t))t='ink';
  document.documentElement.setAttribute('data-theme',t);
  W(THK,t);
  THEMES.forEach(th=>{document.getElementById('to-'+th)?.classList.toggle('active',th===t);});
  if(chartInst){chartInst.destroy();chartInst=null;buildChart();}
  closeThemeMenu();
}
function toggleThemeMenu(){document.getElementById('themePopup').classList.toggle('open');}
function closeThemeMenu(){document.getElementById('themePopup').classList.remove('open');}
document.addEventListener('click',e=>{if(!e.target.closest('.theme-wrap'))closeThemeMenu();});

/* ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ */
let currentUser=null;
function switchTab(tab){
  document.getElementById('loginTab').classList.toggle('active',tab==='login');
  document.getElementById('registerTab').classList.toggle('active',tab==='register');
  document.getElementById('loginForm').style.display=tab==='login'?'':'none';
  document.getElementById('registerForm').style.display=tab==='register'?'':'none';
}
function showSaved(){
  const users=getUsers(),keys=Object.keys(users),el=document.getElementById('savedUsers');
  if(!keys.length){el.innerHTML='';return;}
  el.innerHTML=`<div class="saved-lbl">Quick login</div>`+keys.map(u=>`<span class="uchip" onclick="quickLogin('${u}')">üë§ ${u}</span>`).join('');
}
function quickLogin(u){document.getElementById('loginUser').value=u;document.getElementById('loginPass').focus();}
function doLogin(){
  const u=document.getElementById('loginUser').value.trim(),p=document.getElementById('loginPass').value,err=document.getElementById('loginErr');
  if(!u||!p){err.textContent='Please fill in all fields.';return;}
  const users=getUsers();
  if(!users[u]){err.textContent='Username not found.';return;}
  if(users[u].password!==btoa(p)){err.textContent='Incorrect password.';return;}
  err.textContent='';saveSess({username:u,loginTime:Date.now()});startApp(u);
}
function doRegister(){
  const u=document.getElementById('regUser').value.trim(),p=document.getElementById('regPass').value,p2=document.getElementById('regPass2').value,err=document.getElementById('regErr');
  if(!u||!p){err.textContent='Please fill in all fields.';return;}
  if(u.length<3){err.textContent='Username min. 3 chars.';return;}
  if(p.length<4){err.textContent='Password min. 4 chars.';return;}
  if(p!==p2){err.textContent='Passwords do not match.';return;}
  const users=getUsers();
  if(users[u]){err.textContent='Username already taken.';return;}
  users[u]={password:btoa(p),createdAt:Date.now()};saveUsers(users);
  saveSess({username:u,loginTime:Date.now()});startApp(u);
}
function doLogout(){
  if(!confirm('Sign out?'))return;
  saveChat(currentUser,chatHistory);clrSess();
  currentUser=null;chatHistory=[];tasks=[];
  document.getElementById('mainApp').style.display='none';
  document.getElementById('authScreen').style.display='flex';
  document.getElementById('loginUser').value='';
  document.getElementById('loginPass').value='';
  document.getElementById('loginErr').textContent='';
  showSaved();
}
function startApp(username){
  currentUser=username;
  document.getElementById('authScreen').style.display='none';
  document.getElementById('mainApp').style.display='grid';
  document.getElementById('userName').textContent=username;
  document.getElementById('userAva').textContent=username[0].toUpperCase();
  chatHistory=getChat(username);restoreChatUI();
  const h=new Date().getHours();
  document.getElementById('timeGreet').textContent=h<5?'night':h<12?'morning':h<17?'afternoon':'evening';
  document.getElementById('greetName').textContent=username;
  const now=new Date();
  document.getElementById('todayTag').textContent=now.toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'long',year:'numeric'}).toUpperCase();
  loadTasks();
  setInterval(loadTasks,30000);
  setInterval(()=>saveChat(currentUser,chatHistory),10000);
}

/* ‚îÄ‚îÄ STATE ‚îÄ‚îÄ */
let tasks=[],priFilter='all',stFilter=null,sortMode=null,chatHistory=[];

/* ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ */
function toast(msg,type='inf'){
  const icons={ok:'‚úì',err:'‚úï',inf:'¬∑'};
  const el=document.createElement('div');
  el.className=`toast ${type}`;
  el.innerHTML=`<span>${icons[type]||'¬∑'}</span>${msg}`;
  document.getElementById('toastWrap').appendChild(el);
  setTimeout(()=>el.style.opacity='0',2600);setTimeout(()=>el.remove(),3000);
}
const esc=s=>(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
function fmtDate(s){if(!s)return null;const d=new Date(s+'T00:00:00'),now=new Date(),tmr=new Date();tmr.setDate(now.getDate()+1);if(d.toDateString()===now.toDateString())return'Today';if(d.toDateString()===tmr.toDateString())return'Tomorrow';return d.toLocaleDateString('en-GB',{day:'numeric',month:'short',year:'numeric'});}
const isOD=s=>s&&new Date(s+'T23:59:59')<new Date();
const daysLeft=s=>s?Math.ceil((new Date(s+'T00:00:00')-new Date())/86400000):null;

async function api(method,path,body){
  const res=await fetch(path,{method,headers:body?{'Content-Type':'application/json'}:{},body:body?JSON.stringify(body):undefined});
  return res.json();
}
async function loadTasks(){
  try{tasks=await api('GET','/api/tasks');renderTasks();updateSidebar();renderDashboard();}
  catch{toast('Cannot connect to server','err');}
}
function updateSidebar(){
  const p=tasks.filter(t=>t.status==='pending').length;
  const i=tasks.filter(t=>t.status==='in-progress').length;
  const d=tasks.filter(t=>t.status==='completed').length;
  const o=tasks.filter(t=>isOD(t.due_date)&&t.status!=='completed').length;
  document.getElementById('sPending').textContent=p;
  document.getElementById('sInProg').textContent=i;
  document.getElementById('sDone').textContent=d;
  document.getElementById('sOverdue').textContent=o;
  document.getElementById('hstat').innerHTML=`<strong>${tasks.length}</strong> tasks&nbsp;¬∑&nbsp;<strong>${d}</strong> done`;
}

/* ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ */
function renderDashboard(){
  const total=tasks.length,done=tasks.filter(t=>t.status==='completed').length;
  const pending=tasks.filter(t=>t.status==='pending').length,inprog=tasks.filter(t=>t.status==='in-progress').length;
  const high=tasks.filter(t=>t.priority==='high'&&t.status!=='completed').length;
  const overdue=tasks.filter(t=>isOD(t.due_date)&&t.status!=='completed').length;
  const pct=total?Math.round(done/total*100):0;
  document.getElementById('dashMotivation').textContent=
    overdue>0?`${overdue} overdue task${overdue>1?'s':''} need attention.`:
    pct>=80?`${pct}% complete ‚Äî you're nearly there!`:
    pct>=50?`Solid progress at ${pct}%. Keep going.`:
    total===0?`No tasks yet ‚Äî add your first one to get started.`:
    `${pending} task${pending!==1?'s':''} waiting. One step at a time.`;
  if(total>0){
    document.getElementById('progressRow').style.display='flex';
    document.getElementById('progressPct').textContent=pct+'%';
    setTimeout(()=>{document.getElementById('progressFill').style.width=pct+'%';},80);
  }
  document.getElementById('dashStats').innerHTML=`
    <div class="scard"><div class="scard-lbl">Total</div><div class="scard-val b">${total}</div><div class="scard-sub">all tasks</div></div>
    <div class="scard"><div class="scard-lbl">Done</div><div class="scard-val a">${done}</div><div class="scard-sub">${pct}% rate</div></div>
    <div class="scard"><div class="scard-lbl">Pending</div><div class="scard-val">${pending}</div><div class="scard-sub">to do</div></div>
    <div class="scard"><div class="scard-lbl">Active</div><div class="scard-val">${inprog}</div><div class="scard-sub">in progress</div></div>
    <div class="scard"><div class="scard-lbl">Urgent</div><div class="scard-val">${high}</div><div class="scard-sub">high priority</div></div>
    <div class="scard"><div class="scard-lbl">Overdue</div><div class="scard-val ${overdue?'c':''}">${overdue}</div><div class="scard-sub">${overdue?'needs action':'on track ‚úì'}</div></div>
  `;
  buildChart(done,inprog,pending);
  const days=['S','M','T','W','T','F','S'],today=new Date();let html='';
  for(let i=6;i>=0;i--){const d=new Date(today);d.setDate(d.getDate()-i);const ds=d.toISOString().split('T')[0];const on=tasks.some(t=>t.updated_at&&t.updated_at.startsWith(ds)&&t.status==='completed');html+=`<div class="sday ${i===0?'today':on?'on':''}" title="${ds}">${days[d.getDay()]}</div>`;}
  document.getElementById('streakRow').innerHTML=html;
  const recent=[...tasks].sort((a,b)=>new Date(b.updated_at)-new Date(a.updated_at)).slice(0,5);
  document.getElementById('recentTasks').innerHTML=recent.length?recent.map(t=>`<div class="recent-row"><span class="recent-name">${esc(t.title)}</span><span class="badge b-${t.priority}" style="margin-right:6px">${t.priority}</span><span class="badge b-${t.status}">${t.status}</span></div>`).join(''):`<div style="color:var(--text3);font-size:12px;padding:13px 0;text-align:center;font-style:italic">No tasks yet.</div>`;
}

function buildChart(done,inprog,pending){
  const canvas=document.getElementById('taskChart');if(!canvas)return;
  if(chartInst){chartInst.destroy();chartInst=null;}
  const d=done??tasks.filter(t=>t.status==='completed').length;
  const i=inprog??tasks.filter(t=>t.status==='in-progress').length;
  const p=pending??tasks.filter(t=>t.status==='pending').length;
  const cs=getComputedStyle(document.documentElement);
  const a=cs.getPropertyValue('--accent').trim(),b=cs.getPropertyValue('--accent2').trim(),c=cs.getPropertyValue('--surface3').trim(),t2=cs.getPropertyValue('--text2').trim();
  chartInst=new Chart(canvas.getContext('2d'),{
    type:'doughnut',
    data:{labels:['Done','In Progress','Pending'],datasets:[{data:[d,i,p],backgroundColor:[a,b,c],borderColor:'transparent',borderWidth:0,hoverOffset:4}]},
    options:{responsive:true,maintainAspectRatio:false,cutout:'72%',plugins:{legend:{position:'bottom',labels:{color:t2,font:{family:'Geist Mono',size:10},padding:13,usePointStyle:true,pointStyleWidth:7}}}}
  });
}

/* ‚îÄ‚îÄ TASKS ‚îÄ‚îÄ */
function toggleSort(mode){sortMode=sortMode===mode?null:mode;renderTasks();}
function renderTasks(){
  const q=(document.getElementById('searchBox')?.value||'').toLowerCase();
  let list=tasks.filter(t=>(priFilter==='all'||t.priority===priFilter)&&(!stFilter||t.status===stFilter)&&(!q||t.title.toLowerCase().includes(q)||(t.subject||'').toLowerCase().includes(q)||(t.description||'').toLowerCase().includes(q)));
  if(sortMode==='due')list.sort((a,b)=>{if(!a.due_date&&!b.due_date)return 0;if(!a.due_date)return 1;if(!b.due_date)return -1;return new Date(a.due_date)-new Date(b.due_date);});
  else if(sortMode==='priority'){const ord={high:0,medium:1,low:2};list.sort((a,b)=>(ord[a.priority]||1)-(ord[b.priority]||1));}
  const el=document.getElementById('taskGrid'),cnt=document.getElementById('taskCount');
  if(cnt)cnt.textContent=`${list.length} task${list.length!==1?'s':''}`;
  if(!list.length){el.innerHTML=`<div class="empty"><span class="empty-ico">üì≠</span><div class="empty-txt">No tasks here yet.</div></div>`;return;}
  el.innerHTML=list.map((t,i)=>taskCard(t,i)).join('');
}

function taskCard(t,idx){
  const od=isOD(t.due_date)&&t.status!=='completed',dl=daysLeft(t.due_date);
  let dueStr='';
  if(t.due_date){if(od)dueStr='‚ö† Overdue';else if(dl===0)dueStr='üìÖ Due today';else if(dl===1)dueStr='üìÖ Tomorrow';else if(dl!==null&&dl<=3)dueStr=`üìÖ ${dl} days left`;else dueStr=`üìÖ ${fmtDate(t.due_date)}`;}
  const sd=(t.subtasks||[]).filter(s=>s.done).length,st=(t.subtasks||[]).length;
  const subs=(t.subtasks||[]).map((s,i)=>`<div class="sub-item ${s.done?'done':''}" onclick="toggleSub('${t.id}',${i})"><div class="sub-chk">${s.done?'‚úì':''}</div><span>${esc(s.text)}</span></div>`).join('');
  return`<div class="tcard p-${t.priority} ${t.status==='completed'?'completed':''}" style="animation-delay:${idx*.035}s">
    <div class="tc-top"><div class="tc-title">${esc(t.title)}</div>
    <div class="tc-acts">
      <button class="ibt ai" onclick="editSubs('${t.id}')" title="AI subtasks">‚ú®</button>
      <button class="ibt" onclick="openEdit('${t.id}')" title="Edit">‚úè</button>
      <button class="ibt" onclick="quickDone('${t.id}')" title="Toggle done">‚úÖ</button>
      <button class="ibt del" onclick="delTask('${t.id}')" title="Delete">‚úï</button>
    </div></div>
    ${t.description?`<div class="tc-desc">${esc(t.description)}</div>`:''}
    <div class="tc-meta">
      ${t.subject?`<span class="badge b-subj">${esc(t.subject)}</span>`:''}
      <span class="badge b-${t.priority}">${t.priority}</span>
      <span class="badge b-${t.status}">${t.status}</span>
      ${st>0?`<span class="badge b-pending">${sd}/${st}</span>`:''}
    </div>
    ${dueStr?`<div class="tc-due ${od?'od':''}">${dueStr}</div>`:''}
    ${subs?`<div class="sub-list">${subs}</div>`:''}
  </div>`;
}

/* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
function goPage(name,btn){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('page-'+name)?.classList.add('active');
  if(btn)btn.classList.add('active');
  else document.querySelector(`[data-page="${name}"]`)?.classList.add('active');
  if(name==='upcoming')loadUpcoming();
  if(name==='dashboard')renderDashboard();
  if(name==='tasks')renderTasks();
  closeSidebar();
}
function setHNav(id){document.querySelectorAll('.hnav-btn').forEach(b=>b.classList.remove('active'));document.getElementById(id)?.classList.add('active');}
function setBNav(id){document.querySelectorAll('.bnbtn').forEach(b=>b.classList.remove('active'));document.getElementById(id)?.classList.add('active');}
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('open');document.getElementById('drawerOv').classList.toggle('open');}
function closeSidebar(){document.getElementById('sidebar').classList.remove('open');document.getElementById('drawerOv').classList.remove('open');}
function toggleAI(){const p=document.getElementById('aiPanel'),o=document.getElementById('drawerOv'),open=p.classList.toggle('open');o.classList.toggle('open',open);if(open)setTimeout(()=>document.getElementById('aiInput').focus(),300);}
function closeAll(){document.getElementById('sidebar').classList.remove('open');document.getElementById('aiPanel').classList.remove('open');document.getElementById('drawerOv').classList.remove('open');}

async function loadUpcoming(){
  try{
    const items=await api('GET','/api/upcoming?days=14'),list=document.getElementById('upcomingList');
    if(!items.length){list.innerHTML=`<div class="empty"><span class="empty-ico">üéâ</span><div class="empty-txt">Nothing due in the next 2 weeks!</div></div>`;return;}
    list.innerHTML=items.map((t,i)=>{const d=new Date(t.due_date+'T00:00:00'),dl=daysLeft(t.due_date);
      return`<div class="tl-item" style="animation-delay:${i*.05}s">
        <div class="tl-date"><div class="tl-day">${d.getDate()}</div><div class="tl-mon">${d.toLocaleString('en',{month:'short'})}</div></div>
        <div class="tl-body"><div class="tl-title">${esc(t.title)}</div>
        <div class="tc-meta">${t.subject?`<span class="badge b-subj">${esc(t.subject)}</span>`:''}<span class="badge b-${t.priority}">${t.priority}</span><span class="badge b-${t.status}">${t.status}</span>${dl===0?`<span class="badge b-subj">TODAY</span>`:''}</div></div>
        <div class="tl-acts"><button class="ibt" onclick="openEdit('${t.id}')">‚úè</button><button class="ibt" onclick="quickDone('${t.id}')">‚úÖ</button></div>
      </div>`;}).join('');
  }catch{toast('Error loading upcoming','err');}
}

function setPri(val,btn){priFilter=val;document.querySelectorAll('.chip').forEach(c=>c.classList.remove('on'));if(btn)btn.classList.add('on');renderTasks();}
function filterSt(val){stFilter=val;goPage('tasks');setHNav('hn-tasks');renderTasks();}

/* ‚îÄ‚îÄ CRUD ‚îÄ‚îÄ */
async function submitTask(e){
  e.preventDefault();
  const data={title:document.getElementById('f-title').value,subject:document.getElementById('f-subject').value,due_date:document.getElementById('f-due').value||null,priority:document.getElementById('f-priority').value,status:document.getElementById('f-status').value,description:document.getElementById('f-desc').value};
  const r=await api('POST','/api/tasks',data);
  if(r.error){toast(r.error,'err');return;}
  toast('Task added ‚úì','ok');resetForm();await loadTasks();goPage('tasks');setHNav('hn-tasks');setBNav('bn-tasks');
}
function resetForm(){['f-title','f-subject','f-due','f-desc'].forEach(id=>document.getElementById(id).value='');document.getElementById('f-priority').value='medium';document.getElementById('f-status').value='pending';}
async function delTask(id){if(!confirm('Delete this task?'))return;await api('DELETE',`/api/tasks/${id}`);toast('Deleted','inf');await loadTasks();}
async function quickDone(id){const t=tasks.find(t=>t.id===id);if(!t)return;const ns=t.status==='completed'?'pending':'completed';await api('PUT',`/api/tasks/${id}`,{status:ns});toast(ns==='completed'?'Task done ‚úì':'Reopened','ok');await loadTasks();}
function toggleSub(tid,idx){const t=tasks.find(t=>t.id===tid);if(!t||!t.subtasks)return;t.subtasks[idx].done=!t.subtasks[idx].done;renderTasks();}
function openEdit(id){const t=tasks.find(t=>t.id===id);if(!t)return;document.getElementById('e-id').value=t.id;document.getElementById('e-title').value=t.title;document.getElementById('e-subject').value=t.subject||'';document.getElementById('e-due').value=t.due_date||'';document.getElementById('e-priority').value=t.priority;document.getElementById('e-status').value=t.status;document.getElementById('e-desc').value=t.description||'';document.getElementById('editModal').classList.add('open');}
function closeModal(){document.getElementById('editModal').classList.remove('open');}
async function submitEdit(e){e.preventDefault();const id=document.getElementById('e-id').value;const data={title:document.getElementById('e-title').value,subject:document.getElementById('e-subject').value,due_date:document.getElementById('e-due').value||null,priority:document.getElementById('e-priority').value,status:document.getElementById('e-status').value,description:document.getElementById('e-desc').value};const r=await api('PUT',`/api/tasks/${id}`,data);if(r.error){toast(r.error,'err');return;}toast('Saved ‚úì','ok');closeModal();await loadTasks();}

/* ‚îÄ‚îÄ AI ‚îÄ‚îÄ */
async function aiPriority(){
  const title=document.getElementById('f-title').value;if(!title){toast('Enter a title first','inf');return;}
  toast('Asking AI‚Ä¶','inf');
  try{const r=await api('POST','/api/ai/chat',{message:`Reply with ONLY one word (low/medium/high) for priority: "${title}", subject:"${document.getElementById('f-subject').value}"`,history:[]});const w=r.reply?.toLowerCase().match(/\b(low|medium|high)\b/);if(w){document.getElementById('f-priority').value=w[0];toast(`AI suggests: ${w[0]}`,'ok');}}
  catch{toast('AI unavailable','err');}
}
async function editSubs(id){openEdit(id);await aiSubsFor(id);}
async function aiSubtasks(){await aiSubsFor(document.getElementById('e-id').value);}
async function aiSubsFor(id){
  toast('Generating subtasks‚Ä¶','inf');
  try{const r=await api('POST',`/api/ai/subtasks/${id}`);if(r.error){toast(r.error,'err');return;}const t=tasks.find(t=>t.id===id);if(t){t.subtasks=r.subtasks.map(s=>({text:s,done:false}));renderTasks();toast(`${r.subtasks.length} subtasks created ‚úì`,'ok');}}
  catch{toast('AI unavailable','err');}
}

async function sendMsg(){
  const input=document.getElementById('aiInput'),msg=input.value.trim();if(!msg)return;input.value='';
  addMsg('user',msg);chatHistory.push({role:'user',content:msg});document.getElementById('sendBtn').disabled=true;
  const tid='ty-'+Date.now();
  document.getElementById('aiMsgs').insertAdjacentHTML('beforeend',`<div class="msg ai" id="${tid}"><div class="msg-ava">ü§ñ</div><div class="msg-bub"><div class="typing"><div class="tdot"></div><div class="tdot"></div><div class="tdot"></div></div></div></div>`);
  scrollChat();
  try{const r=await api('POST','/api/ai/chat',{message:msg,history:chatHistory.slice(-12)});document.getElementById(tid)?.remove();const reply=r.reply||r.error||'Something went wrong.';addMsg('ai',reply);chatHistory.push({role:'assistant',content:reply});saveChat(currentUser,chatHistory);}
  catch{document.getElementById(tid)?.remove();addMsg('ai','‚ö† Could not reach the server.');}
  document.getElementById('sendBtn').disabled=false;
}
function addMsg(role,text){const isAI=role==='ai';document.getElementById('aiMsgs').insertAdjacentHTML('beforeend',`<div class="msg ${role}">${isAI?'<div class="msg-ava">ü§ñ</div>':''}<div class="msg-bub">${esc(text).replace(/\n/g,'<br>')}</div>${!isAI?'<div class="msg-ava">üßë</div>':''}</div>`);scrollChat();}
function scrollChat(){const el=document.getElementById('aiMsgs');el.scrollTop=el.scrollHeight;}
function quickPrompt(text){document.getElementById('aiInput').value=text;sendMsg();}
function restoreChatUI(){const c=document.getElementById('aiMsgs');c.innerHTML='';if(!chatHistory.length){c.innerHTML=`<div class="msg ai"><div class="msg-ava">ü§ñ</div><div class="msg-bub">Hi! I'm <strong>StudyBot</strong>.<br><br>I can see all your tasks and help you plan, prioritise, and stay on track. What would you like to tackle?</div></div>`;return;}chatHistory.forEach(m=>addMsg(m.role==='assistant'?'ai':'user',m.content));}

/* ‚îÄ‚îÄ INIT ‚îÄ‚îÄ */
(function(){
  const saved=R(THK,'ink');setTheme(saved);
  showSaved();
  const sess=getSess();
  if(sess?.username){const users=getUsers();if(users[sess.username])startApp(sess.username);else clrSess();}
})();
</script>
</body>
</html>