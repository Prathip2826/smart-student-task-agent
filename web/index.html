<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>StudyBot ‚Äî Smart Task Agent</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,wght@0,300;0,600;0,900;1,300&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root {
    --bg:#0d0d0f; --surface:#141417; --surface2:#1c1c21; --border:#2a2a32;
    --accent:#c8f060; --accent2:#60d4f0; --accent3:#f060a8;
    --text:#e8e8ec; --muted:#6b6b7a;
    --font-head:'Fraunces',Georgia,serif; --font-mono:'DM Mono',monospace;
    --r:12px; --r-lg:20px; --shadow:0 8px 40px rgba(0,0,0,0.5);
  }
  html { scroll-behavior:smooth; }
  body { background:var(--bg); color:var(--text); font-family:var(--font-mono); font-size:14px; line-height:1.6; min-height:100vh; overflow-x:hidden; }
  body::before { content:''; position:fixed; inset:0; background: radial-gradient(ellipse 60% 40% at 80% 10%,rgba(200,240,96,.06) 0%,transparent 60%), radial-gradient(ellipse 50% 50% at 10% 80%,rgba(96,212,240,.05) 0%,transparent 60%); pointer-events:none; z-index:0; }
  .app { position:relative; z-index:1; display:grid; grid-template-columns:260px 1fr 320px; grid-template-rows:64px 1fr; height:100vh; }
  header { grid-column:1/-1; display:flex; align-items:center; justify-content:space-between; padding:0 28px; border-bottom:1px solid var(--border); background:rgba(13,13,15,.9); backdrop-filter:blur(12px); }
  .logo { font-family:var(--font-head); font-size:22px; font-weight:900; letter-spacing:-.5px; display:flex; align-items:center; gap:10px; }
  .logo span { color:var(--accent); }
  .logo-dot { width:8px; height:8px; border-radius:50%; background:var(--accent); animation:pulse 2s ease-in-out infinite; }
  @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.5;transform:scale(.8)} }
  .header-stats { display:flex; gap:20px; font-size:12px; color:var(--muted); }
  .header-stats strong { color:var(--accent); }
  .sidebar { border-right:1px solid var(--border); padding:20px 16px; overflow-y:auto; background:var(--surface); }
  .sidebar-section { margin-bottom:28px; }
  .sidebar-label { font-size:10px; font-weight:500; letter-spacing:2px; text-transform:uppercase; color:var(--muted); margin-bottom:10px; padding:0 8px; }
  .nav-btn { display:flex; align-items:center; gap:10px; width:100%; padding:9px 12px; border-radius:var(--r); border:none; background:transparent; color:var(--muted); font-family:var(--font-mono); font-size:13px; cursor:pointer; transition:all .15s; text-align:left; }
  .nav-btn:hover { background:var(--surface2); color:var(--text); }
  .nav-btn.active { background:rgba(200,240,96,.12); color:var(--accent); }
  .nav-btn .icon { font-size:16px; }
  .mini-stat { display:flex; justify-content:space-between; align-items:center; padding:7px 12px; font-size:12px; color:var(--muted); }
  .mini-stat .val { font-size:18px; font-family:var(--font-head); font-weight:600; color:var(--text); }
  .mini-stat .val.high { color:var(--accent3); }
  .mini-stat .val.done { color:var(--accent); }
  .main { overflow-y:auto; padding:24px 28px; display:flex; flex-direction:column; gap:20px; }
  .page { display:none; flex-direction:column; gap:20px; }
  .page.active { display:flex; }
  .page-title { font-family:var(--font-head); font-size:32px; font-weight:900; letter-spacing:-1px; line-height:1.1; }
  .page-title em { color:var(--accent); font-style:italic; }
  .toolbar { display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
  .filter-chip { padding:6px 14px; border-radius:100px; border:1px solid var(--border); background:transparent; color:var(--muted); font-family:var(--font-mono); font-size:12px; cursor:pointer; transition:all .15s; }
  .filter-chip:hover { border-color:var(--accent); color:var(--accent); }
  .filter-chip.active { background:var(--accent); color:var(--bg); border-color:var(--accent); }
  .search-box { flex:1; max-width:280px; padding:8px 14px; border-radius:100px; border:1px solid var(--border); background:var(--surface2); color:var(--text); font-family:var(--font-mono); font-size:13px; outline:none; transition:border-color .2s; }
  .search-box:focus { border-color:var(--accent2); }
  .search-box::placeholder { color:var(--muted); }
  .task-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:14px; }
  .task-card { background:var(--surface); border:1px solid var(--border); border-radius:var(--r-lg); padding:18px 20px; transition:all .2s; cursor:pointer; position:relative; overflow:hidden; animation:cardIn .3s ease both; }
  @keyframes cardIn { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)} }
  .task-card:hover { border-color:var(--accent2); transform:translateY(-2px); box-shadow:0 12px 32px rgba(0,0,0,.4); }
  .task-card::before { content:''; position:absolute; top:0; left:0; right:0; height:3px; border-radius:var(--r-lg) var(--r-lg) 0 0; background:var(--accent2); opacity:0; transition:opacity .2s; }
  .task-card:hover::before { opacity:1; }
  .task-card.priority-high::before { background:var(--accent3); opacity:1; }
  .task-card.priority-medium::before { background:var(--accent); opacity:.6; }
  .task-card-top { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:10px; }
  .task-title { font-family:var(--font-head); font-size:17px; font-weight:600; line-height:1.3; flex:1; }
  .task-card.completed .task-title { text-decoration:line-through; color:var(--muted); }
  .task-card-actions { display:flex; gap:4px; opacity:0; transition:opacity .2s; }
  .task-card:hover .task-card-actions { opacity:1; }
  .icon-btn { width:28px; height:28px; border-radius:8px; border:none; background:var(--surface2); color:var(--muted); font-size:13px; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all .15s; }
  .icon-btn:hover { background:var(--border); color:var(--text); }
  .icon-btn.danger:hover { background:rgba(240,96,168,.2); color:var(--accent3); }
  .icon-btn.ai-btn:hover { background:rgba(200,240,96,.15); color:var(--accent); }
  .task-meta { display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
  .badge { padding:3px 9px; border-radius:100px; font-size:11px; font-weight:500; border:1px solid; }
  .badge-subject { background:rgba(96,212,240,.1); color:var(--accent2); border-color:rgba(96,212,240,.2); }
  .badge-high { background:rgba(240,96,168,.1); color:var(--accent3); border-color:rgba(240,96,168,.2); }
  .badge-medium { background:rgba(200,240,96,.1); color:var(--accent); border-color:rgba(200,240,96,.2); }
  .badge-low { background:rgba(107,107,122,.2); color:var(--muted); border-color:var(--border); }
  .badge-pending { background:rgba(200,240,96,.08); color:#a8c84a; border-color:rgba(200,240,96,.15); }
  .badge-in-progress { background:rgba(96,212,240,.1); color:var(--accent2); border-color:rgba(96,212,240,.2); }
  .badge-completed { background:rgba(107,107,122,.2); color:var(--muted); border-color:var(--border); }
  .task-due { font-size:12px; color:var(--muted); margin-top:8px; display:flex; align-items:center; gap:5px; }
  .task-due.overdue { color:var(--accent3); }
  .task-desc { font-size:12px; color:var(--muted); margin-top:6px; line-height:1.5; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
  .subtasks-list { margin-top:10px; padding-top:10px; border-top:1px solid var(--border); display:flex; flex-direction:column; gap:4px; }
  .subtask-item { display:flex; align-items:center; gap:8px; font-size:12px; color:var(--muted); cursor:pointer; padding:3px 0; transition:color .15s; }
  .subtask-item:hover { color:var(--text); }
  .subtask-check { width:14px; height:14px; border-radius:3px; border:1px solid var(--border); flex-shrink:0; display:flex; align-items:center; justify-content:center; font-size:9px; transition:all .15s; }
  .subtask-item.done .subtask-check { background:var(--accent); border-color:var(--accent); color:var(--bg); }
  .subtask-item.done span { text-decoration:line-through; }
  .empty-state { grid-column:1/-1; text-align:center; padding:60px 20px; color:var(--muted); }
  .empty-state .big { font-size:48px; margin-bottom:12px; }
  .empty-state p { font-family:var(--font-head); font-style:italic; font-size:18px; }
  .add-form { background:var(--surface); border:1px solid var(--border); border-radius:var(--r-lg); padding:24px; display:flex; flex-direction:column; gap:16px; }
  .form-row { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
  .form-group { display:flex; flex-direction:column; gap:6px; }
  .form-group.full { grid-column:1/-1; }
  label { font-size:11px; letter-spacing:1px; text-transform:uppercase; color:var(--muted); }
  input[type="text"],input[type="date"],textarea,select { background:var(--surface2); border:1px solid var(--border); border-radius:var(--r); padding:10px 14px; color:var(--text); font-family:var(--font-mono); font-size:13px; outline:none; transition:border-color .2s; width:100%; }
  input:focus,textarea:focus,select:focus { border-color:var(--accent2); }
  input::placeholder,textarea::placeholder { color:var(--muted); }
  textarea { resize:vertical; min-height:80px; }
  select option { background:var(--surface2); }
  .btn { padding:11px 22px; border-radius:var(--r); border:none; font-family:var(--font-mono); font-size:13px; font-weight:500; cursor:pointer; transition:all .15s; display:inline-flex; align-items:center; gap:7px; }
  .btn-primary { background:var(--accent); color:var(--bg); }
  .btn-primary:hover { background:#d4f570; transform:translateY(-1px); }
  .btn-secondary { background:var(--surface2); color:var(--text); border:1px solid var(--border); }
  .btn-secondary:hover { border-color:var(--accent2); color:var(--accent2); }
  .btn-ai { background:rgba(200,240,96,.12); color:var(--accent); border:1px solid rgba(200,240,96,.25); }
  .btn-ai:hover { background:rgba(200,240,96,.2); }
  .form-actions { display:flex; gap:10px; justify-content:flex-end; }
  .ai-panel { border-left:1px solid var(--border); background:var(--surface); display:flex; flex-direction:column; overflow:hidden; }
  .ai-header { padding:16px 18px; border-bottom:1px solid var(--border); display:flex; align-items:center; gap:10px; }
  .ai-avatar { width:32px; height:32px; border-radius:10px; background:linear-gradient(135deg,var(--accent),var(--accent2)); display:flex; align-items:center; justify-content:center; font-size:16px; flex-shrink:0; }
  .ai-header-text { flex:1; }
  .ai-name { font-family:var(--font-head); font-weight:600; font-size:15px; }
  .ai-status { font-size:11px; color:var(--accent); }
  .ai-messages { flex:1; overflow-y:auto; padding:16px; display:flex; flex-direction:column; gap:12px; scroll-behavior:smooth; }
  .msg { display:flex; gap:8px; animation:msgIn .2s ease both; }
  @keyframes msgIn { from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:translateY(0)} }
  .msg.user { flex-direction:row-reverse; }
  .msg-bubble { max-width:85%; padding:10px 14px; border-radius:14px; font-size:13px; line-height:1.5; }
  .msg.ai .msg-bubble { background:var(--surface2); border:1px solid var(--border); border-bottom-left-radius:4px; color:var(--text); }
  .msg.user .msg-bubble { background:rgba(200,240,96,.15); border:1px solid rgba(200,240,96,.25); border-bottom-right-radius:4px; color:var(--text); }
  .msg-avatar { width:26px; height:26px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:13px; flex-shrink:0; align-self:flex-end; }
  .msg.ai .msg-avatar { background:linear-gradient(135deg,var(--accent),var(--accent2)); }
  .msg.user .msg-avatar { background:var(--surface2); border:1px solid var(--border); }
  .quick-prompts { padding:12px 16px; display:flex; gap:6px; flex-wrap:wrap; border-top:1px solid var(--border); }
  .quick-btn { padding:5px 11px; border-radius:100px; border:1px solid var(--border); background:transparent; color:var(--muted); font-family:var(--font-mono); font-size:11px; cursor:pointer; transition:all .15s; white-space:nowrap; }
  .quick-btn:hover { border-color:var(--accent); color:var(--accent); background:rgba(200,240,96,.08); }
  .ai-input-row { padding:12px 16px; display:flex; gap:8px; border-top:1px solid var(--border); }
  .ai-input { flex:1; background:var(--surface2); border:1px solid var(--border); border-radius:var(--r); padding:9px 14px; color:var(--text); font-family:var(--font-mono); font-size:13px; outline:none; transition:border-color .2s; }
  .ai-input:focus { border-color:var(--accent); }
  .send-btn { width:36px; height:36px; border-radius:10px; border:none; background:var(--accent); color:var(--bg); font-size:16px; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all .15s; flex-shrink:0; }
  .send-btn:hover { background:#d4f570; }
  .send-btn:disabled { background:var(--surface2); color:var(--muted); cursor:default; }
  .typing { display:flex; gap:4px; padding:10px 14px; }
  .typing-dot { width:7px; height:7px; border-radius:50%; background:var(--muted); animation:typingAnim 1.2s ease-in-out infinite; }
  .typing-dot:nth-child(2){animation-delay:.15s} .typing-dot:nth-child(3){animation-delay:.3s}
  @keyframes typingAnim { 0%,80%,100%{opacity:.3;transform:scale(.8)} 40%{opacity:1;transform:scale(1.1)} }
  .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,.7); backdrop-filter:blur(4px); z-index:100; display:none; align-items:center; justify-content:center; padding:20px; }
  .modal-overlay.open { display:flex; }
  .modal { background:var(--surface); border:1px solid var(--border); border-radius:var(--r-lg); padding:28px; width:100%; max-width:520px; box-shadow:var(--shadow); animation:modalIn .2s ease; }
  @keyframes modalIn { from{opacity:0;transform:scale(.95)} to{opacity:1;transform:scale(1)} }
  .modal-title { font-family:var(--font-head); font-size:22px; font-weight:900; margin-bottom:20px; display:flex; align-items:center; gap:10px; }
  .toast-container { position:fixed; bottom:20px; right:20px; z-index:200; display:flex; flex-direction:column; gap:8px; }
  .toast { padding:12px 18px; border-radius:var(--r); border:1px solid var(--border); background:var(--surface2); font-size:13px; animation:toastIn .25s ease both; max-width:280px; box-shadow:var(--shadow); }
  @keyframes toastIn { from{opacity:0;transform:translateX(20px)} to{opacity:1;transform:translateX(0)} }
  .toast.success { border-color:rgba(200,240,96,.4); color:var(--accent); }
  .toast.error { border-color:rgba(240,96,168,.4); color:var(--accent3); }
  .toast.info { border-color:rgba(96,212,240,.3); color:var(--accent2); }
  .timeline { display:flex; flex-direction:column; gap:10px; }
  .timeline-item { display:flex; gap:16px; align-items:flex-start; padding:16px 20px; background:var(--surface); border:1px solid var(--border); border-radius:var(--r-lg); animation:cardIn .3s ease both; transition:border-color .2s; }
  .timeline-item:hover { border-color:var(--accent2); }
  .timeline-date { text-align:center; min-width:50px; flex-shrink:0; }
  .timeline-day { font-family:var(--font-head); font-size:26px; font-weight:900; line-height:1; color:var(--accent); }
  .timeline-month { font-size:11px; color:var(--muted); letter-spacing:1px; text-transform:uppercase; }
  .timeline-content { flex:1; }
  .timeline-title { font-family:var(--font-head); font-size:16px; font-weight:600; margin-bottom:4px; }
  ::-webkit-scrollbar { width:4px; }
  ::-webkit-scrollbar-track { background:transparent; }
  ::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }
  ::-webkit-scrollbar-thumb:hover { background:var(--muted); }
  .demo-banner { background:rgba(200,240,96,.08); border-bottom:1px solid rgba(200,240,96,.2); padding:6px 28px; font-size:11px; color:var(--accent); letter-spacing:.5px; text-align:center; }
</style>
</head>
<body>

<div class="demo-banner">üé® PREVIEW MODE ‚Äî Mock data loaded. Connect Flask backend for live AI features.</div>

<div class="app">
  <header>
    <div class="logo"><div class="logo-dot"></div>Study<span>Bot</span></div>
    <div class="header-stats" id="headerStats">
      <span>6 tasks &nbsp;¬∑&nbsp; <strong>3</strong> pending &nbsp;¬∑&nbsp; <strong>2</strong> high priority</span>
    </div>
  </header>

  <aside class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-label">Navigate</div>
      <button class="nav-btn active" onclick="showPage('tasks',this)"><span class="icon">üìã</span> All Tasks</button>
      <button class="nav-btn" onclick="showPage('upcoming',this)"><span class="icon">üìÖ</span> Upcoming</button>
      <button class="nav-btn" onclick="showPage('add',this)"><span class="icon">‚úèÔ∏è</span> Add Task</button>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-label">Overview</div>
      <div class="mini-stat"><span>Pending</span><span class="val" id="statPending">3</span></div>
      <div class="mini-stat"><span>In Progress</span><span class="val" id="statInProgress">2</span></div>
      <div class="mini-stat"><span>Done</span><span class="val done" id="statDone">1</span></div>
      <div class="mini-stat"><span>High Priority</span><span class="val high" id="statHigh">2</span></div>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-label">Filter by</div>
      <button class="nav-btn" onclick="filterByStatus('pending')"><span class="icon">üü°</span> Pending</button>
      <button class="nav-btn" onclick="filterByStatus('in-progress')"><span class="icon">üîµ</span> In Progress</button>
      <button class="nav-btn" onclick="filterByStatus('completed')"><span class="icon">‚úÖ</span> Completed</button>
      <button class="nav-btn" onclick="filterByStatus(null)"><span class="icon">üîÑ</span> Clear filter</button>
    </div>
  </aside>

  <main class="main">
    <!-- Tasks Page -->
    <div class="page active" id="page-tasks">
      <h1 class="page-title">Your <em>Tasks</em></h1>
      <div class="toolbar">
        <input class="search-box" type="text" placeholder="üîç  Search tasks..." id="searchBox" oninput="renderTasks()">
        <button class="filter-chip active" onclick="setFilter('all',this)">All</button>
        <button class="filter-chip" onclick="setFilter('high',this)">üî¥ High</button>
        <button class="filter-chip" onclick="setFilter('medium',this)">üü° Medium</button>
        <button class="filter-chip" onclick="setFilter('low',this)">üü¢ Low</button>
      </div>
      <div class="task-grid" id="taskGrid"></div>
    </div>

    <!-- Upcoming Page -->
    <div class="page" id="page-upcoming">
      <h1 class="page-title"><em>Upcoming</em> Deadlines</h1>
      <div class="timeline" id="upcomingList"></div>
    </div>

    <!-- Add Task Page -->
    <div class="page" id="page-add">
      <h1 class="page-title">Add <em>New</em> Task</h1>
      <form class="add-form" onsubmit="submitTask(event)">
        <div class="form-group full"><label>Task Title *</label><input type="text" id="f-title" placeholder="e.g. Write Chemistry Lab Report" required></div>
        <div class="form-row">
          <div class="form-group"><label>Subject</label><input type="text" id="f-subject" placeholder="e.g. Chemistry"></div>
          <div class="form-group"><label>Due Date</label><input type="date" id="f-due"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Priority</label><select id="f-priority"><option value="medium">üü° Medium</option><option value="high">üî¥ High</option><option value="low">üü¢ Low</option></select></div>
          <div class="form-group"><label>Status</label><select id="f-status"><option value="pending">Pending</option><option value="in-progress">In Progress</option><option value="completed">Completed</option></select></div>
        </div>
        <div class="form-group full"><label>Notes / Description</label><textarea id="f-desc" placeholder="Any extra details..."></textarea></div>
        <div class="form-actions">
          <button type="button" class="btn btn-ai" onclick="toast('‚ú® AI would suggest priority here (needs Flask backend)','info')">‚ú® AI Suggest Priority</button>
          <button type="button" class="btn btn-secondary" onclick="resetForm()">Clear</button>
          <button type="submit" class="btn btn-primary">‚ûï Add Task</button>
        </div>
      </form>
    </div>
  </main>

  <aside class="ai-panel">
    <div class="ai-header">
      <div class="ai-avatar">ü§ñ</div>
      <div class="ai-header-text">
        <div class="ai-name">StudyBot AI</div>
        <div class="ai-status">‚óè Preview mode ‚Äî powered by Claude</div>
      </div>
    </div>
    <div class="ai-messages" id="aiMessages">
      <div class="msg ai">
        <div class="msg-avatar">ü§ñ</div>
        <div class="msg-bubble">Hey! üëã I'm StudyBot, your personal study assistant.<br><br>I can see all your tasks and help you plan, prioritise, and stay on track. In preview mode, I'll respond with demo answers ‚Äî connect the Flask backend for real Claude AI!</div>
      </div>
    </div>
    <div class="quick-prompts">
      <button class="quick-btn" onclick="quickPrompt('What should I focus on today?')">Focus today</button>
      <button class="quick-btn" onclick="quickPrompt('Am I overloaded this week?')">Am I overloaded?</button>
      <button class="quick-btn" onclick="quickPrompt('What are my high priority tasks?')">High priority</button>
      <button class="quick-btn" onclick="quickPrompt('Give me a study schedule')">Study plan</button>
    </div>
    <div class="ai-input-row">
      <input class="ai-input" id="aiInput" type="text" placeholder="Ask StudyBot anything..." onkeydown="if(event.key==='Enter')sendMessage()">
      <button class="send-btn" id="sendBtn" onclick="sendMessage()">‚û§</button>
    </div>
  </aside>
</div>

<!-- Edit Modal -->
<div class="modal-overlay" id="editModal">
  <div class="modal">
    <div class="modal-title">‚úèÔ∏è Edit Task</div>
    <form onsubmit="submitEdit(event)" style="display:flex;flex-direction:column;gap:14px">
      <input type="hidden" id="e-id">
      <div class="form-group"><label>Title</label><input type="text" id="e-title" required></div>
      <div class="form-row">
        <div class="form-group"><label>Subject</label><input type="text" id="e-subject"></div>
        <div class="form-group"><label>Due Date</label><input type="date" id="e-due"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Priority</label><select id="e-priority"><option value="medium">üü° Medium</option><option value="high">üî¥ High</option><option value="low">üü¢ Low</option></select></div>
        <div class="form-group"><label>Status</label><select id="e-status"><option value="pending">Pending</option><option value="in-progress">In Progress</option><option value="completed">Completed</option></select></div>
      </div>
      <div class="form-group"><label>Notes</label><textarea id="e-desc"></textarea></div>
      <div class="form-actions">
        <button type="button" class="btn btn-ai" onclick="toast('‚ú® Subtask generation needs Flask backend','info')">‚ú® Generate Subtasks</button>
        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        <button type="submit" class="btn btn-primary">Save Changes</button>
      </div>
    </form>
  </div>
</div>

<div class="toast-container" id="toastContainer"></div>

<script>
// ‚îÄ‚îÄ Mock data ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let tasks = [
  { id:'1', title:'Write History Essay', subject:'History', description:'1500 words on WW2 causes', due_date:'2026-02-28', priority:'high', status:'pending', created_at:'2026-02-20T10:00:00', updated_at:'2026-02-20T10:00:00' },
  { id:'2', title:'Chemistry Lab Report', subject:'Chemistry', description:'Titration experiment analysis', due_date:'2026-03-05', priority:'high', status:'in-progress', created_at:'2026-02-19T09:00:00', updated_at:'2026-02-21T11:00:00',
    subtasks:[{text:'Write introduction',done:true},{text:'Analyse results table',done:true},{text:'Draw conclusion',done:false},{text:'Proofread & submit',done:false}] },
  { id:'3', title:'Maths Problem Set 7', subject:'Mathematics', description:'Chapter 9 exercises 1‚Äì20', due_date:'2026-02-25', priority:'medium', status:'pending', created_at:'2026-02-18T14:00:00', updated_at:'2026-02-18T14:00:00' },
  { id:'4', title:'Read Romeo & Juliet Act 3', subject:'English Lit', description:'', due_date:'2026-03-10', priority:'low', status:'pending', created_at:'2026-02-17T08:00:00', updated_at:'2026-02-17T08:00:00' },
  { id:'5', title:'Physics Revision Notes', subject:'Physics', description:'Electricity & magnetism chapter', due_date:'2026-03-15', priority:'medium', status:'in-progress', created_at:'2026-02-16T16:00:00', updated_at:'2026-02-20T09:00:00' },
  { id:'6', title:'French Vocabulary Test', subject:'French', description:'Unit 5 vocab list', due_date:'2026-02-10', priority:'high', status:'completed', created_at:'2026-02-01T12:00:00', updated_at:'2026-02-10T18:00:00' },
];

let filterPriority = 'all';
let filterStatus = null;
let chatHistory = [];

const demoReplies = [
  "Based on your tasks, I'd focus on the **History Essay** first ‚Äî it's high priority and due Feb 28th! üìù",
  "You have 2 high-priority tasks pending. I'd tackle the Maths Problem Set next since it's due Feb 25th ‚Äî that's coming up fast! ‚è∞",
  "Looking at your workload, you have 3 pending + 2 in-progress tasks. That's manageable! Start with the History Essay today and aim to finish the Chemistry Lab Report by tomorrow. üí™",
  "Your high priority tasks are: History Essay (due Feb 28) and Chemistry Lab Report (in progress, due Mar 5). The French Vocab Test is already done ‚Äî great job! ‚úÖ",
  "Here's a study plan: **Today** ‚Äî History Essay draft. **Tomorrow** ‚Äî Maths Problem Set. **This weekend** ‚Äî Chemistry Lab Report + Physics Notes. **Next week** ‚Äî English Lit reading. You've got this! üéØ",
];
let replyIndex = 0;

function toast(msg, type='info') {
  const el = document.createElement('div');
  el.className = `toast ${type}`;
  el.textContent = msg;
  document.getElementById('toastContainer').appendChild(el);
  setTimeout(() => el.remove(), 3000);
}

function formatDate(str) {
  if (!str) return null;
  const d = new Date(str + 'T00:00:00');
  return d.toLocaleDateString('en-GB', {day:'numeric',month:'short',year:'numeric'});
}
function isOverdue(str) {
  if (!str) return false;
  return new Date(str + 'T23:59:59') < new Date();
}
function escHtml(s) {
  return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function renderTasks() {
  const query = document.getElementById('searchBox').value.toLowerCase();
  let filtered = tasks.filter(t => {
    const matchPri = filterPriority==='all' || t.priority===filterPriority;
    const matchStatus = !filterStatus || t.status===filterStatus;
    const matchSearch = !query || t.title.toLowerCase().includes(query) || (t.subject||'').toLowerCase().includes(query) || (t.description||'').toLowerCase().includes(query);
    return matchPri && matchStatus && matchSearch;
  });
  const grid = document.getElementById('taskGrid');
  if (!filtered.length) {
    grid.innerHTML = `<div class="empty-state"><div class="big">üì≠</div><p>No tasks match.<br>Try clearing filters.</p></div>`;
    return;
  }
  grid.innerHTML = filtered.map(t => {
    const overdue = isOverdue(t.due_date) && t.status!=='completed';
    const subtasksHtml = (t.subtasks||[]).map((s,i) =>
      `<div class="subtask-item ${s.done?'done':''}" onclick="toggleSubtask('${t.id}',${i})">
        <div class="subtask-check">${s.done?'‚úì':''}</div><span>${escHtml(s.text)}</span>
      </div>`).join('');
    return `<div class="task-card priority-${t.priority} ${t.status==='completed'?'completed':''}">
      <div class="task-card-top">
        <div class="task-title">${escHtml(t.title)}</div>
        <div class="task-card-actions">
          <button class="icon-btn ai-btn" onclick="genSubtasks('${t.id}')" title="AI subtasks">‚ú®</button>
          <button class="icon-btn" onclick="openEdit('${t.id}')" title="Edit">‚úèÔ∏è</button>
          <button class="icon-btn" onclick="quickComplete('${t.id}')" title="Mark done">‚úÖ</button>
          <button class="icon-btn danger" onclick="deleteTask('${t.id}')" title="Delete">üóë</button>
        </div>
      </div>
      ${t.description?`<div class="task-desc">${escHtml(t.description)}</div>`:''}
      <div class="task-meta">
        ${t.subject?`<span class="badge badge-subject">${escHtml(t.subject)}</span>`:''}
        <span class="badge badge-${t.priority}">${t.priority}</span>
        <span class="badge badge-${t.status}">${t.status}</span>
      </div>
      ${t.due_date?`<div class="task-due ${overdue?'overdue':''}">${overdue?'‚ö†Ô∏è':'üìÖ'} ${formatDate(t.due_date)}${overdue?' ‚Äî Overdue!':''}</div>`:''}
      ${subtasksHtml?`<div class="subtasks-list">${subtasksHtml}</div>`:''}
    </div>`;
  }).join('');
}

function showPage(name, btn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('page-'+name).classList.add('active');
  if (btn) btn.classList.add('active');
  if (name==='upcoming') renderUpcoming();
}

function renderUpcoming() {
  const cutoff = new Date(); cutoff.setDate(cutoff.getDate()+14);
  const items = tasks.filter(t => t.due_date && t.status!=='completed' && new Date(t.due_date+'T00:00:00') <= cutoff).sort((a,b)=>a.due_date.localeCompare(b.due_date));
  const list = document.getElementById('upcomingList');
  if (!items.length) { list.innerHTML=`<div class="empty-state"><div class="big">üéâ</div><p>Nothing due in the next 2 weeks!</p></div>`; return; }
  list.innerHTML = items.map(t => {
    const d = new Date(t.due_date+'T00:00:00');
    return `<div class="timeline-item">
      <div class="timeline-date"><div class="timeline-day">${d.getDate()}</div><div class="timeline-month">${d.toLocaleString('en',{month:'short'})}</div></div>
      <div class="timeline-content"><div class="timeline-title">${escHtml(t.title)}</div><div class="task-meta">${t.subject?`<span class="badge badge-subject">${escHtml(t.subject)}</span>`:''}<span class="badge badge-${t.priority}">${t.priority}</span></div></div>
      <div style="display:flex;gap:6px;align-items:center"><button class="icon-btn" onclick="openEdit('${t.id}')">‚úèÔ∏è</button><button class="icon-btn" onclick="quickComplete('${t.id}')">‚úÖ</button></div>
    </div>`;
  }).join('');
}

function setFilter(val, btn) {
  filterPriority = val;
  document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
  btn.classList.add('active');
  renderTasks();
}
function filterByStatus(val) {
  filterStatus = val;
  showPage('tasks', document.querySelector('.nav-btn'));
  renderTasks();
}

function submitTask(e) {
  e.preventDefault();
  const id = Date.now().toString();
  tasks.unshift({
    id, title:document.getElementById('f-title').value,
    subject:document.getElementById('f-subject').value,
    due_date:document.getElementById('f-due').value||null,
    priority:document.getElementById('f-priority').value,
    status:document.getElementById('f-status').value,
    description:document.getElementById('f-desc').value,
    created_at:new Date().toISOString(), updated_at:new Date().toISOString()
  });
  toast('Task added! ‚úÖ','success');
  resetForm();
  showPage('tasks', document.querySelectorAll('.nav-btn')[0]);
}
function resetForm() {
  ['f-title','f-subject','f-due','f-desc'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('f-priority').value='medium';
  document.getElementById('f-status').value='pending';
}
function deleteTask(id) {
  if (!confirm('Delete this task?')) return;
  tasks = tasks.filter(t=>t.id!==id);
  toast('Task deleted','info');
  renderTasks();
}
function quickComplete(id) {
  const t = tasks.find(t=>t.id===id); if(!t) return;
  t.status = t.status==='completed'?'pending':'completed';
  toast(t.status==='completed'?'‚úÖ Marked complete!':'üîÑ Reopened','success');
  renderTasks();
}
function toggleSubtask(taskId, idx) {
  const t = tasks.find(t=>t.id===taskId); if(!t||!t.subtasks) return;
  t.subtasks[idx].done = !t.subtasks[idx].done;
  renderTasks();
}
function genSubtasks(id) {
  const t = tasks.find(t=>t.id===id); if(!t) return;
  const demos = ['Research and gather sources','Create an outline','Write first draft','Review and revise','Final proofread & submit'];
  t.subtasks = demos.map(s=>({text:s,done:false}));
  toast('‚ú® Demo subtasks generated!','success');
  renderTasks();
}
function openEdit(id) {
  const t = tasks.find(t=>t.id===id); if(!t) return;
  document.getElementById('e-id').value=t.id;
  document.getElementById('e-title').value=t.title;
  document.getElementById('e-subject').value=t.subject||'';
  document.getElementById('e-due').value=t.due_date||'';
  document.getElementById('e-priority').value=t.priority;
  document.getElementById('e-status').value=t.status;
  document.getElementById('e-desc').value=t.description||'';
  document.getElementById('editModal').classList.add('open');
}
function closeModal() { document.getElementById('editModal').classList.remove('open'); }
function submitEdit(e) {
  e.preventDefault();
  const id = document.getElementById('e-id').value;
  const t = tasks.find(t=>t.id===id); if(!t) return;
  t.title=document.getElementById('e-title').value;
  t.subject=document.getElementById('e-subject').value;
  t.due_date=document.getElementById('e-due').value||null;
  t.priority=document.getElementById('e-priority').value;
  t.status=document.getElementById('e-status').value;
  t.description=document.getElementById('e-desc').value;
  toast('Task updated! ‚úÖ','success');
  closeModal(); renderTasks();
}

// AI Chat (demo)
function sendMessage() {
  const input = document.getElementById('aiInput');
  const msg = input.value.trim(); if(!msg) return;
  input.value='';
  appendMsg('user', msg);
  document.getElementById('sendBtn').disabled=true;
  const typingId='typing-'+Date.now();
  document.getElementById('aiMessages').insertAdjacentHTML('beforeend',
    `<div class="msg ai" id="${typingId}"><div class="msg-avatar">ü§ñ</div><div class="msg-bubble"><div class="typing"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div></div></div>`);
  scrollChat();
  setTimeout(() => {
    document.getElementById(typingId)?.remove();
    const reply = demoReplies[replyIndex % demoReplies.length]; replyIndex++;
    appendMsg('ai', reply);
    document.getElementById('sendBtn').disabled=false;
  }, 1200);
}
function appendMsg(role, text) {
  const avatar = role==='ai'?'ü§ñ':'üßë';
  document.getElementById('aiMessages').insertAdjacentHTML('beforeend',
    `<div class="msg ${role}">${role==='ai'?`<div class="msg-avatar">${avatar}</div>`:''}<div class="msg-bubble">${escHtml(text).replace(/\n/g,'<br>').replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')}</div>${role==='user'?`<div class="msg-avatar">${avatar}</div>`:''}</div>`);
  scrollChat();
}
function scrollChat() { const el=document.getElementById('aiMessages'); el.scrollTop=el.scrollHeight; }
function quickPrompt(text) { document.getElementById('aiInput').value=text; sendMessage(); }

renderTasks();
</script>
</body>
</html>