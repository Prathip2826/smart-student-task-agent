<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>StudyBot â€” Smart Study Companion</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Sora:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js" defer></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:16px;scroll-behavior:smooth}

:root{
  --bg:#F7F8FC;--surface:#FFFFFF;--surface2:#F0F2FA;--surface3:#E8EBF5;
  --border:#E2E6F2;--border2:#CDD2E8;
  --tx:#0D1117;--tx2:#3A4060;--tx3:#6B748F;--tx4:#A8B0CC;
  --acc:#4361EE;--acc2:#7B8EF7;--acc-bg:#EEF1FF;--acc-dark:#2D4BCC;
  --green:#16A34A;--green-bg:#F0FDF4;--green-border:#BBF7D0;
  --red:#DC2626;--red-bg:#FFF5F5;--red-border:#FCA5A5;
  --amber:#D97706;--amber-bg:#FFFBEB;--amber-border:#FCD34D;
  --purple:#7C3AED;--purple-bg:#F5F3FF;--purple-border:#C4B5FD;
  --teal:#0D9488;--teal-bg:#F0FDFA;
  --shadow-xs:0 1px 2px rgba(13,17,23,0.05);
  --shadow-sm:0 1px 4px rgba(13,17,23,0.08),0 1px 2px rgba(13,17,23,0.04);
  --shadow:0 4px 16px rgba(13,17,23,0.08),0 1px 4px rgba(13,17,23,0.04);
  --shadow-lg:0 12px 40px rgba(13,17,23,0.12),0 4px 8px rgba(13,17,23,0.06);
  --shadow-xl:0 24px 64px rgba(13,17,23,0.16);
  --r:12px;--r-sm:8px;--r-lg:18px;--r-xl:24px;
  --font:'Plus Jakarta Sans',sans-serif;--font-display:'Sora',sans-serif;
}
[data-theme="dark"]{
  --bg:#0B0D12;--surface:#13161F;--surface2:#1A1E2C;--surface3:#222638;
  --border:#272C40;--border2:#323852;
  --tx:#E8ECF8;--tx2:#B0B8D4;--tx3:#616880;--tx4:#3A3F55;
  --acc:#6B8BFF;--acc2:#9AABFF;--acc-bg:#1A2240;--acc-dark:#8BA5FF;
  --green:#22C55E;--green-bg:#052010;--green-border:#166534;
  --red:#EF4444;--red-bg:#1A0808;--red-border:#7F1D1D;
  --amber:#F59E0B;--amber-bg:#1A1000;--amber-border:#78350F;
  --purple:#A78BFA;--purple-bg:#180D2E;--purple-border:#4C1D95;
  --teal:#2DD4BF;--teal-bg:#041A18;
  --shadow-xs:0 1px 2px rgba(0,0,0,0.3);
  --shadow-sm:0 1px 4px rgba(0,0,0,0.4);
  --shadow:0 4px 16px rgba(0,0,0,0.4);
  --shadow-lg:0 12px 40px rgba(0,0,0,0.5);
  --shadow-xl:0 24px 64px rgba(0,0,0,0.6);
}

body{background:var(--bg);color:var(--tx);font-family:var(--font);line-height:1.6;-webkit-font-smoothing:antialiased;overflow-x:hidden;transition:background .3s,color .3s}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px}
button,input,select,textarea{font-family:var(--font)}
a{color:var(--acc);text-decoration:none}

/* â”€â”€ KEYFRAMES â”€â”€ */
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes scaleIn{from{opacity:0;transform:scale(0.94) translateY(8px)}to{opacity:1;transform:scale(1) translateY(0)}}
@keyframes slideLeft{from{opacity:0;transform:translateX(24px)}to{opacity:1;transform:translateX(0)}}
@keyframes slideRight{from{opacity:0;transform:translateX(-24px)}to{opacity:1;transform:translateX(0)}}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.04)}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}
@keyframes toastIn{from{opacity:0;transform:translateX(100%)}to{opacity:1;transform:translateX(0)}}
@keyframes toastOut{from{opacity:1;transform:translateX(0)}to{opacity:0;transform:translateX(100%)}}
@keyframes countUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
@keyframes barFill{from{width:0}to{width:var(--w)}}
@keyframes ringAnim{from{stroke-dashoffset:283}to{stroke-dashoffset:var(--d)}}
@keyframes popIn{from{transform:scale(0.5);opacity:0}to{transform:scale(1);opacity:1}}
@keyframes floatBg{0%,100%{transform:translateY(0) rotate(0deg)}50%{transform:translateY(-20px) rotate(5deg)}}
@keyframes gradShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LANDING PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#landingPage{min-height:100vh;display:flex;flex-direction:column}
.land-nav{position:sticky;top:0;z-index:50;background:rgba(247,248,252,0.85);backdrop-filter:blur(16px);border-bottom:1px solid var(--border);padding:0 5%;height:64px;display:flex;align-items:center;justify-content:space-between;transition:background .3s}
[data-theme="dark"] .land-nav{background:rgba(11,13,18,0.85)}
.land-logo{display:flex;align-items:center;gap:10px;font-family:var(--font-display);font-weight:900;font-size:1.4rem;color:var(--tx)}
.land-logo-ic{width:36px;height:36px;background:linear-gradient(135deg,var(--acc),var(--purple));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;box-shadow:0 4px 12px rgba(67,97,238,0.35)}
.land-nav-right{display:flex;align-items:center;gap:12px}
.btn-outline{padding:8px 18px;border-radius:100px;border:1.5px solid var(--border2);background:transparent;color:var(--tx2);font-size:0.85rem;font-weight:600;cursor:pointer;transition:all .2s}
.btn-outline:hover{border-color:var(--acc);color:var(--acc)}
.btn-solid{padding:9px 22px;border-radius:100px;border:none;background:var(--acc);color:#fff;font-size:0.85rem;font-weight:700;cursor:pointer;transition:all .2s;box-shadow:0 4px 12px rgba(67,97,238,0.25)}
.btn-solid:hover{background:var(--acc-dark);transform:translateY(-1px);box-shadow:0 6px 20px rgba(67,97,238,0.35)}
.theme-toggle-btn{width:36px;height:36px;border-radius:10px;border:1.5px solid var(--border);background:transparent;color:var(--tx2);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1rem;transition:all .2s}
.theme-toggle-btn:hover{background:var(--surface2);color:var(--tx)}

/* HERO */
.hero{flex:1;display:flex;align-items:center;justify-content:center;padding:80px 5% 60px;text-align:center;position:relative;overflow:hidden}
.hero-bg{position:absolute;inset:0;pointer-events:none;overflow:hidden}
.hero-blob{position:absolute;border-radius:50%;filter:blur(80px);opacity:0.12;animation:floatBg 8s ease-in-out infinite}
.hero-blob1{width:600px;height:600px;background:var(--acc);top:-200px;left:-200px;animation-delay:0s}
.hero-blob2{width:500px;height:500px;background:var(--purple);top:100px;right:-200px;animation-delay:3s}
.hero-blob3{width:400px;height:400px;background:var(--teal);bottom:-100px;left:30%;animation-delay:1.5s}
.hero-content{position:relative;z-index:1;max-width:700px}
.hero-badge{display:inline-flex;align-items:center;gap:6px;padding:6px 16px;background:var(--acc-bg);border:1px solid rgba(67,97,238,0.2);border-radius:100px;font-size:0.75rem;font-weight:700;color:var(--acc);letter-spacing:1px;text-transform:uppercase;margin-bottom:28px;animation:fadeUp .6s ease both}
.hero-h1{font-family:var(--font-display);font-size:clamp(2.8rem,6vw,5rem);font-weight:900;line-height:1.05;letter-spacing:-2px;margin-bottom:24px;color:var(--tx);animation:fadeUp .6s .1s ease both}
.hero-h1 em{font-style:italic;color:var(--acc)}
.hero-sub{font-size:1.1rem;color:var(--tx3);max-width:520px;margin:0 auto 40px;line-height:1.7;animation:fadeUp .6s .2s ease both}
.hero-btns{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;animation:fadeUp .6s .3s ease both}
.btn-hero-prim{padding:15px 36px;border-radius:100px;border:none;background:var(--acc);color:#fff;font-size:1rem;font-weight:700;cursor:pointer;transition:all .25s;box-shadow:0 6px 20px rgba(67,97,238,0.35)}
.btn-hero-prim:hover{background:var(--acc-dark);transform:translateY(-2px);box-shadow:0 10px 30px rgba(67,97,238,0.4)}
.btn-hero-sec{padding:15px 36px;border-radius:100px;border:1.5px solid var(--border2);background:var(--surface);color:var(--tx2);font-size:1rem;font-weight:600;cursor:pointer;transition:all .25s}
.btn-hero-sec:hover{border-color:var(--acc);color:var(--acc);background:var(--acc-bg)}
.hero-stats{display:flex;gap:40px;justify-content:center;margin-top:56px;animation:fadeUp .6s .4s ease both}
.hero-stat{text-align:center}
.hero-stat-val{font-family:var(--font-display);font-size:2rem;font-weight:900;color:var(--tx)}
.hero-stat-lbl{font-size:0.75rem;font-weight:600;color:var(--tx3);text-transform:uppercase;letter-spacing:0.5px}

/* FEATURES GRID */
.feat-section{padding:80px 5%;background:var(--surface)}
.feat-section-dark{background:var(--surface2)}
.section-label{display:inline-block;padding:4px 14px;background:var(--acc-bg);border-radius:100px;font-size:0.72rem;font-weight:700;color:var(--acc);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:16px}
.section-h2{font-family:var(--font-display);font-size:clamp(1.8rem,4vw,2.8rem);font-weight:900;line-height:1.1;color:var(--tx);margin-bottom:16px}
.section-h2 em{font-style:italic;color:var(--acc)}
.section-p{color:var(--tx3);font-size:1rem;max-width:520px;line-height:1.7;margin-bottom:48px}
.features-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px}
.feat-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-lg);padding:28px;transition:all .25s;position:relative;overflow:hidden}
.feat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;border-radius:3px 3px 0 0;background:linear-gradient(90deg,var(--acc),var(--purple));opacity:0;transition:opacity .25s}
.feat-card:hover{transform:translateY(-4px);box-shadow:var(--shadow-lg);border-color:var(--acc)}
.feat-card:hover::before{opacity:1}
.feat-icon{width:52px;height:52px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;margin-bottom:16px}
.feat-title{font-weight:700;font-size:1rem;margin-bottom:8px;color:var(--tx)}
.feat-desc{font-size:0.875rem;color:var(--tx3);line-height:1.6}

/* LANDING FOOTER */
.land-footer{background:var(--surface);border-top:1px solid var(--border);padding:28px 5%;display:flex;align-items:center;justify-content:space-between;font-size:0.8rem;color:var(--tx4)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#authPage{display:none;min-height:100vh;align-items:center;justify-content:center;padding:24px;background:var(--bg);position:relative;overflow:hidden}
.auth-blob{position:absolute;border-radius:50%;filter:blur(60px);opacity:0.08;pointer-events:none}
.auth-blob1{width:400px;height:400px;background:var(--acc);top:-100px;left:-100px}
.auth-blob2{width:300px;height:300px;background:var(--purple);bottom:-50px;right:-50px}
.auth-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-xl);padding:40px 36px;width:100%;max-width:440px;box-shadow:var(--shadow-xl);position:relative;z-index:1;animation:scaleIn .35s ease}
.auth-logo-wrap{text-align:center;margin-bottom:8px}
.auth-logo-ic{width:52px;height:52px;background:linear-gradient(135deg,var(--acc),var(--purple));border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:1.6rem;margin:0 auto 12px;box-shadow:0 8px 24px rgba(67,97,238,0.3)}
.auth-title{font-family:var(--font-display);font-weight:900;font-size:1.5rem;color:var(--tx);text-align:center}
.auth-sub{text-align:center;color:var(--tx3);font-size:0.875rem;margin-bottom:28px}
.auth-tabs{display:flex;gap:4px;background:var(--surface2);border-radius:var(--r-sm);padding:4px;margin-bottom:24px}
.auth-tab{flex:1;padding:9px;border-radius:6px;border:none;background:transparent;color:var(--tx3);font-weight:600;font-size:0.85rem;cursor:pointer;transition:all .2s;font-family:var(--font)}
.auth-tab.active{background:var(--surface);color:var(--acc);box-shadow:var(--shadow-sm)}
.form-grp{margin-bottom:16px}
.form-lbl{display:block;font-size:0.75rem;font-weight:700;color:var(--tx2);margin-bottom:6px;letter-spacing:.3px;text-transform:uppercase}
.form-inp{width:100%;padding:11px 14px;border:1.5px solid var(--border);background:var(--surface2);border-radius:var(--r-sm);color:var(--tx);font-size:0.9rem;outline:none;transition:all .2s;font-family:var(--font)}
.form-inp:focus{border-color:var(--acc);background:var(--surface);box-shadow:0 0 0 3px rgba(67,97,238,0.1)}
.form-inp::placeholder{color:var(--tx4)}
.form-inp-err{border-color:var(--red)!important}
.form-err{font-size:.72rem;color:var(--red);margin-top:4px;display:none}
.form-sel{width:100%;padding:11px 14px;border:1.5px solid var(--border);background:var(--surface2);border-radius:var(--r-sm);color:var(--tx);font-size:0.9rem;outline:none;cursor:pointer;transition:all .2s;-webkit-appearance:none;font-family:var(--font)}
.form-sel:focus{border-color:var(--acc);box-shadow:0 0 0 3px rgba(67,97,238,0.1)}
.form-ta{width:100%;padding:11px 14px;border:1.5px solid var(--border);background:var(--surface2);border-radius:var(--r-sm);color:var(--tx);font-size:0.9rem;outline:none;resize:vertical;min-height:80px;transition:all .2s;font-family:var(--font)}
.form-ta:focus{border-color:var(--acc);background:var(--surface);box-shadow:0 0 0 3px rgba(67,97,238,0.1)}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.btn-full{width:100%;padding:12px;background:var(--acc);color:#fff;border:none;border-radius:var(--r-sm);font-weight:700;font-size:.95rem;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px;font-family:var(--font)}
.btn-full:hover{background:var(--acc-dark);transform:translateY(-1px)}
.ql-section{margin-top:18px;padding-top:16px;border-top:1px solid var(--border)}
.ql-lbl{font-size:.68rem;font-weight:700;color:var(--tx4);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:8px;text-align:center}
.ql-chips{display:flex;flex-wrap:wrap;gap:6px;justify-content:center}
.ql-chip{padding:5px 12px;background:var(--surface2);border:1px solid var(--border);border-radius:100px;font-size:.78rem;color:var(--tx2);cursor:pointer;transition:all .15s}
.ql-chip:hover{border-color:var(--acc);color:var(--acc)}
.auth-back{text-align:center;margin-top:16px;font-size:.8rem;color:var(--tx3)}
.auth-back a{color:var(--acc)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APP SHELL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#app{display:none;height:100vh;overflow:hidden;flex-direction:column}
#app.visible{display:flex}
.app-body{flex:1;display:grid;grid-template-columns:64px 1fr;overflow:hidden;transition:grid-template-columns .3s cubic-bezier(.4,0,.2,1)}
.app-body.sb-open{grid-template-columns:256px 1fr}

/* â”€â”€ TOPBAR â”€â”€ */
.topbar{height:62px;background:var(--surface);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 20px;gap:12px;flex-shrink:0;z-index:40}
.topbar-hamburger{width:36px;height:36px;border-radius:var(--r-sm);border:1.5px solid var(--border);background:transparent;color:var(--tx3);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1rem;transition:all .15s;flex-shrink:0}
.topbar-hamburger:hover{background:var(--surface2);color:var(--tx)}
.topbar-title{font-family:var(--font-display);font-weight:700;font-size:1.1rem;flex:1;color:var(--tx)}
.topbar-right{display:flex;align-items:center;gap:8px}
.tb-ic-btn{width:36px;height:36px;border-radius:var(--r-sm);border:1.5px solid var(--border);background:transparent;color:var(--tx3);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s;position:relative;font-size:.95rem}
.tb-ic-btn:hover{background:var(--surface2);color:var(--tx)}
.tb-ic-btn.on{background:var(--acc-bg);border-color:var(--acc);color:var(--acc)}
.notif-dot{position:absolute;top:5px;right:5px;width:8px;height:8px;background:var(--red);border-radius:50%;border:2px solid var(--surface);display:none}
.notif-dot.show{display:block}
.tb-cta{padding:0 18px;height:36px;border-radius:100px;border:none;background:var(--acc);color:#fff;font-size:.82rem;font-weight:700;cursor:pointer;white-space:nowrap;transition:all .2s;display:flex;align-items:center;gap:6px}
.tb-cta:hover{background:var(--acc-dark);transform:translateY(-1px)}
.user-pill{display:flex;align-items:center;gap:8px;padding:4px 12px 4px 4px;background:var(--surface2);border:1px solid var(--border);border-radius:100px;cursor:pointer;transition:all .15s}
.user-pill:hover{border-color:var(--acc)}
.user-pill-av{width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,var(--acc),var(--purple));display:flex;align-items:center;justify-content:center;font-weight:800;font-size:.78rem;color:#fff;flex-shrink:0}
.user-pill-name{font-size:.8rem;font-weight:600;color:var(--tx)}

/* â”€â”€ SIDEBAR â”€â”€ */
.sidebar{background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;transition:all .3s cubic-bezier(.4,0,.2,1)}
.sb-logo{display:flex;align-items:center;gap:10px;padding:18px 14px 14px;border-bottom:1px solid var(--border);flex-shrink:0}
.sb-logo-ic{width:32px;height:32px;background:linear-gradient(135deg,var(--acc),var(--purple));border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:.95rem;flex-shrink:0}
.sb-logo-txt{font-family:var(--font-display);font-weight:900;font-size:1rem;color:var(--tx);white-space:nowrap;opacity:0;transition:opacity .2s .1s}
.app-body.sb-open .sb-logo-txt{opacity:1}
.sb-nav{flex:1;overflow-y:auto;padding:10px 8px}
.sb-section{margin-bottom:4px}
.sb-section-lbl{font-size:.6rem;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--tx4);padding:10px 8px 4px;white-space:nowrap;opacity:0;transition:opacity .2s}
.app-body.sb-open .sb-section-lbl{opacity:1}
.sb-btn{width:100%;display:flex;align-items:center;gap:10px;padding:9px 10px;border-radius:var(--r-sm);border:none;background:transparent;color:var(--tx3);font-size:.855rem;font-weight:500;cursor:pointer;transition:all .15s;text-align:left;white-space:nowrap;overflow:hidden;position:relative;font-family:var(--font)}
.sb-btn:hover{background:var(--surface2);color:var(--tx)}
.sb-btn.active{background:var(--acc-bg);color:var(--acc);font-weight:700}
.sb-btn .sb-ic{width:22px;height:22px;display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0}
.sb-btn .sb-lbl{opacity:0;transition:opacity .15s .05s;white-space:nowrap}
.app-body.sb-open .sb-btn .sb-lbl{opacity:1}
.sb-badge{margin-left:auto;background:var(--red);color:#fff;font-size:.6rem;font-weight:800;min-width:16px;height:16px;border-radius:8px;display:flex;align-items:center;justify-content:center;padding:0 3px;flex-shrink:0;animation:popIn .3s ease}
.sb-bottom{padding:10px 8px;border-top:1px solid var(--border);flex-shrink:0}
.sb-user{display:flex;align-items:center;gap:10px;padding:10px;border-radius:var(--r-sm);cursor:pointer;transition:background .15s}
.sb-user:hover{background:var(--surface2)}
.sb-user-av{width:32px;height:32px;border-radius:10px;background:linear-gradient(135deg,var(--acc),var(--purple));display:flex;align-items:center;justify-content:center;font-weight:800;font-size:.8rem;color:#fff;flex-shrink:0}
.sb-user-info{opacity:0;transition:opacity .2s;min-width:0}
.app-body.sb-open .sb-user-info{opacity:1}
.sb-user-name{font-size:.8rem;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--tx)}
.sb-user-role{font-size:.68rem;color:var(--tx3)}
.sb-logout{margin-left:auto;padding:4px 8px;border-radius:6px;border:1px solid var(--border);background:transparent;color:var(--tx4);font-size:.65rem;cursor:pointer;font-family:var(--font);white-space:nowrap;opacity:0;transition:all .2s}
.app-body.sb-open .sb-logout{opacity:1}
.sb-logout:hover{color:var(--red);border-color:var(--red)}

/* â”€â”€ CONTENT â”€â”€ */
.content{overflow-y:auto;background:var(--bg)}
.page{display:none;padding:28px;animation:fadeUp .3s ease both;min-height:100%}
.page.active{display:block}

/* â”€â”€ SHARED COMPONENTS â”€â”€ */
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:20px;transition:box-shadow .2s,border-color .2s}
.card:hover{box-shadow:var(--shadow)}
.c-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.c-title{font-weight:700;font-size:.9rem;color:var(--tx)}
.c-sub{font-size:.72rem;color:var(--tx3);margin-top:2px}
.page-title{font-family:var(--font-display);font-weight:900;font-size:1.5rem;color:var(--tx);margin-bottom:4px}
.page-sub{color:var(--tx3);font-size:.875rem;margin-bottom:24px}
.pill{display:inline-flex;align-items:center;padding:2px 8px;border-radius:100px;font-size:.68rem;font-weight:700;text-transform:uppercase;letter-spacing:.3px}
.ph{background:var(--red-bg);color:var(--red);border:1px solid var(--red-border)}
.pm{background:var(--amber-bg);color:var(--amber);border:1px solid var(--amber-border)}
.pl{background:var(--green-bg);color:var(--green);border:1px solid var(--green-border)}
.pd{background:var(--green-bg);color:var(--green)}
.pp{background:var(--surface2);color:var(--tx3)}
.pi{background:var(--acc-bg);color:var(--acc)}
.po{background:var(--red-bg);color:var(--red)}
.btn{display:inline-flex;align-items:center;gap:6px;padding:9px 18px;border-radius:var(--r-sm);font-size:.85rem;font-weight:600;border:none;cursor:pointer;transition:all .2s;font-family:var(--font)}
.btn-p{background:var(--acc);color:#fff}
.btn-p:hover{background:var(--acc-dark);transform:translateY(-1px)}
.btn-g{background:transparent;color:var(--tx2);border:1.5px solid var(--border)}
.btn-g:hover{background:var(--surface2)}
.btn-r{background:transparent;color:var(--red);border:1.5px solid rgba(220,38,38,.3)}
.btn-r:hover{background:var(--red-bg)}
.btn-sm{padding:6px 12px;font-size:.78rem}
.btn-purple{background:var(--purple-bg);color:var(--purple);border:1px solid var(--purple-border)}
.btn-purple:hover{background:var(--purple);color:#fff}
.ic-btn{width:30px;height:30px;border-radius:var(--r-sm);border:1px solid var(--border);background:transparent;color:var(--tx3);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.85rem;transition:all .15s}
.ic-btn:hover{background:var(--surface2);color:var(--tx)}
.ic-btn.del:hover{color:var(--red);border-color:var(--red)}
.empty-s{text-align:center;padding:48px 20px;color:var(--tx3)}
.empty-s .ei{font-size:2.5rem;margin-bottom:12px}
.empty-s .et{font-weight:700;font-size:.9rem;color:var(--tx2);margin-bottom:6px}
.empty-s .es{font-size:.8rem}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:14px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.dash-greet{margin-bottom:24px}
.dash-greet h2{font-family:var(--font-display);font-size:2.75rem;font-weight:900;color:var(--tx);line-height:1.2;margin-bottom:4px}
.dash-greet p{color:var(--tx3);font-size:.9rem}

/* KPI Row */
.kpi-row{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px;margin-bottom:20px}
.kpi{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:16px;transition:all .25s;animation:fadeUp .4s ease both;cursor:default}
.kpi:hover{transform:translateY(-3px);box-shadow:var(--shadow)}
.kpi-ic{width:38px;height:38px;border-radius:var(--r-sm);display:flex;align-items:center;justify-content:center;font-size:1.1rem;margin-bottom:10px}
.kpi-v{font-family:var(--font-display);font-size:1.9rem;font-weight:900;color:var(--tx);line-height:1;margin-bottom:3px;animation:countUp .5s ease both}
.kpi-l{font-size:.72rem;font-weight:600;color:var(--tx3);text-transform:uppercase;letter-spacing:.4px}
.kpi-chg{font-size:.65rem;font-weight:700;margin-top:4px}
.kpi-chg.up{color:var(--green)}
.kpi-chg.dn{color:var(--red)}

/* Dash layout */
.dash-main{display:grid;grid-template-columns:1fr 320px;gap:16px;margin-bottom:16px}
.dash-col-right{display:flex;flex-direction:column;gap:14px}

/* Progress ring */
.ring-wrap{position:relative;width:130px;height:130px;margin:0 auto 8px}
.ring-svg{transform:rotate(-90deg)}
.ring-bg-c{fill:none;stroke:var(--surface2);stroke-width:10}
.ring-fg-c{fill:none;stroke:var(--acc);stroke-width:10;stroke-linecap:round;stroke-dasharray:283;stroke-dashoffset:283;transition:stroke-dashoffset 1.2s cubic-bezier(.4,0,.2,1)}
.ring-ctr{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.ring-pct{font-family:var(--font-display);font-size:1.5rem;font-weight:900;color:var(--tx)}
.ring-pct-lbl{font-size:.6rem;font-weight:700;color:var(--tx4);text-transform:uppercase;letter-spacing:1px}

/* Streak */
.streak-days{display:flex;gap:4px}
.s-day{display:flex;flex-direction:column;align-items:center;gap:3px;flex:1}
.s-pip{width:100%;aspect-ratio:1;border-radius:6px;background:var(--surface2);border:1px solid var(--border);transition:all .25s}
.s-pip.on{background:var(--acc);border-color:var(--acc);box-shadow:0 2px 8px rgba(67,97,238,.3)}
.s-pip.today-pip{outline:2px solid var(--acc);outline-offset:2px}
.s-lbl{font-size:.55rem;font-weight:700;color:var(--tx4);text-transform:uppercase}

/* Recent */
.t-row{display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--border);transition:background .1s}
.t-row:last-child{border:none}
.t-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.t-info{flex:1;min-width:0}
.t-title{font-size:.85rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--tx)}
.t-meta{font-size:.7rem;color:var(--tx3)}

/* Bottom dash row */
.dash-bottom{display:grid;grid-template-columns:1fr 1fr 200px;gap:16px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TASKS PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toolbar{display:flex;align-items:center;gap:10px;margin-bottom:20px;flex-wrap:wrap}
.search-w{flex:1;min-width:180px;position:relative}
.search-w input{width:100%;padding:10px 14px 10px 38px;border:1.5px solid var(--border);background:var(--surface);border-radius:var(--r-sm);color:var(--tx);font-size:.875rem;outline:none;transition:all .2s;font-family:var(--font)}
.search-w input:focus{border-color:var(--acc);box-shadow:0 0 0 3px rgba(67,97,238,.1)}
.search-w::before{content:'ğŸ”';position:absolute;left:11px;top:50%;transform:translateY(-50%);font-size:.82rem;pointer-events:none}
.fc-row{display:flex;gap:6px;flex-wrap:wrap}
.fc{padding:7px 14px;border-radius:100px;font-size:.76rem;font-weight:600;cursor:pointer;border:1.5px solid var(--border);background:var(--surface);color:var(--tx3);transition:all .2s;font-family:var(--font)}
.fc:hover{border-color:var(--acc);color:var(--acc)}
.fc.active{background:var(--acc);border-color:var(--acc);color:#fff}
.tasks-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:14px}
.tc{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--r);padding:16px;position:relative;transition:all .2s;overflow:hidden}
.tc::after{content:'';position:absolute;left:0;top:0;bottom:0;width:4px;transition:background .2s}
.tc.ph-h::after{background:var(--red)}
.tc.ph-m::after{background:var(--amber)}
.tc.ph-l::after{background:var(--green)}
.tc:hover{box-shadow:var(--shadow);transform:translateY(-2px)}
.tc.done-card{opacity:.65}
.tc-top{display:flex;align-items:flex-start;gap:10px;margin-bottom:8px}
.tc-chk{width:20px;height:20px;border-radius:6px;border:2px solid var(--border2);background:transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s;flex-shrink:0;margin-top:2px}
.tc-chk:hover{border-color:var(--acc)}
.tc-chk.ck{background:var(--green);border-color:var(--green);color:#fff;font-size:.7rem}
.tc-inf{flex:1;min-width:0}
.tc-ttl{font-size:.9rem;font-weight:700;color:var(--tx);margin-bottom:4px;line-height:1.3}
.tc-ttl.lt{text-decoration:line-through;opacity:.5}
.tc-meta{display:flex;align-items:center;gap:6px;flex-wrap:wrap;margin-bottom:5px}
.tc-due{font-size:.7rem;color:var(--tx3);display:flex;align-items:center;gap:3px}
.tc-due.ov{color:var(--red);font-weight:600}
.tc-desc{font-size:.78rem;color:var(--tx3);line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.tc-acts{display:flex;gap:4px;flex-shrink:0}
.tc-footer{margin-top:10px;padding-top:8px;border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:8px}
.st-list{margin-top:8px;display:flex;flex-direction:column;gap:4px}
.st-item{display:flex;align-items:center;gap:6px;cursor:pointer}
.st-cb{width:14px;height:14px;border-radius:4px;border:1.5px solid var(--border2);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:.5rem;transition:all .15s}
.st-cb.ck{background:var(--green);border-color:var(--green);color:#fff}
.st-tx{font-size:.74rem;color:var(--tx2)}
.st-tx.ck{text-decoration:line-through;opacity:.5}
.st-bar-w{height:4px;background:var(--surface2);border-radius:2px;flex:1;overflow:hidden}
.st-bar{height:100%;background:var(--acc);border-radius:2px;transition:width .4s ease}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADD / EDIT TASK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.add-form{max-width:640px}
.prio-sel{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.prio-opt{padding:10px;border-radius:var(--r-sm);border:2px solid var(--border);background:var(--surface);cursor:pointer;text-align:center;font-size:.82rem;font-weight:700;color:var(--tx3);transition:all .2s}
.prio-opt.sel-h{background:var(--red-bg);border-color:var(--red);color:var(--red)}
.prio-opt.sel-m{background:var(--amber-bg);border-color:var(--amber);color:var(--amber)}
.prio-opt.sel-l{background:var(--green-bg);border-color:var(--green);color:var(--green)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UPCOMING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tl-group{margin-bottom:22px}
.tl-lbl{font-size:.75rem;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;display:flex;align-items:center;gap:8px}
.tl-lbl::after{content:'';flex:1;height:1px;background:var(--border)}
.tl-it{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--r);padding:14px 16px;display:flex;align-items:center;gap:12px;margin-bottom:8px;transition:all .2s}
.tl-it:hover{box-shadow:var(--shadow);transform:translateX(4px)}
.tl-ind{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.tl-inf{flex:1;min-width:0}
.tl-t{font-size:.875rem;font-weight:700;margin-bottom:2px;color:var(--tx)}
.tl-s{font-size:.72rem;color:var(--tx3)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PERFORMANCE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.perf-stats{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px;margin-bottom:20px}
.ps{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:20px;text-align:center;transition:all .25s}
.ps:hover{transform:translateY(-3px);box-shadow:var(--shadow)}
.ps-v{font-family:var(--font-display);font-size:2rem;font-weight:900;color:var(--acc);line-height:1;margin-bottom:4px}
.ps-l{font-size:.72rem;color:var(--tx3);font-weight:500}
.subj-bar{margin-bottom:14px}
.sb-row{display:flex;justify-content:space-between;font-size:.8rem;font-weight:600;margin-bottom:5px;color:var(--tx2)}
.sb-track{height:8px;background:var(--surface2);border-radius:4px;overflow:hidden}
.sb-fill{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--acc),var(--purple));transition:width 1.2s cubic-bezier(.4,0,.2,1)}
.hm-grid{display:grid;grid-template-columns:repeat(28,1fr);gap:3px;margin-top:12px}
.hm{aspect-ratio:1;border-radius:4px;background:var(--surface2);transition:all .15s;cursor:default}
.hm:hover{transform:scale(1.3)}
.hm.hm1{background:rgba(67,97,238,.2)}
.hm.hm2{background:rgba(67,97,238,.5)}
.hm.hm3{background:var(--acc)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUIZ PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.quiz-subjects{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:14px;margin-bottom:24px}
.quiz-subj-card{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--r);padding:20px;text-align:center;cursor:pointer;transition:all .25s}
.quiz-subj-card:hover,.quiz-subj-card.selected{border-color:var(--acc);background:var(--acc-bg);transform:translateY(-3px);box-shadow:var(--shadow)}
.quiz-subj-icon{font-size:2rem;margin-bottom:8px}
.quiz-subj-name{font-weight:700;font-size:.9rem;color:var(--tx);margin-bottom:2px}
.quiz-subj-cnt{font-size:.72rem;color:var(--tx3)}
.quiz-area{display:none;animation:fadeUp .3s ease}
.quiz-area.show{display:block}
.quiz-q-num{font-size:.78rem;font-weight:700;color:var(--tx3);margin-bottom:8px;text-transform:uppercase;letter-spacing:.5px}
.quiz-q{font-family:var(--font-display);font-size:1.15rem;font-weight:700;color:var(--tx);margin-bottom:20px;line-height:1.4}
.quiz-opts{display:flex;flex-direction:column;gap:10px;margin-bottom:20px}
.quiz-opt{padding:13px 18px;border:2px solid var(--border);border-radius:var(--r-sm);background:var(--surface);cursor:pointer;font-size:.9rem;font-weight:500;color:var(--tx2);transition:all .2s;text-align:left;font-family:var(--font)}
.quiz-opt:hover:not(.locked){border-color:var(--acc);color:var(--acc);background:var(--acc-bg)}
.quiz-opt.correct{background:var(--green-bg);border-color:var(--green);color:var(--green);font-weight:700}
.quiz-opt.wrong{background:var(--red-bg);border-color:var(--red);color:var(--red)}
.quiz-opt.locked{cursor:default}
.quiz-explanation{padding:14px 16px;background:var(--surface2);border-radius:var(--r-sm);border-left:4px solid var(--acc);font-size:.85rem;color:var(--tx2);margin-bottom:16px;display:none;animation:fadeUp .3s ease}
.quiz-explanation.show{display:block}
.quiz-prog{height:6px;background:var(--surface2);border-radius:3px;overflow:hidden;margin-bottom:16px}
.quiz-prog-fill{height:100%;background:linear-gradient(90deg,var(--acc),var(--purple));border-radius:3px;transition:width .5s ease}
.quiz-result{text-align:center;padding:32px;animation:scaleIn .4s ease}
.quiz-result-score{font-family:var(--font-display);font-size:4rem;font-weight:900;color:var(--acc);line-height:1;margin-bottom:8px}
.quiz-result-msg{font-size:1.1rem;color:var(--tx2);margin-bottom:24px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTES PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.notes-layout{display:grid;grid-template-columns:200px 1fr;gap:16px}
.notes-sidebar{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:12px;align-self:start;position:sticky;top:16px}
.note-cat{display:flex;align-items:center;gap:8px;padding:9px 10px;border-radius:var(--r-sm);cursor:pointer;transition:all .15s;border:none;background:transparent;width:100%;text-align:left;font-family:var(--font);font-size:.85rem;font-weight:500;color:var(--tx3)}
.note-cat:hover{background:var(--surface2);color:var(--tx)}
.note-cat.active{background:var(--acc-bg);color:var(--acc);font-weight:700}
.note-cat-cnt{margin-left:auto;font-size:.65rem;font-weight:700;background:var(--surface3);color:var(--tx3);padding:1px 6px;border-radius:10px}
.notes-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
.note-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:16px;cursor:pointer;transition:all .2s;position:relative}
.note-card:hover{box-shadow:var(--shadow);transform:translateY(-2px)}
.note-title{font-weight:700;font-size:.88rem;color:var(--tx);margin-bottom:6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.note-preview{font-size:.78rem;color:var(--tx3);line-height:1.5;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
.note-footer{margin-top:10px;padding-top:8px;border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.note-date{font-size:.68rem;color:var(--tx4)}
.note-subj-tag{padding:2px 8px;border-radius:100px;font-size:.65rem;font-weight:700;background:var(--acc-bg);color:var(--acc)}
.note-editor{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:20px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STREAK & CALENDAR PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cal-nav{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.cal-month{font-family:var(--font-display);font-weight:800;font-size:1.1rem;color:var(--tx)}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px}
.cal-dn{text-align:center;font-size:.62rem;font-weight:800;color:var(--tx4);text-transform:uppercase;padding:4px 0;letter-spacing:.5px}
.cal-cell{aspect-ratio:1;border-radius:var(--r-sm);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .15s;font-size:.78rem;font-weight:500;color:var(--tx3);position:relative}
.cal-cell:hover{background:var(--surface2)}
.cal-cell.has-t::after{content:'';position:absolute;bottom:3px;width:4px;height:4px;border-radius:50%;background:var(--acc)}
.cal-cell.studied{background:rgba(67,97,238,.12);color:var(--acc);font-weight:700}
.cal-cell.today-cell{background:var(--acc-bg);color:var(--acc);font-weight:800;outline:2px solid var(--acc);outline-offset:2px}
.cal-cell.other-m{opacity:.3}
.goals-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
.goal-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:16px;transition:all .2s}
.goal-card:hover{box-shadow:var(--shadow)}
.goal-name{font-weight:700;font-size:.88rem;color:var(--tx);margin-bottom:8px}
.goal-bar-w{height:8px;background:var(--surface2);border-radius:4px;overflow:hidden;margin-bottom:6px}
.goal-bar{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--acc),var(--purple));transition:width 1s ease}
.goal-meta{display:flex;justify-content:space-between;font-size:.72rem;color:var(--tx3);font-weight:600}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   POMODORO PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pomo-wrap{max-width:440px;margin:0 auto;text-align:center}
.pomo-modes{display:flex;gap:6px;justify-content:center;background:var(--surface2);border-radius:100px;padding:4px;margin-bottom:28px}
.pomo-mode-btn{padding:8px 20px;border-radius:100px;border:none;background:transparent;color:var(--tx3);font-size:.8rem;font-weight:700;cursor:pointer;transition:all .2s;font-family:var(--font)}
.pomo-mode-btn.active{background:var(--surface);color:var(--acc);box-shadow:var(--shadow-sm)}
.pomo-ring-w{position:relative;width:220px;height:220px;margin:0 auto 24px}
.pomo-svg{transform:rotate(-90deg)}
.pomo-track{fill:none;stroke:var(--surface2);stroke-width:10}
.pomo-fill{fill:none;stroke:var(--acc);stroke-width:10;stroke-linecap:round;stroke-dasharray:628;stroke-dashoffset:0;transition:stroke-dashoffset 1s linear,stroke .5s}
.pomo-ctr{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.pomo-t{font-family:var(--font-display);font-size:3.2rem;font-weight:900;color:var(--tx);line-height:1}
.pomo-m{font-size:.7rem;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:1.5px;margin-top:4px}
.pomo-ctrls{display:flex;align-items:center;justify-content:center;gap:14px;margin-bottom:24px}
.pomo-btn-main{width:64px;height:64px;border-radius:50%;border:none;background:var(--acc);color:#fff;font-size:1.4rem;cursor:pointer;transition:all .2s;box-shadow:0 6px 20px rgba(67,97,238,.35);display:flex;align-items:center;justify-content:center}
.pomo-btn-main:hover{transform:scale(1.06)}
.pomo-btn-sec{width:48px;height:48px;border-radius:50%;border:1.5px solid var(--border);background:var(--surface);color:var(--tx2);font-size:1.1rem;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center}
.pomo-btn-sec:hover{background:var(--surface2)}
.pomo-sessions-row{display:flex;gap:8px;justify-content:center;margin-bottom:24px}
.pomo-s-dot{width:12px;height:12px;border-radius:50%;background:var(--surface2);border:2px solid var(--border);transition:all .3s}
.pomo-s-dot.done{background:var(--acc);border-color:var(--acc)}
.pomo-s-dot.cur{background:transparent;border-color:var(--acc);animation:pulse 1.5s infinite}
.pomo-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:20px}
.pomo-stat{background:var(--surface2);border-radius:var(--r-sm);padding:12px;text-align:center}
.pomo-stat-v{font-family:var(--font-display);font-size:1.4rem;font-weight:800;color:var(--tx);line-height:1}
.pomo-stat-l{font-size:.65rem;font-weight:600;color:var(--tx3);text-transform:uppercase;letter-spacing:.5px}
.task-select-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:16px;text-align:left}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AI TOOLS PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.ai-tools-nav{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:24px}
.ai-tool-tab{padding:8px 16px;border-radius:100px;border:1.5px solid var(--border);background:var(--surface);color:var(--tx3);font-size:.8rem;font-weight:600;cursor:pointer;transition:all .2s;font-family:var(--font)}
.ai-tool-tab:hover{border-color:var(--acc);color:var(--acc)}
.ai-tool-tab.active{background:var(--acc);border-color:var(--acc);color:#fff}
.ai-tool-panel{display:none;animation:fadeUp .3s ease}
.ai-tool-panel.show{display:block}
.ai-input-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-lg);padding:24px;margin-bottom:20px}
.slider-grp{margin-bottom:18px}
.slider-lbl{display:flex;justify-content:space-between;align-items:center;font-size:.82rem;font-weight:600;color:var(--tx2);margin-bottom:8px}
.slider-val{font-weight:800;color:var(--acc);font-size:.9rem}
.sl{width:100%;-webkit-appearance:none;appearance:none;height:6px;border-radius:3px;background:var(--surface2);outline:none;cursor:pointer;transition:all .2s}
.sl::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--acc);cursor:pointer;box-shadow:0 2px 6px rgba(67,97,238,.4);transition:transform .2s}
.sl::-webkit-slider-thumb:hover{transform:scale(1.2)}
.result-card{background:linear-gradient(135deg,var(--acc-bg),var(--purple-bg));border:1px solid var(--acc);border-radius:var(--r-lg);padding:24px;animation:scaleIn .4s ease}
.result-big{font-family:var(--font-display);font-size:2.5rem;font-weight:900;color:var(--acc);line-height:1;margin-bottom:8px}
.result-msg{font-size:.9rem;color:var(--tx2);line-height:1.6}
.result-badge{display:inline-flex;align-items:center;gap:6px;padding:6px 16px;background:var(--acc);color:#fff;border-radius:100px;font-size:.82rem;font-weight:700;margin-bottom:12px}
.plan-day{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-sm);padding:12px 14px;margin-bottom:8px;display:flex;align-items:center;gap:12px;transition:all .2s}
.plan-day:hover{box-shadow:var(--shadow-sm);transform:translateX(3px)}
.plan-day-num{font-family:var(--font-display);font-weight:900;font-size:1.1rem;color:var(--acc);width:32px;text-align:center;flex-shrink:0}
.plan-day-info{flex:1}
.plan-day-title{font-size:.85rem;font-weight:700;color:var(--tx)}
.plan-day-sub{font-size:.72rem;color:var(--tx3)}
.plan-day-hrs{font-size:.78rem;font-weight:700;color:var(--purple)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-ov{position:fixed;inset:0;background:rgba(13,17,23,.55);z-index:300;display:none;align-items:center;justify-content:center;padding:20px;backdrop-filter:blur(6px)}
.modal-ov.show{display:flex;animation:fadeIn .2s ease}
.modal-box{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-xl);padding:28px;width:100%;max-width:520px;max-height:90vh;overflow-y:auto;animation:scaleIn .25s ease;box-shadow:var(--shadow-xl)}
.modal-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:22px}
.modal-title{font-family:var(--font-display);font-weight:800;font-size:1.1rem;color:var(--tx)}
.modal-cls{width:32px;height:32px;border-radius:var(--r-sm);border:1.5px solid var(--border);background:transparent;color:var(--tx3);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s;font-family:var(--font)}
.modal-cls:hover{color:var(--red);border-color:var(--red)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTIFICATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.notif-panel{position:absolute;top:48px;right:0;width:320px;background:var(--surface);border:1px solid var(--border);border-radius:var(--r-lg);box-shadow:var(--shadow-lg);z-index:200;display:none;overflow:hidden}
.notif-panel.show{display:block;animation:scaleIn .2s ease}
.np-hd{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
.np-t{font-weight:700;font-size:.88rem;color:var(--tx)}
.np-clr{font-size:.72rem;color:var(--tx3);cursor:pointer;padding:3px 8px;border-radius:var(--r-sm);transition:all .15s}
.np-clr:hover{background:var(--red-bg);color:var(--red)}
.np-list{max-height:280px;overflow-y:auto}
.np-it{padding:12px 16px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .15s}
.np-it:last-child{border:none}
.np-it:hover{background:var(--surface2)}
.np-it.unrd{background:var(--acc-bg)}
.np-it-t{font-size:.8rem;font-weight:600;color:var(--tx);margin-bottom:2px}
.np-it-s{font-size:.7rem;color:var(--tx3)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FOCUS OVERLAY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.focus-ov{display:none;position:fixed;inset:0;background:var(--bg);z-index:400;flex-direction:column;align-items:center;justify-content:center;padding:32px;text-align:center}
.focus-ov.show{display:flex;animation:fadeIn .3s ease}
.focus-task-lbl{font-family:var(--font-display);font-size:1.3rem;font-weight:800;color:var(--tx);margin-bottom:6px}
.focus-hint{font-size:.8rem;color:var(--tx3);margin-bottom:32px}
.focus-exit-btn{margin-top:28px;padding:10px 28px;border-radius:100px;border:1.5px solid var(--border);background:transparent;color:var(--tx2);font-size:.875rem;cursor:pointer;transition:all .2s;font-family:var(--font)}
.focus-exit-btn:hover{border-color:var(--acc);color:var(--acc)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOASTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#toasts{position:fixed;bottom:24px;right:24px;z-index:500;display:flex;flex-direction:column-reverse;gap:8px;pointer-events:none}
.toast{padding:12px 18px;border-radius:var(--r);font-size:.84rem;font-weight:600;min-width:200px;max-width:300px;display:flex;align-items:center;gap:8px;pointer-events:all;animation:toastIn .3s ease;box-shadow:var(--shadow-lg);background:var(--surface);border:1px solid}
.ts{color:var(--green);border-color:var(--green-border)}
.te{color:var(--red);border-color:var(--red-border)}
.ti{color:var(--acc);border-color:rgba(67,97,238,.25)}

/* â”€â”€ BOTTOM NAV â”€â”€ */
.bottom-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--surface);border-top:1px solid var(--border);z-index:50;padding:8px 0 max(8px,env(safe-area-inset-bottom))}
.bn-items{display:flex;justify-content:space-around}
.bn-btn{display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 8px;color:var(--tx3);font-size:.58rem;font-weight:700;cursor:pointer;border:none;background:transparent;text-transform:uppercase;letter-spacing:.5px;transition:color .15s;font-family:var(--font)}
.bn-btn.active,.bn-btn:hover{color:var(--acc)}
.bn-ic{font-size:1.15rem}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:1100px){
  .dash-main{grid-template-columns:1fr}
  .dash-bottom{grid-template-columns:1fr 1fr}
}
@media(max-width:900px){
  .grid-2,.grid-3,.grid-4,.form-row{grid-template-columns:1fr}
  .dash-bottom{grid-template-columns:1fr}
  .notes-layout{grid-template-columns:1fr}
  .notes-sidebar{position:static}
}
@media(max-width:768px){
  .app-body{grid-template-columns:1fr!important}
  .sidebar{position:fixed;left:-260px;top:0;height:100vh;width:260px;z-index:200;transition:left .3s}
  .sidebar.open{left:0}
  .app-body.sb-open .sidebar{left:0}
  .sidebar .sb-logo-txt,.sidebar .sb-lbl,.sidebar .sb-user-info,.sidebar .sb-section-lbl,.sidebar .sb-logout{opacity:1!important}
  .bottom-nav{display:block}
  .page{padding:16px;padding-bottom:80px}
  .topbar{position:fixed;top:0;left:0;right:0;z-index:100;height:62px}
  .content{padding-top:62px}
  .land-nav{padding:0 20px}
  .hero{padding:60px 20px 48px}
  .hero-stats{gap:20px;flex-wrap:wrap}
  .feat-section{padding:48px 20px}
  .land-footer{padding:20px;flex-direction:column;gap:6px;text-align:center}
  .pomo-wrap{max-width:100%}
}
@media(max-width:520px){
  .kpi-row{grid-template-columns:1fr 1fr}
  .quiz-subjects{grid-template-columns:1fr 1fr}
  .perf-stats{grid-template-columns:1fr 1fr}
  .hero-h1{letter-spacing:-1px}
}
/* Toggle Switch */
.toggle-sw{width:44px;height:24px;border-radius:12px;background:var(--border2);cursor:pointer;position:relative;transition:background .25s;flex-shrink:0}
.toggle-sw.on{background:var(--acc)}
.toggle-knob{position:absolute;top:3px;left:3px;width:18px;height:18px;border-radius:50%;background:#fff;transition:left .25s;box-shadow:var(--shadow-sm)}
.toggle-sw.on .toggle-knob{left:23px}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LANDING PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="landingPage">
  <nav class="land-nav">
    <div class="land-logo">
      <div class="land-logo-ic">ğŸ“š</div>
      <span>StudyBot</span>
    </div>
    <div class="land-nav-right">
      <button class="theme-toggle-btn" onclick="toggleTheme()">ğŸŒ™</button>
      <button class="btn-outline" onclick="showAuth('login')">Sign In</button>
      <button class="btn-solid" onclick="showAuth('register')">Get Started Free â†’</button>
    </div>
  </nav>

  <section class="hero">
    <div class="hero-bg">
      <div class="hero-blob hero-blob1"></div>
      <div class="hero-blob hero-blob2"></div>
      <div class="hero-blob hero-blob3"></div>
    </div>
    <div class="hero-content">
      <div class="hero-badge">ğŸ“ AI-Powered Study Companion</div>
      <h1 class="hero-h1">Study <em>Smarter.</em><br>Score Higher.</h1>
      <p class="hero-sub">Your all-in-one academic toolkit â€” quizzes, smart notes, AI tools, focus timer, streak tracker and performance analytics. Personalised just for you.</p>
      <div class="hero-btns">
        <button class="btn-hero-prim" onclick="showAuth('register')">ğŸš€ Start for Free</button>
        <button class="btn-hero-sec" onclick="document.getElementById('features-sec').scrollIntoView({behavior:'smooth'})">Explore Features â†“</button>
      </div>
      <div class="hero-stats">
        <div class="hero-stat"><div class="hero-stat-val">6</div><div class="hero-stat-lbl">Subjects</div></div>
        <div class="hero-stat"><div class="hero-stat-val">48</div><div class="hero-stat-lbl">Topics</div></div>
        <div class="hero-stat"><div class="hero-stat-val">5</div><div class="hero-stat-lbl">AI Tools</div></div>
        <div class="hero-stat"><div class="hero-stat-val">100%</div><div class="hero-stat-lbl">Free</div></div>
      </div>
    </div>
  </section>

  <section class="feat-section" id="features-sec">
    <div style="max-width:900px;margin:0 auto">
      <div class="section-label">Everything you need</div>
      <h2 class="section-h2">Your complete study <em>arsenal</em></h2>
      <p class="section-p">From task management to AI-powered quizzes â€” every tool you need to ace your exams, all in one beautifully designed app.</p>
      <div class="features-grid">
        <div class="feat-card"><div class="feat-icon" style="background:#EEF1FF">ğŸ§ </div><div class="feat-title">AI-Powered Quiz Engine</div><div class="feat-desc">Test yourself across 6 subjects with 48 topics. Get instant explanations and track your score history.</div></div>
        <div class="feat-card"><div class="feat-icon" style="background:#F5F3FF">ğŸ“Š</div><div class="feat-title">Performance Predictor</div><div class="feat-desc">Input your study data and our AI predicts your exam outcome with personalised improvement tips.</div></div>
        <div class="feat-card"><div class="feat-icon" style="background:#F0FDF4">â±ï¸</div><div class="feat-title">Pomodoro Focus Timer</div><div class="feat-desc">Work in focused sprints with smart break reminders. Full-screen focus mode blocks distractions.</div></div>
        <div class="feat-card"><div class="feat-icon" style="background:#FFFBEB">ğŸ”¥</div><div class="feat-title">Streak & Goal Tracker</div><div class="feat-desc">Build daily study habits with streak tracking. Set subject goals and watch your progress visually.</div></div>
        <div class="feat-card"><div class="feat-icon" style="background:#FFF5F5">ğŸ“</div><div class="feat-title">Smart Notes by Subject</div><div class="feat-desc">Capture ideas and summaries instantly. Organised by subject so you always find what you need.</div></div>
        <div class="feat-card"><div class="feat-icon" style="background:#F0FDFA">ğŸ“…</div><div class="feat-title">AI Study Planner</div><div class="feat-desc">Tell us your exam date and target score. Get a personalised day-by-day study schedule instantly.</div></div>
      </div>
    </div>
  </section>

  <footer class="land-footer">
    <div class="land-logo" style="font-size:1rem">
      <div class="land-logo-ic" style="width:28px;height:28px;font-size:.9rem">ğŸ“š</div>
      <span>StudyBot</span>
    </div>
    <span>Â© 2025 StudyBot â€” Built for students</span>
    <span>Free Forever ğŸ’š</span>
  </footer>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     AUTH PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="authPage" style="display:flex">
  <div class="auth-blob auth-blob1"></div>
  <div class="auth-blob auth-blob2"></div>
  <div class="auth-card">
    <div class="auth-logo-wrap">
      <div class="auth-logo-ic">ğŸ“š</div>
      <div class="auth-title">StudyBot</div>
    </div>
    <div class="auth-sub">Your personalised AI study companion</div>
    <div class="auth-tabs">
      <button class="auth-tab active" id="aTabLogin" onclick="switchAuthTab('login')">Sign In</button>
      <button class="auth-tab" id="aTabReg" onclick="switchAuthTab('register')">Register</button>
    </div>
    <!-- Login -->
    <div id="loginForm">
      <div class="form-grp"><label class="form-lbl">Email Address</label><input type="email" id="lEmail" class="form-inp" placeholder="you@example.com"/><div class="form-err" id="lEmailErr">Please enter a valid email.</div></div>
      <div class="form-grp"><label class="form-lbl">Password</label><input type="password" id="lPass" class="form-inp" placeholder="Your password"/><div class="form-err" id="lPassErr">Invalid email or password.</div></div>
      <button class="btn-full" onclick="handleLogin()">ğŸš€ Sign In</button>
      <div id="qlWrap" style="display:none">
        <div class="ql-section"><div class="ql-lbl">Quick Login</div><div class="ql-chips" id="qlChips"></div></div>
      </div>
    </div>
    <!-- Register -->
    <div id="regForm" style="display:none">
      <div class="form-grp"><label class="form-lbl">Full Name</label><input type="text" id="rName" class="form-inp" placeholder="Your name"/><div class="form-err" id="rNameErr">Name is required.</div></div>
      <div class="form-grp"><label class="form-lbl">Email Address</label><input type="email" id="rEmail" class="form-inp" placeholder="you@example.com"/><div class="form-err" id="rEmailErr">Enter a valid email.</div></div>
      <div class="form-row">
        <div class="form-grp"><label class="form-lbl">Class / Grade</label>
          <select id="rGrade" class="form-sel"><option value="">Select</option><option>Class 9</option><option>Class 10</option><option>Class 11</option><option>Class 12</option><option>1st Year UG</option><option>2nd Year UG</option><option>3rd Year UG</option><option>Postgraduate</option><option>Other</option></select>
        </div>
        <div class="form-grp"><label class="form-lbl">Password</label><input type="password" id="rPass" class="form-inp" placeholder="Min 4 chars"/><div class="form-err" id="rPassErr">Password must be 4+ characters.</div></div>
      </div>
      <button class="btn-full" onclick="handleRegister()">âœ¨ Create Account</button>
    </div>
    <div class="auth-back"><a href="#" onclick="showLanding();return false">â† Back to home</a></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app">
  <!-- TOPBAR -->
  <header class="topbar">
    <button class="topbar-hamburger" onclick="toggleSidebar()">â˜°</button>
    <div class="topbar-title" id="tbTitle">Dashboard</div>
    <div class="topbar-right">
      <div style="position:relative">
        <button class="tb-ic-btn" id="notifBtn" onclick="toggleNotif()">ğŸ””<span class="notif-dot" id="notifDot"></span></button>
        <div class="notif-panel" id="notifPanel">
          <div class="np-hd"><span class="np-t">Notifications</span><span class="np-clr" onclick="clearNotifs()">Clear all</span></div>
          <div class="np-list" id="npList"></div>
        </div>
      </div>
      <button class="tb-ic-btn" id="themeBtn2" onclick="toggleTheme()">ğŸŒ™</button>
      <button class="tb-ic-btn" id="focusBtn" onclick="enterFocus()" title="Focus Mode">ğŸ¯</button>
      <div class="user-pill" onclick="navigate('account')">
        <div class="user-pill-av" id="tbAv">?</div>
        <div class="user-pill-name" id="tbName">User</div>
      </div>
    </div>
  </header>

  <div class="app-body" id="appBody">
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="sb-logo">
        <div class="sb-logo-ic">ğŸ“š</div>
        <div class="sb-logo-txt">StudyBot</div>
      </div>
      <div class="sb-nav">
        <div class="sb-section">
          <div class="sb-section-lbl">Overview</div>
          <button class="sb-btn active" data-pg="dashboard" onclick="navigate('dashboard')"><span class="sb-ic">ğŸ </span><span class="sb-lbl">Dashboard</span></button>
          <button class="sb-btn" data-pg="tasks" onclick="navigate('tasks')"><span class="sb-ic">ğŸ“‹</span><span class="sb-lbl">My Tasks</span><span class="sb-badge" id="sbBadge" style="display:none">!</span></button>
          <button class="sb-btn" data-pg="upcoming" onclick="navigate('upcoming')"><span class="sb-ic">ğŸ“…</span><span class="sb-lbl">Upcoming</span></button>
        </div>
        <div class="sb-section">
          <div class="sb-section-lbl">Learn</div>
          <button class="sb-btn" data-pg="quiz" onclick="navigate('quiz')"><span class="sb-ic">ğŸ§ </span><span class="sb-lbl">Quiz</span></button>
          <button class="sb-btn" data-pg="notes" onclick="navigate('notes')"><span class="sb-ic">ğŸ“</span><span class="sb-lbl">Notes</span></button>
          <button class="sb-btn" data-pg="aitools" onclick="navigate('aitools')"><span class="sb-ic">âœ¨</span><span class="sb-lbl">AI Tools</span></button>
        </div>
        <div class="sb-section">
          <div class="sb-section-lbl">Track</div>
          <button class="sb-btn" data-pg="performance" onclick="navigate('performance')"><span class="sb-ic">ğŸ“ˆ</span><span class="sb-lbl">Performance</span></button>
          <button class="sb-btn" data-pg="streaks" onclick="navigate('streaks')"><span class="sb-ic">ğŸ”¥</span><span class="sb-lbl">Streaks & Goals</span></button>
          <button class="sb-btn" data-pg="pomodoro" onclick="navigate('pomodoro')"><span class="sb-ic">â±ï¸</span><span class="sb-lbl">Pomodoro</span></button>
        </div>
        <div class="sb-section">
          <div class="sb-section-lbl">Manage</div>
          <button class="sb-btn" data-pg="add" onclick="navigate('add')"><span class="sb-ic">â•</span><span class="sb-lbl">Add Task</span></button>
          <button class="sb-btn" data-pg="account" onclick="navigate('account')"><span class="sb-ic">âš™ï¸</span><span class="sb-lbl">Account Settings</span></button>
        </div>
      </div>
      <div class="sb-bottom">
        <div class="sb-user">
          <div class="sb-user-av" id="sbAv">?</div>
          <div class="sb-user-info">
            <div class="sb-user-name" id="sbName">Loading</div>
            <div class="sb-user-role" id="sbGrade">Student</div>
          </div>
          <button class="sb-logout" onclick="handleLogout()">Sign out</button>
        </div>
      </div>
    </aside>

    <!-- CONTENT -->
    <main class="content" id="contentArea">

      <!-- â”€â”€ DASHBOARD â”€â”€ -->
      <div class="page active" id="dashboardPage">
        <div class="dash-greet">
          <h2 id="greetH">Good morning! ğŸ‘‹</h2>
          <p id="greetP">Here's your study overview.</p>
        </div>
        <div class="kpi-row" id="kpiRow"></div>
        <div class="dash-main">
          <div class="card">
            <div class="c-hd"><div><div class="c-title">Recent Activity</div><div class="c-sub">Latest task updates</div></div><button class="btn btn-sm btn-g" onclick="navigate('tasks')">View All â†’</button></div>
            <div id="recentTasks"></div>
          </div>
          <div class="dash-col-right">
            <div class="card" style="text-align:center">
              <div class="c-title" style="margin-bottom:14px">Overall Progress</div>
              <div class="ring-wrap">
                <svg class="ring-svg" viewBox="0 0 100 100" width="130" height="130">
                  <circle class="ring-bg-c" cx="50" cy="50" r="45"/>
                  <circle class="ring-fg-c" cx="50" cy="50" r="45" id="dashRing"/>
                </svg>
                <div class="ring-ctr"><div class="ring-pct" id="ringPct">0%</div><div class="ring-pct-lbl">Done</div></div>
              </div>
            </div>
            <div class="card">
              <div class="c-hd"><div><div class="c-title">Study Streak</div><div class="c-sub" id="streakSub">Last 7 days</div></div><div style="font-family:var(--font-display);font-size:1.8rem;font-weight:900;color:var(--acc)" id="streakNum">0ğŸ”¥</div></div>
              <div class="streak-days" id="streakDays"></div>
            </div>
          </div>
        </div>
        <div class="dash-bottom">
          <div class="card">
            <div class="c-hd"><div class="c-title">Task Distribution</div></div>
            <div style="position:relative;height:160px"><canvas id="donutChart"></canvas></div>
          </div>
          <div class="card">
            <div class="c-hd"><div class="c-title">Weekly Completions</div></div>
            <div style="position:relative;height:160px"><canvas id="barChart"></canvas></div>
          </div>
          <div class="card">
            <div class="c-title" style="margin-bottom:12px">Quick Stats</div>
            <div id="quickStats"></div>
          </div>
        </div>
      </div>

      <!-- â”€â”€ TASKS â”€â”€ -->
      <div class="page" id="tasksPage">
        <div class="page-title">My Tasks</div>
        <div class="page-sub">Manage and track all your assignments</div>
        <div class="toolbar">
          <div class="search-w"><input type="text" id="taskSearch" placeholder="Search tasks..." oninput="renderTasks()"/></div>
          <div class="fc-row">
            <button class="fc active" data-f="all" onclick="setFilter('all',this)">All</button>
            <button class="fc" data-f="high" onclick="setFilter('high',this)">ğŸ”´ High</button>
            <button class="fc" data-f="medium" onclick="setFilter('medium',this)">ğŸŸ¡ Medium</button>
            <button class="fc" data-f="low" onclick="setFilter('low',this)">ğŸŸ¢ Low</button>
            <button class="fc" data-f="completed" onclick="setFilter('completed',this)">âœ… Done</button>
            <button class="fc" data-f="overdue" onclick="setFilter('overdue',this)">âš ï¸ Overdue</button>
          </div>
          <button class="btn btn-p" onclick="navigate('add')">+ New Task</button>
        </div>
        <div class="tasks-grid" id="tasksGrid"></div>
      </div>

      <!-- â”€â”€ UPCOMING â”€â”€ -->
      <div class="page" id="upcomingPage">
        <div class="page-title">Upcoming Deadlines</div>
        <div class="page-sub">Tasks due in the next 14 days</div>
        <div id="upcomingTl"></div>
      </div>

      <!-- â”€â”€ QUIZ â”€â”€ -->
      <div class="page" id="quizPage">
        <div class="page-title">Quiz Yourself ğŸ§ </div>
        <div class="page-sub">Test your knowledge across subjects and get instant explanations</div>
        <div id="quizSubjectSelect">
          <div class="quiz-subjects" id="quizSubjectsGrid"></div>
          <div style="text-align:center;margin-top:8px">
            <button class="btn btn-p" id="startQuizBtn" onclick="startQuiz()" disabled>Start Quiz â†’</button>
          </div>
        </div>
        <div class="quiz-area" id="quizArea">
          <div class="card" style="max-width:640px">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
              <div class="quiz-q-num" id="quizQNum">Question 1/8</div>
              <div style="font-size:.78rem;font-weight:700;color:var(--acc)">Score: <span id="quizScore">0</span></div>
            </div>
            <div class="quiz-prog"><div class="quiz-prog-fill" id="quizProgFill" style="width:0%"></div></div>
            <div class="quiz-q" id="quizQ"></div>
            <div class="quiz-opts" id="quizOpts"></div>
            <div class="quiz-explanation" id="quizExp"></div>
            <button class="btn btn-p" id="quizNextBtn" onclick="nextQuestion()" style="display:none">Next Question â†’</button>
          </div>
        </div>
        <div class="quiz-result card" id="quizResult" style="display:none;max-width:400px">
          <div style="font-size:2.5rem;margin-bottom:8px">ğŸ“</div>
          <div class="quiz-result-score" id="quizFinalScore">0/8</div>
          <div class="quiz-result-msg" id="quizFinalMsg">Good effort!</div>
          <div style="display:flex;gap:10px;justify-content:center;margin-top:20px">
            <button class="btn btn-p" onclick="retakeQuiz()">â†º Retake</button>
            <button class="btn btn-g" onclick="resetQuiz()">â† Change Subject</button>
          </div>
        </div>
      </div>

      <!-- â”€â”€ NOTES â”€â”€ -->
      <div class="page" id="notesPage">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px">
          <div class="page-title">Smart Notes ğŸ“</div>
          <button class="btn btn-p" onclick="openNoteEditor()">+ New Note</button>
        </div>
        <div class="page-sub">Capture and organise your study notes by subject</div>
        <div class="notes-layout">
          <div class="notes-sidebar" id="notesSidebar"></div>
          <div>
            <div class="notes-grid" id="notesGrid"></div>
          </div>
        </div>
      </div>

      <!-- â”€â”€ AI TOOLS â”€â”€ -->
      <div class="page" id="aitoolsPage">
        <div class="page-title">AI Study Tools âœ¨</div>
        <div class="page-sub">Personalised AI-powered insights to boost your academic performance</div>
        <div class="ai-tools-nav" id="aiToolsNav">
          <button class="ai-tool-tab active" data-tool="predictor" onclick="switchAITool('predictor',this)">ğŸ“Š Performance Predictor</button>
          <button class="ai-tool-tab" data-tool="difficulty" onclick="switchAITool('difficulty',this)">ğŸ¯ Difficulty Adapter</button>
          <button class="ai-tool-tab" data-tool="planner" onclick="switchAITool('planner',this)">ğŸ“… Study Planner</button>
          <button class="ai-tool-tab" data-tool="style" onclick="switchAITool('style',this)">ğŸ§  Learning Style</button>
          <button class="ai-tool-tab" data-tool="topics" onclick="switchAITool('topics',this)">âœ… Topic Recommender</button>
        </div>
        <!-- Predictor -->
        <div class="ai-tool-panel show" id="tool-predictor">
          <div class="grid-2">
            <div class="ai-input-card">
              <div class="c-title" style="margin-bottom:16px">ğŸ“ˆ Your Study Profile</div>
              <div class="slider-grp"><div class="slider-lbl"><span>Daily Study Hours</span><span class="slider-val" id="sv-hours">3h</span></div><input type="range" class="sl" min="1" max="12" value="3" oninput="this.previousElementSibling.querySelector('.slider-val').textContent=this.value+'h'"/></div>
              <div class="slider-grp"><div class="slider-lbl"><span>Quiz Average Score</span><span class="slider-val" id="sv-quiz">65%</span></div><input type="range" class="sl" min="0" max="100" value="65" oninput="this.previousElementSibling.querySelector('.slider-val').textContent=this.value+'%'"/></div>
              <div class="slider-grp"><div class="slider-lbl"><span>Assignment Submission Rate</span><span class="slider-val" id="sv-asgn">70%</span></div><input type="range" class="sl" min="0" max="100" value="70" oninput="this.previousElementSibling.querySelector('.slider-val').textContent=this.value+'%'"/></div>
              <div class="slider-grp"><div class="slider-lbl"><span>Attendance Rate</span><span class="slider-val" id="sv-att">80%</span></div><input type="range" class="sl" min="0" max="100" value="80" oninput="this.previousElementSibling.querySelector('.slider-val').textContent=this.value+'%'"/></div>
              <div class="slider-grp"><div class="slider-lbl"><span>Subject Interest (1-10)</span><span class="slider-val" id="sv-int">7</span></div><input type="range" class="sl" min="1" max="10" value="7" oninput="this.previousElementSibling.querySelector('.slider-val').textContent=this.value"/></div>
              <button class="btn btn-p" style="width:100%;justify-content:center;margin-top:8px" onclick="predictPerf()">âš¡ Predict My Performance</button>
            </div>
            <div id="predictResult" style="display:flex;align-items:center;justify-content:center"><div style="text-align:center;color:var(--tx4);padding:40px"><div style="font-size:2.5rem;margin-bottom:8px">ğŸ”®</div><div style="font-size:.9rem">Fill in your profile and click Predict!</div></div></div>
          </div>
        </div>
        <!-- Difficulty -->
        <div class="ai-tool-panel" id="tool-difficulty">
          <div class="grid-2">
            <div class="ai-input-card">
              <div class="c-title" style="margin-bottom:16px">ğŸ® Quiz Performance Stats</div>
              <div class="slider-grp"><div class="slider-lbl"><span>Last Quiz Score</span><span class="slider-val">65%</span></div><input type="range" class="sl" id="df-score" min="0" max="100" value="65" oninput="this.previousElementSibling.querySelector('.slider-val').textContent=this.value+'%'"/></div>
              <div class="slider-grp"><div class="slider-lbl"><span>Minutes per Topic</span><span class="slider-val">20m</span></div><input type="range" class="sl" id="df-time" min="5" max="60" value="20" oninput="this.previousElementSibling.querySelector('.slider-val').textContent=this.value+'m'"/></div>
              <div class="slider-grp"><div class="slider-lbl"><span>Mistake Rate</span><span class="slider-val">30%</span></div><input type="range" class="sl" id="df-err" min="0" max="100" value="30" oninput="this.previousElementSibling.querySelector('.slider-val').textContent=this.value+'%'"/></div>
              <div class="slider-grp"><div class="slider-lbl"><span>Topics Completed</span><span class="slider-val">75%</span></div><input type="range" class="sl" id="df-comp" min="0" max="100" value="75" oninput="this.previousElementSibling.querySelector('.slider-val').textContent=this.value+'%'"/></div>
              <button class="btn btn-p" style="width:100%;justify-content:center;margin-top:8px" onclick="adaptDifficulty()">ğŸ¯ Find My Level</button>
            </div>
            <div id="diffResult" style="display:flex;align-items:center;justify-content:center"><div style="text-align:center;color:var(--tx4);padding:40px"><div style="font-size:2.5rem;margin-bottom:8px">ğŸ®</div><div style="font-size:.9rem">Enter your stats to find the perfect difficulty!</div></div></div>
          </div>
        </div>
        <!-- Planner -->
        <div class="ai-tool-panel" id="tool-planner">
          <div class="grid-2">
            <div class="ai-input-card">
              <div class="c-title" style="margin-bottom:16px">ğŸ“† Exam Details</div>
              <div class="form-grp"><label class="form-lbl">Subject Difficulty</label><select class="form-sel" id="pl-diff"><option value="1">ğŸŒ± Easy</option><option value="2" selected>ğŸ“ˆ Medium</option><option value="3">ğŸ”¥ Hard</option><option value="4">ğŸš€ Very Hard</option></select></div>
              <div class="slider-grp"><div class="slider-lbl"><span>Current Knowledge (1-10)</span><span class="slider-val">5</span></div><input type="range" class="sl" id="pl-know" min="1" max="10" value="5" oninput="this.previousElementSibling.querySelector('.slider-val').textContent=this.value"/></div>
              <div class="slider-grp"><div class="slider-lbl"><span>Days Until Exam</span><span class="slider-val">21d</span></div><input type="range" class="sl" id="pl-days" min="3" max="90" value="21" oninput="this.previousElementSibling.querySelector('.slider-val').textContent=this.value+'d'"/></div>
              <div class="slider-grp"><div class="slider-lbl"><span>Target Score</span><span class="slider-val">85%</span></div><input type="range" class="sl" id="pl-target" min="50" max="100" value="85" oninput="this.previousElementSibling.querySelector('.slider-val').textContent=this.value+'%'"/></div>
              <button class="btn btn-p" style="width:100%;justify-content:center;margin-top:8px" onclick="buildPlan()">ğŸ“… Build My Plan</button>
            </div>
            <div id="planResult" style="display:flex;align-items:center;justify-content:center"><div style="text-align:center;color:var(--tx4);padding:40px"><div style="font-size:2.5rem;margin-bottom:8px">ğŸ“†</div><div style="font-size:.9rem">Set your exam details to get a personalised plan!</div></div></div>
          </div>
        </div>
        <!-- Style -->
        <div class="ai-tool-panel" id="tool-style">
          <div class="grid-2">
            <div class="ai-input-card">
              <div class="c-title" style="margin-bottom:16px">ğŸ¨ Your Learning Preferences</div>
              <div class="slider-grp"><div class="slider-lbl"><span>Prefer diagrams over reading</span><span class="slider-val">7</span></div><input type="range" class="sl" id="ls-vis" min="1" max="10" value="7" oninput="this.previousElementSibling.querySelector('.slider-val').textContent=this.value"/></div>
              <div class="slider-grp"><div class="slider-lbl"><span>Love listening to lectures</span><span class="slider-val">4</span></div><input type="range" class="sl" id="ls-aud" min="1" max="10" value="4" oninput="this.previousElementSibling.querySelector('.slider-val').textContent=this.value"/></div>
              <div class="slider-grp"><div class="slider-lbl"><span>Take lots of written notes</span><span class="slider-val">6</span></div><input type="range" class="sl" id="ls-rw" min="1" max="10" value="6" oninput="this.previousElementSibling.querySelector('.slider-val').textContent=this.value"/></div>
              <div class="slider-grp"><div class="slider-lbl"><span>Prefer hands-on practice</span><span class="slider-val">5</span></div><input type="range" class="sl" id="ls-kin" min="1" max="10" value="5" oninput="this.previousElementSibling.querySelector('.slider-val').textContent=this.value"/></div>
              <button class="btn btn-p" style="width:100%;justify-content:center;margin-top:8px" onclick="detectStyle()">ğŸ§  Detect My Style</button>
            </div>
            <div id="styleResult" style="display:flex;align-items:center;justify-content:center"><div style="text-align:center;color:var(--tx4);padding:40px"><div style="font-size:2.5rem;margin-bottom:8px">ğŸ¨</div><div style="font-size:.9rem">Rate your preferences to discover your learning style!</div></div></div>
          </div>
        </div>
        <!-- Topics -->
        <div class="ai-tool-panel" id="tool-topics">
          <div class="c-title" style="margin-bottom:16px">âœ… Topics You've Covered</div>
          <div id="topicCheckGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px;margin-bottom:20px"></div>
          <button class="btn btn-p" onclick="getTopicRecs()">âœ¨ Get Recommendations</button>
          <div id="topicRecResult" style="margin-top:20px"></div>
        </div>
      </div>

      <!-- â”€â”€ PERFORMANCE â”€â”€ -->
      <div class="page" id="performancePage">
        <div class="page-title">Performance Analytics ğŸ“ˆ</div>
        <div class="page-sub">Track your academic progress and patterns</div>
        <div class="perf-stats" id="perfStats"></div>
        <div class="card" style="margin-bottom:16px">
          <div class="c-hd"><div class="c-title">Subject Progress</div></div>
          <div id="subjBars"></div>
        </div>
        <div class="card" style="margin-bottom:16px">
          <div class="c-hd"><div class="c-title">28-Day Activity Heatmap</div><div class="c-sub">Each cell = one day of activity</div></div>
          <div class="hm-grid" id="heatmap"></div>
        </div>
        <div class="card">
          <div class="c-hd"><div class="c-title">Quiz History</div></div>
          <div id="quizHistory"></div>
        </div>
      </div>

      <!-- â”€â”€ STREAKS â”€â”€ -->
      <div class="page" id="streaksPage">
        <div class="page-title">Streaks & Goals ğŸ”¥</div>
        <div class="page-sub">Build daily habits and track your subject goals</div>
        <div class="grid-2" style="margin-bottom:20px">
          <div class="card">
            <div class="c-hd"><div class="c-title">ğŸ“… Study Calendar</div><div style="display:flex;align-items:center;gap:6px"><button class="ic-btn" onclick="calPrev()">â€¹</button><span style="font-size:.8rem;font-weight:700;color:var(--tx);min-width:100px;text-align:center" id="calMonthLbl"></span><button class="ic-btn" onclick="calNext()">â€º</button></div></div>
            <div class="cal-grid" id="calGrid"></div>
            <div style="display:flex;gap:12px;margin-top:12px;font-size:.72rem;color:var(--tx3)">
              <div style="display:flex;align-items:center;gap:4px"><div style="width:10px;height:10px;border-radius:3px;background:var(--acc);opacity:.5"></div>Studied</div>
              <div style="display:flex;align-items:center;gap:4px"><div style="width:10px;height:10px;border-radius:3px;background:var(--acc);outline:2px solid var(--acc);outline-offset:1px"></div>Today</div>
            </div>
          </div>
          <div class="card">
            <div class="c-hd"><div class="c-title">Streak Stats</div></div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px">
              <div class="ps"><div class="ps-v" id="curStreak">0</div><div class="ps-l">Current Streak ğŸ”¥</div></div>
              <div class="ps"><div class="ps-v" id="bestStreak">0</div><div class="ps-l">Best Streak ğŸ†</div></div>
              <div class="ps"><div class="ps-v" id="totalDays">0</div><div class="ps-l">Total Study Days ğŸ“š</div></div>
              <div class="ps"><div class="ps-v" id="thisWeek">0</div><div class="ps-l">This Week ğŸ“…</div></div>
            </div>
          </div>
        </div>
        <div class="c-hd" style="margin-bottom:12px">
          <div class="c-title">ğŸ¯ Subject Goals</div>
          <button class="btn btn-p btn-sm" onclick="openGoalModal()">+ Add Goal</button>
        </div>
        <div class="goals-grid" id="goalsGrid"></div>
      </div>

      <!-- â”€â”€ POMODORO â”€â”€ -->
      <div class="page" id="pomodoroPage">
        <div class="page-title">Pomodoro Timer â±ï¸</div>
        <div class="page-sub">Work in focused sprints. Build your study habit.</div>
        <div class="pomo-wrap">
          <div class="pomo-modes">
            <button class="pomo-mode-btn active" onclick="setPomoPhase('focus',this)">ğŸ… Focus (25m)</button>
            <button class="pomo-mode-btn" onclick="setPomoPhase('short',this)">â˜• Short Break (5m)</button>
            <button class="pomo-mode-btn" onclick="setPomoPhase('long',this)">ğŸŒ¿ Long Break (15m)</button>
          </div>
          <div class="pomo-ring-w">
            <svg class="pomo-svg" viewBox="0 0 220 220" width="220" height="220">
              <circle class="pomo-track" cx="110" cy="110" r="100"/>
              <circle class="pomo-fill" id="pomoFill" cx="110" cy="110" r="100"/>
            </svg>
            <div class="pomo-ctr">
              <div class="pomo-t" id="pomoTime">25:00</div>
              <div class="pomo-m" id="pomoModeLabel">Focus Session</div>
            </div>
          </div>
          <div class="pomo-sessions-row" id="pomoSessRow"></div>
          <div class="pomo-ctrls">
            <button class="pomo-btn-sec" onclick="pomoSkip()" title="Skip">â­</button>
            <button class="pomo-btn-main" id="pomoPlayBtn" onclick="pomoToggle()">â–¶</button>
            <button class="pomo-btn-sec" onclick="pomoReset()" title="Reset">â†º</button>
          </div>
          <div class="pomo-stats">
            <div class="pomo-stat"><div class="pomo-stat-v" id="pomoStatSessions">0</div><div class="pomo-stat-l">Sessions</div></div>
            <div class="pomo-stat"><div class="pomo-stat-v" id="pomoStatTime">0m</div><div class="pomo-stat-l">Focused</div></div>
            <div class="pomo-stat"><div class="pomo-stat-v" id="pomoStatBreaks">0</div><div class="pomo-stat-l">Breaks</div></div>
          </div>
          <div class="task-select-card">
            <div class="c-title" style="margin-bottom:10px">Focus on Task</div>
            <select class="form-sel" id="pomoTaskSel" style="font-size:.84rem"><option value="">â€” Select a task (optional) â€”</option></select>
          </div>
        </div>
      </div>

      <!-- â”€â”€ ADD TASK â”€â”€ -->
      <div class="page" id="addPage">
        <div class="page-title">Add New Task</div>
        <div class="page-sub">Create a new assignment or study task</div>
        <div class="add-form card">
          <div class="form-grp"><label class="form-lbl">Task Title *</label><input type="text" id="tTitle" class="form-inp" placeholder="e.g. Complete Calculus Assignment"/><div class="form-err" id="tTitleErr">Title is required.</div></div>
          <div class="form-row">
            <div class="form-grp"><label class="form-lbl">Subject</label><input type="text" id="tSubject" class="form-inp" placeholder="e.g. Mathematics" list="subjectList"/><datalist id="subjectList"><option>Mathematics</option><option>Physics</option><option>Computer Science</option><option>Chemistry</option><option>Biology</option><option>English</option></datalist></div>
            <div class="form-grp"><label class="form-lbl">Due Date</label><input type="date" id="tDue" class="form-inp"/></div>
          </div>
          <div class="form-grp"><label class="form-lbl">Priority</label>
            <div class="prio-sel">
              <div class="prio-opt sel-h" data-p="high" onclick="selPrio('high')">ğŸ”´ High</div>
              <div class="prio-opt" data-p="medium" onclick="selPrio('medium')">ğŸŸ¡ Medium</div>
              <div class="prio-opt" data-p="low" onclick="selPrio('low')">ğŸŸ¢ Low</div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-grp"><label class="form-lbl">Status</label><select id="tStatus" class="form-sel"><option value="pending">Pending</option><option value="in-progress">In Progress</option><option value="completed">Completed</option></select></div>
            <div class="form-grp"><label class="form-lbl">Estimated Hours</label><input type="number" id="tHours" class="form-inp" placeholder="e.g. 2" min="0.5" max="20" step="0.5"/></div>
          </div>
          <div class="form-grp"><label class="form-lbl">Notes</label><textarea id="tNotes" class="form-ta" placeholder="Additional details, references, or study notes..."></textarea></div>
          <div style="display:flex;gap:10px;margin-top:4px">
            <button class="btn btn-p" onclick="submitTask()">Add Task â†’</button>
            <button class="btn btn-g" onclick="resetAddForm()">Reset</button>
          </div>
        </div>
      </div>

      <!-- â”€â”€ ACCOUNT SETTINGS â”€â”€ -->
      <div class="page" id="accountPage">
        <div class="page-title">Account Settings âš™ï¸</div>
        <div class="page-sub">Manage your profile and preferences</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;max-width:800px">

          <!-- Profile Card -->
          <div class="card" style="grid-column:1/-1">
            <div style="display:flex;align-items:center;gap:20px;flex-wrap:wrap">
              <div style="width:72px;height:72px;border-radius:20px;background:linear-gradient(135deg,var(--acc),var(--purple));display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-weight:900;font-size:1.8rem;color:#fff;flex-shrink:0" id="accAvatar">?</div>
              <div style="flex:1;min-width:0">
                <div style="font-family:var(--font-display);font-weight:800;font-size:1.2rem;color:var(--tx)" id="accName">â€”</div>
                <div style="font-size:.85rem;color:var(--tx3);margin-top:2px" id="accEmail">â€”</div>
                <div style="display:flex;align-items:center;gap:8px;margin-top:6px">
                  <span class="pill pi" id="accGrade">Student</span>
                  <span style="font-size:.72rem;color:var(--tx4)" id="accJoined">â€”</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Edit Profile -->
          <div class="card">
            <div class="c-title" style="margin-bottom:16px">âœï¸ Edit Profile</div>
            <div class="form-grp"><label class="form-lbl">Full Name</label><input type="text" id="accNameInp" class="form-inp" placeholder="Your name"/></div>
            <div class="form-grp"><label class="form-lbl">Class / Grade</label>
              <select id="accGradeInp" class="form-sel">
                <option value="">Select grade</option>
                <option>Class 9</option><option>Class 10</option><option>Class 11</option><option>Class 12</option>
                <option>1st Year UG</option><option>2nd Year UG</option><option>3rd Year UG</option>
                <option>Postgraduate</option><option>Other</option>
              </select>
            </div>
            <button class="btn btn-p" style="width:100%;justify-content:center" onclick="saveProfile()">ğŸ’¾ Save Profile</button>
          </div>

          <!-- Change Password -->
          <div class="card">
            <div class="c-title" style="margin-bottom:16px">ğŸ”’ Change Password</div>
            <div class="form-grp"><label class="form-lbl">Current Password</label><input type="password" id="accOldPass" class="form-inp" placeholder="Current password"/><div class="form-err" id="accOldErr">Incorrect password.</div></div>
            <div class="form-grp"><label class="form-lbl">New Password</label><input type="password" id="accNewPass" class="form-inp" placeholder="Min 4 characters"/></div>
            <div class="form-grp"><label class="form-lbl">Confirm New</label><input type="password" id="accConfPass" class="form-inp" placeholder="Repeat new password"/><div class="form-err" id="accConfErr">Passwords do not match.</div></div>
            <button class="btn btn-p" style="width:100%;justify-content:center" onclick="changePassword()">ğŸ”‘ Update Password</button>
          </div>

          <!-- Preferences -->
          <div class="card">
            <div class="c-title" style="margin-bottom:16px">ğŸ¨ Preferences</div>
            <div style="display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border)">
              <div><div style="font-size:.85rem;font-weight:600;color:var(--tx)">Dark Mode</div><div style="font-size:.72rem;color:var(--tx3)">Toggle light / dark theme</div></div>
              <div class="toggle-sw" id="themeSwitch" onclick="toggleThemeFromAcc()"><div class="toggle-knob"></div></div>
            </div>
            <div style="padding:10px 0;border-bottom:1px solid var(--border)">
              <div style="font-size:.85rem;font-weight:600;color:var(--tx);margin-bottom:6px">Pomodoro Focus Duration</div>
              <div style="display:flex;gap:8px">
                <button class="fc" id="p20" onclick="setPomoDefault(20,this)">20 min</button>
                <button class="fc active" id="p25" onclick="setPomoDefault(25,this)">25 min</button>
                <button class="fc" id="p30" onclick="setPomoDefault(30,this)">30 min</button>
                <button class="fc" id="p45" onclick="setPomoDefault(45,this)">45 min</button>
              </div>
            </div>
            <div style="padding:10px 0">
              <div style="font-size:.85rem;font-weight:600;color:var(--tx);margin-bottom:2px">Notification Alerts</div>
              <div style="font-size:.72rem;color:var(--tx3);margin-bottom:8px">Get alerted for due tasks and streaks</div>
              <div class="toggle-sw on" id="notifSwitch" onclick="this.classList.toggle('on')"><div class="toggle-knob"></div></div>
            </div>
          </div>

          <!-- Stats Summary -->
          <div class="card">
            <div class="c-title" style="margin-bottom:16px">ğŸ“Š Your Stats</div>
            <div id="accStats" style="display:flex;flex-direction:column;gap:10px"></div>
          </div>

          <!-- Danger Zone -->
          <div class="card" style="grid-column:1/-1;border-color:var(--red-border);background:var(--red-bg)">
            <div class="c-title" style="margin-bottom:8px;color:var(--red)">âš ï¸ Danger Zone</div>
            <div style="font-size:.82rem;color:var(--tx3);margin-bottom:14px">These actions are permanent and cannot be undone.</div>
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <button class="btn btn-r" onclick="clearAllData()">ğŸ—‘ï¸ Clear All My Data</button>
              <button class="btn btn-r" onclick="handleLogout()">ğŸšª Sign Out</button>
            </div>
          </div>

        </div>
      </div>

    </main>
  </div><!-- end app-body -->
</div><!-- end app -->

<!-- BOTTOM NAV (mobile) -->
<nav class="bottom-nav">
  <div class="bn-items">
    <button class="bn-btn active" data-pg="dashboard" onclick="navigate('dashboard')"><span class="bn-ic">ğŸ </span>Home</button>
    <button class="bn-btn" data-pg="tasks" onclick="navigate('tasks')"><span class="bn-ic">ğŸ“‹</span>Tasks</button>
    <button class="bn-btn" data-pg="quiz" onclick="navigate('quiz')"><span class="bn-ic">ğŸ§ </span>Quiz</button>
    <button class="bn-btn" data-pg="notes" onclick="navigate('notes')"><span class="bn-ic">ğŸ“</span>Notes</button>
    <button class="bn-btn" data-pg="pomodoro" onclick="navigate('pomodoro')"><span class="bn-ic">â±ï¸</span>Timer</button>
    <button class="bn-btn" data-pg="aitools" onclick="navigate('aitools')"><span class="bn-ic">âœ¨</span>AI</button>
  </div>
</nav>

<!-- FOCUS OVERLAY -->
<div class="focus-ov" id="focusOv">
  <div class="pomo-ring-w">
    <svg class="pomo-svg" viewBox="0 0 220 220" width="200" height="200">
      <circle class="pomo-track" cx="110" cy="110" r="100"/>
      <circle class="pomo-fill" id="focusFill" cx="110" cy="110" r="100"/>
    </svg>
    <div class="pomo-ctr"><div class="pomo-t" id="focusTime">25:00</div><div class="pomo-m" id="focusMode">Focus</div></div>
  </div>
  <div class="focus-task-lbl" id="focusTaskLbl">Deep Focus Session</div>
  <div class="focus-hint">Press ESC or the button below to exit focus mode</div>
  <div style="display:flex;gap:12px">
    <button class="pomo-btn-main" id="focusPlayBtn" onclick="pomoToggle();syncFocus()">â–¶</button>
  </div>
  <button class="focus-exit-btn" onclick="exitFocus()">Exit Focus Mode</button>
</div>

<!-- EDIT TASK MODAL -->
<div class="modal-ov" id="editModal" onclick="if(event.target===this)closeModal('editModal')">
  <div class="modal-box">
    <div class="modal-hd"><div class="modal-title">Edit Task</div><button class="modal-cls" onclick="closeModal('editModal')">âœ•</button></div>
    <div class="form-grp"><label class="form-lbl">Title *</label><input type="text" id="eTitle" class="form-inp"/></div>
    <div class="form-row">
      <div class="form-grp"><label class="form-lbl">Subject</label><input type="text" id="eSubject" class="form-inp" list="subjectList"/></div>
      <div class="form-grp"><label class="form-lbl">Due Date</label><input type="date" id="eDue" class="form-inp"/></div>
    </div>
    <div class="form-row">
      <div class="form-grp"><label class="form-lbl">Priority</label><select id="ePrio" class="form-sel"><option value="high">High</option><option value="medium">Medium</option><option value="low">Low</option></select></div>
      <div class="form-grp"><label class="form-lbl">Status</label><select id="eStat" class="form-sel"><option value="pending">Pending</option><option value="in-progress">In Progress</option><option value="completed">Completed</option></select></div>
    </div>
    <div class="form-grp"><label class="form-lbl">Notes</label><textarea id="eNotes" class="form-ta"></textarea></div>
    <div style="display:flex;gap:10px">
      <button class="btn btn-p" onclick="saveEdit()">Save Changes</button>
      <button class="btn btn-g" onclick="closeModal('editModal')">Cancel</button>
    </div>
  </div>
</div>

<!-- NOTE EDITOR MODAL -->
<div class="modal-ov" id="noteModal" onclick="if(event.target===this)closeModal('noteModal')">
  <div class="modal-box" style="max-width:580px">
    <div class="modal-hd"><div class="modal-title" id="noteModalTitle">New Note</div><button class="modal-cls" onclick="closeModal('noteModal')">âœ•</button></div>
    <div class="form-grp"><label class="form-lbl">Title</label><input type="text" id="nTitle" class="form-inp" placeholder="Note title..."/></div>
    <div class="form-row">
      <div class="form-grp"><label class="form-lbl">Subject</label><select id="nSubj" class="form-sel"><option value="">General</option><option>Mathematics</option><option>Physics</option><option>Computer Science</option><option>Chemistry</option><option>Biology</option><option>English</option></select></div>
    </div>
    <div class="form-grp"><label class="form-lbl">Content</label><textarea id="nContent" class="form-ta" style="min-height:140px" placeholder="Write your notes here..."></textarea></div>
    <div style="display:flex;gap:10px">
      <button class="btn btn-p" onclick="saveNote()">ğŸ’¾ Save Note</button>
      <button class="btn btn-g" onclick="closeModal('noteModal')">Cancel</button>
    </div>
  </div>
</div>

<!-- GOAL MODAL -->
<div class="modal-ov" id="goalModal" onclick="if(event.target===this)closeModal('goalModal')">
  <div class="modal-box" style="max-width:400px">
    <div class="modal-hd"><div class="modal-title">Add Subject Goal</div><button class="modal-cls" onclick="closeModal('goalModal')">âœ•</button></div>
    <div class="form-grp"><label class="form-lbl">Subject</label><input type="text" id="goalSubj" class="form-inp" placeholder="e.g. Mathematics" list="subjectList"/></div>
    <div class="form-grp"><label class="form-lbl">Goal Description</label><input type="text" id="goalDesc" class="form-inp" placeholder="e.g. Finish Calculus Chapter"/></div>
    <div class="form-row">
      <div class="form-grp"><label class="form-lbl">Target Hours</label><input type="number" id="goalTarget" class="form-inp" placeholder="10" min="1" max="200"/></div>
      <div class="form-grp"><label class="form-lbl">Done So Far</label><input type="number" id="goalDone" class="form-inp" placeholder="0" min="0"/></div>
    </div>
    <button class="btn btn-p" style="width:100%;justify-content:center" onclick="saveGoal()">Add Goal</button>
  </div>
</div>

<div id="toasts"></div>
<div id="sbOverlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:180" onclick="closeSidebar()"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let cu = null; // currentUser
let tasks = [];
let notes = [];
let goals = [];
let notifs = [];
let taskFilter = 'all';
let editId = null;
let selPrioVal = 'high';
let sbExpanded = window.innerWidth >= 768;
let noteCat = '';
let editNoteId = null;
let quizSubject = null;
let quizQs = [];
let quizIdx = 0;
let quizScore = 0;
let quizAnswered = false;
let calYear = new Date().getFullYear(), calMonth = new Date().getMonth();
let donut = null, bar = null;
let focusActive = false;
let pomoPhase = 'focus';
let pomoTimes = {focus:25,short:5,long:15};
let pomoLeft = 25*60, pomoTotal = 25*60;
let pomoRunning = false;
let pomoTimer = null;
let pomoSessions = 0, pomoBreaks = 0, pomoFocused = 0;
let topicsDone = [];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STORAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const G = k => { try { return JSON.parse(localStorage.getItem(k)); } catch { return null; } };
const S = (k,v) => localStorage.setItem(k, JSON.stringify(v));
const E = s => String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• INIT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.addEventListener('DOMContentLoaded', () => {
  const pref = G('sb_pref') || {};
  if (pref.theme === 'dark') applyTheme('dark');
  const sess = G('sb_sess');
  if (sess) { cu = sess; initApp(); }
  else { document.getElementById('landingPage').style.display='flex'; document.getElementById('authPage').style.display='none'; document.getElementById('app').style.display='none'; }
  renderQuickLogins();
  // KB
  document.addEventListener('keydown', e => { if(e.key==='Escape'){exitFocus();closeModal('editModal');closeModal('noteModal');closeModal('goalModal');document.getElementById('notifPanel').classList.remove('show');} });
  // Sidebar on resize
  window.addEventListener('resize', () => { if(window.innerWidth>=768){sbExpanded=true;document.getElementById('appBody').classList.add('sb-open');} });
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• THEME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function applyTheme(t) {
  document.documentElement.setAttribute('data-theme', t);
  document.querySelectorAll('.theme-toggle-btn,[id^="themeBtn"]').forEach(b=>b.textContent=t==='dark'?'â˜€ï¸':'ğŸŒ™');
  setTimeout(()=>{if(donut)rebuildCharts();},100);
}
function toggleTheme() {
  const cur = document.documentElement.getAttribute('data-theme')||'light';
  const next = cur==='light'?'dark':'light';
  applyTheme(next);
  const p=G('sb_pref')||{}; p.theme=next; S('sb_pref',p);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LANDING â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showLanding() {
  document.getElementById('landingPage').style.display='flex';
  document.getElementById('authPage').style.display='none';
  document.getElementById('app').style.display='none';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• AUTH â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showAuth(tab='login') {
  document.getElementById('landingPage').style.display='none';
  document.getElementById('authPage').style.display='flex';
  switchAuthTab(tab);
  renderQuickLogins();
}
function switchAuthTab(t) {
  document.getElementById('aTabLogin').classList.toggle('active',t==='login');
  document.getElementById('aTabReg').classList.toggle('active',t==='register');
  document.getElementById('loginForm').style.display=t==='login'?'block':'none';
  document.getElementById('regForm').style.display=t==='register'?'block':'none';
}
function renderQuickLogins() {
  const users=G('sb_users')||{};
  const emails=Object.keys(users);
  if(!emails.length)return;
  document.getElementById('qlWrap').style.display='block';
  document.getElementById('qlChips').innerHTML=emails.map(e=>`<div class="ql-chip" onclick="document.getElementById('lEmail').value='${E(e)}';document.getElementById('lPass').focus()">${E(users[e].name)}</div>`).join('');
}
function handleRegister() {
  const name=document.getElementById('rName').value.trim();
  const email=document.getElementById('rEmail').value.trim();
  const grade=document.getElementById('rGrade').value;
  const pass=document.getElementById('rPass').value;
  let ok=true;
  const se=(id,m)=>{const el=document.getElementById(id);el.style.display='block';el.textContent=m;ok=false;};
  const he=id=>document.getElementById(id).style.display='none';
  if(!name){se('rNameErr','Name is required.');}else he('rNameErr');
  if(!email||!email.includes('@')){se('rEmailErr','Enter a valid email.');}else he('rEmailErr');
  if(pass.length<4){se('rPassErr','Password must be 4+ characters.');}else he('rPassErr');
  if(!ok)return;
  const users=G('sb_users')||{};
  if(users[email]){se('rEmailErr','Email already registered.');return;}
  users[email]={name,email,grade,pass:btoa(pass)};
  S('sb_users',users);
  toast('Account created! Sign in now.','success');
  switchAuthTab('login');
  document.getElementById('lEmail').value=email;
}
function handleLogin() {
  const email=document.getElementById('lEmail').value.trim();
  const pass=document.getElementById('lPass').value;
  const se=(id,m)=>{const el=document.getElementById(id);el.style.display='block';el.textContent=m;};
  const he=id=>document.getElementById(id).style.display='none';
  let ok=true;
  if(!email||!email.includes('@')){se('lEmailErr','Please enter a valid email.');ok=false;}else he('lEmailErr');
  if(!pass){se('lPassErr','Password is required.');ok=false;}else he('lPassErr');
  if(!ok)return;
  const users=G('sb_users')||{};
  const u=users[email];
  if(!u||atob(u.pass)!==pass){se('lPassErr','Invalid email or password.');return;}
  cu={name:u.name,email,grade:u.grade||'Student'};
  S('sb_sess',cu);
  initApp();
}
function handleLogout() {
  localStorage.removeItem('sb_sess');
  cu=null;
  document.getElementById('app').style.display='none';
  document.getElementById('app').classList.remove('visible');
  showLanding();
  toast('Signed out.','info');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• APP INIT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initApp() {
  document.getElementById('landingPage').style.display='none';
  document.getElementById('authPage').style.display='none';
  document.getElementById('app').style.display='flex';
  document.getElementById('app').classList.add('visible');
  loadAll();
  updateUserUI();
  updateGreeting();
  navigate('dashboard');
  checkNotifs();
  if(sbExpanded)document.getElementById('appBody').classList.add('sb-open');
  topicsDone=G(`topics_${cu.email}`)||[];
  renderTopicCheckGrid();
  renderPomodoro();
  // Apply saved pomo default
  const pref=G('sb_pref')||{};
  if(pref.pomoDef){pomoTimes.focus=pref.pomoDef;pomoLeft=pref.pomoDef*60;pomoTotal=pomoLeft;}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ACCOUNT SETTINGS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderAccount(){
  if(!cu)return;
  const av=cu.name.charAt(0).toUpperCase();
  document.getElementById('accAvatar').textContent=av;
  document.getElementById('accName').textContent=cu.name;
  document.getElementById('accEmail').textContent=cu.email;
  document.getElementById('accGrade').textContent=cu.grade||'Student';
  document.getElementById('accJoined').textContent='Member since '+new Date().toLocaleDateString('en-US',{month:'long',year:'numeric'});
  document.getElementById('accNameInp').value=cu.name;
  document.getElementById('accGradeInp').value=cu.grade||'';
  // Theme toggle sync
  const isDark=document.documentElement.getAttribute('data-theme')==='dark';
  const sw=document.getElementById('themeSwitch');
  if(isDark)sw.classList.add('on'); else sw.classList.remove('on');
  // Pomo default highlight
  const pref=G('sb_pref')||{};
  const pomoDef=pref.pomoDef||25;
  ['20','25','30','45'].forEach(v=>{const b=document.getElementById('p'+v);if(b){b.classList.toggle('active',parseInt(v)===pomoDef);}});
  // Stats
  const total=tasks.length,done=tasks.filter(t=>t.status==='completed').length;
  const streak=getStreakData();const streakDays=Object.keys(streak).length;
  const quizH=G(`quizHist_${cu.email}`)||[];
  const avgQ=quizH.length?Math.round(quizH.reduce((s,q)=>s+(q.score/q.total*100),0)/quizH.length):0;
  document.getElementById('accStats').innerHTML=[
    {ic:'ğŸ“‹',l:'Total Tasks',v:total},
    {ic:'âœ…',l:'Completed',v:done},
    {ic:'ğŸ”¥',l:'Study Days',v:streakDays},
    {ic:'ğŸ§ ',l:'Quizzes Taken',v:quizH.length},
    {ic:'ğŸ“Š',l:'Quiz Average',v:avgQ+'%'},
    {ic:'ğŸ“',l:'Notes Saved',v:notes.length},
  ].map(s=>`<div style="display:flex;align-items:center;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--border)"><div style="display:flex;align-items:center;gap:8px;font-size:.83rem;color:var(--tx2)">${s.ic} ${s.l}</div><span style="font-weight:800;font-size:.9rem;color:var(--acc)">${s.v}</span></div>`).join('');
}
function saveProfile(){
  const name=document.getElementById('accNameInp').value.trim();
  const grade=document.getElementById('accGradeInp').value;
  if(!name){toast('Name cannot be empty','error');return;}
  const users=G('sb_users')||{};
  if(users[cu.email]){users[cu.email].name=name;users[cu.email].grade=grade;S('sb_users',users);}
  cu.name=name;cu.grade=grade;S('sb_sess',cu);
  updateUserUI();renderAccount();toast('Profile updated! âœ…','success');
}
function changePassword(){
  const oldP=document.getElementById('accOldPass').value;
  const newP=document.getElementById('accNewPass').value;
  const confP=document.getElementById('accConfPass').value;
  const oe=document.getElementById('accOldErr'),ce=document.getElementById('accConfErr');
  oe.style.display='none';ce.style.display='none';
  const users=G('sb_users')||{};
  const u=users[cu.email];
  if(!u||atob(u.pass)!==oldP){oe.style.display='block';return;}
  if(newP.length<4){toast('New password must be 4+ characters','error');return;}
  if(newP!==confP){ce.style.display='block';return;}
  u.pass=btoa(newP);S('sb_users',users);
  ['accOldPass','accNewPass','accConfPass'].forEach(id=>document.getElementById(id).value='');
  toast('Password updated! ğŸ”‘','success');
}
function toggleThemeFromAcc(){
  toggleTheme();
  const isDark=document.documentElement.getAttribute('data-theme')==='dark';
  const sw=document.getElementById('themeSwitch');
  if(isDark)sw.classList.add('on'); else sw.classList.remove('on');
}
function setPomoDefault(mins,el){
  document.querySelectorAll('#accountPage .fc').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  pomoTimes.focus=mins;
  if(pomoPhase==='focus'){pomoLeft=mins*60;pomoTotal=mins*60;updatePomoDisplay();}
  const pref=G('sb_pref')||{};pref.pomoDef=mins;S('sb_pref',pref);
  toast(`Focus timer set to ${mins} min â±ï¸`,'success');
}
function clearAllData(){
  if(!confirm('This will delete ALL your tasks, notes, goals, and streak data. Are you sure?'))return;
  ['tasks','notes','goals','notifs',`quizHist`,`streak`,`topics`].forEach(k=>localStorage.removeItem(`${k}_${cu.email}`));
  localStorage.removeItem(`streak_${cu.email}`);
  tasks=[];notes=[];goals=[];notifs=[];
  toast('All data cleared.','info');
  renderAccount();
}
function loadAll() {
  tasks=G(`tasks_${cu.email}`)||[];
  notes=G(`notes_${cu.email}`)||[];
  goals=G(`goals_${cu.email}`)||[];
  notifs=G(`notifs_${cu.email}`)||[];
}
function saveAll() { S(`tasks_${cu.email}`,tasks);S(`notes_${cu.email}`,notes);S(`goals_${cu.email}`,goals); }
function updateUserUI() {
  const av=cu.name.charAt(0).toUpperCase();
  document.getElementById('sbAv').textContent=av;
  document.getElementById('tbAv').textContent=av;
  document.getElementById('sbName').textContent=cu.name;
  document.getElementById('tbName').textContent=cu.name;
  document.getElementById('sbGrade').textContent=cu.grade||'Student';
}
function updateGreeting() {
  const h=new Date().getHours();
  const g=h<12?'Good morning':h<17?'Good afternoon':'Good evening';
  document.getElementById('greetH').textContent=`${g}, ${cu.name}! ğŸ‘‹`;
  document.getElementById('greetP').textContent=`${new Date().toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric'})} â€” Here's your study overview.`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• NAVIGATION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const PAGE_TITLES={dashboard:'Dashboard',tasks:'My Tasks',upcoming:'Upcoming',quiz:'Quiz',notes:'Notes',aitools:'AI Tools',performance:'Performance',streaks:'Streaks & Goals',pomodoro:'Pomodoro',add:'Add Task',account:'Account Settings'};
function navigate(pg) {
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.sb-btn,.bn-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById(pg+'Page').classList.add('active');
  document.querySelectorAll(`[data-pg="${pg}"]`).forEach(b=>b.classList.add('active'));
  document.getElementById('tbTitle').textContent=PAGE_TITLES[pg]||'StudyBot';
  if(pg==='dashboard')renderDashboard();
  if(pg==='tasks')renderTasks();
  if(pg==='upcoming')renderUpcoming();
  if(pg==='performance')renderPerf();
  if(pg==='streaks')renderStreaks();
  if(pg==='notes')renderNotes();
  if(pg==='quiz')renderQuizSubjects();
  if(pg==='pomodoro')renderPomodoro();
  if(pg==='account')renderAccount();
  if(window.innerWidth<768)closeSidebar();
  document.getElementById('notifPanel').classList.remove('show');
  document.getElementById('contentArea').scrollTo(0,0);
}
function toggleSidebar() {
  if(window.innerWidth<768){
    const sb=document.getElementById('sidebar');
    const ov=document.getElementById('sbOverlay');
    sb.classList.toggle('open');
    ov.style.display=sb.classList.contains('open')?'block':'none';
  } else {
    sbExpanded=!sbExpanded;
    document.getElementById('appBody').classList.toggle('sb-open',sbExpanded);
  }
}
function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sbOverlay').style.display='none';
}
function closeModal(id){document.getElementById(id).classList.remove('show');}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TASKS CRUD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function selPrio(p) {
  selPrioVal=p;
  document.querySelectorAll('.prio-opt').forEach(el=>{el.className='prio-opt';if(el.dataset.p===p)el.classList.add(`sel-${p.charAt(0)}`);});
}
function submitTask() {
  const title=document.getElementById('tTitle').value.trim();
  if(!title){document.getElementById('tTitleErr').style.display='block';return;}
  document.getElementById('tTitleErr').style.display='none';
  const t={id:Date.now().toString(),title,subject:document.getElementById('tSubject').value.trim(),due:document.getElementById('tDue').value,priority:selPrioVal,status:document.getElementById('tStatus').value,notes:document.getElementById('tNotes').value.trim(),hours:parseFloat(document.getElementById('tHours').value)||0,subtasks:[],created:Date.now(),updated:Date.now()};
  tasks.unshift(t); saveAll(); addNotif(`New task: "${title}"`); toast('Task added! âœ…','success'); resetAddForm(); renderTaskBadge(); navigate('tasks');
}
function resetAddForm() { ['tTitle','tSubject','tDue','tNotes','tHours'].forEach(id=>document.getElementById(id).value=''); document.getElementById('tStatus').value='pending'; selPrio('high'); }
function deleteTask(id) { if(!confirm('Delete this task?'))return; tasks=tasks.filter(t=>t.id!==id); saveAll(); toast('Task deleted.','info'); renderTasks(); renderTaskBadge(); }
function toggleDone(id) {
  const t=tasks.find(t=>t.id===id); if(!t)return;
  t.status=t.status==='completed'?'pending':'completed'; t.updated=Date.now();
  if(t.status==='completed'){markStreak();toast(`Task completed! ğŸ‰`,'success');addNotif(`âœ… "${t.title}" done!`);}
  saveAll(); renderTasks(); renderTaskBadge();
}
function openEdit(id) {
  const t=tasks.find(t=>t.id===id); if(!t)return;
  editId=id;
  document.getElementById('eTitle').value=t.title;
  document.getElementById('eSubject').value=t.subject||'';
  document.getElementById('eDue').value=t.due||'';
  document.getElementById('ePrio').value=t.priority;
  document.getElementById('eStat').value=t.status;
  document.getElementById('eNotes').value=t.notes||'';
  document.getElementById('editModal').classList.add('show');
}
function saveEdit() {
  const t=tasks.find(t=>t.id===editId); if(!t)return;
  const title=document.getElementById('eTitle').value.trim(); if(!title)return;
  t.title=title; t.subject=document.getElementById('eSubject').value.trim(); t.due=document.getElementById('eDue').value; t.priority=document.getElementById('ePrio').value; t.status=document.getElementById('eStat').value; t.notes=document.getElementById('eNotes').value.trim(); t.updated=Date.now();
  saveAll(); closeModal('editModal'); toast('Task updated!','success'); renderTasks();
}
function toggleSubtask(tid,idx) {
  const t=tasks.find(t=>t.id===tid); if(!t||!t.subtasks[idx])return;
  t.subtasks[idx].done=!t.subtasks[idx].done; t.updated=Date.now(); saveAll(); renderTasks();
}
function genSubtasks(id) {
  const t=tasks.find(t=>t.id===id); if(!t)return;
  const m=t.title.toLowerCase();
  let st=[];
  if(m.includes('essay')||m.includes('write')||m.includes('report'))st=['Research the topic','Create an outline','Write first draft','Revise and edit','Proofread and submit'];
  else if(m.includes('math')||m.includes('calculus')||m.includes('algebra'))st=['Review formulas','Work practice problems','Check answers','Summarise methods'];
  else if(m.includes('code')||m.includes('program'))st=['Plan architecture','Set up environment','Implement features','Test and debug'];
  else if(m.includes('study')||m.includes('revise'))st=['Gather materials','Read through notes','Make summary cards','Practice recall'];
  else if(m.includes('present')||m.includes('slides'))st=['Research content','Build slide structure','Design visuals','Practice delivery'];
  else st=['Understand requirements','Gather resources','Create action plan','Complete work','Review and submit'];
  t.subtasks=st.map(text=>({text,done:false})); t.updated=Date.now(); saveAll(); renderTasks(); toast(`Generated ${st.length} subtasks! âœ¨`,'success');
}
function isOverdue(t){return t.due&&t.status!=='completed'&&new Date(t.due+'T00:00:00')<new Date(new Date().toDateString());}
function renderTaskBadge(){const ov=tasks.filter(isOverdue).length;const el=document.getElementById('sbBadge');if(ov>0){el.style.display='flex';el.textContent=ov;}else el.style.display='none';}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FILTER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setFilter(f,el){taskFilter=f;document.querySelectorAll('.fc').forEach(b=>b.classList.remove('active'));el.classList.add('active');renderTasks();}
function getFiltered(){
  const q=(document.getElementById('taskSearch')?.value||'').toLowerCase();
  return tasks.filter(t=>{
    const ms=!q||t.title.toLowerCase().includes(q)||(t.subject||'').toLowerCase().includes(q);
    const mf=taskFilter==='all'||(taskFilter==='completed'?t.status==='completed':taskFilter==='overdue'?isOverdue(t):t.priority===taskFilter);
    return ms&&mf;
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RENDER TASKS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderTasks() {
  const grid=document.getElementById('tasksGrid');
  const filtered=getFiltered();
  if(!filtered.length){grid.innerHTML=`<div class="empty-s" style="grid-column:1/-1"><div class="ei">ğŸ“‹</div><div class="et">No tasks found</div><div class="es">Try adjusting filters or add a new task</div></div>`;return;}
  grid.innerHTML=filtered.map(t=>{
    const ov=isOverdue(t);
    const done=t.status==='completed';
    const stD=(t.subtasks||[]).filter(s=>s.done).length;
    const stT=(t.subtasks||[]).length;
    const stP=stT?Math.round((stD/stT)*100):0;
    const dueD=t.due?new Date(t.due+'T00:00:00'):null;
    const dueStr=dueD?dueD.toLocaleDateString('en-GB',{day:'numeric',month:'short'}):'';
    return `<div class="tc ph-${t.priority}${done?' done-card':''}">
      <div class="tc-top">
        <div class="tc-chk${done?' ck':''}" onclick="toggleDone('${t.id}')">${done?'âœ“':''}</div>
        <div class="tc-inf">
          <div class="tc-ttl${done?' lt':''}">${E(t.title)}</div>
          <div class="tc-meta">
            <span class="pill p${t.priority.charAt(0)}">${t.priority}</span>
            ${ov?'<span class="pill po">Overdue</span>':done?'<span class="pill pd">Done</span>':t.status==='in-progress'?'<span class="pill pi">Active</span>':'<span class="pill pp">Pending</span>'}
            ${t.subject?`<span style="font-size:.68rem;color:var(--tx3)">ğŸ“š ${E(t.subject)}</span>`:''}
          </div>
          ${t.due?`<div class="tc-due${ov?' ov':''}">ğŸ“… ${dueStr}</div>`:''}
          ${t.notes?`<div class="tc-desc">${E(t.notes)}</div>`:''}
        </div>
        <div class="tc-acts">
          <div class="ic-btn" onclick="openEdit('${t.id}')" title="Edit">âœ</div>
          <div class="ic-btn del" onclick="deleteTask('${t.id}')" title="Delete">âœ•</div>
        </div>
      </div>
      ${stT?`<div class="st-list">${t.subtasks.slice(0,3).map((s,i)=>`<div class="st-item" onclick="toggleSubtask('${t.id}',${i})"><div class="st-cb${s.done?' ck':''}">${s.done?'âœ“':''}</div><span class="st-tx${s.done?' ck':''}">${E(s.text)}</span></div>`).join('')}${stT>3?`<div style="font-size:.68rem;color:var(--tx4)">+${stT-3} more</div>`:''}</div>`:''}
      <div class="tc-footer">
        ${stT?`<div style="flex:1;margin-right:8px"><div style="font-size:.67rem;color:var(--tx4);margin-bottom:3px">${stD}/${stT} subtasks</div><div class="st-bar-w"><div class="st-bar" style="width:${stP}%"></div></div></div>`:'<div></div>'}
        <button class="btn btn-sm btn-purple" onclick="genSubtasks('${t.id}')">âœ¨ AI</button>
      </div>
    </div>`;
  }).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderDashboard() {
  const total=tasks.length, done=tasks.filter(t=>t.status==='completed').length;
  const pending=tasks.filter(t=>t.status==='pending').length;
  const inProg=tasks.filter(t=>t.status==='in-progress').length;
  const high=tasks.filter(t=>t.priority==='high'&&t.status!=='completed').length;
  const overdue=tasks.filter(isOverdue).length;
  const pct=total?Math.round((done/total)*100):0;
  const dls=[0,.06,.12,.18,.24,.3];
  document.getElementById('kpiRow').innerHTML=[
    {ic:'ğŸ“‹',v:total,l:'Total Tasks',c:'var(--acc)',bg:'var(--acc-bg)',ch:'+'+pending+' pending'},
    {ic:'âœ…',v:done,l:'Completed',c:'var(--green)',bg:'var(--green-bg)',ch:pct+'% rate'},
    {ic:'ğŸ”„',v:inProg,l:'In Progress',c:'var(--acc)',bg:'var(--acc-bg)',ch:'Active now'},
    {ic:'â³',v:pending,l:'Pending',c:'var(--amber)',bg:'var(--amber-bg)',ch:'To do'},
    {ic:'ğŸ”´',v:high,l:'High Priority',c:'var(--red)',bg:'var(--red-bg)',ch:'Urgent'},
    {ic:'âš ï¸',v:overdue,l:'Overdue',c:'var(--red)',bg:'var(--red-bg)',ch:'Past due'},
  ].map((k,i)=>`<div class="kpi" style="animation-delay:${dls[i]}s"><div class="kpi-ic" style="background:${k.bg}">${k.ic}</div><div class="kpi-v">${k.v}</div><div class="kpi-l">${k.l}</div><div class="kpi-chg ${overdue>0&&k.l==='Overdue'?'dn':'up'}">${k.ch}</div></div>`).join('');
  // Ring
  const circ=283, off=circ-(pct/100)*circ;
  const ring=document.getElementById('dashRing');
  if(ring){ring.style.strokeDashoffset=off;ring.style.stroke=pct>=80?'var(--green)':pct>=50?'var(--acc)':'var(--amber)';}
  document.getElementById('ringPct').textContent=pct+'%';
  // Recent
  const rec=[...tasks].sort((a,b)=>b.updated-a.updated).slice(0,7);
  const rt=document.getElementById('recentTasks');
  rt.innerHTML=rec.length?rec.map(t=>{
    const col=t.priority==='high'?'var(--red)':t.priority==='medium'?'var(--amber)':'var(--green)';
    return `<div class="t-row"><div class="t-dot" style="background:${col}"></div><div class="t-info"><div class="t-title">${E(t.title)}</div><div class="t-meta">${t.subject||'General'} Â· ${new Date(t.updated).toLocaleDateString()}</div></div><span class="pill ${t.status==='completed'?'pd':t.status==='in-progress'?'pi':'pp'}">${t.status}</span></div>`;
  }).join(''):`<div class="empty-s"><div class="ei">ğŸ“‹</div><div class="et">No tasks yet</div><div class="es">Add your first task to get started!</div></div>`;
  // Quick stats
  const subjects={};
  tasks.forEach(t=>{const s=t.subject||'General';if(!subjects[s])subjects[s]={t:0,d:0};subjects[s].t++;if(t.status==='completed')subjects[s].d++;});
  const topS=Object.entries(subjects).sort((a,b)=>b[1].t-a[1].t)[0];
  const quizH=G(`quizHist_${cu.email}`)||[];
  const avgQ=quizH.length?Math.round(quizH.reduce((s,q)=>s+(q.score/q.total*100),0)/quizH.length):null;
  document.getElementById('quickStats').innerHTML=`<div style="display:flex;flex-direction:column;gap:10px">
    <div style="display:flex;justify-content:space-between;font-size:.82rem;padding:6px 0;border-bottom:1px solid var(--border)"><span style="color:var(--tx3)">Completion Rate</span><span style="font-weight:700;color:var(--acc)">${pct}%</span></div>
    <div style="display:flex;justify-content:space-between;font-size:.82rem;padding:6px 0;border-bottom:1px solid var(--border)"><span style="color:var(--tx3)">Overdue Tasks</span><span style="font-weight:700;color:var(--red)">${overdue}</span></div>
    <div style="display:flex;justify-content:space-between;font-size:.82rem;padding:6px 0;border-bottom:1px solid var(--border)"><span style="color:var(--tx3)">Quiz Average</span><span style="font-weight:700;color:var(--green)">${avgQ!==null?avgQ+'%':'â€”'}</span></div>
    <div style="display:flex;justify-content:space-between;font-size:.82rem;padding:6px 0"><span style="color:var(--tx3)">Top Subject</span><span style="font-weight:700;color:var(--tx)">${topS?E(topS[0]):'-'}</span></div>
  </div>`;
  renderStreak7();
  rebuildCharts();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STREAK â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function markStreak(){const k=`streak_${cu.email}`;const s=G(k)||{};s[new Date().toDateString()]=true;S(k,s);}
function getStreakData(){
  const k=`streak_${cu.email}`;const s=G(k)||{};
  tasks.forEach(t=>{if(t.status==='completed'){const d=new Date(t.updated).toDateString();s[d]=true;}});
  return s;
}
function renderStreak7(){
  const s=getStreakData();
  const days=[];
  for(let i=6;i>=0;i--){const d=new Date(Date.now()-i*86400000);days.push({label:d.toLocaleDateString('en',{weekday:'short'}).slice(0,2),done:!!s[d.toDateString()],today:i===0});}
  let streak=0;
  for(let i=0;i<7;i++){if(days[6-i].done)streak++;else if(i>0)break;}
  document.getElementById('streakNum').textContent=streak+'ğŸ”¥';
  document.getElementById('streakDays').innerHTML=days.map(d=>`<div class="s-day"><div class="s-pip${d.done?' on':''}${d.today?' today-pip':''}"></div><div class="s-lbl">${d.label}</div></div>`).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CHARTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function rebuildCharts(){
  const done=tasks.filter(t=>t.status==='completed').length;
  const inProg=tasks.filter(t=>t.status==='in-progress').length;
  const pending=tasks.filter(t=>t.status==='pending').length;
  const cs=getComputedStyle(document.documentElement);
  const acc=cs.getPropertyValue('--acc').trim();
  const green=cs.getPropertyValue('--green').trim();
  const amber=cs.getPropertyValue('--amber').trim();
  const s2=cs.getPropertyValue('--surface2').trim();
  const tx3=cs.getPropertyValue('--tx3').trim();
  const bd=cs.getPropertyValue('--border').trim();
  if(donut)donut.destroy();
  const dc=document.getElementById('donutChart');
  if(dc)donut=new Chart(dc,{type:'doughnut',data:{labels:['Done','Active','Pending'],datasets:[{data:[done,inProg,pending],backgroundColor:[green,acc,s2],borderWidth:0,hoverOffset:4}]},options:{responsive:true,maintainAspectRatio:false,cutout:'68%',plugins:{legend:{position:'bottom',labels:{color:tx3,padding:10,font:{size:10,family:'Outfit'}}}}}});
  const weeks=['Mo','Tu','We','Th','Fr','Sa','Su'];
  const wc=weeks.map((_,i)=>{const d=new Date();const day=d.getDay()||7;const diff=(i+1)-day;const td=new Date(d.getTime()+diff*86400000);return tasks.filter(t=>t.status==='completed'&&new Date(t.updated).toDateString()===td.toDateString()).length;});
  if(bar)bar.destroy();
  const bc=document.getElementById('barChart');
  if(bc)bar=new Chart(bc,{type:'bar',data:{labels:weeks,datasets:[{data:wc,backgroundColor:acc+'40',borderColor:acc,borderWidth:2,borderRadius:6}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{ticks:{color:tx3,font:{size:10}},grid:{display:false}},y:{ticks:{color:tx3,stepSize:1,font:{size:10}},grid:{color:bd}}}}});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• UPCOMING â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderUpcoming(){
  const today=new Date(), in14=new Date(Date.now()+14*86400000);
  const up=tasks.filter(t=>t.due&&t.status!=='completed'&&new Date(t.due+'T00:00:00')<=in14).sort((a,b)=>new Date(a.due)-new Date(b.due));
  const tl=document.getElementById('upcomingTl');
  if(!up.length){tl.innerHTML=`<div class="empty-s"><div class="ei">ğŸ‰</div><div class="et">All clear!</div><div class="es">No deadlines in the next 14 days</div></div>`;return;}
  const groups={};
  up.forEach(t=>{
    const d=new Date(t.due+'T00:00:00');
    const ov=d<today&&d.toDateString()!==today.toDateString();
    const tod=d.toDateString()===today.toDateString();
    const lbl=ov?'âš ï¸ Overdue':tod?'ğŸ“ Today':d.toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric'});
    if(!groups[lbl])groups[lbl]=[];
    groups[lbl].push({...t,_ov:ov,_tod:tod});
  });
  tl.innerHTML=Object.entries(groups).map(([lbl,grp])=>`<div class="tl-group"><div class="tl-lbl">${lbl}</div>${grp.map(t=>`<div class="tl-it"><div class="tl-ind" style="background:${t.priority==='high'?'var(--red)':t.priority==='medium'?'var(--amber)':'var(--green)'}"></div><div class="tl-inf"><div class="tl-t">${E(t.title)}</div><div class="tl-s">${t.subject?E(t.subject)+' Â· ':''}${t.priority} priority</div></div><span class="pill p${t.priority.charAt(0)}">${t.priority}</span></div>`).join('')}</div>`).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PERFORMANCE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderPerf(){
  const total=tasks.length,done=tasks.filter(t=>t.status==='completed').length;
  const high=tasks.filter(t=>t.priority==='high').length;
  const highDone=tasks.filter(t=>t.priority==='high'&&t.status==='completed').length;
  const ov=tasks.filter(isOverdue).length;
  const rate=total?Math.round((done/total)*100):0;
  const grade=rate>=90?'A+':rate>=80?'A':rate>=70?'B':rate>=60?'C':'D';
  const quizH=G(`quizHist_${cu.email}`)||[];
  const avgQ=quizH.length?Math.round(quizH.reduce((s,q)=>s+(q.score/q.total*100),0)/quizH.length):0;
  document.getElementById('perfStats').innerHTML=[
    {v:rate+'%',l:'Completion Rate'},{v:`${highDone}/${high}`,l:'High Priority Done'},{v:ov,l:'Overdue'},{v:grade,l:'Grade'},{v:avgQ+'%',l:'Quiz Average'},{v:quizH.length,l:'Quizzes Taken'},
  ].map((s,i)=>`<div class="ps" style="animation:fadeUp .3s ease ${i*.07}s both"><div class="ps-v">${s.v}</div><div class="ps-l">${s.l}</div></div>`).join('');
  const subjects={};
  tasks.forEach(t=>{const s=t.subject||'General';if(!subjects[s])subjects[s]={t:0,d:0};subjects[s].t++;if(t.status==='completed')subjects[s].d++;});
  document.getElementById('subjBars').innerHTML=Object.entries(subjects).length?Object.entries(subjects).sort((a,b)=>b[1].t-a[1].t).map(([s,v])=>{const p=Math.round((v.d/v.t)*100);return `<div class="subj-bar"><div class="sb-row"><span>${E(s)}</span><span>${v.d}/${v.t} (${p}%)</span></div><div class="sb-track"><div class="sb-fill" style="width:${p}%"></div></div></div>`;}).join(''):'<div style="color:var(--tx3);font-size:.875rem">No subject data yet.</div>';
  // Heatmap
  const s=getStreakData();
  document.getElementById('heatmap').innerHTML=Array(28).fill(0).map((_,i)=>{
    const d=new Date(Date.now()-(27-i)*86400000);
    const cnt=tasks.filter(t=>t.status==='completed'&&new Date(t.updated).toDateString()===d.toDateString()).length;
    const lvl=cnt>=3?3:cnt>=2?2:cnt>=1?1:0;
    return `<div class="hm${lvl?` hm${lvl}`:''}" title="${d.toLocaleDateString()}: ${cnt} tasks" style="animation-delay:${i*.02}s"></div>`;
  }).join('');
  // Quiz history
  const qhEl=document.getElementById('quizHistory');
  qhEl.innerHTML=quizH.length?quizH.slice(-8).reverse().map(q=>{const p=Math.round(q.score/q.total*100);return `<div class="t-row"><div class="t-dot" style="background:${p>=80?'var(--green)':p>=60?'var(--amber)':'var(--red)'}"></div><div class="t-info"><div class="t-title">${E(q.subject)}</div><div class="t-meta">${q.score}/${q.total} correct Â· ${new Date(q.date).toLocaleDateString()}</div></div><span style="font-family:var(--font-display);font-weight:800;color:${p>=80?'var(--green)':p>=60?'var(--amber)':'var(--red)'}">${p}%</span></div>`;}).join(''):`<div class="empty-s"><div class="ei">ğŸ§ </div><div class="et">No quizzes yet</div><div class="es">Take a quiz to see your history</div></div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STREAKS PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderStreaks(){
  renderCal();
  const s=getStreakData();
  const days=Object.keys(s);
  // Calculate current streak
  let cur=0;
  for(let i=0;;i++){const d=new Date(Date.now()-i*86400000).toDateString();if(s[d])cur++;else break;}
  // Best streak
  let best=0,tmp=0,prev=null;
  const sorted=days.sort();
  sorted.forEach(d=>{
    const dt=new Date(d);
    if(prev&&(dt-prev)===86400000){tmp++;best=Math.max(best,tmp);}
    else tmp=1;
    prev=dt;
  });
  const tw=[...Array(7)].filter((_,i)=>{const d=new Date(Date.now()-i*86400000).toDateString();return s[d];}).length;
  document.getElementById('curStreak').textContent=cur;
  document.getElementById('bestStreak').textContent=best||cur;
  document.getElementById('totalDays').textContent=days.length;
  document.getElementById('thisWeek').textContent=tw;
  renderGoals();
}
function renderCal(){
  const s=getStreakData();
  const today=new Date();
  const firstDay=new Date(calYear,calMonth,1).getDay();
  const dim=new Date(calYear,calMonth+1,0).getDate();
  document.getElementById('calMonthLbl').textContent=new Date(calYear,calMonth).toLocaleDateString('en-US',{month:'long',year:'numeric'});
  const dns=['Su','Mo','Tu','We','Th','Fr','Sa'];
  let h=dns.map(d=>`<div class="cal-dn">${d}</div>`).join('');
  for(let i=0;i<firstDay;i++)h+=`<div class="cal-cell other-m"></div>`;
  for(let d=1;d<=dim;d++){
    const dt=new Date(calYear,calMonth,d);
    const isT=dt.toDateString()===today.toDateString();
    const studied=!!s[dt.toDateString()];
    const htasks=tasks.some(t=>t.due&&new Date(t.due+'T00:00:00').toDateString()===dt.toDateString());
    h+=`<div class="cal-cell${isT?' today-cell':''}${studied?' studied':''}${htasks?' has-t':''}">${d}</div>`;
  }
  document.getElementById('calGrid').innerHTML=h;
}
function calPrev(){calMonth--;if(calMonth<0){calMonth=11;calYear--;}renderCal();}
function calNext(){calMonth++;if(calMonth>11){calMonth=0;calYear++;}renderCal();}
function openGoalModal(){document.getElementById('goalSubj').value='';document.getElementById('goalDesc').value='';document.getElementById('goalTarget').value='';document.getElementById('goalDone').value='';document.getElementById('goalModal').classList.add('show');}
function saveGoal(){
  const subj=document.getElementById('goalSubj').value.trim();
  const desc=document.getElementById('goalDesc').value.trim();
  const target=parseFloat(document.getElementById('goalTarget').value)||10;
  const done=parseFloat(document.getElementById('goalDone').value)||0;
  if(!subj)return;
  goals.push({id:Date.now().toString(),subj,desc,target,done,created:Date.now()});
  saveAll();closeModal('goalModal');renderGoals();toast('Goal added!','success');
}
function renderGoals(){
  const el=document.getElementById('goalsGrid');
  if(!goals.length){el.innerHTML=`<div class="empty-s"><div class="ei">ğŸ¯</div><div class="et">No goals yet</div><div class="es">Set a subject goal to track your progress</div></div>`;return;}
  el.innerHTML=goals.map(g=>{
    const pct=Math.min(100,Math.round((g.done/g.target)*100));
    return `<div class="goal-card"><div style="display:flex;align-items:flex-start;justify-content:space-between;gap:6px;margin-bottom:4px"><div><div class="goal-name">${E(g.subj)}</div>${g.desc?`<div style="font-size:.72rem;color:var(--tx3)">${E(g.desc)}</div>`:''}</div><div class="ic-btn del" onclick="delGoal('${g.id}')">âœ•</div></div><div class="goal-bar-w"><div class="goal-bar" style="width:${pct}%"></div></div><div class="goal-meta"><span>${g.done}h / ${g.target}h done</span><span style="color:var(--acc)">${pct}%</span></div></div>`;
  }).join('');
}
function delGoal(id){goals=goals.filter(g=>g.id!==id);saveAll();renderGoals();}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• NOTES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const NOTE_CATS=['','Mathematics','Physics','Computer Science','Chemistry','Biology','English'];
const NOTE_CAT_ICONS={'':'ğŸ“‹','Mathematics':'ğŸ“','Physics':'âš›ï¸','Computer Science':'ğŸ’»','Chemistry':'ğŸ§ª','Biology':'ğŸ§¬','English':'ğŸ“š'};
function renderNotes(){
  const sb=document.getElementById('notesSidebar');
  sb.innerHTML=NOTE_CATS.map(c=>{
    const cnt=c?notes.filter(n=>n.subject===c).length:notes.length;
    return `<button class="note-cat${noteCat===c?' active':''}" onclick="setNoteCat('${c}')">${NOTE_CAT_ICONS[c]||'ğŸ“‹'} ${c||'All Notes'}<span class="note-cat-cnt">${cnt}</span></button>`;
  }).join('');
  const filtered=noteCat?notes.filter(n=>n.subject===noteCat):notes;
  const grid=document.getElementById('notesGrid');
  if(!filtered.length){grid.innerHTML=`<div class="empty-s"><div class="ei">ğŸ“</div><div class="et">No notes here</div><div class="es">Create your first note!</div></div>`;return;}
  grid.innerHTML=filtered.sort((a,b)=>b.updated-a.updated).map(n=>`<div class="note-card"><div class="note-title">${E(n.title||'Untitled')}</div><div class="note-preview">${E(n.content)}</div><div class="note-footer"><span class="note-date">${new Date(n.updated).toLocaleDateString()}</span><div style="display:flex;align-items:center;gap:6px"><span class="note-subj-tag">${E(n.subject||'General')}</span><div class="ic-btn del" onclick="delNote('${n.id}')">âœ•</div></div></div></div>`).join('');
}
function setNoteCat(c){noteCat=c;renderNotes();}
function openNoteEditor(id){
  editNoteId=id||null;
  const n=id?notes.find(n=>n.id===id):null;
  document.getElementById('noteModalTitle').textContent=id?'Edit Note':'New Note';
  document.getElementById('nTitle').value=n?n.title:'';
  document.getElementById('nSubj').value=n?n.subject:'';
  document.getElementById('nContent').value=n?n.content:'';
  document.getElementById('noteModal').classList.add('show');
}
function saveNote(){
  const title=document.getElementById('nTitle').value.trim();
  const subj=document.getElementById('nSubj').value;
  const content=document.getElementById('nContent').value.trim();
  if(!content){toast('Note content cannot be empty','error');return;}
  if(editNoteId){
    const n=notes.find(n=>n.id===editNoteId);
    if(n){n.title=title;n.subject=subj;n.content=content;n.updated=Date.now();}
  } else {
    notes.unshift({id:Date.now().toString(),title,subject:subj,content,created:Date.now(),updated:Date.now()});
  }
  saveAll();closeModal('noteModal');toast('Note saved! ğŸ“','success');renderNotes();
}
function delNote(id){if(!confirm('Delete this note?'))return;notes=notes.filter(n=>n.id!==id);saveAll();renderNotes();}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• QUIZ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const QUIZ_DATA={
  'Mathematics':[
    {q:'What is the derivative of sin(x)?',opts:['cos(x)','-cos(x)','tan(x)','-sin(x)'],ans:0,exp:'The derivative of sin(x) is cos(x) â€” a fundamental calculus identity.'},
    {q:'What is âˆ«xÂ² dx?',opts:['xÂ³/3 + C','2x + C','xÂ²/2 + C','3x + C'],ans:0,exp:'Using the power rule: âˆ«xâ¿ dx = xâ¿âºÂ¹/(n+1) + C, so âˆ«xÂ² dx = xÂ³/3 + C.'},
    {q:'Which of these is a prime number?',opts:['91','57','73','51'],ans:2,exp:'73 is prime. 91=7Ã—13, 57=3Ã—19, 51=3Ã—17.'},
    {q:'What is the value of sin(90Â°)?',opts:['0','1','-1','âˆš2/2'],ans:1,exp:'sin(90Â°) = 1. At 90Â°, the unit circle y-coordinate equals 1.'},
    {q:'If f(x) = 3xÂ² + 2x, what is f\'(x)?',opts:['6x','6x + 2','3x + 2','6xÂ² + 2'],ans:1,exp:'Using power rule: d/dx(3xÂ²) = 6x and d/dx(2x) = 2, so f\'(x) = 6x + 2.'},
    {q:'The sum of angles in a triangle is?',opts:['90Â°','180Â°','270Â°','360Â°'],ans:1,exp:'The interior angles of any triangle always sum to 180Â°.'},
    {q:'What is logâ‚‚(64)?',opts:['4','5','6','8'],ans:2,exp:'logâ‚‚(64) = 6 because 2â¶ = 64.'},
    {q:'Solve: xÂ² - 5x + 6 = 0',opts:['x=1,6','x=2,3','x=-2,-3','x=3,4'],ans:1,exp:'Factor: (x-2)(x-3)=0, so x=2 or x=3.'},
  ],
  'Physics':[
    {q:'What is Newton\'s 2nd Law?',opts:['F = mv','F = ma','E = mcÂ²','p = mv'],ans:1,exp:'Newton\'s 2nd Law: Force = mass Ã— acceleration (F = ma).'},
    {q:'Speed of light in vacuum is approximately?',opts:['3Ã—10â¶ m/s','3Ã—10â¸ m/s','3Ã—10Â¹â° m/s','3Ã—10â´ m/s'],ans:1,exp:'The speed of light c â‰ˆ 3Ã—10â¸ m/s (299,792,458 m/s exactly).'},
    {q:'Ohm\'s Law states that V =?',opts:['IR','I/R','R/I','P/I'],ans:0,exp:'Ohm\'s Law: V = IR, where V=voltage, I=current, R=resistance.'},
    {q:'Kinetic energy formula is?',opts:['mgh','Â½mvÂ²','mv','Fd'],ans:1,exp:'Kinetic energy KE = Â½mvÂ², where m is mass and v is velocity.'},
    {q:'The unit of electric charge is?',opts:['Ampere','Volt','Coulomb','Watt'],ans:2,exp:'The SI unit of electric charge is the Coulomb (C).'},
    {q:'Which type of wave is sound?',opts:['Transverse','Longitudinal','Electromagnetic','Gamma'],ans:1,exp:'Sound waves are longitudinal â€” particles oscillate parallel to wave travel.'},
    {q:'Work done formula is?',opts:['W = F/d','W = Fd cosÎ¸','W = Fd sinÎ¸','W = FÂ²d'],ans:1,exp:'Work W = Fd cosÎ¸, where Î¸ is the angle between force and displacement.'},
    {q:'What is the unit of power?',opts:['Joule','Newton','Watt','Pascal'],ans:2,exp:'Power is measured in Watts (W). 1 Watt = 1 Joule/second.'},
  ],
  'Computer Science':[
    {q:'Big O notation O(log n) represents?',opts:['Linear time','Quadratic time','Logarithmic time','Constant time'],ans:2,exp:'O(log n) is logarithmic time â€” e.g., binary search halves the search space each step.'},
    {q:'What does CPU stand for?',opts:['Central Processing Unit','Computer Processing Unit','Core Processing Unit','Central Program Unit'],ans:0,exp:'CPU = Central Processing Unit â€” the primary processor of a computer.'},
    {q:'Which data structure uses LIFO order?',opts:['Queue','Stack','Heap','Tree'],ans:1,exp:'A Stack uses Last In, First Out (LIFO) order.'},
    {q:'What is the binary value of decimal 12?',opts:['1010','1100','1001','1110'],ans:1,exp:'12 = 8+4 = 1100 in binary.'},
    {q:'HTTP status 404 means?',opts:['Server Error','Unauthorized','Not Found','Redirect'],ans:2,exp:'HTTP 404 means "Not Found" â€” the requested resource doesn\'t exist.'},
    {q:'SQL stands for?',opts:['Structured Query Language','Simple Query Language','Standard Query Logic','System Query Language'],ans:0,exp:'SQL = Structured Query Language, used for database operations.'},
    {q:'Which sorting algorithm has O(n log n) average?',opts:['Bubble Sort','Insertion Sort','Quick Sort','Selection Sort'],ans:2,exp:'Quick Sort averages O(n log n) time complexity through divide-and-conquer.'},
    {q:'RAM is what type of memory?',opts:['Read-Only','Sequential','Random Access','Flash'],ans:2,exp:'RAM = Random Access Memory â€” volatile memory allowing any byte to be accessed directly.'},
  ],
  'Chemistry':[
    {q:'What is the chemical formula for water?',opts:['Hâ‚‚Oâ‚‚','HO','Hâ‚‚O','Hâ‚ƒO'],ans:2,exp:'Water has the formula Hâ‚‚O â€” two hydrogen atoms bonded to one oxygen.'},
    {q:'Atomic number of Carbon is?',opts:['6','12','8','14'],ans:0,exp:'Carbon has atomic number 6 (6 protons). Its atomic mass is ~12.'},
    {q:'pH of a neutral solution is?',opts:['0','7','14','10'],ans:1,exp:'A neutral solution has pH = 7 (neither acidic nor basic).'},
    {q:'What is the valency of Oxygen?',opts:['1','2','3','4'],ans:1,exp:'Oxygen has valency 2 â€” it forms 2 bonds to complete its outer shell.'},
    {q:'Which gas is produced during photosynthesis?',opts:['COâ‚‚','Hâ‚‚','Oâ‚‚','Nâ‚‚'],ans:2,exp:'Plants release oxygen (Oâ‚‚) as a byproduct of photosynthesis.'},
    {q:'Avogadro\'s number is approximately?',opts:['6.02Ã—10Â²Â³','6.02Ã—10Â²Â²','3.14Ã—10Â²Â³','9.8Ã—10Â²Â³'],ans:0,exp:'Avogadro\'s number â‰ˆ 6.022Ã—10Â²Â³ particles per mole.'},
    {q:'NaCl is commonly known as?',opts:['Baking soda','Table salt','Vinegar','Alcohol'],ans:1,exp:'NaCl is sodium chloride â€” common table salt.'},
    {q:'Which is an example of an exothermic reaction?',opts:['Photosynthesis','Dissolution of ammonium nitrate','Combustion of wood','Electrolysis'],ans:2,exp:'Combustion releases heat (exothermic). Photosynthesis absorbs energy (endothermic).'},
  ],
  'Biology':[
    {q:'What is the powerhouse of the cell?',opts:['Nucleus','Ribosome','Mitochondria','Chloroplast'],ans:2,exp:'Mitochondria produce ATP via cellular respiration â€” hence "powerhouse of the cell".'},
    {q:'DNA double helix was discovered by?',opts:['Darwin & Mendel','Watson & Crick','Fleming & Pasteur','Curie & Einstein'],ans:1,exp:'Watson and Crick (with data from Franklin & Wilkins) discovered DNA structure in 1953.'},
    {q:'Which blood cells carry oxygen?',opts:['White blood cells','Platelets','Red blood cells','Plasma'],ans:2,exp:'Red blood cells (erythrocytes) carry oxygen using haemoglobin.'},
    {q:'The process of cell division is called?',opts:['Meiosis only','Mitosis only','Both mitosis & meiosis','Osmosis'],ans:2,exp:'Mitosis (body cells) and meiosis (sex cells) are both forms of cell division.'},
    {q:'Which organ produces insulin?',opts:['Liver','Kidney','Pancreas','Stomach'],ans:2,exp:'The pancreas produces insulin to regulate blood glucose levels.'},
    {q:'Photosynthesis occurs in which organelle?',opts:['Mitochondria','Ribosome','Chloroplast','Nucleus'],ans:2,exp:'Chloroplasts contain chlorophyll and are the site of photosynthesis in plant cells.'},
    {q:'The basic unit of life is?',opts:['Organ','Tissue','Atom','Cell'],ans:3,exp:'The cell is the basic structural and functional unit of all living organisms.'},
    {q:'Normal human body temperature is?',opts:['35Â°C','36.5â€“37.5Â°C','38Â°C','40Â°C'],ans:1,exp:'Normal human body temperature is approximately 36.5â€“37.5Â°C (98.6Â°F).'},
  ],
  'English':[
    {q:'A word that describes a noun is called?',opts:['Verb','Adverb','Adjective','Conjunction'],ans:2,exp:'An adjective describes or modifies a noun (e.g., "the red ball").'},
    {q:'Which is an example of a simile?',opts:['"The moon was a coin."','"She runs like the wind."','"The stars danced."','"Time flew by."'],ans:1,exp:'A simile compares using "like" or "as": "She runs like the wind."'},
    {q:'The main theme of Romeo and Juliet is?',opts:['Adventure','Comedy','Love and conflict','Mystery'],ans:2,exp:'Romeo and Juliet explores love, family conflict, fate, and tragedy.'},
    {q:'What is an antonym of "benevolent"?',opts:['Kind','Generous','Malevolent','Charitable'],ans:2,exp:'"Malevolent" (wishing harm) is the antonym of "benevolent" (wishing good).'},
    {q:'A paragraph\'s main idea is found in the?',opts:['Conclusion','Body sentence','Topic sentence','Supporting detail'],ans:2,exp:'The topic sentence states the main idea of a paragraph, usually at the start.'},
    {q:'Which literary device does "crash, bang, boom" represent?',opts:['Alliteration','Onomatopoeia','Metaphor','Irony'],ans:1,exp:'Onomatopoeia uses words that imitate sounds (crash, bang, boom).'},
    {q:'"To kill two birds with one stone" is an example of?',opts:['Simile','Metaphor','Idiom','Personification'],ans:2,exp:'It\'s an idiom â€” an expression whose meaning differs from its literal words.'},
    {q:'Present perfect tense of "go" is?',opts:['Went','Going','Has gone','Will go'],ans:2,exp:'Present perfect: "has/have + past participle". For "go": has gone.'},
  ],
};
const SUBJ_ICONS={'Mathematics':'ğŸ“','Physics':'âš›ï¸','Computer Science':'ğŸ’»','Chemistry':'ğŸ§ª','Biology':'ğŸ§¬','English':'ğŸ“š'};
function renderQuizSubjects(){
  const grid=document.getElementById('quizSubjectsGrid');
  const quizH=G(`quizHist_${cu.email}`)||[];
  grid.innerHTML=Object.keys(QUIZ_DATA).map(s=>{
    const lastQ=quizH.filter(q=>q.subject===s).slice(-1)[0];
    const lastScore=lastQ?Math.round(lastQ.score/lastQ.total*100)+'%':'â€”';
    return `<div class="quiz-subj-card${quizSubject===s?' selected':''}" onclick="selectQuizSubj('${s}',this)">
      <div class="quiz-subj-icon">${SUBJ_ICONS[s]||'ğŸ“š'}</div>
      <div class="quiz-subj-name">${s}</div>
      <div class="quiz-subj-cnt">8 questions Â· Last: ${lastScore}</div>
    </div>`;
  }).join('');
}
function selectQuizSubj(s,el){
  quizSubject=s;
  document.querySelectorAll('.quiz-subj-card').forEach(c=>c.classList.remove('selected'));
  el.classList.add('selected');
  document.getElementById('startQuizBtn').disabled=false;
}
function startQuiz(){
  if(!quizSubject)return;
  quizQs=[...QUIZ_DATA[quizSubject]].sort(()=>Math.random()-.5).slice(0,8);
  quizIdx=0;quizScore=0;
  document.getElementById('quizSubjectSelect').style.display='none';
  document.getElementById('quizResult').style.display='none';
  document.getElementById('quizArea').classList.add('show');
  renderQuestion();
}
function renderQuestion(){
  const q=quizQs[quizIdx];
  quizAnswered=false;
  document.getElementById('quizQNum').textContent=`Question ${quizIdx+1}/${quizQs.length}`;
  document.getElementById('quizScore').textContent=quizScore;
  document.getElementById('quizProgFill').style.width=(quizIdx/quizQs.length*100)+'%';
  document.getElementById('quizQ').textContent=q.q;
  document.getElementById('quizOpts').innerHTML=q.opts.map((o,i)=>`<button class="quiz-opt" onclick="answerQ(${i})">${o}</button>`).join('');
  document.getElementById('quizExp').classList.remove('show');
  document.getElementById('quizNextBtn').style.display='none';
}
function answerQ(idx){
  if(quizAnswered)return;
  quizAnswered=true;
  const q=quizQs[quizIdx];
  const opts=document.querySelectorAll('.quiz-opt');
  opts.forEach((o,i)=>{o.classList.add('locked');if(i===q.ans)o.classList.add('correct');else if(i===idx)o.classList.add('wrong');});
  if(idx===q.ans)quizScore++;
  document.getElementById('quizScore').textContent=quizScore;
  const expEl=document.getElementById('quizExp');
  expEl.textContent=q.exp;
  expEl.classList.add('show');
  document.getElementById('quizNextBtn').style.display='block';
  document.getElementById('quizNextBtn').textContent=quizIdx===quizQs.length-1?'See Results â†’':'Next Question â†’';
}
function nextQuestion(){
  quizIdx++;
  if(quizIdx>=quizQs.length){showQuizResult();return;}
  renderQuestion();
}
function showQuizResult(){
  document.getElementById('quizArea').classList.remove('show');
  document.getElementById('quizResult').style.display='block';
  const pct=Math.round(quizScore/quizQs.length*100);
  document.getElementById('quizFinalScore').textContent=`${quizScore}/${quizQs.length}`;
  const msgs=['Keep practising â€” you\'ve got this! ğŸ’ª','Good effort! Review the explanations. ğŸ“š','Solid work! You\'re getting there. ğŸ‘','Great job! Almost there! ğŸŒŸ','Excellent! Outstanding performance! ğŸ†'];
  document.getElementById('quizFinalMsg').textContent=msgs[Math.min(4,Math.floor(pct/20))];
  markStreak();
  // Save history
  const quizH=G(`quizHist_${cu.email}`)||[];
  quizH.push({subject:quizSubject,score:quizScore,total:quizQs.length,date:Date.now()});
  S(`quizHist_${cu.email}`,quizH);
  toast(`Quiz done! ${pct}% â€” ${quizScore}/${quizQs.length} correct ğŸ“`,'success');
}
function retakeQuiz(){quizIdx=0;quizScore=0;quizQs=[...QUIZ_DATA[quizSubject]].sort(()=>Math.random()-.5).slice(0,8);document.getElementById('quizResult').style.display='none';document.getElementById('quizArea').classList.add('show');renderQuestion();}
function resetQuiz(){document.getElementById('quizArea').classList.remove('show');document.getElementById('quizResult').style.display='none';document.getElementById('quizSubjectSelect').style.display='block';quizSubject=null;document.getElementById('startQuizBtn').disabled=true;renderQuizSubjects();}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• AI TOOLS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function switchAITool(tool,el){
  document.querySelectorAll('.ai-tool-panel').forEach(p=>p.classList.remove('show'));
  document.querySelectorAll('.ai-tool-tab').forEach(b=>b.classList.remove('active'));
  document.getElementById('tool-'+tool).classList.add('show');
  el.classList.add('active');
}
function predictPerf(){
  const sliders=document.querySelectorAll('#tool-predictor input[type="range"]');
  const [hours,quiz,asgn,att,interest]=Array.from(sliders).map(s=>parseFloat(s.value));
  const score=Math.round((hours*5+quiz*0.4+asgn*0.2+att*0.2+interest*3)*100/((12*5+100*0.4+100*0.2+100*0.2+10*3)));
  const pct=Math.min(98,Math.max(40,score));
  const grade=pct>=90?'A+':pct>=80?'A':pct>=70?'B':pct>=60?'C':'D';
  const tips=[];
  if(hours<4)tips.push('ğŸ“š Increase daily study to 4+ hours for best results');
  if(quiz<70)tips.push('ğŸ§  Practice more quizzes to boost retention');
  if(asgn<80)tips.push('ğŸ“‹ Submit all assignments â€” they significantly impact your grade');
  if(att<85)tips.push('ğŸ« Improve attendance â€” class participation is crucial');
  if(interest<6)tips.push('ğŸ’¡ Find ways to engage more with the subject material');
  document.getElementById('predictResult').innerHTML=`<div class="result-card"><div class="result-badge">âœ¨ Your AI Prediction</div><div class="result-big">${pct}%</div><div style="font-family:var(--font-display);font-size:1.3rem;font-weight:800;color:var(--purple);margin-bottom:12px">Grade: ${grade}</div><div class="result-msg">${tips.length?'<strong>To improve:</strong><br>'+tips.join('<br>'):'ğŸŒŸ Excellent profile! Keep up the amazing work!'}</div></div>`;
}
function adaptDifficulty(){
  const score=parseFloat(document.getElementById('df-score').value);
  const time=parseFloat(document.getElementById('df-time').value);
  const err=parseFloat(document.getElementById('df-err').value);
  const comp=parseFloat(document.getElementById('df-comp').value);
  const lvlScore=(score*0.4+(100-err)*0.3+comp*0.2+(60-Math.min(60,time))/60*100*0.1);
  const level=lvlScore>=80?'Advanced ğŸš€':lvlScore>=65?'Intermediate ğŸ“ˆ':lvlScore>=45?'Beginner+ ğŸŒ±':'Beginner ğŸŒ±';
  const advice=lvlScore>=80?'You\'re ready for challenging problems. Try past papers and competitive math.'
    :lvlScore>=65?'Focus on application problems and real-world examples.'
    :lvlScore>=45?'Strengthen your fundamentals with guided practice.'
    :'Start with basic concepts and build confidence step by step.';
  document.getElementById('diffResult').innerHTML=`<div class="result-card"><div class="result-badge">ğŸ® Recommended Level</div><div class="result-big" style="font-size:1.8rem">${level}</div><div class="result-msg" style="margin-top:8px">${advice}</div><div style="margin-top:12px;font-size:.8rem;color:var(--tx3)">Score: ${Math.round(lvlScore)}/100</div></div>`;
}
function buildPlan(){
  const diff=parseInt(document.getElementById('pl-diff').value);
  const know=parseInt(document.getElementById('pl-know').value);
  const days=parseInt(document.getElementById('pl-days').value);
  const target=parseInt(document.getElementById('pl-target').value);
  const dailyHrs=Math.max(1,Math.round(((diff*(10-know)*0.5)+(target/10))));
  const phases=[
    {label:'Foundation',pct:.3,activity:'Core concepts, key definitions, and theory review'},
    {label:'Practice',pct:.4,activity:'Problem sets, worked examples, and past questions'},
    {label:'Revision',pct:.2,activity:'Full topic review, identifying and fixing weak spots'},
    {label:'Mock Tests',pct:.1,activity:'Timed practice under exam conditions'},
  ];
  let planHtml=`<div class="result-card"><div class="result-badge">ğŸ“… Your Study Plan</div><div style="margin-bottom:16px;font-size:.88rem;color:var(--tx2)"><strong>${days} days</strong> Â· <strong>${dailyHrs}h/day</strong> recommended Â· Target: <strong>${target}%</strong></div>`;
  let dayStart=1;
  phases.forEach(p=>{
    const pDays=Math.max(1,Math.round(days*p.pct));
    planHtml+=`<div class="plan-day"><div class="plan-day-num">D${dayStart}</div><div class="plan-day-info"><div class="plan-day-title">${p.label} Phase</div><div class="plan-day-sub">${p.activity}</div></div><div class="plan-day-hrs">${dailyHrs}h/day</div></div>`;
    dayStart+=pDays;
  });
  planHtml+='</div>';
  document.getElementById('planResult').innerHTML=planHtml;
}
function detectStyle(){
  const vis=parseInt(document.getElementById('ls-vis').value);
  const aud=parseInt(document.getElementById('ls-aud').value);
  const rw=parseInt(document.getElementById('ls-rw').value);
  const kin=parseInt(document.getElementById('ls-kin').value);
  const scores={Visual:vis,Auditory:aud,'Read/Write':rw,Kinesthetic:kin};
  const top=Object.entries(scores).sort((a,b)=>b[1]-a[1]);
  const [primary,secondary]=top;
  const tips={Visual:'Use diagrams, mind maps, colour coding, and visual summaries.',Auditory:'Record lectures, discuss topics aloud, use podcasts and verbal revision.',
    'Read/Write':'Take detailed notes, rewrite key points, use lists and definitions.',Kinesthetic:'Learn by doing â€” use practice problems, projects, and hands-on activities.'};
  const icons={Visual:'ğŸ‘€',Auditory:'ğŸµ','Read/Write':'ğŸ“',Kinesthetic:'ğŸ¤¸'};
  document.getElementById('styleResult').innerHTML=`<div class="result-card">
    <div class="result-badge">ğŸ¨ Your Learning Style</div>
    <div class="result-big" style="font-size:2rem">${icons[primary[0]]} ${primary[0]}</div>
    <div style="margin:8px 0 12px;font-size:.85rem;color:var(--tx3)">Secondary: ${secondary[0]}</div>
    <div class="result-msg"><strong>Study Tip:</strong> ${tips[primary[0]]}</div>
    <div style="margin-top:16px;display:grid;grid-template-columns:1fr 1fr;gap:8px">
      ${top.map(([s,v])=>`<div style="background:var(--surface);border-radius:var(--r-sm);padding:10px;text-align:center"><div style="font-size:.7rem;color:var(--tx3);margin-bottom:4px">${s}</div><div style="font-family:var(--font-display);font-weight:800;color:var(--acc)">${v}/10</div></div>`).join('')}
    </div></div>`;
}
const ALL_TOPICS=['Algebra','Calculus','Statistics','Geometry','Mechanics','Electromagnetism','Thermodynamics','Quantum Physics','Data Structures','Algorithms','Machine Learning','Databases','Organic Chemistry','Inorganic Chemistry','Physical Chemistry','Cell Biology','Genetics','Ecology','Evolution','Grammar','Literature','Creative Writing','Poetry'];
function renderTopicCheckGrid(){
  const el=document.getElementById('topicCheckGrid');
  if(!el)return;
  el.innerHTML=ALL_TOPICS.map(t=>`<label style="display:flex;align-items:center;gap:8px;padding:10px;background:var(--surface);border:1.5px solid var(--border);border-radius:var(--r-sm);cursor:pointer;transition:all .15s;font-size:.82rem;font-weight:500;color:var(--tx2)" onmouseover="this.style.borderColor='var(--acc)'" onmouseout="this.style.borderColor=this.querySelector('input').checked?'var(--acc)':'var(--border)'"><input type="checkbox" ${topicsDone.includes(t)?'checked':''} onchange="toggleTopic('${t}')"/> ${t}</label>`).join('');
}
function toggleTopic(t){if(topicsDone.includes(t))topicsDone=topicsDone.filter(x=>x!==t);else topicsDone.push(t);S(`topics_${cu.email}`,topicsDone);}
function getTopicRecs(){
  const remaining=ALL_TOPICS.filter(t=>!topicsDone.includes(t));
  if(!remaining.length){document.getElementById('topicRecResult').innerHTML=`<div class="result-card"><div class="result-big" style="font-size:1.5rem">ğŸ† Amazing!</div><div class="result-msg">You've covered all available topics! Time for revision and mock tests.</div></div>`;return;}
  const recs=remaining.slice(0,5);
  document.getElementById('topicRecResult').innerHTML=`<div class="result-card"><div class="result-badge">ğŸŒŸ Recommended Next Topics</div><div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">${recs.map((t,i)=>`<div class="plan-day"><div class="plan-day-num">${i+1}</div><div class="plan-day-info"><div class="plan-day-title">${t}</div></div><span class="pill pi">Recommended</span></div>`).join('')}</div>${remaining.length>5?`<div style="font-size:.78rem;color:var(--tx3);margin-top:10px">+${remaining.length-5} more topics remaining</div>`:''}</div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• POMODORO â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderPomodoro(){
  const sel=document.getElementById('pomoTaskSel');
  if(sel){sel.innerHTML='<option value="">â€” Select a task (optional) â€”</option>'+tasks.filter(t=>t.status!=='completed').map(t=>`<option value="${t.id}">${E(t.title)}</option>`).join('');}
  updatePomoDisplay();
}
function setPomoPhase(phase,el){
  pomoPhase=phase;pomoLeft=pomoTimes[phase]*60;pomoTotal=pomoLeft;
  pomoRunning=false;clearInterval(pomoTimer);
  document.getElementById('pomoPlayBtn').textContent='â–¶';
  document.querySelectorAll('.pomo-mode-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  const fill=document.getElementById('pomoFill');
  if(fill)fill.style.stroke=phase==='focus'?'var(--acc)':phase==='short'?'var(--green)':'var(--purple)';
  updatePomoDisplay();
}
function pomoToggle(){
  if(pomoRunning){pomoRunning=false;clearInterval(pomoTimer);document.getElementById('pomoPlayBtn').textContent='â–¶';if(document.getElementById('focusPlayBtn'))document.getElementById('focusPlayBtn').textContent='â–¶';}
  else{pomoRunning=true;document.getElementById('pomoPlayBtn').textContent='â¸';if(document.getElementById('focusPlayBtn'))document.getElementById('focusPlayBtn').textContent='â¸';
    pomoTimer=setInterval(()=>{
      pomoLeft--;
      if(pomoPhase==='focus')pomoFocused++;
      updatePomoDisplay();syncFocus();
      if(pomoLeft<=0){
        clearInterval(pomoTimer);pomoRunning=false;
        document.getElementById('pomoPlayBtn').textContent='â–¶';
        if(pomoPhase==='focus'){pomoSessions++;markStreak();toast('Focus session done! ğŸ‰ Take a break.','success');addNotif('Pomodoro complete! Take a break.');}
        else{pomoBreaks++;toast('Break over! Ready to focus? ğŸ’ª','info');}
        updatePomoDisplay();
      }
    },1000);
  }
  syncFocus();
}
function pomoReset(){clearInterval(pomoTimer);pomoRunning=false;pomoLeft=pomoTimes[pomoPhase]*60;pomoTotal=pomoLeft;document.getElementById('pomoPlayBtn').textContent='â–¶';updatePomoDisplay();syncFocus();}
function pomoSkip(){
  clearInterval(pomoTimer);pomoRunning=false;document.getElementById('pomoPlayBtn').textContent='â–¶';
  const phases=['focus','short','long'];const next=phases[(phases.indexOf(pomoPhase)+1)%phases.length];
  const btn=document.querySelector(`.pomo-mode-btn:nth-child(${phases.indexOf(next)+1})`);
  if(btn)setPomoPhase(next,btn);
}
function updatePomoDisplay(){
  const m=Math.floor(pomoLeft/60),s=pomoLeft%60;
  const ts=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  ['pomoTime'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent=ts;});
  const ml={focus:'Focus Session',short:'Short Break',long:'Long Break'};
  const mi=document.getElementById('pomoModeLabel');if(mi)mi.textContent=ml[pomoPhase];
  const pct=pomoLeft/pomoTotal;
  const fill=document.getElementById('pomoFill');
  if(fill)fill.style.strokeDashoffset=628*(1-pct);
  ['pomoStatSessions','pomoStatTime','pomoStatBreaks'].forEach((id,i)=>{
    const el=document.getElementById(id);
    if(el)el.textContent=i===0?pomoSessions:i===1?Math.round(pomoFocused/60)+'m':pomoBreaks;
  });
  const sr=document.getElementById('pomoSessRow');
  if(sr)sr.innerHTML=Array(4).fill(0).map((_,i)=>`<div class="pomo-s-dot${i<pomoSessions?' done':i===pomoSessions?' cur':''}"></div>`).join('');
  document.title=pomoRunning?`${ts} â€” StudyBot`:'StudyBot â€” Study Smarter';
}
function syncFocus(){
  const m=Math.floor(pomoLeft/60),s=pomoLeft%60;
  const ts=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  const ft=document.getElementById('focusTime');if(ft)ft.textContent=ts;
  const fm=document.getElementById('focusMode');if(fm)fm.textContent={focus:'Focus',short:'Short Break',long:'Long Break'}[pomoPhase];
  const ff=document.getElementById('focusFill');if(ff)ff.style.strokeDashoffset=628*(1-pomoLeft/pomoTotal);
  const fpb=document.getElementById('focusPlayBtn');if(fpb)fpb.textContent=pomoRunning?'â¸':'â–¶';
}
function enterFocus(){
  const sel=document.getElementById('pomoTaskSel');
  const t=sel&&sel.value?tasks.find(t=>t.id===sel.value):null;
  const lbl=document.getElementById('focusTaskLbl');
  if(lbl)lbl.textContent=t?t.title:'Deep Focus Session';
  document.getElementById('focusOv').classList.add('show');
  focusActive=true;syncFocus();
}
function exitFocus(){document.getElementById('focusOv').classList.remove('show');focusActive=false;document.title='StudyBot â€” Study Smarter';}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• NOTIFICATIONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function addNotif(title){if(!cu)return;notifs.unshift({id:Date.now().toString(),title,time:Date.now(),read:false});S(`notifs_${cu.email}`,notifs);updateNotifDot();}
function checkNotifs(){
  if(!cu)return;
  notifs=G(`notifs_${cu.email}`)||[];
  const today=new Date().toDateString(),tom=new Date(Date.now()+86400000).toDateString();
  tasks.forEach(t=>{
    if(!t.due||t.status==='completed')return;
    const due=new Date(t.due+'T00:00:00').toDateString();
    const exists=notifs.find(n=>n.title.includes(t.title.slice(0,15))&&n.time>Date.now()-86400000);
    if(!exists){if(due===today)addNotif(`ğŸ“ Due today: "${t.title}"`);else if(due===tom)addNotif(`â° Due tomorrow: "${t.title}"`);else if(isOverdue(t))addNotif(`âš ï¸ Overdue: "${t.title}"`);}
  });
  updateNotifDot();renderNotifList();
}
function updateNotifDot(){const unread=notifs.filter(n=>!n.read).length;const d=document.getElementById('notifDot');if(d)d.classList.toggle('show',unread>0);}
function renderNotifList(){const l=document.getElementById('npList');if(!l)return;if(!notifs.length){l.innerHTML='<div style="padding:24px;text-align:center;color:var(--tx3);font-size:.84rem">No notifications</div>';return;}l.innerHTML=notifs.slice(0,12).map(n=>`<div class="np-it${n.read?'':' unrd'}"><div class="np-it-t">${E(n.title)}</div><div class="np-it-s">${new Date(n.time).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</div></div>`).join('');}
function toggleNotif(){notifs.forEach(n=>n.read=true);S(`notifs_${cu.email}`,notifs);updateNotifDot();renderNotifList();document.getElementById('notifPanel').classList.toggle('show');}
function clearNotifs(){notifs=[];S(`notifs_${cu.email}`,notifs);updateNotifDot();renderNotifList();document.getElementById('notifPanel').classList.remove('show');}
document.addEventListener('click',e=>{
  const np=document.getElementById('notifPanel'),nb=document.getElementById('notifBtn');
  if(np&&nb&&!np.contains(e.target)&&!nb.contains(e.target))np.classList.remove('show');
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOAST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toast(msg,type='info'){
  const t=document.createElement('div');
  t.className=`toast t${type.charAt(0)}`;
  const icons={success:'âœ…',error:'âŒ',info:'â„¹ï¸'};
  t.innerHTML=`${icons[type]||'â„¹ï¸'} ${E(msg)}`;
  document.getElementById('toasts').appendChild(t);
  setTimeout(()=>{t.style.animation='toastOut .3s ease forwards';setTimeout(()=>t.remove(),300);},3200);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• KEYBOARD INIT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('lPass')?.addEventListener('keydown',e=>{if(e.key==='Enter')handleLogin();});
document.getElementById('rPass')?.addEventListener('keydown',e=>{if(e.key==='Enter')handleRegister();});
</script>
</body>
</html>